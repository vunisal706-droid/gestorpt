<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a5f4a">
    <title>Gestor PE v3</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='110' fill='%231a5f4a'/%3E%3Crect x='100' y='70' width='220' height='300' rx='20' fill='white'/%3E%3Ccircle cx='160' cy='140' r='16' fill='%2322c55e'/%3E%3Ccircle cx='370' cy='350' r='100' fill='%23f59e0b'/%3E%3Ccircle cx='370' cy='350' r='80' fill='white'/%3E%3Cpath d='M370 290v60h50' stroke='%231a5f4a' stroke-width='12' stroke-linecap='round' fill='none'/%3E%3C/svg%3E">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root{--primary:#1a5f4a;--primary-light:#2d8a6e;--primary-dark:#134536;--bg:#f5f7f6;--bg-card:#fff;--text:#1a2a24;--text-light:#5a6b64;--border:#d4ddd9;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444;--proceso:#3b82f6;--shadow:0 4px 20px rgba(26,95,74,0.1);--radius:16px;--radius-sm:10px}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
        .header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:12px 16px;position:sticky;top:0;z-index:100}
        .header-content{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
        .header h1{font-size:1.1rem;cursor:pointer}
        .status{display:flex;align-items:center;gap:5px;font-size:.7rem;background:rgba(255,255,255,.2);padding:4px 10px;border-radius:20px}
        .status-dot{width:8px;height:8px;border-radius:50%;background:var(--warning)}
        .status-dot.ok{background:var(--success)}
        .container{max-width:1200px;margin:0 auto;padding:14px}
        .screen{display:none}.screen.active{display:block}
        .card{background:var(--bg-card);border-radius:var(--radius);padding:16px;margin-bottom:12px;box-shadow:var(--shadow)}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px}
        .card-title{font-size:1rem;font-weight:700;color:var(--primary)}
        .btn{padding:10px 14px;border:none;border-radius:var(--radius-sm);font-family:inherit;font-size:.85rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:4px}
        .btn-primary{background:var(--primary);color:#fff}
        .btn-secondary{background:var(--bg);color:var(--text);border:2px solid var(--border)}
        .btn-danger{background:var(--danger);color:#fff}
        .btn-warning{background:var(--warning);color:#fff}
        .btn-ai{background:#10a37f;color:#fff}
        .btn-sm{padding:7px 10px;font-size:.75rem}
        .btn-group{display:flex;gap:6px;flex-wrap:wrap}
        .nav-tabs{display:flex;gap:8px;margin-bottom:16px}
        .nav-tab{padding:12px 20px;border:none;background:var(--bg-card);color:var(--text-light);font-family:inherit;font-size:.9rem;font-weight:600;cursor:pointer;border-radius:var(--radius);box-shadow:var(--shadow)}
        .nav-tab.active{background:var(--primary);color:#fff}
        .alumnos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin-top:12px}
        .alumno-card{background:var(--bg-card);border-radius:var(--radius);padding:16px 10px;text-align:center;cursor:pointer;border:2px solid transparent;box-shadow:var(--shadow)}
        .alumno-card:hover{border-color:var(--primary-light)}
        .alumno-siglas{font-family:monospace;font-size:1.3rem;font-weight:700;color:var(--primary)}
        .alumno-curso{font-size:.75rem;color:var(--text-light)}
        .alumno-progs{font-size:.65rem;color:var(--primary);margin-top:4px}
        .alumno-card-add{background:transparent;border:2px dashed var(--primary-light);color:var(--primary);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:85px}
        .tabs{display:flex;gap:4px;background:var(--bg-card);padding:4px;border-radius:var(--radius);margin-bottom:14px;overflow-x:auto}
        .tab{flex:1;padding:9px 8px;border:none;background:transparent;color:var(--text-light);font-family:inherit;font-size:.75rem;font-weight:600;cursor:pointer;border-radius:var(--radius-sm);white-space:nowrap}
        .tab.active{background:var(--primary);color:#fff}
        .tab-content{display:none}.tab-content.active{display:block}
        .form-group{margin-bottom:12px}
        .form-label{display:block;font-weight:600;margin-bottom:4px;font-size:.8rem}
        .form-input,.form-select,.form-textarea{width:100%;padding:10px 12px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:inherit;font-size:16px}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--primary)}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000;padding:14px}
        .modal-overlay.active{display:flex}
        .modal{background:var(--bg-card);border-radius:var(--radius);width:100%;max-width:500px;max-height:85vh;overflow-y:auto}
        .modal-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-title{font-size:.95rem;font-weight:700}
        .modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-light)}
        .modal-body{padding:16px}
        .modal-footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:6px}
        .dias-btns{display:flex;gap:6px;margin-top:5px}
        .dia-btn{width:42px;height:42px;border:2px solid var(--border);border-radius:var(--radius-sm);background:#fff;font-weight:600;cursor:pointer}
        .dia-btn.active{border-color:var(--primary);background:rgba(26,95,74,.15);color:var(--primary)}
        .programa-card{background:var(--bg);border-radius:var(--radius-sm);padding:12px;margin-bottom:10px;border-left:4px solid var(--primary)}
        .programa-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .programa-titulo{font-weight:600;font-size:.9rem}
        .objetivo-card{background:#fff;border-radius:8px;padding:10px;margin-bottom:8px}
        .objetivo-header{display:flex;gap:5px;margin-bottom:5px;align-items:center}
        .objetivo-num{font-family:monospace;font-size:.7rem;font-weight:600;padding:2px 5px;border-radius:4px;background:rgba(26,95,74,.15);color:var(--primary)}
        .trimestre-badge{font-size:.65rem;padding:2px 5px;border-radius:4px;font-weight:600}
        .t1{background:#8b5cf620;color:#8b5cf6}.t2{background:#06b6d420;color:#06b6d4}.t3{background:#f59e0b20;color:#f59e0b}
        .objetivo-desc{font-size:.8rem}
        .indicadores-list{font-size:.75rem;margin-top:6px;padding-top:6px;border-top:1px solid var(--border);list-style:none}
        .indicadores-list li{padding:2px 0}
        .cuadrante-nav{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}
        .nav-btn{width:34px;height:34px;border:2px solid var(--border);background:#fff;border-radius:8px;cursor:pointer}
        .cuadrante-table{width:100%;border-collapse:collapse;font-size:.75rem}
        .cuadrante-table th,.cuadrante-table td{border:1px solid var(--border);padding:5px;text-align:left;vertical-align:top}
        .cuadrante-table th{background:var(--primary);color:#fff;text-align:center}
        .cuadrante-table td:first-child{background:var(--primary-light);color:#fff;text-align:center;width:40px}
        .celda{min-height:50px;cursor:pointer;position:relative}
        .celda:hover{background:var(--bg)}
        .celda-vacia{background:#f9fafb;color:var(--text-light)}
        .celda-obj{font-weight:600;color:var(--primary);font-size:.7rem}
        .celda-ind{font-size:.6rem;color:var(--text)}
        .celda-ausencia{background:#fee2e2!important}
        .celda-sincole{background:#e0e7ff!important}
        .celda-icon{position:absolute;top:2px;right:2px;font-size:.6rem}
        .upload-zone{border:2px dashed var(--border);border-radius:var(--radius-sm);padding:20px;text-align:center;cursor:pointer;background:var(--bg)}
        .upload-zone.has-file{border-color:var(--success);background:rgba(34,197,94,.1)}
        .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--text);color:#fff;padding:10px 18px;border-radius:var(--radius-sm);font-weight:500;opacity:0;transition:all .3s;z-index:2000}
        .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
        .toast.success{background:var(--success)}
        .toast.error{background:var(--danger)}
        .empty-state{text-align:center;padding:25px;color:var(--text-light)}
        .leyenda{display:flex;gap:12px;flex-wrap:wrap;font-size:.7rem;margin-top:8px}
        .leyenda-item{display:flex;align-items:center;gap:4px}
        .leyenda-color{width:12px;height:12px;border-radius:3px}
        .alumno-header{display:flex;align-items:center;gap:12px;margin-bottom:14px;flex-wrap:wrap}
        .alumno-header-siglas{font-family:monospace;font-size:1.5rem;font-weight:700;color:var(--primary);background:rgba(26,95,74,.1);padding:10px 16px;border-radius:var(--radius)}
        .stats-box{display:flex;gap:10px;flex-wrap:wrap;padding:10px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:12px}
        .stat-item{text-align:center;padding:8px 12px;background:#fff;border-radius:8px;min-width:70px;flex:1}
        .stat-num{font-size:1.3rem;font-weight:700}
        .stat-label{font-size:.65rem;color:var(--text-light)}
        .eval-item{display:flex;align-items:center;gap:6px;padding:8px;background:var(--bg);border-radius:6px;margin-bottom:5px;flex-wrap:wrap}
        .eval-text{flex:1;font-size:.8rem;min-width:140px}
        .eval-btn{width:32px;height:32px;border-radius:50%;border:2px solid var(--border);background:#fff;cursor:pointer;font-size:.85rem}
        .eval-btn.c{border-color:var(--success);color:var(--success)}
        .eval-btn.c.active{background:var(--success);color:#fff}
        .eval-btn.p{border-color:var(--proceso);color:var(--proceso)}
        .eval-btn.p.active{background:var(--proceso);color:#fff}
        .eval-btn.n{border-color:#888;color:#888}
        .eval-btn.n.active{background:#888;color:#fff}
        .asist-btns{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
        .asist-btn{flex:1;padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer;text-align:center;min-width:80px}
        .asist-btn.selected{border-width:3px}
        .asist-btn.asiste.selected{border-color:var(--success);background:rgba(34,197,94,.1)}
        .asist-btn.ausencia.selected{border-color:var(--danger);background:rgba(239,68,68,.1)}
        .asist-btn.sincole.selected{border-color:#6366f1;background:rgba(99,102,241,.1)}
        .resultado-btns{display:flex;gap:8px;margin-top:10px}
        .resultado-btn{flex:1;padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer;text-align:center;font-size:.8rem}
        .resultado-btn.selected{border-width:3px}
        .resultado-btn.conseguido.selected{border-color:var(--success);background:rgba(34,197,94,.1)}
        .resultado-btn.repetir.selected{border-color:var(--warning);background:rgba(245,158,11,.1)}
        .chart-container{background:#fff;border-radius:var(--radius-sm);padding:12px;margin-bottom:12px}
        .chart-container canvas{max-height:200px}
        .informe-preview{background:#fff;border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-top:12px;font-size:.85rem;max-height:400px;overflow-y:auto}
        .pasado-badge{font-size:.6rem;background:#fef3c7;color:#92400e;padding:1px 4px;border-radius:3px;margin-left:4px}
        .print-option{padding:12px;border:2px solid var(--border);border-radius:var(--radius-sm);margin-bottom:8px;cursor:pointer;transition:all .2s}
        .print-option:hover{border-color:var(--primary);background:rgba(26,95,74,.05)}
        .print-option h4{margin-bottom:4px;color:var(--primary)}
        .print-option p{font-size:.8rem;color:var(--text-light)}
        .filtros{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
        .filtros select{padding:8px 12px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.85rem}
        .plantilla-card{background:var(--bg-card);border-radius:var(--radius);padding:14px;margin-bottom:10px;box-shadow:var(--shadow);cursor:pointer;border:2px solid transparent;transition:all .2s}
        .plantilla-card:hover{border-color:var(--primary-light)}
        .plantilla-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
        .plantilla-titulo{font-weight:700;color:var(--primary);font-size:.95rem}
        .plantilla-meta{display:flex;gap:6px;flex-wrap:wrap}
        .plantilla-badge{font-size:.65rem;padding:3px 8px;border-radius:12px;font-weight:600}
        .badge-area{background:#dcfce7;color:#166534}
        .plantilla-stats{font-size:.75rem;color:var(--text-light)}
        .ciclo-infantil{background:#fce7f3;color:#be185d}
        .ciclo-ciclo1{background:#dbeafe;color:#1e40af}
        .ciclo-ciclo2{background:#d1fae5;color:#065f46}
        .ciclo-ciclo3{background:#fef3c7;color:#92400e}
        @media print{.no-print{display:none!important}body{background:#fff}.card{box-shadow:none;border:1px solid #ddd}}
        /* SÃ‰NECA STYLES */
        .seneca-programa{background:var(--bg-card);border-radius:var(--radius);padding:16px;margin-bottom:16px;box-shadow:var(--shadow);border-left:5px solid var(--primary)}
        .seneca-programa-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid var(--primary)}
        .seneca-programa-titulo{font-size:1.1rem;font-weight:700;color:var(--primary)}
        .seneca-objetivo{background:var(--bg);border-radius:var(--radius-sm);padding:14px;margin-bottom:12px}
        .seneca-objetivo-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .seneca-objetivo-titulo{font-weight:600;color:var(--text)}
        .seneca-seccion{background:#fff;border-radius:8px;padding:12px;margin-bottom:8px;border:1px solid var(--border)}
        .seneca-seccion-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .seneca-seccion-titulo{font-weight:600;font-size:.85rem;color:var(--primary-dark)}
        .seneca-contenido{font-size:.8rem;color:var(--text);line-height:1.5;white-space:pre-wrap}
        .btn-copiar{padding:5px 10px;font-size:.7rem;background:var(--primary);color:#fff;border:none;border-radius:6px;cursor:pointer;display:inline-flex;align-items:center;gap:4px}
        .btn-copiar:hover{background:var(--primary-dark)}
        .btn-copiar.copiado{background:var(--success)}
        .btn-copiar-sm{padding:4px 8px;font-size:.65rem;min-width:32px}
        .seneca-indicadores-lista{display:flex;flex-direction:column;gap:6px}
        .seneca-indicador-item{display:flex;align-items:center;gap:8px;padding:8px 10px;background:#fff;border-radius:6px;border:1px solid var(--border)}
        .seneca-indicador-num{font-weight:700;color:var(--primary);min-width:20px;text-align:center;font-size:.8rem}
        .seneca-indicador-texto{flex:1;font-size:.8rem;color:var(--text)}
        .seneca-info{background:#e0f2fe;padding:12px;border-radius:8px;font-size:.8rem;color:#0369a1;margin-bottom:16px}
    </style>
</head>
<body>
    <header class="header no-print">
        <div class="header-content">
            <h1 onclick="volverInicio()">ğŸ“‹ Gestor PE v3</h1>
            <div class="status"><div class="status-dot" id="statusDot"></div><span id="statusText">Conectando...</span></div>
        </div>
    </header>

    <div id="screenInicio" class="screen active">
        <div class="container">
            <div class="nav-tabs no-print">
                <button class="nav-tab active" onclick="cambiarSeccion('alumnos',this)">ğŸ‘¥ Alumnos</button>
                <button class="nav-tab" onclick="cambiarSeccion('estadisticas',this)">ğŸ“Š EstadÃ­sticas</button>
                <button class="nav-tab" onclick="cambiarSeccion('biblioteca',this)">ğŸ“š Biblioteca</button>
            </div>
            <div id="seccionAlumnos">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ğŸ‘¥ Mis Alumnos</h2>
                        <div class="btn-group">
                            <button class="btn btn-secondary btn-sm" onclick="abrirModalImprimir()">ğŸ–¨ï¸</button>
                            <button class="btn btn-primary btn-sm" onclick="abrirModalNuevo()">â• Nuevo</button>
                        </div>
                    </div>
                    <div class="alumnos-grid" id="alumnosGrid"></div>
                </div>
            </div>
            <div id="seccionEstadisticas" style="display:none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ğŸ“Š EstadÃ­sticas Globales</h2>
                    </div>
                    <div class="chart-container"><canvas id="chartRanking"></canvas></div>
                    <div class="chart-container" style="margin-top:12px"><canvas id="chartDistAreas"></canvas></div>
                </div>
                
                <div class="card" style="margin-top:12px">
                    <div class="card-header">
                        <h2 class="card-title">ğŸ“‹ Informes de EvaluaciÃ³n</h2>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Selecciona trimestre para el informe:</label>
                        <select id="trimestreInforme" class="form-select">
                            <option value="todos">ğŸ“Š Todos los trimestres (comparativa completa)</option>
                            <option value="1">ğŸ“— Trimestre 1</option>
                            <option value="2">ğŸ“˜ Trimestre 2</option>
                            <option value="3">ğŸ“™ Trimestre 3</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="imprimirInformeEvaluacion()">ğŸ–¨ï¸ Generar Informe con GrÃ¡ficas</button>
                </div>
            </div>
            <div id="seccionBiblioteca" style="display:none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ğŸ“š Biblioteca de Plantillas</h2>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm" onclick="abrirModalNuevaPlantilla()">â• Nueva</button>
                        </div>
                    </div>
                    <div class="filtros">
                        <select id="filtroCiclo" onchange="renderBiblioteca()">
                            <option value="">Todos los ciclos</option>
                            <option value="infantil">ğŸ’’ Infantil</option>
                            <option value="ciclo1">ğŸ”µ 1Âº Ciclo</option>
                            <option value="ciclo2">ğŸŸ¢ 2Âº Ciclo</option>
                            <option value="ciclo3">ğŸŸ  3Âº Ciclo</option>
                        </select>
                        <select id="filtroArea" onchange="renderBiblioteca()">
                            <option value="">Todas las Ã¡reas</option>
                            <option value="psicomotor">Desarrollo Psicomotor</option>
                            <option value="motor">Desarrollo Motor</option>
                            <option value="comunicativo">Desarrollo Comunicativo</option>
                            <option value="cognitivo">Desarrollo Cognitivo</option>
                            <option value="social">Desarrollo Social-Emocional</option>
                            <option value="autonomia">AutonomÃ­a Personal</option>
                            <option value="tdah">TDAH</option>
                        </select>
                    </div>
                    <div id="bibliotecaGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="screenAlumno" class="screen">
        <div class="container">
            <div class="alumno-header" id="alumnoHeader"></div>
            <div class="tabs no-print">
                <button class="tab active" onclick="cambiarTab('programas')">ğŸ“„ Programas</button>
                <button class="tab" onclick="cambiarTab('programacion')">ğŸ“… ProgramaciÃ³n</button>
                <button class="tab" onclick="cambiarTab('evaluacion')">ğŸ“Š EvaluaciÃ³n</button>
                <button class="tab" onclick="cambiarTab('asistencia')">ğŸ“ˆ Resumen</button>
                <button class="tab" onclick="cambiarTab('seneca')">ğŸ›ï¸ SÃ©neca</button>
            </div>
            <div id="tabProgramas" class="tab-content active"></div>
            <div id="tabProgramacion" class="tab-content"></div>
            <div id="tabEvaluacion" class="tab-content"></div>
            <div id="tabAsistencia" class="tab-content"></div>
            <div id="tabSeneca" class="tab-content"></div>
        </div>
    </div>

    <!-- MODALES -->
    <div class="modal-overlay" id="modalNuevo">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">â• Nuevo Alumno</h3><button class="modal-close" onclick="cerrarModal('modalNuevo')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Siglas *</label><input type="text" class="form-input" id="nuevoSiglas" placeholder="M.G.L." maxlength="10"></div>
                    <div class="form-group"><label class="form-label">Curso *</label><select class="form-select" id="nuevoCurso"><option value="infantil">Infantil 3 aÃ±os</option><option value="infantil">Infantil 4 aÃ±os</option><option value="infantil" selected>Infantil 5 aÃ±os</option><option value="ciclo1">1Âº Primaria</option><option value="ciclo1">2Âº Primaria</option><option value="ciclo2">3Âº Primaria</option><option value="ciclo2">4Âº Primaria</option><option value="ciclo3">5Âº Primaria</option><option value="ciclo3">6Âº Primaria</option></select></div>
                </div>
                <div class="form-group"><label class="form-label">DÃ­as de sesiÃ³n</label><div class="dias-btns" id="diasBtns"><button type="button" class="dia-btn" data-dia="0" onclick="toggleDia(0)">L</button><button type="button" class="dia-btn active" data-dia="1" onclick="toggleDia(1)">M</button><button type="button" class="dia-btn" data-dia="2" onclick="toggleDia(2)">X</button><button type="button" class="dia-btn active" data-dia="3" onclick="toggleDia(3)">J</button><button type="button" class="dia-btn active" data-dia="4" onclick="toggleDia(4)">V</button></div></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalNuevo')">Cancelar</button><button class="btn btn-primary" onclick="crearAlumno()">âœ“ Crear</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalAddProg">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸ“„ AÃ±adir Programa</h3><button class="modal-close" onclick="cerrarModal('modalAddProg')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Seleccionar de biblioteca</label>
                    <select class="form-select" id="selPlantilla" onchange="previsualizarPlantilla()">
                        <option value="">-- Elegir plantilla --</option>
                    </select>
                </div>
                <div id="previewPlantilla" style="display:none;margin-top:12px;padding:12px;background:var(--bg);border-radius:8px;font-size:.8rem;max-height:200px;overflow-y:auto"></div>
                <hr style="margin:16px 0;border:none;border-top:1px solid var(--border)">
                <p style="font-size:.8rem;color:var(--text-light);margin-bottom:10px">O crear manualmente:</p>
                <div class="form-group"><label class="form-label">Tipo de programa</label><select class="form-select" id="addProgTipo" onchange="cambioTipoProg()"><option value="">Seleccionar...</option><option value="psicomotor">ğŸƒ Desarrollo Psicomotor</option><option value="motor">âœ‹ Desarrollo Motor</option><option value="comunicativo">ğŸ’¬ Desarrollo Comunicativo</option><option value="cognitivo">ğŸ§  Desarrollo Cognitivo</option><option value="social">â¤ï¸ Desarrollo Social-Emocional</option><option value="autonomia">ğŸ¯ AutonomÃ­a Personal</option><option value="tdah">âš¡ TDAH</option><option value="lectoescritura">ğŸ“– Lectoescritura (predefinido)</option></select></div>
                <div id="zonaDocx"><div class="form-group"><label class="form-label">Importar DOCX</label><div class="upload-zone" id="uploadZone" onclick="document.getElementById('inputFile').click()">ğŸ“„ Toca para seleccionar</div><input type="file" id="inputFile" accept=".docx" style="display:none" onchange="cargarDocx(this)"></div><div class="form-group"><label class="form-label">O pegar texto</label><textarea class="form-input" id="addProgTexto" rows="3" placeholder="OBJETIVO 1: ..."></textarea></div><button class="btn btn-secondary btn-sm" onclick="analizarTexto()">ğŸ” Analizar</button></div>
                <div id="zonaLecto" style="display:none"><div style="background:var(--bg);padding:12px;border-radius:8px"><strong>ğŸ“– Programa predefinido</strong><p style="font-size:.8rem;color:var(--text-light)">Vocales y consonantes</p></div></div>
                <div id="previewProg" style="display:none;margin-top:12px;padding:10px;background:var(--bg);border-radius:8px;font-size:.8rem"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalAddProg')">Cancelar</button><button class="btn btn-primary" onclick="addPrograma()">ğŸ“¥ AÃ±adir</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalCelda">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title" id="celdaTitulo">SesiÃ³n</h3><button class="modal-close" onclick="cerrarModal('modalCelda')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Estado</label><div class="asist-btns"><button type="button" class="asist-btn asiste" onclick="setEstado('asiste',this)">âœ… Asiste</button><button type="button" class="asist-btn ausencia" onclick="setEstado('ausencia',this)">âŒ Ausencia</button><button type="button" class="asist-btn sincole" onclick="setEstado('sincole',this)">ğŸ« Sin cole</button></div></div>
                <div id="contenidoSesion">
                    <div class="form-group"><label class="form-label">Programa</label><select class="form-select" id="selPrograma" onchange="cargarObjetivos()"></select></div>
                    <div class="form-group"><label class="form-label">Objetivo</label><select class="form-select" id="selObjetivo" onchange="cargarIndicadores()"></select></div>
                    <div class="form-group"><label class="form-label">Indicador</label><select class="form-select" id="selIndicador"></select></div>
                    <div class="form-group"><label class="form-label">Resultado</label><div class="resultado-btns"><button type="button" class="resultado-btn conseguido" onclick="setResultado('conseguido',this)">âœ… Conseguido</button><button type="button" class="resultado-btn repetir" onclick="setResultado('repetir',this)">ğŸ”„ Repetir</button></div></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-danger btn-sm" onclick="borrarCelda()">ğŸ—‘ï¸</button><button class="btn btn-secondary" onclick="cerrarModal('modalCelda')">Cancelar</button><button class="btn btn-primary" onclick="guardarCelda()">ğŸ’¾ Guardar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalInforme">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title">ğŸ“„ Generar Informe</h3><button class="modal-close" onclick="cerrarModal('modalInforme')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Trimestre</label><select class="form-select" id="informeTrim"><option value="1">1Âº Trimestre</option><option value="2">2Âº Trimestre</option><option value="3">3Âº Trimestre</option></select></div>
                    <div class="form-group"><label class="form-label">PerÃ­odo</label><select class="form-select" id="informePeriodo"><option value="trimestral">Trimestral</option><option value="mensual">Mensual</option></select></div>
                </div>
                <div class="form-group" id="grupoMes" style="display:none"><label class="form-label">Mes</label><select class="form-select" id="informeMes"></select></div>
                <div class="btn-group" style="flex-direction:column;gap:8px">
                    <button class="btn btn-primary" onclick="generarInforme()">ğŸ“„ Generar Informe PT</button>
                    <button class="btn btn-ai" onclick="abrirChatGPTInforme('pt')">ğŸ¤– ChatGPT - ValoraciÃ³n PT</button>
                    <hr style="border:none;border-top:1px solid var(--border);margin:4px 0">
                    <button class="btn btn-ai" onclick="abrirChatGPTInforme('familia')" style="background:#8b5cf6">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ChatGPT - Informe Familias</button>
                    <button class="btn btn-ai" onclick="abrirChatGPTInforme('tutor')" style="background:#06b6d4">ğŸ‘©â€ğŸ« ChatGPT - Informe Tutor</button>
                </div>
                <div id="informePreview" class="informe-preview" style="display:none"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalInforme')">Cerrar</button><button class="btn btn-primary" id="btnImprimirInforme" onclick="imprimirInforme()" style="display:none">ğŸ–¨ï¸ Imprimir</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalImportJSON">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title">ğŸ“¥ Importar JSON</h3><button class="modal-close" onclick="cerrarModal('modalImportJSON')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Pega el JSON:</label><textarea class="form-textarea" id="jsonInput" rows="10"></textarea></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalImportJSON')">Cancelar</button><button class="btn btn-primary" onclick="importarJSON()">ğŸ“¥ Importar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalImprimir">
        <div class="modal" style="max-width:500px">
            <div class="modal-header"><h3 class="modal-title">ğŸ–¨ï¸ Imprimir</h3><button class="modal-close" onclick="cerrarModal('modalImprimir')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Mes</label><select class="form-select" id="printMes"><option value="-1">ğŸ“… Todo el curso</option><option value="0">Septiembre</option><option value="1">Octubre</option><option value="2">Noviembre</option><option value="3">Diciembre</option><option value="4">Enero</option><option value="5">Febrero</option><option value="6">Marzo</option><option value="7">Abril</option><option value="8">Mayo</option><option value="9">Junio</option></select></div>
                <div class="print-option" onclick="imprimirCompacto()"><h4>ğŸ“„ Imprimir compacto + valoraciÃ³n</h4><p>Programaciones juntas + hoja de indicadores para valorar</p></div>
                <div class="print-option" onclick="imprimirTodos()"><h4>ğŸ–¨ï¸ Imprimir separado</h4><p>Cada alumno en una pÃ¡gina distinta</p></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalImprimir')">Cerrar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalPlantilla">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title" id="modalPlantillaTitulo">ğŸ“š Plantilla</h3><button class="modal-close" onclick="cerrarModal('modalPlantilla')">Ã—</button></div>
            <div class="modal-body" id="modalPlantillaBody"></div>
            <div class="modal-footer" id="modalPlantillaFooter"></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalNuevaPlantilla">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title">â• Nueva Plantilla</h3><button class="modal-close" onclick="cerrarModal('modalNuevaPlantilla')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Nombre *</label><input type="text" class="form-input" id="plantillaNombre"></div>
                    <div class="form-group"><label class="form-label">Ciclo *</label><select class="form-select" id="plantillaCiclo"><option value="infantil">Infantil</option><option value="ciclo1">1Âº Ciclo</option><option value="ciclo2">2Âº Ciclo</option><option value="ciclo3">3Âº Ciclo</option></select></div>
                </div>
                <div class="form-group"><label class="form-label">Ãrea *</label><select class="form-select" id="plantillaArea"><option value="psicomotor">Desarrollo Psicomotor</option><option value="motor">Desarrollo Motor</option><option value="comunicativo">Desarrollo Comunicativo</option><option value="cognitivo">Desarrollo Cognitivo</option><option value="social">Desarrollo Social-Emocional</option><option value="autonomia">AutonomÃ­a Personal</option><option value="tdah">TDAH</option></select></div>
                <div class="form-group"><label class="form-label">Importar DOCX o pegar texto</label><div class="upload-zone" id="uploadZonePlantilla" onclick="document.getElementById('inputFilePlantilla').click()">ğŸ“„ Toca para seleccionar</div><input type="file" id="inputFilePlantilla" accept=".docx" style="display:none" onchange="cargarDocxPlantilla(this)"></div>
                <div class="form-group"><textarea class="form-input" id="plantillaTexto" rows="5" placeholder="OBJETIVO 1: ..."></textarea></div>
                <button class="btn btn-secondary btn-sm" onclick="analizarTextoPlantilla()">ğŸ” Analizar</button>
                <div id="previewPlantillaNueva" style="display:none;margin-top:12px;padding:10px;background:var(--bg);border-radius:8px;font-size:.8rem"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalNuevaPlantilla')">Cancelar</button><button class="btn btn-primary" id="btnGuardarPlantilla" onclick="guardarNuevaPlantilla()" disabled>ğŸ’¾ Guardar</button></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        firebase.initializeApp({databaseURL:"https://gestorpt-7946b-default-rtdb.europe-west1.firebasedatabase.app"});
        const db=firebase.database();
        let alumnos={},plantillas={},alumnoActual=null,mesActual=0,diasSel=[1,3,4],celdaEditando=null,docExtraido=null,docExtraidoPlantilla=null,estadoCelda='asiste',resultadoCelda=null,evalTrim=1,charts={},informeData=null;
        
        const CICLOS={infantil:{nombre:'Infantil',icon:'ğŸ’’'},ciclo1:{nombre:'1Âº Ciclo',icon:'ğŸ”µ'},ciclo2:{nombre:'2Âº Ciclo',icon:'ğŸŸ¢'},ciclo3:{nombre:'3Âº Ciclo',icon:'ğŸŸ '}};
        const AREAS={psicomotor:{nombre:'Desarrollo Psicomotor',icon:'ğŸƒ',color:'#8b5cf6'},motor:{nombre:'Desarrollo Motor',icon:'âœ‹',color:'#06b6d4'},comunicativo:{nombre:'Desarrollo Comunicativo',icon:'ğŸ’¬',color:'#10b981'},cognitivo:{nombre:'Desarrollo Cognitivo',icon:'ğŸ§ ',color:'#3b82f6'},social:{nombre:'Desarrollo Social-Emocional',icon:'â¤ï¸',color:'#ec4899'},autonomia:{nombre:'AutonomÃ­a Personal',icon:'ğŸ¯',color:'#f59e0b'},lectoescritura:{nombre:'Lectoescritura',icon:'ğŸ“–',color:'#6366f1'},tdah:{nombre:'TDAH',icon:'âš¡',color:'#f97316'}};
        const MESES=[{nombre:'Septiembre',semanas:3,trim:1},{nombre:'Octubre',semanas:4,trim:1},{nombre:'Noviembre',semanas:4,trim:1},{nombre:'Diciembre',semanas:2,trim:1},{nombre:'Enero',semanas:3,trim:2},{nombre:'Febrero',semanas:4,trim:2},{nombre:'Marzo',semanas:3,trim:2},{nombre:'Abril',semanas:3,trim:3},{nombre:'Mayo',semanas:4,trim:3},{nombre:'Junio',semanas:3,trim:3}];
        const DIAS=['Lunes','Martes','MiÃ©rcoles','Jueves','Viernes'],DIAS_C=['L','M','X','J','V'];
        const LECTO=['A','E','I','O','U','M','P','S','L','T','N','D','F','B','V','J','R','C','Q','G','H','CH','Ã‘','Y','LL','Z','X','K','W'].map((l,i)=>({numero:i+1,descripcion:'Letra '+l,trimestre:i<10?1:(i<20?2:3),indicadores:['Reconoce '+l,'Traza '+l,'Lee sÃ­labas con '+l]}));
        
        // PLANTILLAS BASE - 12 plantillas completas
        const PLANTILLAS_BASE = [
            {nombre:'Desarrollo Cognitivo',ciclo:'infantil',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Mejorar atenciÃ³n sostenida',trimestre:1,indicadores:['Mantiene atenciÃ³n 3 min','Sigue con mirada objetos','Permanece sentado en actividad','Atiende a cuentos breves']},
                {numero:2,descripcion:'Desarrollar atenciÃ³n selectiva',trimestre:1,indicadores:['Discrimina figura-fondo','Localiza objetos en imÃ¡genes','Identifica sonidos del entorno','Selecciona objetos por color']},
                {numero:3,descripcion:'Mejorar memoria visual',trimestre:1,indicadores:['Recuerda 2-3 imÃ¡genes','Encuentra objeto escondido','Empareja imÃ¡genes iguales','Completa puzzles 4-6 piezas']},
                {numero:4,descripcion:'Desarrollar memoria auditiva',trimestre:1,indicadores:['Repite secuencia 2 sonidos','Sigue instrucciones 1 paso','Recuerda nombres compaÃ±eros','Reproduce ritmos sencillos']},
                {numero:5,descripcion:'Mejorar percepciÃ³n visual',trimestre:1,indicadores:['Discrimina colores bÃ¡sicos','Reconoce formas geomÃ©tricas','Identifica grande-pequeÃ±o','Completa series 2 elementos']},
                {numero:6,descripcion:'Desarrollar razonamiento bÃ¡sico',trimestre:2,indicadores:['Clasifica por un atributo','Agrupa objetos iguales','Identifica diferente en grupo','Ordena por tamaÃ±o 3 objetos']},
                {numero:7,descripcion:'Mejorar orientaciÃ³n espacial',trimestre:2,indicadores:['Identifica arriba-abajo','Reconoce dentro-fuera','SitÃºa delante-detrÃ¡s','Sigue caminos sencillos']},
                {numero:8,descripcion:'Desarrollar orientaciÃ³n temporal',trimestre:2,indicadores:['Diferencia dÃ­a-noche','Conoce rutinas diarias','Ordena secuencia 2 imÃ¡genes','Identifica antes-despuÃ©s']},
                {numero:9,descripcion:'Ampliar atenciÃ³n conjunta',trimestre:2,indicadores:['SeÃ±ala objeto de interÃ©s','Comparte atenciÃ³n con adulto','Mira donde seÃ±ala otro','Responde a su nombre']},
                {numero:10,descripcion:'Mejorar funciones ejecutivas',trimestre:2,indicadores:['Espera turno con apoyo','Inhibe respuesta ante STOP','Cambia actividad sin rabieta','Sigue rutina 2 pasos']},
                {numero:11,descripcion:'Desarrollar pensamiento simbÃ³lico',trimestre:3,indicadores:['Juega a ser otro personaje','Usa objeto como si fuera otro','Imita acciones cotidianas','Representa con plastilina']},
                {numero:12,descripcion:'Mejorar resoluciÃ³n problemas',trimestre:3,indicadores:['Busca objeto no visible','Usa herramienta para alcanzar','Pide ayuda cuando necesita','Intenta varias soluciones']},
                {numero:13,descripcion:'Ampliar conocimiento entorno',trimestre:3,indicadores:['Nombra animales comunes','Identifica alimentos bÃ¡sicos','Reconoce transportes','Conoce partes del cuerpo']},
                {numero:14,descripcion:'Desarrollar creatividad',trimestre:3,indicadores:['Garabatea con intenciÃ³n','Construye con bloques','Experimenta con materiales','Propone juegos nuevos']},
                {numero:15,descripcion:'Generalizar aprendizajes',trimestre:3,indicadores:['Aplica en otros contextos','Transfiere a casa','Recuerda tras vacaciones','Muestra progreso acumulado']}
            ]},
            {nombre:'Desarrollo Cognitivo',ciclo:'ciclo1',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Mejorar atenciÃ³n sostenida',trimestre:1,indicadores:['Mantiene atenciÃ³n 10 min','Finaliza tareas cortas','Trabaja sin distraerse','Sigue explicaciones grupales']},
                {numero:2,descripcion:'Desarrollar atenciÃ³n selectiva',trimestre:1,indicadores:['Localiza diferencias','Busca elementos especÃ­ficos','Filtra informaciÃ³n relevante','Sigue instrucciones con distractores']},
                {numero:3,descripcion:'Mejorar memoria de trabajo',trimestre:1,indicadores:['Retiene 3-4 instrucciones','Opera mentalmente con nÃºmeros','Recuerda inicio de frase','Mantiene informaciÃ³n trabajando']},
                {numero:4,descripcion:'Ampliar memoria largo plazo',trimestre:1,indicadores:['Recuerda contenidos anteriores','Evoca vocabulario aprendido','Relaciona con previos','Aplica procedimientos']},
                {numero:5,descripcion:'Mejorar percepciÃ³n visual',trimestre:1,indicadores:['Discrimina letras similares','Reconoce palabras globalmente','Percibe detalles en imÃ¡genes','Copia figuras con precisiÃ³n']},
                {numero:6,descripcion:'Desarrollar razonamiento lÃ³gico',trimestre:2,indicadores:['Clasifica por 2 atributos','Establece causa-efecto','Resuelve problemas sencillos','Completa series numÃ©ricas']},
                {numero:7,descripcion:'Mejorar organizaciÃ³n espacial',trimestre:2,indicadores:['SitÃºa izquierda-derecha','Interpreta planos sencillos','Reproduce en cuadrÃ­cula','Describe posiciones objetos']},
                {numero:8,descripcion:'Desarrollar organizaciÃ³n temporal',trimestre:2,indicadores:['Ordena secuencias 4 imÃ¡genes','Conoce dÃ­as semana','SitÃºa ayer-hoy-maÃ±ana','Estima duraciones cortas']},
                {numero:9,descripcion:'Mejorar planificaciÃ³n',trimestre:2,indicadores:['Organiza material','Sigue pasos en orden','Anticipa lo que necesita','Divide tarea en partes']},
                {numero:10,descripcion:'Desarrollar flexibilidad cognitiva',trimestre:2,indicadores:['Acepta cambios de plan','Considera alternativas','Corrige errores sin frustrar','Adapta estrategia']},
                {numero:11,descripcion:'Mejorar comprensiÃ³n verbal',trimestre:3,indicadores:['Entiende instrucciones complejas','Comprende textos cortos','Responde preguntas literales','Identifica idea principal']},
                {numero:12,descripcion:'Desarrollar expresiÃ³n verbal',trimestre:3,indicadores:['Explica procedimientos','Narra ordenadamente','Usa vocabulario adecuado','Formula preguntas coherentes']},
                {numero:13,descripcion:'Ampliar razonamiento numÃ©rico',trimestre:3,indicadores:['Comprende valor posicional','Resuelve suma/resta','Estima cantidades','Usa estrategias cÃ¡lculo']},
                {numero:14,descripcion:'Mejorar metacogniciÃ³n',trimestre:3,indicadores:['Identifica quÃ© sabe/no sabe','Pide aclaraciones','Revisa su trabajo','Valora su esfuerzo']},
                {numero:15,descripcion:'Generalizar aprendizajes',trimestre:3,indicadores:['Aplica en otras Ã¡reas','Transfiere a casa','Mantiene logros','Muestra autonomÃ­a creciente']}
            ]},
            {nombre:'Desarrollo Social-Emocional',ciclo:'infantil',tipo:'social',objetivos:[
                {numero:1,descripcion:'Desarrollar conciencia emocional',trimestre:1,indicadores:['Identifica alegrÃ­a','Reconoce tristeza','Expresa enfado bÃ¡sico','Identifica miedo']},
                {numero:2,descripcion:'Reconocer emociones en otros',trimestre:1,indicadores:['Identifica caras alegres','Reconoce tristeza otros','Detecta enfado en otros','Responde a llanto']},
                {numero:3,descripcion:'Mejorar regulaciÃ³n emocional',trimestre:1,indicadores:['Acepta consuelo adulto','Usa objeto de apego','Se calma con estrategias','Tolera pequeÃ±as frustraciones']},
                {numero:4,descripcion:'Desarrollar vÃ­nculo adultos',trimestre:1,indicadores:['Busca proximidad adulto','Acepta separaciÃ³n','Muestra preferencia figuras','Comparte con adulto']},
                {numero:5,descripcion:'Iniciar relaciÃ³n iguales',trimestre:1,indicadores:['Muestra interÃ©s otros niÃ±os','Juega al lado de otros','Observa juego compaÃ±eros','Acepta presencia otros']},
                {numero:6,descripcion:'Desarrollar juego social',trimestre:2,indicadores:['Participa juego paralelo','Comparte espacio juego','Imita compaÃ±eros','Inicia interacciÃ³n simple']},
                {numero:7,descripcion:'Mejorar comunicaciÃ³n social',trimestre:2,indicadores:['Saluda con apoyo','Se despide','Responde cuando llaman','Pide por favor']},
                {numero:8,descripcion:'Desarrollar conductas prosociales',trimestre:2,indicadores:['Ayuda a recoger','Ofrece objeto a otro','Muestra preocupaciÃ³n','Consuela bÃ¡sico']},
                {numero:9,descripcion:'Mejorar tolerancia frustraciÃ³n',trimestre:2,indicadores:['Espera turno apoyo visual','Acepta no ser primero','Tolera perder','Acepta lÃ­mites adulto']},
                {numero:10,descripcion:'Desarrollar autoconcepto',trimestre:2,indicadores:['Dice su nombre','Reconoce pertenencias','Muestra logros','Expresa preferencias']},
                {numero:11,descripcion:'Ampliar juego cooperativo',trimestre:3,indicadores:['Participa con otros','Acepta propuestas','Sigue reglas simples','Comparte materiales']},
                {numero:12,descripcion:'Mejorar resoluciÃ³n conflictos',trimestre:3,indicadores:['Pide ayuda ante conflicto','Acepta mediaciÃ³n','Usa palabras no pegar','Propone soluciÃ³n']},
                {numero:13,descripcion:'Desarrollar empatÃ­a bÃ¡sica',trimestre:3,indicadores:['PreocupaciÃ³n otro triste','Ofrece ayuda espontÃ¡nea','Adapta conducta','Celebra logros otros']},
                {numero:14,descripcion:'Ampliar autonomÃ­a emocional',trimestre:3,indicadores:['Expresa emociones verbal','Pide lo que necesita','Acepta ayuda','Orgullo por logros']},
                {numero:15,descripcion:'Generalizar habilidades',trimestre:3,indicadores:['Aplica en recreo','Conductas en casa','InteractÃºa adultos','Mantiene amistades']}
            ]},
            {nombre:'Desarrollo Social-Emocional',ciclo:'ciclo1',tipo:'social',objetivos:[
                {numero:1,descripcion:'Ampliar vocabulario emocional',trimestre:1,indicadores:['Nombra emociones bÃ¡sicas','Describe situaciones','Usa palabras emocionales','Diferencia intensidad']},
                {numero:2,descripcion:'Mejorar conciencia emocional',trimestre:1,indicadores:['Identifica emociones propias','Reconoce cambios','Relaciona situaciÃ³n-emociÃ³n','Expresa cÃ³mo se siente']},
                {numero:3,descripcion:'Desarrollar regulaciÃ³n emocional',trimestre:1,indicadores:['Usa relajaciÃ³n simple','Aplica respiraciÃ³n','Busca lugar tranquilo','Pide ayuda para regular']},
                {numero:4,descripcion:'Mejorar tolerancia frustraciÃ³n',trimestre:1,indicadores:['Acepta errores sin rabieta','Sigue tras fracaso','Espera turno','Acepta no ganar']},
                {numero:5,descripcion:'Desarrollar autoestima',trimestre:1,indicadores:['Reconoce fortalezas','Acepta dificultades','Orgullo por logros','Habla positivamente']},
                {numero:6,descripcion:'Mejorar conversaciÃ³n',trimestre:2,indicadores:['Inicia conversaciÃ³n','Mantiene tema','Respeta turnos palabra','Hace preguntas']},
                {numero:7,descripcion:'Desarrollar asertividad',trimestre:2,indicadores:['Expresa opiniones','Defiende derechos','Dice no apropiadamente','Pide lo que necesita']},
                {numero:8,descripcion:'Mejorar cooperaciÃ³n',trimestre:2,indicadores:['Trabaja en equipo','Aporta al grupo','Acepta ideas otros','Celebra logros grupales']},
                {numero:9,descripcion:'Desarrollar empatÃ­a',trimestre:2,indicadores:['Reconoce emociones otros','Se pone en lugar','Ofrece consuelo','Adapta conducta']},
                {numero:10,descripcion:'Mejorar resoluciÃ³n conflictos',trimestre:2,indicadores:['Identifica problema','Propone soluciones','Negocia','Acepta compromiso']},
                {numero:11,descripcion:'Desarrollar amistad',trimestre:3,indicadores:['Inicia amistades','Comparte con amigos','Ayuda a amigos','Resuelve conflictos amigos']},
                {numero:12,descripcion:'Mejorar conducta grupo',trimestre:3,indicadores:['Sigue normas grupales','Participa activamente','Respeta opiniones','Contribuye clima positivo']},
                {numero:13,descripcion:'Desarrollar responsabilidad',trimestre:3,indicadores:['Asume consecuencias','Cumple compromisos','Cuida materiales','Ayuda sin pedir']},
                {numero:14,descripcion:'Ampliar regulaciÃ³n conductual',trimestre:3,indicadores:['Controla impulsos','Piensa antes actuar','Sigue normas solo','Se autorregula']},
                {numero:15,descripcion:'Generalizar competencias',trimestre:3,indicadores:['Aplica en contextos','Mejora en casa','Relaciones positivas','Gestiona emociones']}
            ]},
            {nombre:'Desarrollo Comunicativo',ciclo:'infantil',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Desarrollar intenciÃ³n comunicativa',trimestre:1,indicadores:['Usa gestos comunicar','SeÃ±ala para pedir','Muestra objetos','Busca atenciÃ³n adulto']},
                {numero:2,descripcion:'Ampliar comprensiÃ³n verbal',trimestre:1,indicadores:['Comprende palabras familiares','Sigue Ã³rdenes simples','Identifica objetos','Responde sÃ­/no']},
                {numero:3,descripcion:'Mejorar expresiÃ³n oral',trimestre:1,indicadores:['Emite vocalizaciones','Produce primeras palabras','Nombra objetos','Pide mediante palabra']},
                {numero:4,descripcion:'Desarrollar vocabulario',trimestre:1,indicadores:['Comprende 50+ palabras','Produce 10+ palabras','Aprende nuevas','Usa nombres cercanos']},
                {numero:5,descripcion:'Mejorar articulaciÃ³n',trimestre:1,indicadores:['Produce vocales','Articula consonantes iniciales','Produce sÃ­labas directas','Inteligible cercanos']},
                {numero:6,descripcion:'Ampliar estructura frases',trimestre:2,indicadores:['Combina dos palabras','Usa frase 3 elementos','Usa artÃ­culos','Incorpora verbos']},
                {numero:7,descripcion:'Desarrollar comprensiÃ³n oraciones',trimestre:2,indicadores:['Comprende Ã³rdenes 2 pasos','Entiende quÃ©/quiÃ©n','Sigue instrucciones','Comprende negaciones']},
                {numero:8,descripcion:'Mejorar pragmÃ¡tica',trimestre:2,indicadores:['Saluda apropiadamente','Responde a saludos','Participa intercambios','Mantiene tema breve']},
                {numero:9,descripcion:'Desarrollar narraciÃ³n',trimestre:2,indicadores:['Cuenta experiencias','Secuencia 2 eventos','Describe imÃ¡genes','Responde sobre cuentos']},
                {numero:10,descripcion:'Ampliar comprensiÃ³n cuentos',trimestre:2,indicadores:['Atiende cuentos cortos','Identifica personajes','Responde preguntas','Anticipa eventos']},
                {numero:11,descripcion:'Mejorar conciencia fonolÃ³gica',trimestre:3,indicadores:['Identifica rimas','Reconoce sonido inicial','Segmenta sÃ­labas','Discrimina sonidos']},
                {numero:12,descripcion:'Desarrollar lenguaje descriptivo',trimestre:3,indicadores:['Usa adjetivos bÃ¡sicos','Describe objetos','Compara tamaÃ±o/color','Describe acciones']},
                {numero:13,descripcion:'Ampliar uso preguntas',trimestre:3,indicadores:['Hace preguntas quÃ©','Pregunta dÃ³nde','Usa por quÃ©','Responde abiertas']},
                {numero:14,descripcion:'Mejorar discurso',trimestre:3,indicadores:['Narra inicio-fin','Usa conectores bÃ¡sicos','Mantiene coherencia','Adapta interlocutor']},
                {numero:15,descripcion:'Preparar lectoescritura',trimestre:3,indicadores:['Reconoce nombre escrito','Identifica letras','Garabatea intenciÃ³n','Diferencia dibujo-escritura']}
            ]},
            {nombre:'Desarrollo Comunicativo',ciclo:'ciclo1',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Mejorar conciencia fonolÃ³gica',trimestre:1,indicadores:['Segmenta en sÃ­labas','Identifica sÃ­laba inicial','Reconoce rimas','Manipula fonemas']},
                {numero:2,descripcion:'Desarrollar decodificaciÃ³n',trimestre:1,indicadores:['Lee sÃ­labas directas','Lee palabras 2 sÃ­labas','Automatiza frecuentes','Lee menos silabeo']},
                {numero:3,descripcion:'Mejorar fluidez lectora',trimestre:1,indicadores:['Lee frases cortas','Respeta puntuaciÃ³n','Aumenta velocidad','Lee sin regresiones']},
                {numero:4,descripcion:'Desarrollar comprensiÃ³n lectora',trimestre:1,indicadores:['Comprende frases','Responde literales','Identifica personajes','Secuencia eventos']},
                {numero:5,descripcion:'Mejorar expresiÃ³n escrita',trimestre:1,indicadores:['Copia correcciÃ³n','Escribe dictado','Separa palabras','Usa mayÃºscula inicial']},
                {numero:6,descripcion:'Ampliar vocabulario',trimestre:2,indicadores:['Vocabulario de Ã¡rea','Define palabras','Usa sinÃ³nimos','Comprende en contexto']},
                {numero:7,descripcion:'Mejorar expresiÃ³n oral',trimestre:2,indicadores:['Narra con orden','Describe objetos','Explica procedimientos','Argumenta preferencias']},
                {numero:8,descripcion:'Desarrollar lectura comprensiva',trimestre:2,indicadores:['Comprende textos','Realiza inferencias','Identifica idea principal','Relaciona previo']},
                {numero:9,descripcion:'Mejorar escritura creativa',trimestre:2,indicadores:['Escribe frases propias','Completa textos','Redacta breves','Vocabulario variado']},
                {numero:10,descripcion:'Desarrollar ortografÃ­a',trimestre:2,indicadores:['Aplica reglas','Usa mayÃºsculas','Escribe sin omisiones','Corrige errores']},
                {numero:11,descripcion:'Ampliar comprensiÃ³n oral',trimestre:3,indicadores:['Comprende explicaciones','Sigue instrucciones complejas','Entiende textos orales','Capta implÃ­cita']},
                {numero:12,descripcion:'Mejorar habilidades discursivas',trimestre:3,indicadores:['Organiza discurso','Mantiene coherencia','Usa conectores','Adapta registro']},
                {numero:13,descripcion:'Desarrollar lectura expresiva',trimestre:3,indicadores:['Lee con entonaciÃ³n','Respeta pausas','Lee expresivamente','Lee para otros']},
                {numero:14,descripcion:'Ampliar producciÃ³n escrita',trimestre:3,indicadores:['Escribe 5+ oraciones','Planifica textos','Revisa escrito','Presenta legibles']},
                {numero:15,descripcion:'Consolidar comunicativa',trimestre:3,indicadores:['Comunica eficazmente','Lee comprensiÃ³n funcional','Escribe para comunicar','Disfruta leer/escribir']}
            ]},
            {nombre:'AutonomÃ­a Personal',ciclo:'infantil',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Desarrollar autonomÃ­a alimentaciÃ³n',trimestre:1,indicadores:['Come con cuchara','Bebe de vaso','Permanece sentado','Muestra preferencias']},
                {numero:2,descripcion:'Mejorar control esfÃ­nteres',trimestre:1,indicadores:['Avisa necesidad','Usa WC con ayuda','Permanece seco','Colabora limpieza']},
                {numero:3,descripcion:'Desarrollar autonomÃ­a vestido',trimestre:1,indicadores:['Colabora vestirse','Se quita prendas','Identifica partes ropa','SeÃ±ala su ropa']},
                {numero:4,descripcion:'Mejorar higiene personal',trimestre:1,indicadores:['Acepta lavado manos','Colabora lavado cara','Se limpia nariz','Acepta peinarse']},
                {numero:5,descripcion:'Desarrollar organizaciÃ³n',trimestre:1,indicadores:['Guarda juguetes','Reconoce pertenencias','Sigue rutina','Acepta transiciones']},
                {numero:6,descripcion:'Ampliar autonomÃ­a alimentaciÃ³n',trimestre:2,indicadores:['Usa tenedor','Se sirve con ayuda','Limpia derramado','Come variedad']},
                {numero:7,descripcion:'Consolidar control esfÃ­nteres',trimestre:2,indicadores:['Va WC solo','Se limpia supervisiÃ³n','Permanece seco dÃ­a','Avisa anticipaciÃ³n']},
                {numero:8,descripcion:'Mejorar autonomÃ­a vestido',trimestre:2,indicadores:['Se pone ropa sencilla','Se quita zapatos','Intenta abrochar','Elige entre opciones']},
                {numero:9,descripcion:'Ampliar higiene personal',trimestre:2,indicadores:['Se lava manos solo','Se lava cara','Cepilla dientes','Usa jabÃ³n']},
                {numero:10,descripcion:'Desarrollar seguridad',trimestre:2,indicadores:['Conoce normas seguridad','Identifica peligros','Pide ayuda','Se orienta espacios']},
                {numero:11,descripcion:'Consolidar alimentaciÃ³n',trimestre:3,indicadores:['Come autÃ³nomamente','Usa servilleta','Pone/quita mesa','Prueba nuevos']},
                {numero:12,descripcion:'Ampliar autonomÃ­a vestido',trimestre:3,indicadores:['Se viste completamente','Abrocha velcro/botones','Calza zapatos','Cuelga abrigo']},
                {numero:13,descripcion:'Consolidar higiene',trimestre:3,indicadores:['Rutina autÃ³noma','Reconoce cuÃ¡ndo lavarse','Tira cisterna','Usa WC pÃºblico']},
                {numero:14,descripcion:'Desarrollar autonomÃ­a tareas',trimestre:3,indicadores:['Prepara material','Recoge tras actividad','Sigue rutina clase','Realiza encargos']},
                {numero:15,descripcion:'Generalizar autonomÃ­a',trimestre:3,indicadores:['AutÃ³nomo rutinas','Transfiere a casa','Pide ayuda apropiada','Muestra iniciativa']}
            ]},
            {nombre:'AutonomÃ­a Personal',ciclo:'ciclo1',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Consolidar hÃ¡bitos higiene',trimestre:1,indicadores:['Aseo autÃ³nomo','Cuida aspecto','Usa WC correctamente','Lava manos solo']},
                {numero:2,descripcion:'Mejorar autonomÃ­a alimentaciÃ³n',trimestre:1,indicadores:['Come cualquier alimento','Usa cubiertos','Se sirve cantidad','Mastica correctamente']},
                {numero:3,descripcion:'Desarrollar autonomÃ­a vestido',trimestre:1,indicadores:['Se viste solo','Ata cordones','Abrocha cierres','Elige ropa apropiada']},
                {numero:4,descripcion:'Mejorar organizaciÃ³n materiales',trimestre:1,indicadores:['Prepara mochila','Cuida material','Organiza mesa','Encuentra lo necesario']},
                {numero:5,descripcion:'Desarrollar gestiÃ³n tiempo',trimestre:1,indicadores:['Sigue horario','Distingue momentos dÃ­a','Calcula tiempo','Llega puntual']},
                {numero:6,descripcion:'Ampliar responsabilidad',trimestre:2,indicadores:['Cuida pertenencias','Cumple encargos','Recuerda tareas','Asume consecuencias']},
                {numero:7,descripcion:'Mejorar autonomÃ­a acadÃ©mica',trimestre:2,indicadores:['Inicia tareas solo','Busca informaciÃ³n','Pide ayuda apropiada','Trabaja solo']},
                {numero:8,descripcion:'Desarrollar seguridad personal',trimestre:2,indicadores:['Conoce normas','ActÃºa con prudencia','Se orienta entorno','Identifica riesgos']},
                {numero:9,descripcion:'Mejorar autocuidado',trimestre:2,indicadores:['Reconoce malestar','Comunica necesidades','Cuida heridas','Conoce hÃ¡bitos']},
                {numero:10,descripcion:'Desarrollar autonomÃ­a hogar',trimestre:2,indicadores:['Colabora tareas','Recoge habitaciÃ³n','Pone/quita mesa','Cuida espacios']},
                {numero:11,descripcion:'Ampliar desplazamientos',trimestre:3,indicadores:['Se desplaza colegio','Conoce espacios','Llega solo cercanos','Se orienta planos']},
                {numero:12,descripcion:'Mejorar gestiÃ³n pertenencias',trimestre:3,indicadores:['Cuida cosas','Presta/pide prestado','Administra cantidades','Valora lo que tiene']},
                {numero:13,descripcion:'Desarrollar resoluciÃ³n problemas',trimestre:3,indicadores:['Resuelve pequeÃ±os solo','Busca alternativas','Toma decisiones','Pide ayuda necesaria']},
                {numero:14,descripcion:'Ampliar hÃ¡bitos saludables',trimestre:3,indicadores:['Dieta equilibrada','Actividad fÃ­sica','Duerme horas','Evita perjudiciales']},
                {numero:15,descripcion:'Generalizar autonomÃ­a',trimestre:3,indicadores:['AutÃ³nomo rutinas','ActÃºa responsable','Muestra iniciativa','Generaliza habilidades']}
            ]},
            {nombre:'Desarrollo Motor',ciclo:'infantil',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Desarrollar prensiÃ³n',trimestre:1,indicadores:['Agarra objetos gruesos','Usa pinza digital','Manipula plastilina','Ensarta cuentas grandes']},
                {numero:2,descripcion:'Mejorar coordinaciÃ³n Ã³culo-manual',trimestre:1,indicadores:['Apila 4-5 bloques','Encaja piezas','Abre/cierra tapones','Vierte con ayuda']},
                {numero:3,descripcion:'Desarrollar grafomotricidad',trimestre:1,indicadores:['Garabatea con agarre','Traza lÃ­neas verticales','Imita trazos','Colorea sin lÃ­mites']},
                {numero:4,descripcion:'Mejorar destreza manual',trimestre:1,indicadores:['Abre recipientes','Pasa pÃ¡ginas','Usa pegamento','Rasga papel']},
                {numero:5,descripcion:'Desarrollar lateralidad',trimestre:1,indicadores:['Preferencia mano','Usa dominante','Cruza lÃ­nea media','Identifica manos']},
                {numero:6,descripcion:'Ampliar precisiÃ³n manual',trimestre:2,indicadores:['Recorta con tijeras','Pica con punzÃ³n','Moldea formas','Dobla papel']},
                {numero:7,descripcion:'Mejorar grafomotricidad',trimestre:2,indicadores:['Traza horizontales','Dibuja cÃ­rculos','Copia formas','Colorea contorno']},
                {numero:8,descripcion:'Desarrollar coordinaciÃ³n bimanual',trimestre:2,indicadores:['Usa manos coordinadas','Enrosca/desenrosca','Abre cremalleras','Abotona grandes']},
                {numero:9,descripcion:'Mejorar manejo utensilios',trimestre:2,indicadores:['Usa tijeras bien','Maneja pincel','Agarre correcto lÃ¡piz','Usa goma']},
                {numero:10,descripcion:'Ampliar destrezas finas',trimestre:2,indicadores:['Ensarta pequeÃ±as','Construye piezas pequeÃ±as','Manipula pequeÃ±os','Pliega papel']},
                {numero:11,descripcion:'Consolidar grafomotricidad',trimestre:3,indicadores:['Dibuja figura humana','Copia letras','Escribe nombre','Controla presiÃ³n']},
                {numero:12,descripcion:'Mejorar precisiÃ³n',trimestre:3,indicadores:['Recorta lÃ­neas','Pega precisiÃ³n','Colorea sin salir','Dibuja detalles']},
                {numero:13,descripcion:'Desarrollar autonomÃ­a manipulativa',trimestre:3,indicadores:['Manualidades guiadas','Completa tareas solo','Organiza materiales','Cuida herramientas']},
                {numero:14,descripcion:'Ampliar destreza juegos',trimestre:3,indicadores:['Construye bloques pequeÃ±os','Puzzles 12+ piezas','Juegos construcciones','Manipula mesa']},
                {numero:15,descripcion:'Preparar para escritura',trimestre:3,indicadores:['Postura correcta','Agarre maduro','Traza con fluidez','Controla espacio']}
            ]},
            {nombre:'Desarrollo Motor',ciclo:'ciclo1',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Consolidar agarre lÃ¡piz',trimestre:1,indicadores:['Agarre trÃ­pode correcto','PresiÃ³n adecuada','Postura correcta','Fluidez en trazo']},
                {numero:2,descripcion:'Mejorar trazo grafomotor',trimestre:1,indicadores:['Escribe en renglÃ³n','Respeta mÃ¡rgenes','TamaÃ±o uniforme','Direccionalidad correcta']},
                {numero:3,descripcion:'Desarrollar precisiÃ³n recorte',trimestre:1,indicadores:['Recorta lÃ­neas curvas','Recorta figuras','Recorta con precisiÃ³n','Usa tijeras dominante']},
                {numero:4,descripcion:'Ampliar destrezas manipulativas',trimestre:1,indicadores:['Ensarta agujas','Hace nudos','Trenza','Usa herramientas finas']},
                {numero:5,descripcion:'Mejorar coordinaciÃ³n bimanual',trimestre:1,indicadores:['Tareas ambas manos','Usa mano auxiliar','Coordina movimientos','Actividades bimanuales']},
                {numero:6,descripcion:'Desarrollar velocidad escritura',trimestre:2,indicadores:['Escribe mÃ¡s rÃ¡pido','Mantiene calidad','Copia con fluidez','Dictado a ritmo']},
                {numero:7,descripcion:'Mejorar organizaciÃ³n espacial papel',trimestre:2,indicadores:['Distribuye espacio','Usa cuadrÃ­cula','Respeta formatos','Presenta ordenado']},
                {numero:8,descripcion:'Ampliar manualidades',trimestre:2,indicadores:['Origami sencillo','Manualidades complejas','Usa materiales variados','Sigue instrucciones']},
                {numero:9,descripcion:'Desarrollar dibujo representativo',trimestre:2,indicadores:['Dibuja con detalle','ProporciÃ³n figuras','Usa colores apropiados','Representa escenas']},
                {numero:10,descripcion:'Mejorar uso tecnologÃ­a',trimestre:2,indicadores:['Usa ratÃ³n precisiÃ³n','Teclea palabras','Usa tablet','Coordina ojo-mano pantalla']},
                {numero:11,descripcion:'Consolidar escritura',trimestre:3,indicadores:['Escribe legible','Velocidad adecuada','Automatiza letras','Cansancio mÃ­nimo']},
                {numero:12,descripcion:'Ampliar expresiÃ³n plÃ¡stica',trimestre:3,indicadores:['TÃ©cnicas variadas','Creatividad manual','Trabajos elaborados','Presenta con cuidado']},
                {numero:13,descripcion:'Desarrollar coordinaciÃ³n fina deportes',trimestre:3,indicadores:['Lanza con punterÃ­a','Bota con control','Maneja implementos','CoordinaciÃ³n raqueta']},
                {numero:14,descripcion:'Mejorar autonomÃ­a tareas manuales',trimestre:3,indicadores:['Prepara materiales','Ejecuta sin ayuda','Limpia y recoge','Cuida herramientas']},
                {numero:15,descripcion:'Generalizar destrezas',trimestre:3,indicadores:['Aplica en contextos','Transfiere habilidades','Muestra destreza','AutonomÃ­a motora']}
            ]},
            {nombre:'Desarrollo Psicomotor',ciclo:'infantil',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Desarrollar control postural',trimestre:1,indicadores:['Equilibrio de pie','Se sienta correcto','Cambia posiciÃ³n','Mantiene postura']},
                {numero:2,descripcion:'Mejorar desplazamientos',trimestre:1,indicadores:['Camina seguro','Corre sin caer','Sube escaleras','Baja con apoyo']},
                {numero:3,descripcion:'Desarrollar coordinaciÃ³n global',trimestre:1,indicadores:['Salta dos pies','Lanza pelota','Atrapa grande','Patea balÃ³n']},
                {numero:4,descripcion:'Mejorar esquema corporal',trimestre:1,indicadores:['SeÃ±ala partes cuerpo','Nombra principales','Dibuja figura bÃ¡sica','Imita posiciones']},
                {numero:5,descripcion:'Desarrollar equilibrio estÃ¡tico',trimestre:1,indicadores:['Pata coja','De puntillas','Posturas estatua','Equilibrio un pie']},
                {numero:6,descripcion:'Ampliar desplazamientos',trimestre:2,indicadores:['Salta obstÃ¡culos','Corre cambiando','Galopa','Desplaza atrÃ¡s']},
                {numero:7,descripcion:'Mejorar coordinaciÃ³n dinÃ¡mica',trimestre:2,indicadores:['Intenta saltar cuerda','Bota pelota','Camina lÃ­nea','Sigue circuitos']},
                {numero:8,descripcion:'Desarrollar lateralidad corporal',trimestre:2,indicadores:['Diferencia derecha-izquierda','Usa lado dominante','Cruza lÃ­nea media','Movimientos bilaterales']},
                {numero:9,descripcion:'Mejorar ritmo movimiento',trimestre:2,indicadores:['Sigue ritmos cuerpo','Baila con mÃºsica','Reproduce secuencias','Coordina con sonido']},
                {numero:10,descripcion:'Desarrollar conciencia espacial',trimestre:2,indicadores:['Arriba/abajo/dentro','Sigue direcciones','Calcula distancias','Se orienta']},
                {numero:11,descripcion:'Consolidar equilibrio dinÃ¡mico',trimestre:3,indicadores:['Camina barra baja','Salta alternando','Equilibrio movimiento','Supera circuitos']},
                {numero:12,descripcion:'Ampliar habilidades motrices',trimestre:3,indicadores:['Trepa','Se cuelga','Voltereta con ayuda','Usa aparatos parque']},
                {numero:13,descripcion:'Mejorar coordinaciÃ³n objetos',trimestre:3,indicadores:['Bota y camina','Lanza con direcciÃ³n','Atrapa pequeÃ±as','Maneja implementos']},
                {numero:14,descripcion:'Desarrollar expresiÃ³n corporal',trimestre:3,indicadores:['Representa cuerpo','Imita animales','Expresa emociones','Participa dramatizaciones']},
                {numero:15,descripcion:'Preparar deportes',trimestre:3,indicadores:['Juegos grupales motrices','Sigue reglas','Deportividad bÃ¡sica','Disfruta actividad']}
            ]},
            // COGNITIVO 2Âº CICLO - Con matemÃ¡ticas nivel 2Âº Primaria
            {nombre:'Desarrollo Cognitivo',ciclo:'ciclo2',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Mejorar atenciÃ³n sostenida y concentraciÃ³n',trimestre:1,indicadores:['Mantiene atenciÃ³n 15-20 min','Finaliza tareas sin supervisiÃ³n continua','Ignora distractores ambientales','Retoma tarea tras interrupciÃ³n']},
                {numero:2,descripcion:'Desarrollar memoria de trabajo',trimestre:1,indicadores:['Retiene 4-5 instrucciones seguidas','Opera con nÃºmeros mentalmente','Recuerda informaciÃ³n mientras resuelve','Mantiene el hilo en tareas largas']},
                {numero:3,descripcion:'Consolidar numeraciÃ³n hasta 999',trimestre:1,indicadores:['Lee y escribe nÃºmeros hasta 999','Identifica valor posicional (C-D-U)','Ordena nÃºmeros de mayor a menor','Compara usando > < =']},
                {numero:4,descripcion:'Dominar suma con llevadas',trimestre:1,indicadores:['Realiza sumas de 2 cifras con llevada','Coloca correctamente en vertical','Resuelve sumas de 3 sumandos','Automatiza combinaciones bÃ¡sicas']},
                {numero:5,descripcion:'Dominar resta con llevadas',trimestre:1,indicadores:['Realiza restas de 2 cifras con llevada','Comprende el concepto de "prestar"','Verifica resultado con suma','Resuelve restas en horizontal y vertical']},
                {numero:6,descripcion:'Iniciar multiplicaciÃ³n',trimestre:2,indicadores:['Comprende multiplicar como suma repetida','Memoriza tablas del 2, 5 y 10','Resuelve multiplicaciones de 1 cifra','Aplica propiedad conmutativa']},
                {numero:7,descripcion:'Resolver problemas de una operaciÃ³n',trimestre:2,indicadores:['Identifica datos del problema','Elige operaciÃ³n correcta (+ o -)','Escribe la operaciÃ³n y resuelve','Comprueba si el resultado tiene sentido']},
                {numero:8,descripcion:'Manejar monedas y billetes',trimestre:2,indicadores:['Reconoce monedas de 1, 2, 5, 10, 20, 50 cts y 1, 2â‚¬','Cuenta cantidades con monedas','Calcula vueltas sencillas','Forma cantidades de diferentes modos']},
                {numero:9,descripcion:'Comprender medidas de longitud',trimestre:2,indicadores:['Usa regla para medir en cm','Estima longitudes cotidianas','Conoce metro y centÃ­metro','Resuelve problemas sencillos de medida']},
                {numero:10,descripcion:'Desarrollar razonamiento lÃ³gico',trimestre:2,indicadores:['Completa series numÃ©ricas','Identifica patrones','Clasifica por varios criterios','Resuelve acertijos sencillos']},
                {numero:11,descripcion:'Ampliar tablas de multiplicar',trimestre:3,indicadores:['Memoriza tablas del 3 y 4','Aplica tablas en problemas','Relaciona multiplicaciÃ³n con repartos','Calcula dobles y triples']},
                {numero:12,descripcion:'Comprender fracciones bÃ¡sicas',trimestre:3,indicadores:['Identifica mitad y cuarto','Parte figuras en partes iguales','Asocia fracciÃ³n con representaciÃ³n','Resuelve problemas de mitades']},
                {numero:13,descripcion:'Interpretar datos sencillos',trimestre:3,indicadores:['Lee pictogramas','Interpreta grÃ¡ficos de barras','Recoge datos en tabla','Responde preguntas sobre grÃ¡ficos']},
                {numero:14,descripcion:'Reconocer formas geomÃ©tricas',trimestre:3,indicadores:['Identifica triÃ¡ngulo, cuadrado, rectÃ¡ngulo, cÃ­rculo','Reconoce formas en el entorno','Dibuja formas con regla','Conoce lados y vÃ©rtices']},
                {numero:15,descripcion:'Generalizar aprendizajes matemÃ¡ticos',trimestre:3,indicadores:['Aplica cÃ¡lculo en situaciones reales','Usa matemÃ¡ticas en otras Ã¡reas','Resuelve problemas cotidianos','Muestra confianza con nÃºmeros']}
            ]},
            // COGNITIVO 3Âº CICLO - Con matemÃ¡ticas nivel 3Âº-4Âº Primaria
            {nombre:'Desarrollo Cognitivo',ciclo:'ciclo3',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Consolidar atenciÃ³n ejecutiva',trimestre:1,indicadores:['Mantiene atenciÃ³n 25-30 min','Alterna entre tareas eficientemente','Filtra informaciÃ³n relevante','Planifica antes de actuar']},
                {numero:2,descripcion:'Desarrollar metacogniciÃ³n',trimestre:1,indicadores:['Identifica quÃ© sabe y quÃ© no','Elige estrategias de estudio','EvalÃºa su propio trabajo','Pide ayuda especÃ­fica cuando necesita']},
                {numero:3,descripcion:'Dominar numeraciÃ³n hasta 99.999',trimestre:1,indicadores:['Lee y escribe nÃºmeros hasta 99.999','Descompone en U, D, C, UM, DM','Redondea a decenas y centenas','Ordena series numÃ©ricas']},
                {numero:4,descripcion:'Consolidar multiplicaciÃ³n',trimestre:1,indicadores:['Domina todas las tablas','Multiplica por 2 cifras','Resuelve con ceros intermedios','Aplica propiedades de multiplicaciÃ³n']},
                {numero:5,descripcion:'Dominar divisiÃ³n',trimestre:1,indicadores:['Divide entre 1 cifra','Comprende resto y cociente','Verifica con multiplicaciÃ³n','Resuelve divisiones exactas e inexactas']},
                {numero:6,descripcion:'Resolver problemas de dos operaciones',trimestre:2,indicadores:['Identifica pasos del problema','Elige operaciones necesarias','Organiza datos correctamente','Verifica la soluciÃ³n']},
                {numero:7,descripcion:'Operar con fracciones sencillas',trimestre:2,indicadores:['Lee y escribe fracciones','Representa fracciones grÃ¡ficamente','Compara fracciones mismo denominador','Calcula fracciÃ³n de un nÃºmero']},
                {numero:8,descripcion:'Manejar unidades de medida',trimestre:2,indicadores:['Conoce km, m, cm, mm','Conoce kg, g y litro, ml','Realiza conversiones sencillas','Resuelve problemas de medida']},
                {numero:9,descripcion:'Comprender el tiempo',trimestre:2,indicadores:['Lee reloj analÃ³gico y digital','Calcula duraciones','Conoce equivalencias h-min-seg','Interpreta calendarios']},
                {numero:10,descripcion:'Desarrollar cÃ¡lculo mental',trimestre:2,indicadores:['Suma y resta decenas mentalmente','Multiplica por 10, 100','Estima resultados','Usa estrategias de cÃ¡lculo']},
                {numero:11,descripcion:'Calcular perÃ­metro y Ã¡rea',trimestre:3,indicadores:['Mide perÃ­metro de figuras','Calcula Ã¡rea de rectÃ¡ngulo','Diferencia perÃ­metro de Ã¡rea','Resuelve problemas geomÃ©tricos']},
                {numero:12,descripcion:'Interpretar y crear grÃ¡ficos',trimestre:3,indicadores:['Lee grÃ¡ficos de barras y lÃ­neas','Recoge datos y organiza en tabla','Construye grÃ¡ficos sencillos','Analiza informaciÃ³n estadÃ­stica']},
                {numero:13,descripcion:'Desarrollar razonamiento abstracto',trimestre:3,indicadores:['Resuelve problemas de lÃ³gica','Completa series complejas','Encuentra reglas y patrones','Aplica razonamiento deductivo']},
                {numero:14,descripcion:'Preparar transiciÃ³n a ESO',trimestre:3,indicadores:['Organiza trabajo autÃ³nomamente','Usa agenda y planificaciÃ³n','Gestiona materiales de varias Ã¡reas','Trabaja con autonomÃ­a creciente']},
                {numero:15,descripcion:'Generalizar competencia matemÃ¡tica',trimestre:3,indicadores:['Aplica matemÃ¡ticas a vida real','Resuelve problemas contextualizados','Muestra actitud positiva','Transfiere a otras Ã¡reas']}
            ]},
            // SOCIAL-EMOCIONAL 2Âº CICLO
            {nombre:'Desarrollo Social y Emocional',ciclo:'ciclo2',tipo:'social',objetivos:[
                {numero:1,descripcion:'Ampliar vocabulario emocional',trimestre:1,indicadores:['Nombra emociones complejas (vergÃ¼enza, orgullo, celos)','Describe matices emocionales','Diferencia emociones similares','Expresa emociones verbalmente']},
                {numero:2,descripcion:'Desarrollar autoconciencia emocional',trimestre:1,indicadores:['Identifica desencadenantes emocionales','Reconoce seÃ±ales corporales','Anticipa reacciones propias','Reflexiona sobre su conducta']},
                {numero:3,descripcion:'Mejorar autorregulaciÃ³n',trimestre:1,indicadores:['Aplica tÃ©cnicas de relajaciÃ³n','Usa tiempo fuera voluntariamente','Controla impulsos en situaciones difÃ­ciles','Gestiona frustraciÃ³n sin explosiones']},
                {numero:4,descripcion:'Desarrollar tolerancia a la frustraciÃ³n',trimestre:1,indicadores:['Acepta errores como aprendizaje','Persiste ante dificultades','Maneja el fracaso constructivamente','Pide ayuda sin abandonar']},
                {numero:5,descripcion:'Fortalecer autoestima',trimestre:1,indicadores:['Reconoce fortalezas y debilidades','Acepta crÃ­ticas constructivas','Valora sus logros sin compararse','Habla de sÃ­ mismo con respeto']},
                {numero:6,descripcion:'Mejorar habilidades conversacionales',trimestre:2,indicadores:['Inicia y mantiene conversaciones','Muestra interÃ©s por el otro','Respeta turnos de palabra','Adapta lenguaje al contexto']},
                {numero:7,descripcion:'Desarrollar asertividad',trimestre:2,indicadores:['Expresa opiniones con respeto','Defiende derechos sin agredir','Dice no de forma adecuada','Pide lo que necesita claramente']},
                {numero:8,descripcion:'Mejorar trabajo en equipo',trimestre:2,indicadores:['Colabora activamente en grupo','Acepta diferentes roles','Aporta ideas y escucha otras','Resuelve desacuerdos dialogando']},
                {numero:9,descripcion:'Profundizar en empatÃ­a',trimestre:2,indicadores:['Toma perspectiva del otro','Comprende emociones ajenas','Adapta conducta al estado del otro','Muestra compasiÃ³n genuina']},
                {numero:10,descripcion:'Mejorar resoluciÃ³n de conflictos',trimestre:2,indicadores:['Identifica el problema objetivamente','Genera mÃºltiples soluciones','Negocia y busca compromiso','Acepta mediaciÃ³n cuando necesita']},
                {numero:11,descripcion:'Desarrollar habilidades de amistad',trimestre:3,indicadores:['Mantiene amistades estables','Supera conflictos con amigos','Muestra lealtad apropiada','Diferencia amigos de conocidos']},
                {numero:12,descripcion:'Manejar presiÃ³n de grupo',trimestre:3,indicadores:['Reconoce presiÃ³n de iguales','Mantiene criterio propio','Rechaza propuestas inadecuadas','Busca grupos positivos']},
                {numero:13,descripcion:'Desarrollar responsabilidad social',trimestre:3,indicadores:['Cumple compromisos grupales','Asume consecuencias de actos','Contribuye al bien comÃºn','Respeta normas sociales']},
                {numero:14,descripcion:'Gestionar situaciones sociales complejas',trimestre:3,indicadores:['Maneja situaciones nuevas','Se adapta a diferentes grupos','ActÃºa apropiadamente en pÃºblico','Pide ayuda en situaciones difÃ­ciles']},
                {numero:15,descripcion:'Generalizar competencias socioemocionales',trimestre:3,indicadores:['Aplica habilidades en todos los contextos','Mantiene relaciones positivas','Gestiona emociones autÃ³nomamente','Muestra madurez emocional']}
            ]},
            // SOCIAL-EMOCIONAL 3Âº CICLO
            {nombre:'Desarrollo Social y Emocional',ciclo:'ciclo3',tipo:'social',objetivos:[
                {numero:1,descripcion:'Desarrollar inteligencia emocional',trimestre:1,indicadores:['Analiza emociones propias en profundidad','Comprende causas y efectos emocionales','Anticipa estados emocionales','Reflexiona sobre patrones emocionales']},
                {numero:2,descripcion:'Consolidar autorregulaciÃ³n emocional',trimestre:1,indicadores:['Usa mÃºltiples estrategias de regulaciÃ³n','Adapta estrategia a la situaciÃ³n','Mantiene calma en situaciones estresantes','Se recupera de emociones intensas']},
                {numero:3,descripcion:'Fortalecer identidad personal',trimestre:1,indicadores:['Conoce sus valores personales','Acepta sus caracterÃ­sticas','Muestra coherencia yo real-ideal','Construye autoconcepto positivo']},
                {numero:4,descripcion:'Desarrollar pensamiento crÃ­tico social',trimestre:1,indicadores:['Cuestiona estereotipos','Analiza mensajes de medios','Forma opiniones fundamentadas','Respeta diversidad de opiniones']},
                {numero:5,descripcion:'Manejar ansiedad y estrÃ©s',trimestre:1,indicadores:['Identifica fuentes de estrÃ©s','Aplica tÃ©cnicas de relajaciÃ³n avanzadas','Organiza tiempo para reducir agobio','Pide apoyo cuando lo necesita']},
                {numero:6,descripcion:'Desarrollar comunicaciÃ³n asertiva avanzada',trimestre:2,indicadores:['Comunica necesidades claramente','Expresa desacuerdo con respeto','Negocia soluciones win-win','Maneja crÃ­ticas constructivamente']},
                {numero:7,descripcion:'Profundizar habilidades de equipo',trimestre:2,indicadores:['Asume liderazgo cuando corresponde','Delega y coordina tareas','Motiva a compaÃ±eros','EvalÃºa trabajo grupal objetivamente']},
                {numero:8,descripcion:'Desarrollar empatÃ­a cognitiva y afectiva',trimestre:2,indicadores:['Comprende perspectivas diferentes','Responde emocionalmente apropiado','Ayuda de forma efectiva','Muestra sensibilidad social']},
                {numero:9,descripcion:'Gestionar conflictos complejos',trimestre:2,indicadores:['Analiza conflictos desde mÃºltiples perspectivas','Media en conflictos de otros','Propone soluciones creativas','Mantiene relaciÃ³n tras el conflicto']},
                {numero:10,descripcion:'Resistir presiÃ³n social',trimestre:2,indicadores:['Mantiene valores bajo presiÃ³n','Rechaza conductas de riesgo','Busca apoyo en adultos','Elige amistades positivas']},
                {numero:11,descripcion:'Preparar cambios de la adolescencia',trimestre:3,indicadores:['Comprende cambios fÃ­sicos y emocionales','Acepta transformaciones corporales','Gestiona nuevas emociones','Mantiene comunicaciÃ³n con adultos']},
                {numero:12,descripcion:'Desarrollar toma de decisiones',trimestre:3,indicadores:['EvalÃºa opciones y consecuencias','Considera valores en decisiones','Asume responsabilidad de elecciones','Aprende de decisiones errÃ³neas']},
                {numero:13,descripcion:'Construir proyecto personal',trimestre:3,indicadores:['Identifica intereses y metas','Planifica pasos hacia objetivos','Muestra motivaciÃ³n intrÃ­nseca','Visualiza futuro positivamente']},
                {numero:14,descripcion:'Preparar transiciÃ³n a ESO',trimestre:3,indicadores:['Maneja incertidumbre del cambio','Desarrolla autonomÃ­a emocional','Construye red de apoyo','Muestra resiliencia ante retos']},
                {numero:15,descripcion:'Consolidar madurez socioemocional',trimestre:3,indicadores:['Integra habilidades aprendidas','ActÃºa con responsabilidad social','Mantiene bienestar emocional','Muestra competencia social']}
            ]},
            // COMUNICATIVO 2Âº CICLO
            {nombre:'Desarrollo Comunicativo',ciclo:'ciclo2',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Consolidar fluidez lectora',trimestre:1,indicadores:['Lee con velocidad adecuada (80-100 ppm)','Respeta signos de puntuaciÃ³n','Lee con entonaciÃ³n expresiva','Evita silabeo y regresiones']},
                {numero:2,descripcion:'Desarrollar comprensiÃ³n lectora literal',trimestre:1,indicadores:['Identifica informaciÃ³n explÃ­cita','Localiza datos concretos','Reconoce personajes y hechos','Secuencia eventos del texto']},
                {numero:3,descripcion:'Mejorar comprensiÃ³n inferencial',trimestre:1,indicadores:['Deduce informaciÃ³n implÃ­cita','Interpreta expresiones figuradas','Predice acontecimientos','Relaciona causa-efecto']},
                {numero:4,descripcion:'Ampliar vocabulario',trimestre:1,indicadores:['Incorpora vocabulario de Ã¡reas','Deduce significado por contexto','Usa sinÃ³nimos y antÃ³nimos','Consulta diccionario autÃ³nomamente']},
                {numero:5,descripcion:'Mejorar expresiÃ³n escrita',trimestre:1,indicadores:['Escribe textos de 5-8 oraciones','Usa conectores bÃ¡sicos (y, pero, porque)','Respeta estructura inicio-desarrollo-fin','Revisa y corrige textos propios']},
                {numero:6,descripcion:'Consolidar ortografÃ­a',trimestre:2,indicadores:['Aplica reglas de b/v, g/j, h','Usa mayÃºsculas correctamente','Escribe sin omisiones ni sustituciones','AcentÃºa palabras frecuentes']},
                {numero:7,descripcion:'Desarrollar expresiÃ³n oral estructurada',trimestre:2,indicadores:['Expone temas con orden','Usa apoyo visual en exposiciones','Responde preguntas sobre lo expuesto','Adapta registro al contexto']},
                {numero:8,descripcion:'Mejorar comprensiÃ³n oral',trimestre:2,indicadores:['Comprende explicaciones extensas','Sigue instrucciones de 4-5 pasos','Extrae ideas principales de audio','Toma notas sencillas']},
                {numero:9,descripcion:'Producir textos narrativos',trimestre:2,indicadores:['Escribe relatos con estructura','Describe personajes y escenarios','Incluye diÃ¡logos','Crea finales coherentes']},
                {numero:10,descripcion:'Producir textos descriptivos',trimestre:2,indicadores:['Describe personas ordenadamente','Describe lugares con detalle','Usa adjetivos variados','Organiza descripciÃ³n lÃ³gicamente']},
                {numero:11,descripcion:'Desarrollar lectura comprensiva de problemas',trimestre:3,indicadores:['Identifica datos en enunciados','Comprende quÃ© se pregunta','Subraya informaciÃ³n relevante','Relee para verificar comprensiÃ³n']},
                {numero:12,descripcion:'Mejorar producciÃ³n de textos funcionales',trimestre:3,indicadores:['Escribe cartas y emails','Redacta instrucciones claras','Completa formularios','Toma notas organizadas']},
                {numero:13,descripcion:'Desarrollar habilidades argumentativas bÃ¡sicas',trimestre:3,indicadores:['Expresa opiniÃ³n con razones','Defiende punto de vista','Escucha argumentos contrarios','Distingue hecho de opiniÃ³n']},
                {numero:14,descripcion:'Fomentar gusto por la lectura',trimestre:3,indicadores:['Lee por placer regularmente','Elige libros segÃºn intereses','Comenta lecturas realizadas','Recomienda libros a otros']},
                {numero:15,descripcion:'Generalizar competencia comunicativa',trimestre:3,indicadores:['Comunica eficazmente oral y escrito','Lee con comprensiÃ³n funcional','Adapta comunicaciÃ³n al contexto','Disfruta expresÃ¡ndose']}
            ]},
            // COMUNICATIVO 3Âº CICLO
            {nombre:'Desarrollo Comunicativo',ciclo:'ciclo3',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Consolidar fluidez y expresividad lectora',trimestre:1,indicadores:['Lee con velocidad adecuada (100-120 ppm)','Modula voz segÃºn contenido','Lee en voz alta para otros','Transmite emociones del texto']},
                {numero:2,descripcion:'Profundizar comprensiÃ³n lectora',trimestre:1,indicadores:['Identifica ideas principales y secundarias','Realiza inferencias complejas','Interpreta intenciones del autor','Relaciona con conocimientos previos']},
                {numero:3,descripcion:'Desarrollar lectura crÃ­tica',trimestre:1,indicadores:['Distingue hechos de opiniones','EvalÃºa fiabilidad de fuentes','Detecta intenciones persuasivas','Compara diferentes textos']},
                {numero:4,descripcion:'Ampliar competencia lÃ©xica',trimestre:1,indicadores:['Usa vocabulario tÃ©cnico de Ã¡reas','Comprende palabras polisÃ©micas','Emplea lenguaje figurado','Incorpora vocabulario nuevo activamente']},
                {numero:5,descripcion:'Mejorar expresiÃ³n escrita compleja',trimestre:1,indicadores:['Escribe textos de 10-15 oraciones','Usa conectores variados','Estructura pÃ¡rrafos coherentes','Revisa contenido y forma']},
                {numero:6,descripcion:'Dominar ortografÃ­a',trimestre:2,indicadores:['Aplica reglas de acentuaciÃ³n','Escribe sin errores frecuentes','Usa puntuaciÃ³n correctamente','Autocorrige errores ortogrÃ¡ficos']},
                {numero:7,descripcion:'Desarrollar expresiÃ³n oral formal',trimestre:2,indicadores:['Realiza exposiciones estructuradas','Usa recursos expresivos','Gestiona tiempo de intervenciÃ³n','Responde preguntas con soltura']},
                {numero:8,descripcion:'Mejorar comprensiÃ³n oral compleja',trimestre:2,indicadores:['Comprende textos orales extensos','Identifica estructura del discurso','Toma apuntes organizados','Distingue informaciÃ³n relevante']},
                {numero:9,descripcion:'Producir textos argumentativos',trimestre:2,indicadores:['Estructura opiniÃ³n con argumentos','Anticipa contraargumentos','Usa ejemplos y datos','Concluye coherentemente']},
                {numero:10,descripcion:'Producir textos expositivos',trimestre:2,indicadores:['Organiza informaciÃ³n lÃ³gicamente','Usa tÃ­tulos y subtÃ­tulos','Incluye ejemplos y definiciones','Cita fuentes sencillas']},
                {numero:11,descripcion:'Desarrollar tÃ©cnicas de estudio',trimestre:3,indicadores:['Subraya ideas principales','Hace esquemas y resÃºmenes','Usa mapas conceptuales','Estudia de forma autÃ³noma']},
                {numero:12,descripcion:'Mejorar comprensiÃ³n de textos de estudio',trimestre:3,indicadores:['Comprende libros de texto','Extrae informaciÃ³n de esquemas','Interpreta grÃ¡ficos y tablas','Relaciona informaciÃ³n de fuentes']},
                {numero:13,descripcion:'Desarrollar comunicaciÃ³n digital',trimestre:3,indicadores:['Busca informaciÃ³n en internet','EvalÃºa pÃ¡ginas web','Produce textos digitales','Comunica respetando netiqueta']},
                {numero:14,descripcion:'Preparar exigencias comunicativas de ESO',trimestre:3,indicadores:['Lee textos mÃ¡s extensos','Toma apuntes de explicaciones','Expresa ideas con precisiÃ³n','Trabaja con mÃºltiples fuentes']},
                {numero:15,descripcion:'Consolidar competencia comunicativa',trimestre:3,indicadores:['Comunica con eficacia en cualquier contexto','Lee comprensivamente todo tipo de textos','Escribe con correcciÃ³n y coherencia','Muestra gusto por la comunicaciÃ³n']}
            ]},
            // MOTOR 3Âº CICLO
            {nombre:'Desarrollo Motor',ciclo:'ciclo3',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Consolidar escritura automatizada y eficiente',trimestre:1,indicadores:['Escribe con velocidad adecuada al nivel','Mantiene legibilidad en textos extensos','Toma apuntes sin perder informaciÃ³n','Adapta letra segÃºn contexto']},
                {numero:2,descripcion:'Desarrollar precisiÃ³n en trabajos manuales',trimestre:1,indicadores:['Realiza trabajos con alta precisiÃ³n','Maneja herramientas especializadas','Ejecuta tareas de detalle','Presenta trabajos de calidad']},
                {numero:3,descripcion:'Mejorar coordinaciÃ³n fina en tecnologÃ­a',trimestre:1,indicadores:['Teclea con velocidad y precisiÃ³n','Usa dispositivos tÃ¡ctiles con destreza','Maneja programas de diseÃ±o bÃ¡sico','Coordina acciones en pantalla']},
                {numero:4,descripcion:'Ampliar tÃ©cnicas artÃ­sticas avanzadas',trimestre:1,indicadores:['Domina tÃ©cnicas plÃ¡sticas variadas','Combina materiales creativamente','Ejecuta proyectos artÃ­sticos complejos','Muestra estilo personal']},
                {numero:5,descripcion:'Desarrollar destrezas para la vida diaria',trimestre:1,indicadores:['Realiza tareas domÃ©sticas manuales','Manipula herramientas del hogar','Ejecuta pequeÃ±as reparaciones','Muestra autonomÃ­a prÃ¡ctica']},
                {numero:6,descripcion:'Consolidar habilidades instrumentales',trimestre:2,indicadores:['Usa instrumentos de mediciÃ³n','Maneja compÃ¡s y reglas','Ejecuta dibujo tÃ©cnico bÃ¡sico','Trabaja con precisiÃ³n matemÃ¡tica']},
                {numero:7,descripcion:'Mejorar coordinaciÃ³n en deportes',trimestre:2,indicadores:['Muestra destreza en deportes de raqueta','Coordina en deportes de equipo','Maneja implementos deportivos','Ejecuta tÃ©cnicas especÃ­ficas']},
                {numero:8,descripcion:'Desarrollar expresiÃ³n plÃ¡stica elaborada',trimestre:2,indicadores:['Crea obras con intenciÃ³n artÃ­stica','Planifica proyectos visuales','Combina tÃ©cnicas de forma innovadora','Expresa ideas complejas visualmente']},
                {numero:9,descripcion:'Ampliar uso de tecnologÃ­a creativa',trimestre:2,indicadores:['Crea contenido digital bÃ¡sico','Edita imÃ¡genes y vÃ­deo','Usa herramientas de diseÃ±o','Presenta trabajos multimedia']},
                {numero:10,descripcion:'Mejorar autonomÃ­a en proyectos manuales',trimestre:2,indicadores:['Planifica proyectos completos','Ejecuta sin supervisiÃ³n continua','Resuelve problemas tÃ©cnicos','EvalÃºa resultados crÃ­ticamente']},
                {numero:11,descripcion:'Preparar habilidades para ESO',trimestre:3,indicadores:['Toma apuntes eficientemente','Organiza informaciÃ³n visual','Presenta trabajos con rigor','Gestiona materiales mÃºltiples']},
                {numero:12,descripcion:'Consolidar destrezas deportivas',trimestre:3,indicadores:['Muestra competencia en varios deportes','Ejecuta tÃ©cnicas con correcciÃ³n','Mejora rendimiento personal','Disfruta de la prÃ¡ctica deportiva']},
                {numero:13,descripcion:'Desarrollar proyectos tecnolÃ³gicos',trimestre:3,indicadores:['Participa en proyectos STEM','Construye prototipos bÃ¡sicos','Resuelve retos tÃ©cnicos','Muestra pensamiento maker']},
                {numero:14,descripcion:'Ampliar autonomÃ­a creativa',trimestre:3,indicadores:['Desarrolla proyectos propios','Muestra iniciativa artÃ­stica','Explora nuevas tÃ©cnicas','Comparte creaciones']},
                {numero:15,descripcion:'Generalizar competencia motora fina',trimestre:3,indicadores:['Muestra destreza manual completa','Aplica habilidades en contextos variados','Transfiere a situaciones nuevas','AutonomÃ­a motora funcional']}
            ]},
            // PSICOMOTOR 3Âº CICLO
            {nombre:'Desarrollo Psicomotor',ciclo:'ciclo3',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Consolidar habilidades motrices bÃ¡sicas',trimestre:1,indicadores:['Ejecuta carrera con tÃ©cnica eficiente','Salta con coordinaciÃ³n y potencia','Lanza con precisiÃ³n y fuerza','Recepciona en situaciones variadas']},
                {numero:2,descripcion:'Desarrollar condiciÃ³n fÃ­sica',trimestre:1,indicadores:['Mejora resistencia cardiovascular','Desarrolla fuerza muscular adecuada','Mantiene flexibilidad','Aumenta velocidad de reacciÃ³n']},
                {numero:3,descripcion:'Mejorar habilidades gimnÃ¡sticas avanzadas',trimestre:1,indicadores:['Ejecuta secuencias gimnÃ¡sticas','Realiza equilibrios complejos','Combina elementos con fluidez','Muestra control corporal']},
                {numero:4,descripcion:'Ampliar deportes individuales',trimestre:1,indicadores:['Practica atletismo bÃ¡sico','Desarrolla nataciÃ³n','Participa en deportes de raqueta','Mejora marcas personales']},
                {numero:5,descripcion:'Desarrollar deportes colectivos',trimestre:1,indicadores:['Domina tÃ©cnicas de fÃºtbol/baloncesto','Participa en juegos de equipo','Asume diferentes posiciones','Colabora tÃ¡cticamente']},
                {numero:6,descripcion:'Mejorar expresiÃ³n corporal elaborada',trimestre:2,indicadores:['Crea coreografÃ­as grupales','Expresa emociones complejas','Improvisa con creatividad','Comunica a travÃ©s del cuerpo']},
                {numero:7,descripcion:'Consolidar orientaciÃ³n espacial y temporal',trimestre:2,indicadores:['Se orienta en espacios amplios','Anticipa movimientos de otros','Coordina acciones con el tiempo','Ocupa espacios tÃ¡cticamente']},
                {numero:8,descripcion:'Desarrollar trabajo en equipo motor',trimestre:2,indicadores:['Lidera actividades grupales','Coordina acciones con compaÃ±eros','Comunica durante el juego','Acepta roles diversos']},
                {numero:9,descripcion:'Ampliar conocimiento corporal',trimestre:2,indicadores:['Conoce capacidades y lÃ­mites','Adapta esfuerzo a la tarea','Reconoce efectos del ejercicio','Cuida su cuerpo']},
                {numero:10,descripcion:'Mejorar fair play y deportividad',trimestre:2,indicadores:['Respeta normas y Ã¡rbitros','Acepta victoria y derrota','Ayuda a compaÃ±eros','Rechaza conductas antideportivas']},
                {numero:11,descripcion:'Preparar actividad fÃ­sica autÃ³noma',trimestre:3,indicadores:['Calienta correctamente','Dosifica el esfuerzo','Recupera adecuadamente','Practica con regularidad']},
                {numero:12,descripcion:'Consolidar hÃ¡bitos saludables',trimestre:3,indicadores:['Mantiene vida activa','Equilibra ejercicio y descanso','Conoce beneficios del deporte','Rechaza sedentarismo']},
                {numero:13,descripcion:'Desarrollar competencias para ESO',trimestre:3,indicadores:['Prepara para educaciÃ³n fÃ­sica de ESO','Conoce deportes del curriculum','Muestra autonomÃ­a en actividades','Transfiere aprendizajes']},
                {numero:14,descripcion:'Ampliar prÃ¡ctica deportiva extraescolar',trimestre:3,indicadores:['Participa en actividades fuera del cole','Muestra interÃ©s por deporte','Busca prÃ¡ctica regular','Disfruta de la actividad fÃ­sica']},
                {numero:15,descripcion:'Generalizar competencia motriz',trimestre:3,indicadores:['Muestra competencia motriz global','Adapta motricidad a cualquier contexto','Mantiene estilo de vida activo','AutonomÃ­a motora completa']}
            ]},
            // AUTONOMÃA 3Âº CICLO
            {nombre:'AutonomÃ­a Personal',ciclo:'ciclo3',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Consolidar autonomÃ­a en rutinas diarias',trimestre:1,indicadores:['Gestiona rutinas sin supervisiÃ³n','Organiza su tiempo de forma autÃ³noma','Cumple responsabilidades regularmente','Muestra iniciativa personal']},
                {numero:2,descripcion:'Desarrollar hÃ¡bitos de estudio avanzados',trimestre:1,indicadores:['Planifica estudio semanalmente','Usa tÃ©cnicas de estudio eficaces','Organiza material de varias asignaturas','Prepara exÃ¡menes autÃ³nomamente']},
                {numero:3,descripcion:'Mejorar gestiÃ³n del tiempo',trimestre:1,indicadores:['Usa agenda o planificador','Prioriza tareas','Cumple plazos establecidos','Equilibra obligaciones y ocio']},
                {numero:4,descripcion:'Ampliar responsabilidad personal',trimestre:1,indicadores:['Asume consecuencias de sus actos','Cumple compromisos adquiridos','Muestra responsabilidad con otros','ActÃºa con integridad']},
                {numero:5,descripcion:'Desarrollar autonomÃ­a en desplazamientos',trimestre:1,indicadores:['Se desplaza solo por el barrio','Usa transporte pÃºblico bÃ¡sico','Conoce normas de circulaciÃ³n','Se orienta en entornos conocidos']},
                {numero:6,descripcion:'Consolidar autocuidado y salud',trimestre:2,indicadores:['Mantiene hÃ¡bitos saludables','Reconoce seÃ±ales de su cuerpo','ActÃºa ante malestar bÃ¡sico','Conoce primeros auxilios bÃ¡sicos']},
                {numero:7,descripcion:'Mejorar gestiÃ³n econÃ³mica bÃ¡sica',trimestre:2,indicadores:['Administra paga o asignaciÃ³n','Ahorra para objetivos','Distingue necesidades de deseos','Valora el dinero']},
                {numero:8,descripcion:'Desarrollar colaboraciÃ³n en el hogar',trimestre:2,indicadores:['Realiza tareas domÃ©sticas regulares','Colabora en organizaciÃ³n familiar','Cuida espacios comunes','Ayuda sin que le pidan']},
                {numero:9,descripcion:'Ampliar seguridad personal',trimestre:2,indicadores:['Identifica situaciones de riesgo','ActÃºa con prudencia','Conoce recursos de ayuda','Protege datos personales']},
                {numero:10,descripcion:'Mejorar toma de decisiones',trimestre:2,indicadores:['EvalÃºa opciones antes de decidir','Considera consecuencias','Asume decisiones tomadas','Aprende de errores']},
                {numero:11,descripcion:'Preparar transiciÃ³n a ESO',trimestre:3,indicadores:['Conoce funcionamiento de ESO','Prepara cambio de centro','Gestiona incertidumbre','Muestra madurez ante cambios']},
                {numero:12,descripcion:'Consolidar uso responsable de tecnologÃ­a',trimestre:3,indicadores:['Usa internet con criterio','Gestiona tiempo de pantallas','Protege privacidad online','Identifica contenidos inadecuados']},
                {numero:13,descripcion:'Desarrollar proyecto personal',trimestre:3,indicadores:['Identifica intereses y metas','Planifica pasos hacia objetivos','Muestra motivaciÃ³n','Persevera ante dificultades']},
                {numero:14,descripcion:'Ampliar competencia social autÃ³noma',trimestre:3,indicadores:['InteractÃºa apropiadamente en contextos nuevos','Pide ayuda cuando la necesita','Se relaciona con adultos correctamente','Muestra habilidades sociales maduras']},
                {numero:15,descripcion:'Generalizar autonomÃ­a personal',trimestre:3,indicadores:['ActÃºa con autonomÃ­a en todos los Ã¡mbitos','Toma decisiones responsables','Muestra madurez personal','Preparado para nueva etapa']}
            ]},
            // MOTOR 2Âº CICLO
            {nombre:'Desarrollo Motor',ciclo:'ciclo2',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Consolidar grafomotricidad funcional',trimestre:1,indicadores:['Escribe con letra legible y uniforme','Mantiene velocidad sin perder calidad','Respeta mÃ¡rgenes y renglones','Presenta trabajos limpios y ordenados']},
                {numero:2,descripcion:'Mejorar precisiÃ³n en recorte',trimestre:1,indicadores:['Recorta figuras complejas con precisiÃ³n','Recorta materiales de diferentes grosores','Sigue lÃ­neas curvas y Ã¡ngulos','Usa tijeras con destreza']},
                {numero:3,descripcion:'Desarrollar destrezas manipulativas finas',trimestre:1,indicadores:['Realiza manualidades con pequeÃ±os objetos','Ensarta cuentas pequeÃ±as','Hace nudos y lazadas','Manipula herramientas de precisiÃ³n']},
                {numero:4,descripcion:'Ampliar coordinaciÃ³n bimanual',trimestre:1,indicadores:['Coordina ambas manos en tareas complejas','Usa mano auxiliar eficientemente','Realiza tareas que requieren ambas manos','Mantiene estabilidad mientras manipula']},
                {numero:5,descripcion:'Mejorar control del trazo',trimestre:1,indicadores:['Controla presiÃ³n del lÃ¡piz','Traza lÃ­neas fluidas','Dibuja con detalle y proporciÃ³n','Colorea respetando contornos']},
                {numero:6,descripcion:'Desarrollar velocidad de escritura',trimestre:2,indicadores:['Aumenta velocidad manteniendo legibilidad','Copia textos a ritmo adecuado','Toma dictados sin quedarse atrÃ¡s','Escribe al ritmo de su pensamiento']},
                {numero:7,descripcion:'Mejorar organizaciÃ³n espacial en papel',trimestre:2,indicadores:['Distribuye espacio en la hoja','Usa correctamente la cuadrÃ­cula','Respeta formatos establecidos','Organiza informaciÃ³n visualmente']},
                {numero:8,descripcion:'Ampliar tÃ©cnicas plÃ¡sticas',trimestre:2,indicadores:['Domina diferentes tÃ©cnicas artÃ­sticas','Usa materiales variados con destreza','Combina tÃ©cnicas creativamente','Presenta trabajos cuidados']},
                {numero:9,descripcion:'Desarrollar dibujo representativo detallado',trimestre:2,indicadores:['Dibuja figuras con proporciÃ³n','Incluye detalles en sus dibujos','Representa escenas complejas','Usa perspectiva bÃ¡sica']},
                {numero:10,descripcion:'Mejorar uso de tecnologÃ­a',trimestre:2,indicadores:['Usa ratÃ³n con precisiÃ³n','Teclea con agilidad','Maneja tablet y stylus','Realiza tareas digitales con destreza']},
                {numero:11,descripcion:'Consolidar escritura automatizada',trimestre:3,indicadores:['Escribe sin pensar en el trazo','Mantiene calidad en textos largos','Muestra mÃ­nimo cansancio','Escribe con fluidez']},
                {numero:12,descripcion:'Ampliar expresiÃ³n plÃ¡stica creativa',trimestre:3,indicadores:['Crea trabajos originales','Combina tÃ©cnicas con creatividad','Expresa ideas a travÃ©s del arte','Muestra estilo personal']},
                {numero:13,descripcion:'Desarrollar habilidades para deportes',trimestre:3,indicadores:['Maneja implementos deportivos','Coordina ojo-mano en juegos','Lanza y recepciona con precisiÃ³n','Participa en actividades deportivas']},
                {numero:14,descripcion:'Mejorar autonomÃ­a en tareas manuales',trimestre:3,indicadores:['Prepara materiales sin ayuda','Ejecuta proyectos completos','Limpia y organiza su espacio','Cuida herramientas y materiales']},
                {numero:15,descripcion:'Generalizar destrezas motoras finas',trimestre:3,indicadores:['Aplica habilidades en diferentes contextos','Transfiere destrezas a nuevas tareas','Muestra confianza manipulativa','AutonomÃ­a motora fina completa']}
            ]},
            // PSICOMOTOR 2Âº CICLO
            {nombre:'Desarrollo Psicomotor',ciclo:'ciclo2',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Consolidar habilidades locomotrices',trimestre:1,indicadores:['Corre con tÃ©cnica eficiente','Salta con coordinaciÃ³n','Realiza desplazamientos variados','Combina movimientos con fluidez']},
                {numero:2,descripcion:'Mejorar equilibrio dinÃ¡mico',trimestre:1,indicadores:['Mantiene equilibrio en movimiento','Camina sobre superficies estrechas','Realiza giros sin perder estabilidad','Equilibrio en situaciones cambiantes']},
                {numero:3,descripcion:'Desarrollar coordinaciÃ³n Ã³culo-manual',trimestre:1,indicadores:['Lanza con precisiÃ³n a diana','Atrapa objetos en movimiento','Golpea objetos con implementos','Coordina vista y manos eficientemente']},
                {numero:4,descripcion:'Ampliar coordinaciÃ³n Ã³culo-pÃ©dica',trimestre:1,indicadores:['Conduce balÃ³n con control','Golpea balÃ³n con precisiÃ³n','Combina carrera y golpeo','Coordina vista y pies']},
                {numero:5,descripcion:'Mejorar control corporal',trimestre:1,indicadores:['Controla movimientos globales','Ajusta fuerza segÃºn tarea','Frena y arranca con control','Adapta movimiento al espacio']},
                {numero:6,descripcion:'Desarrollar habilidades gimnÃ¡sticas',trimestre:2,indicadores:['Realiza volteretas con tÃ©cnica','Ejecuta equilibrios invertidos','Combina elementos gimnÃ¡sticos','Muestra control en aparatos']},
                {numero:7,descripcion:'Mejorar expresiÃ³n corporal',trimestre:2,indicadores:['Expresa emociones con el cuerpo','Crea secuencias de movimiento','Sigue ritmos con coordinaciÃ³n','Improvisa movimientos creativos']},
                {numero:8,descripcion:'Ampliar juegos predeportivos',trimestre:2,indicadores:['Participa en juegos de equipo','Aplica reglas deportivas','Colabora con compaÃ±eros','Acepta victoria y derrota']},
                {numero:9,descripcion:'Desarrollar orientaciÃ³n espacial dinÃ¡mica',trimestre:2,indicadores:['Se orienta en espacios amplios','Calcula trayectorias de objetos','Anticipa movimientos de otros','Ocupa espacios estratÃ©gicamente']},
                {numero:10,descripcion:'Mejorar condiciÃ³n fÃ­sica bÃ¡sica',trimestre:2,indicadores:['Muestra resistencia en actividades','Desarrolla fuerza apropiada','Mantiene flexibilidad','Mejora velocidad de reacciÃ³n']},
                {numero:11,descripcion:'Consolidar deportes colectivos',trimestre:3,indicadores:['Practica deportes de equipo','Conoce y aplica reglas','Asume diferentes roles','Muestra deportividad']},
                {numero:12,descripcion:'Ampliar deportes individuales',trimestre:3,indicadores:['Practica deportes individuales','Mejora marcas personales','Muestra constancia en prÃ¡ctica','Disfruta de la actividad']},
                {numero:13,descripcion:'Desarrollar autonomÃ­a en actividad fÃ­sica',trimestre:3,indicadores:['Calienta antes de actividad','Estira despuÃ©s del ejercicio','Cuida su higiene deportiva','Practica actividad regularmente']},
                {numero:14,descripcion:'Mejorar trabajo en equipo motor',trimestre:3,indicadores:['Colabora en actividades grupales','Comunica durante el juego','Ayuda a compaÃ±eros','Acepta diferentes niveles']},
                {numero:15,descripcion:'Generalizar competencia motriz',trimestre:3,indicadores:['Muestra competencia motriz global','Disfruta del movimiento','Mantiene hÃ¡bitos activos','Transfiere a vida cotidiana']}
            ]},
            // AUTONOMÃA 2Âº CICLO
            {nombre:'AutonomÃ­a Personal',ciclo:'ciclo2',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Consolidar higiene personal',trimestre:1,indicadores:['Realiza aseo diario autÃ³nomo','Cuida su imagen personal','Mantiene higiene dental correcta','Reconoce necesidades de higiene']},
                {numero:2,descripcion:'Mejorar organizaciÃ³n de materiales',trimestre:1,indicadores:['Prepara mochila correctamente','Organiza su espacio de trabajo','Cuida y mantiene materiales','Encuentra lo que necesita']},
                {numero:3,descripcion:'Desarrollar gestiÃ³n del tiempo',trimestre:1,indicadores:['Sigue horarios establecidos','Calcula tiempo para tareas','Llega puntual','Aprovecha el tiempo']},
                {numero:4,descripcion:'Ampliar responsabilidad personal',trimestre:1,indicadores:['Cumple con sus obligaciones','Asume consecuencias de actos','Recuerda tareas sin ayuda','Muestra iniciativa']},
                {numero:5,descripcion:'Mejorar autonomÃ­a en tareas escolares',trimestre:1,indicadores:['Inicia tareas sin que le digan','Trabaja de forma independiente','Busca informaciÃ³n necesaria','Pide ayuda apropiadamente']},
                {numero:6,descripcion:'Desarrollar hÃ¡bitos de estudio',trimestre:2,indicadores:['Tiene lugar fijo de estudio','Organiza tiempo de deberes','Prepara material antes','Mantiene concentraciÃ³n']},
                {numero:7,descripcion:'Mejorar autocuidado',trimestre:2,indicadores:['Reconoce sÃ­ntomas de malestar','Comunica necesidades de salud','Conoce hÃ¡bitos saludables','Se protege del sol y frÃ­o']},
                {numero:8,descripcion:'Ampliar colaboraciÃ³n en hogar',trimestre:2,indicadores:['Realiza tareas domÃ©sticas','Colabora sin que le pidan','Cuida espacios comunes','Ayuda a la familia']},
                {numero:9,descripcion:'Desarrollar seguridad personal',trimestre:2,indicadores:['Conoce normas de seguridad','ActÃºa con prudencia','Identifica situaciones de riesgo','Sabe pedir ayuda']},
                {numero:10,descripcion:'Mejorar desplazamientos autÃ³nomos',trimestre:2,indicadores:['Se desplaza por el centro solo','Conoce el camino a lugares','Sigue normas de circulaciÃ³n','Se orienta en entorno conocido']},
                {numero:11,descripcion:'Consolidar alimentaciÃ³n saludable',trimestre:3,indicadores:['Elige alimentos saludables','Come de forma equilibrada','Conoce grupos de alimentos','Evita excesos de dulces']},
                {numero:12,descripcion:'Ampliar gestiÃ³n del ocio',trimestre:3,indicadores:['Organiza su tiempo libre','Elige actividades variadas','Equilibra pantallas y otras actividades','Propone planes']},
                {numero:13,descripcion:'Desarrollar resoluciÃ³n de problemas cotidianos',trimestre:3,indicadores:['Resuelve pequeÃ±os problemas solo','Busca alternativas','Toma decisiones adecuadas','Pide ayuda cuando la necesita']},
                {numero:14,descripcion:'Mejorar gestiÃ³n de pertenencias',trimestre:3,indicadores:['Cuida sus cosas','Ahorra y administra dinero','Valora lo que tiene','Comparte apropiadamente']},
                {numero:15,descripcion:'Generalizar autonomÃ­a personal',trimestre:3,indicadores:['Muestra autonomÃ­a en rutinas','ActÃºa con responsabilidad','Toma iniciativas apropiadas','Transfiere habilidades a nuevos contextos']}
            ]},
            {nombre:'Desarrollo Psicomotor',ciclo:'ciclo1',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Consolidar carrera',trimestre:1,indicadores:['Corre con tÃ©cnica','Cambia direcciÃ³n','Acelera/frena','Carrera continuada']},
                {numero:2,descripcion:'Mejorar salto',trimestre:1,indicadores:['Salta longitud','Salta altura','Salto alternando','Triple salto bÃ¡sico']},
                {numero:3,descripcion:'Desarrollar lanzamiento',trimestre:1,indicadores:['Lanza con fuerza','Lanza con precisiÃ³n','Lanza diferentes objetos','TÃ©cnica lanzamiento']},
                {numero:4,descripcion:'Ampliar recepciÃ³n',trimestre:1,indicadores:['Atrapa con manos','Recepciona movimiento','Atrapa diferentes tamaÃ±os','Anticipa trayectoria']},
                {numero:5,descripcion:'Mejorar equilibrio',trimestre:1,indicadores:['Equilibrio dinÃ¡mico','Equilibrio estÃ¡tico prolongado','Equilibrio con ojos cerrados','Equilibrio inestable']},
                {numero:6,descripcion:'Desarrollar coordinaciÃ³n general',trimestre:2,indicadores:['Circuitos complejos','Combina habilidades','Movimientos fluidos','Adapta a situaciones']},
                {numero:7,descripcion:'Ampliar habilidades gimnÃ¡sticas',trimestre:2,indicadores:['Voltereta adelante','Voltereta atrÃ¡s','Rueda lateral','Equilibrios invertidos']},
                {numero:8,descripcion:'Mejorar coordinaciÃ³n con implementos',trimestre:2,indicadores:['Maneja raqueta','Usa bate','Conduce balÃ³n pie','Maneja stick']},
                {numero:9,descripcion:'Desarrollar expresiÃ³n corporal',trimestre:2,indicadores:['CoreografÃ­as sencillas','Expresa con cuerpo','Sigue mÃºsica','Improvisa movimiento']},
                {numero:10,descripcion:'Ampliar juegos predeportivos',trimestre:2,indicadores:['Participa juegos equipo','Entiende reglas','Colabora con compaÃ±eros','Acepta resultados']},
                {numero:11,descripcion:'Consolidar habilidades',trimestre:3,indicadores:['Ejecuta con eficacia','Automatiza movimientos','Transfiere a deporte','Muestra competencia']},
                {numero:12,descripcion:'Desarrollar condiciÃ³n fÃ­sica',trimestre:3,indicadores:['Resistencia bÃ¡sica','Fuerza apropiada','Flexibilidad','Velocidad reacciÃ³n']},
                {numero:13,descripcion:'Ampliar deportes',trimestre:3,indicadores:['Practica varios deportes','Conoce reglas bÃ¡sicas','Participa competiciones','Deportividad']},
                {numero:14,descripcion:'Mejorar orientaciÃ³n espacial',trimestre:3,indicadores:['Se orienta espacio','Calcula trayectorias','Anticipa compaÃ±eros','Ocupa espacios']},
                {numero:15,descripcion:'Generalizar competencia motriz',trimestre:3,indicadores:['Competencia motriz general','Disfruta movimiento','HÃ¡bitos actividad','AutonomÃ­a motora']}
            ]},
            {nombre:'TDAH',ciclo:'ciclo1',tipo:'tdah',objetivos:[
                {numero:1,descripcion:'Mejorar atenciÃ³n sostenida',trimestre:1,indicadores:['Mantiene atenciÃ³n 5 min en tarea','Finaliza actividad corta sin levantarse','Sigue instrucciones de 2 pasos','Escucha explicaciÃ³n breve completa']},
                {numero:2,descripcion:'Desarrollar atenciÃ³n selectiva',trimestre:1,indicadores:['Localiza informaciÃ³n en una ficha','Discrimina estÃ­mulos relevantes','Filtra distracciones auditivas','Completa bÃºsqueda visual']},
                {numero:3,descripcion:'Mejorar control de impulsos',trimestre:1,indicadores:['Espera turno para hablar','Levanta la mano antes de intervenir','Piensa antes de responder','Espera en fila sin empujar']},
                {numero:4,descripcion:'Desarrollar autorregulaciÃ³n conductual',trimestre:1,indicadores:['Permanece sentado durante la tarea','Controla movimientos en asamblea','Reduce interrupciones','Acepta correcciones sin enfado']},
                {numero:5,descripcion:'Mejorar memoria de trabajo',trimestre:1,indicadores:['Retiene instrucciÃ³n de 2 pasos','Recuerda material de la sesiÃ³n anterior','Mantiene informaciÃ³n mientras trabaja','Sigue secuencia de actividad']},
                {numero:6,descripcion:'Desarrollar planificaciÃ³n de tareas',trimestre:2,indicadores:['Identifica pasos de una actividad','Prepara material antes de empezar','Sigue orden en la tarea','Revisa trabajo antes de entregar']},
                {numero:7,descripcion:'Ampliar flexibilidad cognitiva',trimestre:2,indicadores:['Cambia de actividad sin resistencia','Acepta cambios en la rutina','Busca alternativas ante bloqueo','Adapta estrategia si no funciona']},
                {numero:8,descripcion:'Mejorar organizaciÃ³n personal',trimestre:2,indicadores:['Organiza material en la mesa','Encuentra sus cosas en la mochila','Sigue rutina de inicio de sesiÃ³n','Recoge materiales al terminar']},
                {numero:9,descripcion:'Desarrollar regulaciÃ³n emocional',trimestre:2,indicadores:['Identifica cuando se frustra','Usa estrategia de calma','Expresa enfado con palabras','Recupera la calma con apoyo']},
                {numero:10,descripcion:'Mejorar habilidades sociales',trimestre:2,indicadores:['Respeta turno en juego','Escucha al compaÃ±ero','Coopera en actividad de pareja','Resuelve conflicto con palabras']},
                {numero:11,descripcion:'Consolidar atenciÃ³n en tareas acadÃ©micas',trimestre:3,indicadores:['Mantiene atenciÃ³n 10 min','Completa tarea con mÃ­nima supervisiÃ³n','Atiende a explicaciÃ³n grupal','Trabaja sin distraer a otros']},
                {numero:12,descripcion:'Ampliar autocontrol',trimestre:3,indicadores:['Inhibe respuesta impulsiva','Espera sin necesidad de recordatorio','Regula volumen de voz','Controla movimientos en clase']},
                {numero:13,descripcion:'Desarrollar autonomÃ­a en el trabajo',trimestre:3,indicadores:['Inicia tarea solo','Sigue pasos sin ayuda continua','Pide ayuda de forma adecuada','Gestiona su tiempo con apoyo visual']},
                {numero:14,descripcion:'Mejorar autoestima y motivaciÃ³n',trimestre:3,indicadores:['Verbaliza logros propios','Acepta errores sin frustraciÃ³n excesiva','Muestra iniciativa','Se esfuerza ante dificultad']},
                {numero:15,descripcion:'Generalizar estrategias',trimestre:3,indicadores:['Aplica estrategias en aula ordinaria','Usa autoinstrucciones','Transfiere hÃ¡bitos a casa','Mantiene mejoras sin apoyo constante']}
            ]},
            {nombre:'TDAH',ciclo:'ciclo2',tipo:'tdah',objetivos:[
                {numero:1,descripcion:'Mejorar atenciÃ³n sostenida y concentraciÃ³n',trimestre:1,indicadores:['Mantiene atenciÃ³n 15 min en tarea','Completa actividad sin interrupciones frecuentes','Se concentra con distracciones ambientales','Retoma tarea tras distracciÃ³n']},
                {numero:2,descripcion:'Desarrollar atenciÃ³n dividida',trimestre:1,indicadores:['Escucha y toma notas simultÃ¡neamente','Alterna entre dos tareas','Atiende a instrucciones mientras trabaja','Gestiona varios estÃ­mulos']},
                {numero:3,descripcion:'Mejorar control inhibitorio',trimestre:1,indicadores:['Piensa antes de actuar','Controla respuestas impulsivas verbales','Respeta turnos en debate','Espera instrucciÃ³n completa antes de empezar']},
                {numero:4,descripcion:'Desarrollar autorregulaciÃ³n emocional',trimestre:1,indicadores:['Identifica seÃ±ales de frustraciÃ³n','Aplica tÃ©cnica de relajaciÃ³n','Gestiona enfado sin conducta disruptiva','Tolera espera y demora de recompensa']},
                {numero:5,descripcion:'Ampliar memoria de trabajo',trimestre:1,indicadores:['Retiene instrucciones de 3 pasos','Opera mentalmente con informaciÃ³n','Recuerda y aplica normas de clase','Mantiene hilo en conversaciÃ³n']},
                {numero:6,descripcion:'Mejorar planificaciÃ³n y organizaciÃ³n',trimestre:2,indicadores:['Planifica pasos antes de una tarea','Usa agenda o checklist','Organiza cuaderno por asignaturas','Prioriza tareas por importancia']},
                {numero:7,descripcion:'Desarrollar gestiÃ³n del tiempo',trimestre:2,indicadores:['Estima tiempo necesario para tarea','Usa temporizador como apoyo','Distribuye trabajo en sesiÃ³n','Finaliza dentro del tiempo previsto']},
                {numero:8,descripcion:'Ampliar flexibilidad cognitiva',trimestre:2,indicadores:['Acepta cambios de plan sin desregularse','Considera diferentes puntos de vista','Cambia de estrategia cuando falla','Resuelve problemas de forma flexible']},
                {numero:9,descripcion:'Mejorar habilidades sociales avanzadas',trimestre:2,indicadores:['Participa en trabajo grupal equitativamente','Negocia y llega a acuerdos','Interpreta seÃ±ales sociales','Adapta conducta al contexto']},
                {numero:10,descripcion:'Desarrollar metacogniciÃ³n',trimestre:2,indicadores:['Identifica quÃ© le cuesta mÃ¡s','Elige estrategia adecuada','EvalÃºa su propio trabajo','Detecta y corrige errores']},
                {numero:11,descripcion:'Consolidar estrategias de autocontrol',trimestre:3,indicadores:['Usa autoinstrucciones de forma autÃ³noma','Aplica parada de pensamiento','Autorregula nivel de activaciÃ³n','Mantiene conducta adecuada toda la sesiÃ³n']},
                {numero:12,descripcion:'Ampliar autonomÃ­a acadÃ©mica',trimestre:3,indicadores:['Trabaja de forma independiente 20 min','Gestiona deberes con apoyo mÃ­nimo','Organiza material sin recordatorio','Revisa y corrige trabajo autÃ³nomamente']},
                {numero:13,descripcion:'Mejorar autoconcepto y motivaciÃ³n',trimestre:3,indicadores:['Reconoce sus fortalezas','Afronta retos sin evitaciÃ³n','Persevera ante dificultad','Valora su esfuerzo y progreso']},
                {numero:14,descripcion:'Desarrollar resoluciÃ³n de problemas',trimestre:3,indicadores:['Analiza situaciÃ³n antes de actuar','Genera varias soluciones posibles','EvalÃºa consecuencias de opciones','Elige y ejecuta la mejor opciÃ³n']},
                {numero:15,descripcion:'Generalizar competencias',trimestre:3,indicadores:['Aplica estrategias en todas las Ã¡reas','Mantiene hÃ¡bitos sin supervisiÃ³n','Transfiere aprendizajes a contexto familiar','Muestra progreso sostenido']}
            ]}
        ];
        
        // Cargar plantillas base inmediatamente (sin esperar Firebase)
        PLANTILLAS_BASE.forEach((p,i)=>{
            const id='base_'+p.ciclo+'_'+p.tipo;
            plantillas[id]={...p,esBase:true};
        });
        
        // Firebase listeners
        db.ref('gestorpe/alumnos').on('value',snap=>{alumnos=snap.val()||{};renderInicio();if(alumnoActual&&alumnos[alumnoActual]){renderProgs();renderProg();renderEval();renderAsis();}document.getElementById('statusDot').classList.add('ok');document.getElementById('statusText').textContent='Conectado';});
        db.ref('gestorpe/plantillas').on('value',snap=>{
            const customPlantillas=snap.val()||{};
            // AÃ±adir plantillas personalizadas de Firebase
            Object.keys(customPlantillas).forEach(id=>{
                plantillas[id]=customPlantillas[id];
            });
            renderBiblioteca();
        });
        
        // Renderizar biblioteca aunque Firebase no conecte
        renderBiblioteca();

        function cambiarSeccion(s,btn){document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');document.getElementById('seccionAlumnos').style.display=s==='alumnos'?'block':'none';document.getElementById('seccionEstadisticas').style.display=s==='estadisticas'?'block':'none';document.getElementById('seccionBiblioteca').style.display=s==='biblioteca'?'block':'none';if(s==='estadisticas')renderEstadisticasGlobal();}
        function renderInicio(){const g=document.getElementById('alumnosGrid'),ids=Object.keys(alumnos);if(!ids.length){g.innerHTML='<div class="alumno-card alumno-card-add" onclick="abrirModalNuevo()"><span style="font-size:1.3rem">â•</span><span style="font-size:.8rem">AÃ±adir</span></div>';return;}let h=ids.map(id=>{const a=alumnos[id],n=a.programas?Object.keys(a.programas).length:0;return'<div class="alumno-card" onclick="abrirAlumno(\''+id+'\')"><div class="alumno-siglas">'+a.siglas+'</div><div class="alumno-curso">'+a.curso+'</div><div class="alumno-progs">'+n+' prog.</div></div>';}).join('');h+='<div class="alumno-card alumno-card-add" onclick="abrirModalNuevo()"><span style="font-size:1.3rem">â•</span></div>';g.innerHTML=h;}
        
        // BIBLIOTECA
        function renderBiblioteca(){const c=document.getElementById('bibliotecaGrid');const cicloF=document.getElementById('filtroCiclo').value;const areaF=document.getElementById('filtroArea').value;const lista=Object.keys(plantillas).map(id=>({id,...plantillas[id]}));const filtrada=lista.filter(p=>{if(cicloF&&p.ciclo!==cicloF)return false;if(areaF&&p.tipo!==areaF)return false;return true;});if(!filtrada.length){c.innerHTML='<div class="empty-state"><p>No hay plantillas con estos filtros</p></div>';return;}c.innerHTML=filtrada.map(p=>{const ciclo=CICLOS[p.ciclo]||{nombre:p.ciclo};const area=AREAS[p.tipo]||{nombre:p.tipo,icon:'ğŸ“„'};const nObj=p.objetivos?p.objetivos.length:0;const nInd=p.objetivos?p.objetivos.reduce((s,o)=>s+(o.indicadores?o.indicadores.length:0),0):0;const baseBadge=p.esBase?'<span style="font-size:.6rem;background:#e0e7ff;color:#4338ca;padding:2px 6px;border-radius:8px;margin-left:4px">BASE</span>':'';return'<div class="plantilla-card" onclick="verPlantilla(\''+p.id+'\')"><div class="plantilla-header"><span class="plantilla-titulo">'+area.icon+' '+p.nombre+baseBadge+'</span></div><div class="plantilla-meta"><span class="plantilla-badge ciclo-'+p.ciclo+'">'+ciclo.nombre+'</span><span class="plantilla-badge badge-area">'+area.nombre+'</span></div><div class="plantilla-stats">'+nObj+' objetivos Â· '+nInd+' indicadores</div></div>';}).join('');}
        
        function verPlantilla(id){const p=plantillas[id];if(!p)return;const area=AREAS[p.tipo]||{nombre:p.tipo,icon:'ğŸ“„'};const ciclo=CICLOS[p.ciclo]||{nombre:p.ciclo};document.getElementById('modalPlantillaTitulo').textContent=area.icon+' '+p.nombre;let h='<div class="plantilla-meta" style="margin-bottom:12px"><span class="plantilla-badge ciclo-'+p.ciclo+'">'+ciclo.nombre+'</span><span class="plantilla-badge badge-area">'+area.nombre+'</span>'+(p.esBase?'<span style="font-size:.7rem;background:#e0e7ff;color:#4338ca;padding:3px 8px;border-radius:8px">Plantilla base</span>':'')+'</div>';(p.objetivos||[]).forEach(o=>{h+='<div class="objetivo-card"><div class="objetivo-header"><span class="objetivo-num">O'+o.numero+'</span><span class="trimestre-badge t'+o.trimestre+'">T'+o.trimestre+'</span></div><div class="objetivo-desc">'+o.descripcion+'</div>';if(o.indicadores&&o.indicadores.length){h+='<ul class="indicadores-list">'+o.indicadores.map(x=>'<li>â€¢ '+x+'</li>').join('')+'</ul>';}h+='</div>';});document.getElementById('modalPlantillaBody').innerHTML=h;const deleteBtn=p.esBase?'':'<button class="btn btn-danger btn-sm" onclick="eliminarPlantilla(\''+id+'\')">ğŸ—‘ï¸</button>';document.getElementById('modalPlantillaFooter').innerHTML=deleteBtn+'<button class="btn btn-secondary" onclick="cerrarModal(\'modalPlantilla\')">Cerrar</button><button class="btn btn-primary" onclick="usarPlantilla(\''+id+'\')">ğŸ“¥ Usar</button>';abrirModal('modalPlantilla');}
        
        function usarPlantilla(id){cerrarModal('modalPlantilla');if(!alumnoActual){const ids=Object.keys(alumnos);if(!ids.length){toast('Crea un alumno primero','error');return;}let h='<div class="form-group"><label class="form-label">Selecciona alumno:</label><select class="form-select" id="selAlumnoPlantilla">';ids.forEach(aid=>{h+='<option value="'+aid+'">'+alumnos[aid].siglas+' - '+alumnos[aid].curso+'</option>';});h+='</select></div>';document.getElementById('modalPlantillaBody').innerHTML=h;document.getElementById('modalPlantillaTitulo').textContent='Seleccionar alumno';document.getElementById('modalPlantillaFooter').innerHTML='<button class="btn btn-secondary" onclick="cerrarModal(\'modalPlantilla\')">Cancelar</button><button class="btn btn-primary" onclick="asignarPlantillaAlumno(\''+id+'\')">Asignar</button>';abrirModal('modalPlantilla');}else{asignarPlantilla(id,alumnoActual);}}
        
        function asignarPlantillaAlumno(pid){const aid=document.getElementById('selAlumnoPlantilla').value;cerrarModal('modalPlantilla');asignarPlantilla(pid,aid);}
        
        function asignarPlantilla(pid,aid){const p=plantillas[pid],a=alumnos[aid];if(!p||!a)return;const newPid='p_'+Date.now();const programa={tipo:p.tipo,objetivos:JSON.parse(JSON.stringify(p.objetivos))};db.ref('gestorpe/alumnos/'+aid+'/programas/'+newPid).set(programa).then(()=>{a.programas=a.programas||{};a.programas[newPid]=programa;const nueva=generarProgramacion(a);return db.ref('gestorpe/alumnos/'+aid+'/programacion').set(nueva);}).then(()=>{toast('Plantilla asignada a '+a.siglas,'success');if(alumnoActual===aid){renderProgs();renderProg();}});}
        
        function eliminarPlantilla(id){if(plantillas[id]&&plantillas[id].esBase){toast('No se pueden eliminar plantillas base','error');return;}if(!confirm('Â¿Eliminar plantilla?'))return;db.ref('gestorpe/plantillas/'+id).remove().then(()=>{cerrarModal('modalPlantilla');toast('Eliminada','success');});}
        
        function abrirModalNuevaPlantilla(){document.getElementById('plantillaNombre').value='';document.getElementById('plantillaTexto').value='';document.getElementById('uploadZonePlantilla').innerHTML='ğŸ“„ Toca para seleccionar';document.getElementById('uploadZonePlantilla').classList.remove('has-file');document.getElementById('previewPlantillaNueva').style.display='none';document.getElementById('btnGuardarPlantilla').disabled=true;docExtraidoPlantilla=null;abrirModal('modalNuevaPlantilla');}
        async function cargarDocxPlantilla(inp){const f=inp.files[0];if(!f)return;document.getElementById('uploadZonePlantilla').innerHTML='ğŸ“„ '+f.name;document.getElementById('uploadZonePlantilla').classList.add('has-file');try{const r=await mammoth.extractRawText({arrayBuffer:await f.arrayBuffer()});document.getElementById('plantillaTexto').value=r.value;}catch(e){toast('Error','error');}}
        function analizarTextoPlantilla(){const t=document.getElementById('plantillaTexto').value;if(t.length<20){toast('Pega mÃ¡s contenido','error');return;}const objs=extraerObjetivos(t);if(!objs.length){toast('No se encontraron objetivos','error');return;}docExtraidoPlantilla=objs;document.getElementById('previewPlantillaNueva').innerHTML='âœ“ '+objs.length+' objetivos';document.getElementById('previewPlantillaNueva').style.display='block';document.getElementById('btnGuardarPlantilla').disabled=false;}
        function guardarNuevaPlantilla(){const nombre=document.getElementById('plantillaNombre').value.trim();if(!nombre){toast('Introduce nombre','error');return;}if(!docExtraidoPlantilla||!docExtraidoPlantilla.length){toast('Analiza texto','error');return;}const id='pl_'+Date.now();db.ref('gestorpe/plantillas/'+id).set({nombre:nombre,ciclo:document.getElementById('plantillaCiclo').value,tipo:document.getElementById('plantillaArea').value,objetivos:docExtraidoPlantilla}).then(()=>{cerrarModal('modalNuevaPlantilla');toast('Guardada','success');});}

        // ALUMNOS
        function abrirModalNuevo(){document.getElementById('nuevoSiglas').value='';diasSel=[1,3,4];actualizarDiasBtns();abrirModal('modalNuevo');}
        function toggleDia(d){const idx=diasSel.indexOf(d);if(idx>-1){if(diasSel.length>1)diasSel.splice(idx,1);}else{diasSel.push(d);diasSel.sort((a,b)=>a-b);}actualizarDiasBtns();}
        function actualizarDiasBtns(){document.querySelectorAll('#diasBtns .dia-btn').forEach(btn=>{btn.classList.toggle('active',diasSel.includes(parseInt(btn.dataset.dia)));});}
        function crearAlumno(){const siglas=document.getElementById('nuevoSiglas').value.trim().toUpperCase();if(!siglas){toast('Introduce siglas','error');return;}const cursoSel=document.getElementById('nuevoCurso'),cursoTexto=cursoSel.options[cursoSel.selectedIndex].text,ciclo=cursoSel.value;db.ref('gestorpe/alumnos').push().set({siglas:siglas,curso:cursoTexto,ciclo:ciclo,diasSesion:diasSel.slice(),programas:{},programacion:{},evaluaciones:{},ausencias:{},sincole:{},resultados:{},pasados:{}}).then(()=>{cerrarModal('modalNuevo');toast(siglas+' creado âœ“','success');});}
        function abrirAlumno(id){alumnoActual=id;mesActual=0;evalTrim=1;document.getElementById('screenInicio').classList.remove('active');document.getElementById('screenAlumno').classList.add('active');const a=alumnos[id],diasStr=(a.diasSesion||[0,2,4]).map(d=>DIAS_C[d]).join('-');document.getElementById('alumnoHeader').innerHTML='<div class="alumno-header-siglas">'+a.siglas+'</div><div><h2 style="font-size:.95rem">'+a.curso+'</h2><p style="color:var(--text-light);font-size:.75rem">'+diasStr+'</p></div><div style="margin-left:auto" class="btn-group no-print"><button class="btn btn-secondary btn-sm" onclick="volverInicio()">â† Volver</button><button class="btn btn-secondary btn-sm" onclick="window.print()">ğŸ–¨ï¸</button><button class="btn btn-danger btn-sm" onclick="eliminarAlumno(\''+id+'\')">ğŸ—‘ï¸</button></div>';document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',i===0));document.querySelectorAll('.tab-content').forEach((c,i)=>c.classList.toggle('active',i===0));renderProgs();renderProg();renderEval();renderAsis();}
        function volverInicio(){alumnoActual=null;document.getElementById('screenAlumno').classList.remove('active');document.getElementById('screenInicio').classList.add('active');}
        function cambiarTab(t){document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1)).classList.add('active');if(t==='asistencia')setTimeout(renderAsisCharts,100);if(t==='evaluacion')setTimeout(renderEvalCharts,100);if(t==='seneca')renderSeneca();}
        function eliminarAlumno(id){if(confirm('Â¿Eliminar alumno?')){db.ref('gestorpe/alumnos/'+id).remove();volverInicio();toast('Eliminado','success');}}

        // PROGRAMAS
        function renderProgs(){const a=alumnos[alumnoActual];let h='<div class="card"><div class="card-header"><h3 class="card-title">ğŸ“„ Programas</h3><button class="btn btn-primary btn-sm no-print" onclick="abrirModalAddProg()">â•</button></div>';if(!a.programas||!Object.keys(a.programas).length){h+='<div class="empty-state">Sin programas</div>';}else{Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{icon:'ğŸ“„',nombre:p.tipo,color:'#666'};h+='<div class="programa-card" style="border-left-color:'+info.color+'"><div class="programa-header"><span class="programa-titulo">'+info.icon+' '+info.nombre+'</span><button class="btn btn-danger btn-sm no-print" onclick="elimProg(\''+pId+'\')">ğŸ—‘ï¸</button></div>';(p.objetivos||[]).forEach(obj=>{h+='<div class="objetivo-card"><div class="objetivo-header"><span class="objetivo-num">O'+obj.numero+'</span><span class="trimestre-badge t'+obj.trimestre+'">T'+obj.trimestre+'</span></div><div class="objetivo-desc">'+obj.descripcion+'</div>';if(obj.indicadores&&obj.indicadores.length){h+='<ul class="indicadores-list">'+obj.indicadores.map(x=>'<li>â€¢ '+x+'</li>').join('')+'</ul>';}h+='</div>';});h+='</div>';});}h+='<div class="btn-group no-print" style="margin-top:12px"><button class="btn btn-secondary btn-sm" onclick="regenerarProg()">ğŸ”„ Regenerar</button><button class="btn btn-ai btn-sm" onclick="generarPromptIA()">ğŸ¤– IA</button><button class="btn btn-warning btn-sm" onclick="abrirModal(\'modalImportJSON\')">ğŸ“¥ JSON</button></div></div>';document.getElementById('tabProgramas').innerHTML=h;}
        function abrirModalAddProg(){const a=alumnos[alumnoActual];const cicloAlumno=a.ciclo||'ciclo1';const sel=document.getElementById('selPlantilla');sel.innerHTML='<option value="">-- Elegir plantilla --</option>';Object.keys(plantillas).forEach(id=>{const p=plantillas[id];if(p.ciclo===cicloAlumno){const area=AREAS[p.tipo]||{icon:'ğŸ“„'};sel.innerHTML+='<option value="'+id+'">'+area.icon+' '+p.nombre+'</option>';}});document.getElementById('previewPlantilla').style.display='none';document.getElementById('addProgTipo').value='';document.getElementById('addProgTexto').value='';document.getElementById('uploadZone').innerHTML='ğŸ“„ Toca para seleccionar';document.getElementById('uploadZone').classList.remove('has-file');document.getElementById('previewProg').style.display='none';document.getElementById('zonaDocx').style.display='block';document.getElementById('zonaLecto').style.display='none';docExtraido=null;abrirModal('modalAddProg');}
        function previsualizarPlantilla(){const id=document.getElementById('selPlantilla').value;if(!id){document.getElementById('previewPlantilla').style.display='none';return;}const p=plantillas[id];if(!p)return;const nObj=p.objetivos?p.objetivos.length:0;const nInd=p.objetivos?p.objetivos.reduce((s,o)=>s+(o.indicadores?o.indicadores.length:0),0):0;document.getElementById('previewPlantilla').innerHTML='<strong>'+p.nombre+'</strong><br>'+nObj+' objetivos Â· '+nInd+' indicadores';document.getElementById('previewPlantilla').style.display='block';}
        function cambioTipoProg(){const t=document.getElementById('addProgTipo').value;document.getElementById('zonaDocx').style.display=t==='lectoescritura'?'none':'block';document.getElementById('zonaLecto').style.display=t==='lectoescritura'?'block':'none';}
        async function cargarDocx(inp){const f=inp.files[0];if(!f)return;document.getElementById('uploadZone').innerHTML='ğŸ“„ '+f.name;document.getElementById('uploadZone').classList.add('has-file');try{const r=await mammoth.extractRawText({arrayBuffer:await f.arrayBuffer()});procesarTexto(r.value);}catch(e){toast('Error','error');}}
        function analizarTexto(){const t=document.getElementById('addProgTexto').value;if(t.length<20){toast('Pega mÃ¡s contenido','error');return;}procesarTexto(t);}
        function procesarTexto(txt){const objs=extraerObjetivos(txt);if(!objs.length){toast('No se encontraron objetivos','error');return;}docExtraido=objs;document.getElementById('previewProg').innerHTML='âœ“ '+objs.length+' objetivos';document.getElementById('previewProg').style.display='block';}
        function extraerObjetivos(txt){const objs=[],lineas=txt.split('\n');let actual=null,seccion=null;for(let i=0;i<lineas.length;i++){const lt=lineas[i].trim();if(!lt)continue;const m=lt.match(/^OBJETIVO\s*(\d+)[.:]\s*(.+)?/i)||lt.match(/^(\d+)[.\-)\s]+(.{15,})/);if(m){if(actual)objs.push(actual);actual={numero:parseInt(m[1]),descripcion:(m[2]||'').trim(),indicadores:[],trimestre:1};seccion=null;continue;}if(lt.toUpperCase().indexOf('INDICADOR')>-1){seccion='indicadores';continue;}if(actual&&seccion==='indicadores'&&lt.length>5){const ind=lt.replace(/^[-â€¢Â·â–ªâ–ºâ—â—‹â—¦â€£âƒ*]\s*/,'').trim();if(ind.length>5)actual.indicadores.push(ind);}}if(actual)objs.push(actual);const n=objs.length,p=Math.ceil(n/3);objs.forEach((o,i)=>{o.trimestre=i<p?1:(i<p*2?2:3);if(!o.indicadores.length)o.indicadores=['Indicador de '+o.descripcion.substring(0,20)];});return objs;}
        function addPrograma(){const plantillaId=document.getElementById('selPlantilla').value;if(plantillaId){asignarPlantilla(plantillaId,alumnoActual);cerrarModal('modalAddProg');return;}const tipo=document.getElementById('addProgTipo').value;if(!tipo){toast('Selecciona tipo o plantilla','error');return;}const objetivos=tipo==='lectoescritura'?LECTO:docExtraido;if(!objetivos||!objetivos.length){toast('Sin objetivos','error');return;}const a=alumnos[alumnoActual],pId='p_'+Date.now();db.ref('gestorpe/alumnos/'+alumnoActual+'/programas/'+pId).set({tipo:tipo,objetivos:objetivos}).then(()=>{a.programas=a.programas||{};a.programas[pId]={tipo:tipo,objetivos:objetivos};const nueva=generarProgramacion(a);return db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(nueva);}).then(()=>{cerrarModal('modalAddProg');renderProgs();renderProg();toast('AÃ±adido âœ“','success');});}
        function elimProg(pId){if(!confirm('Â¿Eliminar?'))return;db.ref('gestorpe/alumnos/'+alumnoActual+'/programas/'+pId).remove().then(()=>{delete alumnos[alumnoActual].programas[pId];return db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(generarProgramacion(alumnos[alumnoActual]));}).then(()=>{renderProgs();renderProg();toast('Eliminado','success');});}

        // PROGRAMACIÃ“N
        function getIndicadoresPasados(a,trim){const pasados=a.pasados||{},result=[];Object.keys(pasados).forEach(k=>{if(pasados[k]===trim){const parts=k.split('_');result.push({pId:parts[0],oIdx:parseInt(parts[1]),iIdx:parseInt(parts[2]),key:k});}});return result;}
        function getTodasLasSesiones(a){const dias=a.diasSesion||[1,3,4],keys=[];for(let mi=0;mi<MESES.length;mi++){const m=MESES[mi];for(let s=1;s<=m.semanas;s++){for(let di=0;di<dias.length;di++){keys.push(mi+'_'+s+'_'+dias[di]);}}}return keys;}
        function generarProgramacion(a){const prog={};if(!a.programas)return prog;const pIds=Object.keys(a.programas);if(!pIds.length)return prog;const todasSesiones=getTodasLasSesiones(a);const sesionesPorTrim={1:0,2:0,3:0};todasSesiones.forEach(k=>{const mi=parseInt(k.split('_')[0]);sesionesPorTrim[MESES[mi].trim]++;});const poolT={1:[],2:[],3:[]};pIds.forEach(pId=>{const p=a.programas[pId];(p.objetivos||[]).forEach((o,oi)=>{const trim=o.trimestre||1;(o.indicadores||['Indicador']).forEach((_,ii)=>{poolT[trim].push({pId:pId,oIdx:oi,iIdx:ii});});});});[2,3].forEach(t=>{getIndicadoresPasados(a,t).forEach(p=>poolT[t].push({pId:p.pId,oIdx:p.oIdx,iIdx:p.iIdx}));});[1,2,3].forEach(t=>{if(poolT[t].length<2)return;const porProg={};poolT[t].forEach(item=>{if(!porProg[item.pId])porProg[item.pId]=[];porProg[item.pId].push(item);});const pIdsEnPool=Object.keys(porProg);if(pIdsEnPool.length<2)return;const nuevo=[];let maxLen=Math.max(...pIdsEnPool.map(id=>porProg[id].length));for(let i=0;i<maxLen;i++){pIdsEnPool.forEach(id=>{if(porProg[id][i])nuevo.push(porProg[id][i]);});}poolT[t]=nuevo;});[1,2,3].forEach(t=>{if(!poolT[t].length)return;const sesiones=sesionesPorTrim[t];while(poolT[t].length<sesiones){const original=[...poolT[t]];for(let i=0;i<original.length&&poolT[t].length<sesiones;i++){poolT[t].push({...original[i]});}}});let idxT={1:0,2:0,3:0};todasSesiones.forEach(k=>{const mi=parseInt(k.split('_')[0]);const trim=MESES[mi].trim;const pool=poolT[trim];if(!pool.length)return;prog[k]=pool[idxT[trim]%pool.length];idxT[trim]++;});return prog;}
        function regenerarProg(){const a=alumnos[alumnoActual];if(!a.programas||!Object.keys(a.programas).length){toast('AÃ±ade programa','error');return;}const nueva=generarProgramacion(a);db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(nueva).then(()=>{a.programacion=nueva;renderProg();toast('Regenerado âœ“','success');});}
        function reajustarDesde(a,desdeClave){const todasSesiones=getTodasLasSesiones(a);const idx=todasSesiones.indexOf(desdeClave);if(idx<0)return a.programacion;const nueva={...a.programacion};for(let i=todasSesiones.length-1;i>idx;i--){const keyActual=todasSesiones[i];const keyAnterior=todasSesiones[i-1];if(nueva[keyAnterior]){nueva[keyActual]=nueva[keyAnterior];}}delete nueva[desdeClave];return nueva;}
        function insertarRepeticion(a,clave,contenido){const todasSesiones=getTodasLasSesiones(a);const idx=todasSesiones.indexOf(clave);if(idx<0)return a.programacion;const dias=a.diasSesion||[1,3,4];let idxRepetir=idx+dias.length;if(idxRepetir>=todasSesiones.length)idxRepetir=todasSesiones.length-1;const claveRepetir=todasSesiones[idxRepetir];const nueva={...a.programacion};for(let i=todasSesiones.length-1;i>idxRepetir;i--){const keyActual=todasSesiones[i];const keyAnterior=todasSesiones[i-1];if(nueva[keyAnterior]){nueva[keyActual]=nueva[keyAnterior];}}nueva[claveRepetir]=contenido;return nueva;}
        function generarPromptIA(){const a=alumnos[alumnoActual];if(!a.programas||!Object.keys(a.programas).length){toast('AÃ±ade programas','error');return;}const dias=a.diasSesion||[1,3,4];const todasSesiones=getTodasLasSesiones(a);let prompt='Genera programaciÃ³n COMPLETA curso 2025/2026.\n\nğŸ‘¤ '+a.siglas+' ('+a.curso+')\nğŸ“† '+dias.map(d=>DIAS_C[d]).join(', ')+'\nğŸ“Š '+todasSesiones.length+' sesiones\n\nğŸ“š PROGRAMAS:\n';Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};prompt+='\nğŸ”· '+info.nombre+' (ID: "'+pId+'")\n';(p.objetivos||[]).forEach((obj,oi)=>{prompt+='  O'+obj.numero+' (oIdx:'+oi+', T'+obj.trimestre+'): '+obj.descripcion+'\n';(obj.indicadores||[]).forEach((ind,ii)=>{prompt+='    - iIdx:'+ii+': '+ind+'\n';});});});prompt+='\nğŸ“¤ RESPONDE SOLO JSON:\n{"mes_semana_dia": {"pId": "...", "oIdx": N, "iIdx": N}, ...}\n\nâš ï¸ '+todasSesiones.length+' entradas. Alterna 50-50. Respeta trimestres.';navigator.clipboard.writeText(prompt).then(()=>{toast('Copiado','success');window.open('https://chat.openai.com/','_blank');});}
        function importarJSON(){const txt=document.getElementById('jsonInput').value.trim();if(!txt){toast('Pega JSON','error');return;}try{let cleanJSON=txt.replace(/```json?\n?/g,'').replace(/```/g,'').trim();const prog=JSON.parse(cleanJSON);db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(prog).then(()=>{alumnos[alumnoActual].programacion=prog;cerrarModal('modalImportJSON');document.getElementById('jsonInput').value='';renderProg();toast('Importado âœ“','success');});}catch(e){toast('Error JSON','error');}}
        function renderProg(){const a=alumnos[alumnoActual],dias=a.diasSesion||[1,3,4],noms=dias.map(d=>DIAS_C[d]),mes=MESES[mesActual],st=calcStats(a);let h='<div class="card"><div class="stats-box no-print"><div class="stat-item"><div class="stat-num" style="color:var(--danger)">'+(st.porMes[mesActual]?st.porMes[mesActual].aus:0)+'</div><div class="stat-label">Ausencias</div></div></div><div class="cuadrante-nav no-print"><button class="nav-btn" onclick="cambiarMes(-1)">â—€</button><select class="form-select" style="width:auto" onchange="mesActual=parseInt(this.value);renderProg()">';for(let i=0;i<MESES.length;i++){h+='<option value="'+i+'"'+(i===mesActual?' selected':'')+'>'+MESES[i].nombre+'</option>';}h+='</select><button class="nav-btn" onclick="cambiarMes(1)">â–¶</button><span class="trimestre-badge t'+mes.trim+'">T'+mes.trim+'</span></div><div class="leyenda no-print"><div class="leyenda-item"><div class="leyenda-color" style="background:#fee2e2"></div>Ausencia</div><div class="leyenda-item"><div class="leyenda-color" style="background:#e0e7ff"></div>Sin cole</div></div><div style="overflow-x:auto;margin-top:8px"><table class="cuadrante-table"><thead><tr><th>S</th>';for(let i=0;i<noms.length;i++){h+='<th>'+noms[i]+'</th>';}h+='</tr></thead><tbody>';for(let si=0;si<mes.semanas;si++){const sem=si+1;h+='<tr><td>'+sem+'</td>';for(let di=0;di<dias.length;di++){h+=renderCelda(a,mesActual+'_'+sem+'_'+dias[di],dias[di]);}h+='</tr>';}h+='</tbody></table></div></div>';document.getElementById('tabProgramacion').innerHTML=h;}
        function renderCelda(a,k,d){const c=a.programacion?a.programacion[k]:null,aus=a.ausencias?a.ausencias[k]:false,sc=a.sincole?a.sincole[k]:false,res=a.resultados?a.resultados[k]:null;let cls='celda',icon='';if(sc){cls+=' celda-sincole';icon='ğŸ«';}else if(aus){cls+=' celda-ausencia';icon='âŒ';}else if(res==='conseguido'){icon='âœ…';}else if(res==='repetir'){icon='ğŸ”„';}if(!c||!a.programas||!a.programas[c.pId]){return'<td class="'+cls+' celda-vacia" onclick="editarCelda(\''+k+'\','+d+')">'+(icon?'<span class="celda-icon">'+icon+'</span>':'')+'+</td>';}const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;if(!obj)return'<td class="'+cls+'">?</td>';const info=AREAS[p.tipo]||{color:'#666'},ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';return'<td class="'+cls+'" onclick="editarCelda(\''+k+'\','+d+')">'+(icon?'<span class="celda-icon">'+icon+'</span>':'')+'<div class="celda-obj" style="color:'+info.color+'">O'+obj.numero+'</div><div class="celda-ind">'+ind.substring(0,25)+(ind.length>25?'...':'')+'</div></td>';}
        function cambiarMes(dir){mesActual=Math.max(0,Math.min(9,mesActual+dir));renderProg();}
        function editarCelda(k,d){celdaEditando=k;estadoCelda='asiste';resultadoCelda=null;const a=alumnos[alumnoActual],c=a.programacion?a.programacion[k]:{};document.getElementById('celdaTitulo').textContent=DIAS[d];document.querySelectorAll('.asist-btn').forEach(b=>b.classList.remove('selected'));document.querySelectorAll('.resultado-btn').forEach(b=>b.classList.remove('selected'));if(a.sincole&&a.sincole[k]){estadoCelda='sincole';document.querySelector('.asist-btn.sincole').classList.add('selected');document.getElementById('contenidoSesion').style.display='none';}else if(a.ausencias&&a.ausencias[k]){estadoCelda='ausencia';document.querySelector('.asist-btn.ausencia').classList.add('selected');document.getElementById('contenidoSesion').style.display='none';}else{document.querySelector('.asist-btn.asiste').classList.add('selected');document.getElementById('contenidoSesion').style.display='block';}resultadoCelda=(a.resultados&&a.resultados[k])?a.resultados[k]:null;if(resultadoCelda){const btn=document.querySelector('.resultado-btn.'+resultadoCelda);if(btn)btn.classList.add('selected');}const sel=document.getElementById('selPrograma');sel.innerHTML='<option value="">-</option>';if(a.programas){Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{icon:'ğŸ“„'};sel.innerHTML+='<option value="'+pId+'"'+(c.pId===pId?' selected':'')+'>'+info.icon+' '+(info.nombre||p.tipo)+'</option>';});}if(c.pId){cargarObjetivos();setTimeout(()=>{document.getElementById('selObjetivo').value=c.oIdx!==undefined?c.oIdx:'';cargarIndicadores();setTimeout(()=>{document.getElementById('selIndicador').value=c.iIdx!==undefined?c.iIdx:'';},30);},30);}else{document.getElementById('selObjetivo').innerHTML='<option value="">-</option>';document.getElementById('selIndicador').innerHTML='<option value="">-</option>';}abrirModal('modalCelda');}
        function setEstado(e,btn){estadoCelda=e;document.querySelectorAll('.asist-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');document.getElementById('contenidoSesion').style.display=e==='asiste'?'block':'none';}
        function setResultado(r,btn){if(resultadoCelda===r){resultadoCelda=null;btn.classList.remove('selected');}else{resultadoCelda=r;document.querySelectorAll('.resultado-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');}}
        function cargarObjetivos(){const a=alumnos[alumnoActual],pId=document.getElementById('selPrograma').value,sel=document.getElementById('selObjetivo');sel.innerHTML='<option value="">-</option>';document.getElementById('selIndicador').innerHTML='<option value="">-</option>';if(!pId||!a.programas||!a.programas[pId])return;a.programas[pId].objetivos.forEach((o,i)=>{sel.innerHTML+='<option value="'+i+'">O'+o.numero+': '+o.descripcion.substring(0,20)+'...</option>';});}
        function cargarIndicadores(){const a=alumnos[alumnoActual],pId=document.getElementById('selPrograma').value,oIdx=document.getElementById('selObjetivo').value,sel=document.getElementById('selIndicador');sel.innerHTML='<option value="">-</option>';if(!pId||oIdx==='')return;const inds=a.programas[pId].objetivos[parseInt(oIdx)].indicadores||[];inds.forEach((x,i)=>{sel.innerHTML+='<option value="'+i+'">'+x.substring(0,30)+'...</option>';});}
        function guardarCelda(){const a=alumnos[alumnoActual];const updates={};const contenidoActual=a.programacion?a.programacion[celdaEditando]:null;updates['gestorpe/alumnos/'+alumnoActual+'/ausencias/'+celdaEditando]=null;updates['gestorpe/alumnos/'+alumnoActual+'/sincole/'+celdaEditando]=null;updates['gestorpe/alumnos/'+alumnoActual+'/resultados/'+celdaEditando]=null;if(estadoCelda==='ausencia'||estadoCelda==='sincole'){const tipo=estadoCelda==='ausencia'?'ausencias':'sincole';updates['gestorpe/alumnos/'+alumnoActual+'/'+tipo+'/'+celdaEditando]=true;if(contenidoActual){const nuevaProg=reajustarDesde(a,celdaEditando);updates['gestorpe/alumnos/'+alumnoActual+'/programacion']=nuevaProg;}}else{const pId=document.getElementById('selPrograma').value;const oIdx=document.getElementById('selObjetivo').value;const iIdx=document.getElementById('selIndicador').value;if(pId&&oIdx!==''){const nuevoContenido={pId:pId,oIdx:parseInt(oIdx),iIdx:iIdx!==''?parseInt(iIdx):0};if(resultadoCelda==='repetir'){// Primero actualizar la celda actual en el objeto local
                    a.programacion=a.programacion||{};a.programacion[celdaEditando]=nuevoContenido;
                    // Luego insertar repeticiÃ³n (que desplaza todo)
                    const nuevaProg=insertarRepeticion(a,celdaEditando,nuevoContenido);
                    updates['gestorpe/alumnos/'+alumnoActual+'/programacion']=nuevaProg;}else{updates['gestorpe/alumnos/'+alumnoActual+'/programacion/'+celdaEditando]=nuevoContenido;}}if(resultadoCelda){updates['gestorpe/alumnos/'+alumnoActual+'/resultados/'+celdaEditando]=resultadoCelda;}}db.ref().update(updates).then(()=>{cerrarModal('modalCelda');toast(resultadoCelda==='repetir'?'RepeticiÃ³n insertada âœ“':'Guardado âœ“','success');});}
        function borrarCelda(){const updates={};['programacion','ausencias','sincole','resultados'].forEach(t=>{updates['gestorpe/alumnos/'+alumnoActual+'/'+t+'/'+celdaEditando]=null;});db.ref().update(updates).then(()=>{cerrarModal('modalCelda');toast('Eliminado','success');});}
        function calcStats(a){const aus=a.ausencias||{},res=a.resultados||{};let ausencias=0,conseguidos=0,repetir=0;const dias=a.diasSesion||[1,3,4],porMes={},porTrim={1:{aus:0},2:{aus:0},3:{aus:0}};for(let mi=0;mi<MESES.length;mi++){const m=MESES[mi];porMes[mi]={aus:0};for(let s=1;s<=m.semanas;s++){for(let di=0;di<dias.length;di++){const k=mi+'_'+s+'_'+dias[di];if(aus[k]){ausencias++;porMes[mi].aus++;porTrim[m.trim].aus++;}if(res[k]==='conseguido')conseguidos++;if(res[k]==='repetir')repetir++;}}}return{ausencias:ausencias,conseguidos:conseguidos,repetir:repetir,porMes:porMes,porTrim:porTrim};}

        // EVALUACIÃ“N
        function renderEval(){const a=alumnos[alumnoActual];let h='<div class="card"><div class="card-header"><h3 class="card-title">ğŸ“Š EvaluaciÃ³n</h3></div><div class="btn-group no-print" style="margin-bottom:12px"><button class="btn '+(evalTrim===1?'btn-primary':'btn-secondary')+' btn-sm" onclick="setTrim(1)">T1</button><button class="btn '+(evalTrim===2?'btn-primary':'btn-secondary')+' btn-sm" onclick="setTrim(2)">T2</button><button class="btn '+(evalTrim===3?'btn-primary':'btn-secondary')+' btn-sm" onclick="setTrim(3)">T3</button><button class="btn btn-warning btn-sm" onclick="abrirModalInforme()">ğŸ“„ Informe</button>';if(evalTrim<3){h+='<button class="btn btn-ai btn-sm" onclick="pasarNoConseguidos()">ğŸ“¤ P/Nâ†’T'+(evalTrim+1)+'</button>';}h+='</div><div class="chart-container no-print"><canvas id="chartProgreso"></canvas></div><div id="pctArea" class="no-print"></div><div id="evalList"></div></div>';document.getElementById('tabEvaluacion').innerHTML=h;renderEvalList();setTimeout(renderEvalCharts,100);}
        function setTrim(t){evalTrim=t;renderEval();}
        function renderEvalCharts(){const a=alumnos[alumnoActual];if(!a.programas)return;const ctx=document.getElementById('chartProgreso');if(!ctx)return;if(charts.progreso)charts.progreso.destroy();const labels=[],conseguidos=[],proceso=[],noIniciados=[];const pasadosAqui=getIndicadoresPasados(a,evalTrim);Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};const objsT=(p.objetivos||[]).filter(o=>o.trimestre===evalTrim);const pasadosProg=pasadosAqui.filter(x=>x.pId===pId);if(!objsT.length&&!pasadosProg.length)return;labels.push(info.nombre.substring(0,12));let c=0,pr=0,n=0;objsT.forEach(obj=>{const oi=p.objetivos.indexOf(obj);(obj.indicadores||[]).forEach((_,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:null;if(e==='C')c++;else if(e==='P')pr++;else n++;});});pasadosProg.forEach(item=>{const k=item.pId+'_'+item.oIdx+'_'+item.iIdx+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:null;if(e==='C')c++;else if(e==='P')pr++;else n++;});conseguidos.push(c);proceso.push(pr);noIniciados.push(n);});charts.progreso=new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'Conseguido',data:conseguidos,backgroundColor:'#22c55e'},{label:'En proceso',data:proceso,backgroundColor:'#3b82f6'},{label:'No iniciado',data:noIniciados,backgroundColor:'#d1d5db'}]},options:{responsive:true,plugins:{legend:{position:'bottom'},title:{display:true,text:'Indicadores T'+evalTrim}},scales:{x:{stacked:true},y:{stacked:true}}}});
            // % consecuciÃ³n por Ã¡rea
            let pctHtml='<div style="margin-top:10px">';
            labels.forEach((lbl,i)=>{const total=conseguidos[i]+proceso[i]+noIniciados[i];const pct=total?Math.round(conseguidos[i]/total*100):0;const pctP=total?Math.round(proceso[i]/total*100):0;const bar=pct+pctP;pctHtml+='<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:.75rem"><span style="min-width:90px;font-weight:600;color:var(--primary)">'+lbl+'</span><div style="flex:1;background:#e5e7eb;border-radius:6px;height:18px;overflow:hidden;display:flex"><div style="width:'+pct+'%;background:#22c55e;height:100%"></div><div style="width:'+pctP+'%;background:#3b82f6;height:100%"></div></div><span style="min-width:36px;text-align:right;font-weight:700;color:'+(pct>=60?'#22c55e':pct>=30?'#f59e0b':'#ef4444')+'">'+pct+'%</span></div>';});
            pctHtml+='<div style="display:flex;gap:12px;justify-content:center;margin-top:4px;font-size:.65rem;color:var(--text-light)"><span>ğŸŸ© Conseguido</span><span>ğŸŸ¦ En proceso</span><span>â¬œ No iniciado</span></div></div>';
            const pctContainer=document.getElementById('pctArea');
            if(pctContainer) pctContainer.innerHTML=pctHtml;
        }
        function renderEvalList(){const a=alumnos[alumnoActual],c=document.getElementById('evalList');let h='',hay=false;if(!a.programas){c.innerHTML='<p style="text-align:center;color:var(--text-light)">Sin programas</p>';return;}const pasadosAqui=getIndicadoresPasados(a,evalTrim);Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{icon:'ğŸ“„',nombre:p.tipo,color:'#666'};const objsT=(p.objetivos||[]).filter(o=>o.trimestre===evalTrim);const pasadosProg=pasadosAqui.filter(x=>x.pId===pId);if(!objsT.length&&!pasadosProg.length)return;hay=true;h+='<div class="programa-card" style="border-left-color:'+info.color+'"><div class="programa-titulo" style="margin-bottom:8px">'+info.icon+' '+info.nombre+'</div>';objsT.forEach(obj=>{const oi=p.objetivos.indexOf(obj);h+='<div style="margin-bottom:8px"><div style="font-weight:600;font-size:.8rem;margin-bottom:4px">O'+obj.numero+': '+obj.descripcion.substring(0,30)+'...</div>';(obj.indicadores||[]).forEach((ind,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';h+='<div class="eval-item"><span class="eval-text">'+ind+'</span><button class="eval-btn c '+(e==='C'?'active':'')+'" onclick="setEval(\''+pId+'\','+oi+','+ii+',\'C\')">âœ“</button><button class="eval-btn p '+(e==='P'?'active':'')+'" onclick="setEval(\''+pId+'\','+oi+','+ii+',\'P\')">â—</button><button class="eval-btn n '+(e==='N'?'active':'')+'" onclick="setEval(\''+pId+'\','+oi+','+ii+',\'N\')">â—‹</button></div>';});h+='</div>';});if(pasadosProg.length){h+='<div style="margin-top:8px;padding-top:8px;border-top:1px dashed var(--border)"><div style="font-size:.75rem;color:var(--warning);margin-bottom:6px">ğŸ“¤ Pasados:</div>';pasadosProg.forEach(item=>{const obj=p.objetivos[item.oIdx];if(!obj)return;const ind=obj.indicadores?obj.indicadores[item.iIdx]:'';const k=pId+'_'+item.oIdx+'_'+item.iIdx+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';h+='<div class="eval-item"><span class="eval-text">O'+obj.numero+': '+ind+'<span class="pasado-badge">T'+(evalTrim-1)+'</span></span><button class="eval-btn c '+(e==='C'?'active':'')+'" onclick="setEval(\''+pId+'\','+item.oIdx+','+item.iIdx+',\'C\')">âœ“</button><button class="eval-btn p '+(e==='P'?'active':'')+'" onclick="setEval(\''+pId+'\','+item.oIdx+','+item.iIdx+',\'P\')">â—</button><button class="eval-btn n '+(e==='N'?'active':'')+'" onclick="setEval(\''+pId+'\','+item.oIdx+','+item.iIdx+',\'N\')">â—‹</button></div>';});h+='</div>';}h+='</div>';});c.innerHTML=hay?h:'<p style="text-align:center;color:var(--text-light)">Sin indicadores en T'+evalTrim+'</p>';}
        function setEval(pId,oi,ii,e){const a=alumnos[alumnoActual],k=pId+'_'+oi+'_'+ii+'_T'+evalTrim;a.evaluaciones=a.evaluaciones||{};if(a.evaluaciones[k]===e){db.ref('gestorpe/alumnos/'+alumnoActual+'/evaluaciones/'+k).remove();delete a.evaluaciones[k];}else{db.ref('gestorpe/alumnos/'+alumnoActual+'/evaluaciones/'+k).set(e);a.evaluaciones[k]=e;}renderEvalList();setTimeout(renderEvalCharts,100);}
        function pasarNoConseguidos(){if(evalTrim>=3)return;const a=alumnos[alumnoActual];if(!a.programas)return;const siguienteTrim=evalTrim+1,updates={};let count=0;Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId];(p.objetivos||[]).forEach((obj,oi)=>{if(obj.trimestre!==evalTrim)return;(obj.indicadores||[]).forEach((_,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';if(e!=='C'){const pasadoKey=pId+'_'+oi+'_'+ii;updates['gestorpe/alumnos/'+alumnoActual+'/pasados/'+pasadoKey]=siguienteTrim;count++;}});});});const pasadosActuales=getIndicadoresPasados(a,evalTrim);pasadosActuales.forEach(item=>{const k=item.pId+'_'+item.oIdx+'_'+item.iIdx+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';if(e!=='C'){updates['gestorpe/alumnos/'+alumnoActual+'/pasados/'+item.key]=siguienteTrim;count++;}});if(count===0){toast('Â¡Todo conseguido!','success');return;}db.ref().update(updates).then(()=>{const nueva=generarProgramacion(alumnos[alumnoActual]);return db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(nueva);}).then(()=>{toast(count+' â†’ T'+siguienteTrim,'success');evalTrim=siguienteTrim;renderEval();renderProg();});}

        // RESUMEN
        function renderAsis(){const a=alumnos[alumnoActual],st=calcStats(a);let totalC=0,totalP=0,totalN=0;if(a.evaluaciones){Object.keys(a.evaluaciones).forEach(k=>{const e=a.evaluaciones[k];if(e==='C')totalC++;else if(e==='P')totalP++;else if(e==='N')totalN++;});}document.getElementById('tabAsistencia').innerHTML='<div class="card"><div class="card-header"><h3 class="card-title">ğŸ“ˆ Resumen</h3></div><div class="stats-box"><div class="stat-item"><div class="stat-num" style="color:var(--danger)">'+st.ausencias+'</div><div class="stat-label">Ausencias</div></div><div class="stat-item"><div class="stat-num" style="color:var(--success)">'+st.conseguidos+'</div><div class="stat-label">Sesiones OK</div></div><div class="stat-item"><div class="stat-num" style="color:var(--warning)">'+st.repetir+'</div><div class="stat-label">Repetir</div></div></div><div class="stats-box"><div class="stat-item"><div class="stat-num" style="color:var(--success)">'+totalC+'</div><div class="stat-label">Conseguidos</div></div><div class="stat-item"><div class="stat-num" style="color:var(--proceso)">'+totalP+'</div><div class="stat-label">En proceso</div></div><div class="stat-item"><div class="stat-num" style="color:gray">'+totalN+'</div><div class="stat-label">No iniciados</div></div></div><div class="chart-container"><canvas id="chartAusTrim"></canvas></div><div class="chart-container" style="margin-top:12px"><canvas id="chartCompTrim"></canvas></div><div class="chart-container" style="margin-top:12px"><canvas id="chartRadar"></canvas></div></div>';setTimeout(renderAsisCharts,100);}
        function renderAsisCharts(){
            const a=alumnos[alumnoActual],st=calcStats(a);
            // Ausencias por trimestre
            const ctx1=document.getElementById('chartAusTrim');
            if(ctx1){if(charts.ausTrim)charts.ausTrim.destroy();charts.ausTrim=new Chart(ctx1,{type:'bar',data:{labels:['T1','T2','T3'],datasets:[{label:'Ausencias',data:[st.porTrim[1].aus,st.porTrim[2].aus,st.porTrim[3].aus],backgroundColor:'#ef4444'}]},options:{responsive:true,plugins:{legend:{display:false},title:{display:true,text:'Ausencias por trimestre'}}}});}

            if(!a.programas) return;

            // Comparativa trimestres: C/P/N por cada trimestre
            const trimData={1:{c:0,p:0,n:0,total:0},2:{c:0,p:0,n:0,total:0},3:{c:0,p:0,n:0,total:0}};
            Object.keys(a.programas).forEach(pId=>{const pr=a.programas[pId];
                (pr.objetivos||[]).forEach((obj,oi)=>{const t=obj.trimestre||1;
                    (obj.indicadores||[]).forEach((_,ii)=>{
                        const k=pId+'_'+oi+'_'+ii+'_T'+t,e=a.evaluaciones?a.evaluaciones[k]:null;
                        trimData[t].total++;
                        if(e==='C')trimData[t].c++;else if(e==='P')trimData[t].p++;else trimData[t].n++;
                    });
                });
            });
            const ctx2=document.getElementById('chartCompTrim');
            if(ctx2){if(charts.compTrim)charts.compTrim.destroy();
                const pctC=[1,2,3].map(t=>trimData[t].total?Math.round(trimData[t].c/trimData[t].total*100):0);
                const pctP=[1,2,3].map(t=>trimData[t].total?Math.round(trimData[t].p/trimData[t].total*100):0);
                const pctN=[1,2,3].map(t=>trimData[t].total?Math.round(trimData[t].n/trimData[t].total*100):0);
                charts.compTrim=new Chart(ctx2,{type:'bar',data:{labels:['Trimestre 1','Trimestre 2','Trimestre 3'],datasets:[
                    {label:'Conseguido %',data:pctC,backgroundColor:'#22c55e'},
                    {label:'En proceso %',data:pctP,backgroundColor:'#3b82f6'},
                    {label:'No iniciado %',data:pctN,backgroundColor:'#d1d5db'}
                ]},options:{responsive:true,plugins:{title:{display:true,text:'Comparativa por trimestres (%)'},legend:{position:'bottom'}},scales:{x:{stacked:true},y:{stacked:true,max:100,ticks:{callback:v=>v+'%'}}}}});
            }

            // Radar por Ã¡reas
            const areaData={};
            Object.keys(a.programas).forEach(pId=>{const pr=a.programas[pId],info=AREAS[pr.tipo]||{nombre:pr.tipo};
                if(!areaData[pr.tipo])areaData[pr.tipo]={nombre:info.nombre,c:0,total:0};
                (pr.objetivos||[]).forEach((obj,oi)=>{
                    (obj.indicadores||[]).forEach((_,ii)=>{
                        areaData[pr.tipo].total++;
                        for(let t=1;t<=3;t++){const k=pId+'_'+oi+'_'+ii+'_T'+t,e=a.evaluaciones?a.evaluaciones[k]:null;if(e==='C'){areaData[pr.tipo].c++;break;}}
                    });
                });
            });
            const radarLabels=[],radarData=[];
            Object.values(areaData).forEach(d=>{radarLabels.push(d.nombre.substring(0,14));radarData.push(d.total?Math.round(d.c/d.total*100):0);});
            const ctx3=document.getElementById('chartRadar');
            if(ctx3&&radarLabels.length>=3){if(charts.radar)charts.radar.destroy();
                charts.radar=new Chart(ctx3,{type:'radar',data:{labels:radarLabels,datasets:[{label:'% Conseguido',data:radarData,backgroundColor:'rgba(34,197,94,0.2)',borderColor:'#22c55e',pointBackgroundColor:'#22c55e',pointRadius:4}]},options:{responsive:true,plugins:{title:{display:true,text:'ConsecuciÃ³n por Ã¡rea'},legend:{display:false}},scales:{r:{beginAtZero:true,max:100,ticks:{stepSize:25,callback:v=>v+'%'}}}}});
            }else if(ctx3&&radarLabels.length<3){
                ctx3.parentElement.innerHTML='<p style="text-align:center;color:var(--text-light);padding:12px;font-size:.8rem">El radar necesita al menos 3 Ã¡reas</p>';
            }
        }

        // ESTADÃSTICAS GLOBALES
        function renderEstadisticasGlobal(){
            const ids=Object.keys(alumnos);
            if(!ids.length) return;

            // RANKING DE PROGRESO
            const ranking=[];
            ids.forEach(id=>{
                const a=alumnos[id];let totalInd=0,totalC=0;
                if(a.programas){Object.keys(a.programas).forEach(pId=>{const pr=a.programas[pId];
                    (pr.objetivos||[]).forEach((obj,oi)=>{(obj.indicadores||[]).forEach((_,ii)=>{
                        totalInd++;
                        for(let t=1;t<=3;t++){const k=pId+'_'+oi+'_'+ii+'_T'+t,e=a.evaluaciones?a.evaluaciones[k]:null;if(e==='C'){totalC++;break;}}
                    });});
                });}
                ranking.push({siglas:a.siglas,pct:totalInd?Math.round(totalC/totalInd*100):0});
            });
            ranking.sort((a,b)=>b.pct-a.pct);
            const ctxR=document.getElementById('chartRanking');
            if(ctxR){if(charts.ranking)charts.ranking.destroy();
                const colors=ranking.map(r=>r.pct>=60?'#22c55e':r.pct>=30?'#f59e0b':'#ef4444');
                charts.ranking=new Chart(ctxR,{type:'bar',data:{labels:ranking.map(r=>r.siglas),datasets:[{label:'% Conseguido',data:ranking.map(r=>r.pct),backgroundColor:colors}]},options:{indexAxis:'y',responsive:true,plugins:{title:{display:true,text:'Ranking de progreso (% indicadores conseguidos)'},legend:{display:false}},scales:{x:{max:100,ticks:{callback:v=>v+'%'}}}}});
            }

            // DISTRIBUCIÃ“N POR ÃREAS
            const areaCounts={};
            ids.forEach(id=>{const a=alumnos[id];
                if(a.programas){Object.keys(a.programas).forEach(pId=>{const pr=a.programas[pId],info=AREAS[pr.tipo]||{nombre:pr.tipo};
                    if(!areaCounts[pr.tipo])areaCounts[pr.tipo]={nombre:info.nombre,color:info.color||'#999',count:0};
                    areaCounts[pr.tipo].count++;
                });}
            });
            const areaVals=Object.values(areaCounts);
            const ctxD=document.getElementById('chartDistAreas');
            if(ctxD&&areaVals.length){if(charts.distAreas)charts.distAreas.destroy();
                charts.distAreas=new Chart(ctxD,{type:'doughnut',data:{labels:areaVals.map(a=>a.nombre),datasets:[{data:areaVals.map(a=>a.count),backgroundColor:areaVals.map(a=>a.color)}]},options:{responsive:true,plugins:{title:{display:true,text:'DistribuciÃ³n de programas por Ã¡rea'},legend:{position:'bottom'}}}});
            }
        }

        // SÃ‰NECA
        function renderSeneca(){
            const a=alumnos[alumnoActual];
            let h='<div class="card"><div class="card-header"><h3 class="card-title">ğŸ›ï¸ Exportar a SÃ©neca</h3></div>';
            h+='<div class="seneca-info">â„¹ï¸ Esta secciÃ³n organiza los datos del programa especÃ­fico para copiarlos fÃ¡cilmente a SÃ©neca. Usa los botones de copiar para trasladar cada parte.</div>';
            
            if(!a.programas||!Object.keys(a.programas).length){
                h+='<div class="empty-state">Sin programas creados</div></div>';
                document.getElementById('tabSeneca').innerHTML=h;
                return;
            }
            
            let progNum=1;
            Object.keys(a.programas).forEach(pId=>{
                const p=a.programas[pId];
                const info=AREAS[p.tipo]||{icon:'ğŸ“„',nombre:p.tipo};
                const nombrePrograma='PROGRAMA ESPECÃFICO PARA EL DESARROLLO '+info.nombre.toUpperCase();
                
                h+='<div class="seneca-programa">';
                h+='<div class="seneca-programa-header">';
                h+='<span class="seneca-programa-titulo">'+info.icon+' Programa '+progNum+': '+info.nombre+'</span>';
                h+='</div>';
                
                // Nombre del programa
                h+='<div class="seneca-seccion">';
                h+='<div class="seneca-seccion-header">';
                h+='<span class="seneca-seccion-titulo">ğŸ“‹ Nombre del Programa</span>';
                h+='<button class="btn-copiar" onclick="copiarSeneca(this,\''+nombrePrograma+'\')">ğŸ“‹ Copiar</button>';
                h+='</div>';
                h+='<div class="seneca-contenido">'+nombrePrograma+'</div>';
                h+='</div>';
                
                // Agrupar objetivos similares
                const objetivosAgrupados=agruparObjetivos(p.objetivos||[]);
                
                objetivosAgrupados.forEach((objAgrupado,idx)=>{
                    h+='<div class="seneca-objetivo">';
                    h+='<div class="seneca-objetivo-header">';
                    h+='<span class="seneca-objetivo-titulo">ğŸ¯ Objetivo '+(idx+1)+'</span>';
                    h+='</div>';
                    
                    // DefiniciÃ³n del objetivo
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">DefiniciÃ³n del objetivo</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(objAgrupado.descripcion)+'`)">ğŸ“‹ Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+objAgrupado.descripcion+'</div>';
                    h+='</div>';
                    
                    // Indicadores - cada uno con su botÃ³n de copiar
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">ğŸ“Š Indicadores</span>';
                    h+='</div>';
                    h+='<div class="seneca-indicadores-lista">';
                    objAgrupado.indicadores.forEach((ind,i)=>{
                        h+='<div class="seneca-indicador-item">';
                        h+='<span class="seneca-indicador-num">'+(i+1)+'</span>';
                        h+='<span class="seneca-indicador-texto">'+ind+'</span>';
                        h+='<button class="btn-copiar btn-copiar-sm" onclick="copiarSeneca(this,\''+escaparTexto(ind)+'\')">ğŸ“‹</button>';
                        h+='</div>';
                    });
                    h+='</div>';
                    h+='</div>';
                    
                    // Contenidos
                    const contenidos=generarContenidos(objAgrupado,p.tipo);
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">ğŸ“š Contenidos</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(contenidos)+'`)">ğŸ“‹ Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+contenidos+'</div>';
                    h+='</div>';
                    
                    // Actividades
                    const actividades=generarActividades(objAgrupado,p.tipo);
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">ğŸ® Actividades</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(actividades)+'`)">ğŸ“‹ Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+actividades+'</div>';
                    h+='</div>';
                    
                    // Competencias
                    const competencias=generarCompetencias(p.tipo);
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">ğŸ† Competencias</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(competencias)+'`)">ğŸ“‹ Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+competencias+'</div>';
                    h+='</div>';
                    
                    h+='</div>'; // cierre seneca-objetivo
                });
                
                h+='</div>'; // cierre seneca-programa
                progNum++;
            });
            
            h+='</div>'; // cierre card
            document.getElementById('tabSeneca').innerHTML=h;
        }
        
        function agruparObjetivos(objetivos){
            if(!objetivos.length)return[];
            
            // MÃ­nimo 3 objetivos, mÃ¡ximo 6
            const MIN_OBJETIVOS=3;
            const MAX_OBJETIVOS=6;
            
            // Si hay 3 o menos objetivos, no agrupar
            if(objetivos.length<=MIN_OBJETIVOS){
                return objetivos.map(obj=>({
                    descripcion:obj.descripcion,
                    indicadores:[...(obj.indicadores||[])],
                    trimestres:[obj.trimestre]
                }));
            }
            
            // Agrupar por trimestre primero
            const porTrimestre={1:[],2:[],3:[]};
            objetivos.forEach(obj=>{
                const t=obj.trimestre||1;
                porTrimestre[t].push(obj);
            });
            
            const grupos=[];
            
            // Para cada trimestre, crear 1-2 objetivos agrupados
            [1,2,3].forEach(trim=>{
                const objsTrim=porTrimestre[trim];
                if(!objsTrim.length)return;
                
                if(objsTrim.length<=2){
                    // Pocos objetivos en este trimestre, crear uno por cada uno
                    objsTrim.forEach(obj=>{
                        grupos.push({
                            descripcion:obj.descripcion,
                            indicadores:[...(obj.indicadores||[])],
                            trimestres:[trim]
                        });
                    });
                }else if(objsTrim.length<=4){
                    // 3-4 objetivos: crear 2 grupos
                    const mitad=Math.ceil(objsTrim.length/2);
                    const grupo1=objsTrim.slice(0,mitad);
                    const grupo2=objsTrim.slice(mitad);
                    
                    grupos.push(crearGrupoObjetivos(grupo1,trim));
                    grupos.push(crearGrupoObjetivos(grupo2,trim));
                }else{
                    // 5+ objetivos: crear 2 grupos
                    const tercio=Math.ceil(objsTrim.length/2);
                    const grupo1=objsTrim.slice(0,tercio);
                    const grupo2=objsTrim.slice(tercio);
                    
                    grupos.push(crearGrupoObjetivos(grupo1,trim));
                    grupos.push(crearGrupoObjetivos(grupo2,trim));
                }
            });
            
            // Asegurar mÃ­nimo 3 objetivos
            if(grupos.length<MIN_OBJETIVOS){
                // Si hay menos de 3, desagrupar hasta tener 3
                const resultado=[];
                for(let i=0;i<grupos.length&&resultado.length<MIN_OBJETIVOS;i++){
                    resultado.push(grupos[i]);
                }
                // AÃ±adir objetivos individuales si aÃºn faltan
                let idx=0;
                while(resultado.length<MIN_OBJETIVOS&&idx<objetivos.length){
                    const obj=objetivos[idx];
                    const yaIncluido=resultado.some(g=>g.descripcion.includes(obj.descripcion.split(' ')[0]));
                    if(!yaIncluido){
                        resultado.push({
                            descripcion:obj.descripcion,
                            indicadores:[...(obj.indicadores||[])],
                            trimestres:[obj.trimestre]
                        });
                    }
                    idx++;
                }
                return resultado;
            }
            
            // Asegurar mÃ¡ximo 6 objetivos
            if(grupos.length>MAX_OBJETIVOS){
                return grupos.slice(0,MAX_OBJETIVOS);
            }
            
            return grupos;
        }
        
        function crearGrupoObjetivos(objs,trimestre){
            if(objs.length===1){
                return{
                    descripcion:objs[0].descripcion,
                    indicadores:[...(objs[0].indicadores||[])],
                    trimestres:[trimestre]
                };
            }
            
            // Combinar descripciones de forma inteligente
            const verbos=[];
            const temas=[];
            objs.forEach(obj=>{
                const palabras=obj.descripcion.split(' ');
                const verbo=palabras[0];
                const tema=palabras.slice(1).join(' ');
                if(!verbos.includes(verbo))verbos.push(verbo);
                temas.push(tema);
            });
            
            // Crear descripciÃ³n combinada
            let descripcion='';
            if(verbos.length===1){
                descripcion=verbos[0]+' '+temas.join(', ');
            }else{
                descripcion=objs.map(o=>o.descripcion).join('; ');
            }
            
            // Combinar todos los indicadores (sin duplicados)
            const todosIndicadores=objs.flatMap(o=>o.indicadores||[]);
            const indicadoresUnicos=[...new Set(todosIndicadores)];
            
            return{
                descripcion:descripcion,
                indicadores:indicadoresUnicos,
                trimestres:[trimestre]
            };
        }
        
        function generarContenidos(objAgrupado,tipo){
            const contenidosBase={
                'comunicativo':['Vocabulario funcional y expresivo','Estructuras gramaticales bÃ¡sicas','Habilidades pragmÃ¡ticas del lenguaje','ComprensiÃ³n y expresiÃ³n oral','Conciencia fonolÃ³gica'],
                'cognitivo':['AtenciÃ³n y concentraciÃ³n','Memoria de trabajo','Razonamiento lÃ³gico-matemÃ¡tico','ResoluciÃ³n de problemas','Funciones ejecutivas'],
                'psicomotor':['Esquema corporal','CoordinaciÃ³n dinÃ¡mica general','Equilibrio y control postural','OrientaciÃ³n espacial y temporal','Lateralidad'],
                'motor':['Motricidad fina','CoordinaciÃ³n Ã³culo-manual','Grafomotricidad','ManipulaciÃ³n de objetos','PrecisiÃ³n y destreza manual'],
                'social':['Habilidades sociales bÃ¡sicas','RegulaciÃ³n emocional','InteracciÃ³n con iguales','Normas de convivencia','EmpatÃ­a y asertividad'],
                'autonomia':['HÃ¡bitos de autonomÃ­a personal','Autocuidado e higiene','OrganizaciÃ³n y planificaciÃ³n','Responsabilidad en tareas','Independencia funcional']
            };
            
            const base=contenidosBase[tipo]||['Contenidos especÃ­ficos del Ã¡rea','Habilidades funcionales','GeneralizaciÃ³n de aprendizajes'];
            
            // Personalizar segÃºn indicadores
            const palabrasClave=objAgrupado.indicadores.join(' ').toLowerCase();
            let contenidos=[...base];
            
            if(palabrasClave.includes('vocabulario')||palabrasClave.includes('palabra'))contenidos.push('AmpliaciÃ³n del lÃ©xico');
            if(palabrasClave.includes('comprens'))contenidos.push('ComprensiÃ³n de instrucciones');
            if(palabrasClave.includes('escrib')||palabrasClave.includes('lectura'))contenidos.push('IniciaciÃ³n a la lectoescritura');
            if(palabrasClave.includes('nÃºmero')||palabrasClave.includes('contar'))contenidos.push('Conceptos numÃ©ricos bÃ¡sicos');
            if(palabrasClave.includes('atenciÃ³n'))contenidos.push('Estrategias atencionales');
            
            return contenidos.slice(0,5).map((c,i)=>(i+1)+'. '+c).join('\n');
        }
        
        function generarActividades(objAgrupado,tipo){
            const actividadesBase={
                'comunicativo':['Juegos de denominaciÃ³n y descripciÃ³n de imÃ¡genes','Actividades de comprensiÃ³n de Ã³rdenes y narraciones','Ejercicios de conciencia fonolÃ³gica (rimas, segmentaciÃ³n)','DiÃ¡logos guiados y role-playing comunicativo'],
                'cognitivo':['Actividades de atenciÃ³n visual y auditiva','Juegos de memoria y secuenciaciÃ³n','ResoluciÃ³n de problemas manipulativos','Tareas de clasificaciÃ³n y seriaciÃ³n'],
                'psicomotor':['Circuitos motrices y juegos de movimiento','Actividades de equilibrio y coordinaciÃ³n','Ejercicios de esquema corporal','Juegos de orientaciÃ³n espacial'],
                'motor':['Actividades de recorte, picado y pegado','Ejercicios de grafomotricidad','ManipulaciÃ³n de plastilina y materiales','Juegos de ensartado y encaje'],
                'social':['Role-playing de situaciones sociales','Juegos cooperativos en pequeÃ±o grupo','Actividades de identificaciÃ³n emocional','DinÃ¡micas de turnos y normas'],
                'autonomia':['Rutinas de autocuidado guiadas','Tareas de organizaciÃ³n del material','Actividades de responsabilidad','Secuencias de autonomÃ­a personal']
            };
            
            return(actividadesBase[tipo]||['Actividades manipulativas','Juegos estructurados','Tareas funcionales','GeneralizaciÃ³n en contextos naturales']).slice(0,4).map((a,i)=>(i+1)+'. '+a).join('\n');
        }
        
        function generarCompetencias(tipo){
            const competenciasMap={
                'comunicativo':'CCL (Competencia en ComunicaciÃ³n LingÃ¼Ã­stica)',
                'cognitivo':'STEM (Competencia MatemÃ¡tica y en Ciencia, TecnologÃ­a e IngenierÃ­a)',
                'psicomotor':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)',
                'motor':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)',
                'social':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)\nCC (Competencia Ciudadana)',
                'autonomia':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)'
            };
            return competenciasMap[tipo]||'CPSAA (Competencia Personal, Social y de Aprender a Aprender)';
        }
        
        function escaparTexto(texto){
            return texto.replace(/`/g,"'").replace(/\\/g,'\\\\').replace(/\n/g,'\\n');
        }
        
        function copiarSeneca(btn,texto){
            const textoReal=texto.replace(/\\n/g,'\n');
            navigator.clipboard.writeText(textoReal).then(()=>{
                const textoOriginal=btn.innerHTML;
                btn.innerHTML='âœ“ Copiado';
                btn.classList.add('copiado');
                setTimeout(()=>{
                    btn.innerHTML=textoOriginal;
                    btn.classList.remove('copiado');
                },1500);
            }).catch(()=>{
                toast('Error al copiar','error');
            });
        }

        // INFORMES
        function abrirModalInforme(){document.getElementById('informeTrim').value=evalTrim;document.getElementById('informePeriodo').value='trimestral';document.getElementById('grupoMes').style.display='none';document.getElementById('informePreview').style.display='none';document.getElementById('btnImprimirInforme').style.display='none';informeData=null;
            // Configurar selector de periodo
            document.getElementById('informePeriodo').onchange=function(){
                const esMensual=this.value==='mensual';
                document.getElementById('grupoMes').style.display=esMensual?'block':'none';
                if(esMensual){
                    const trim=parseInt(document.getElementById('informeTrim').value);
                    const mesesTrim=MESES.map((m,i)=>({idx:i,...m})).filter(m=>m.trim===trim);
                    const sel=document.getElementById('informeMes');
                    sel.innerHTML=mesesTrim.map(m=>'<option value="'+m.idx+'">'+m.nombre+'</option>').join('');
                }
            };
            document.getElementById('informeTrim').onchange=function(){
                if(document.getElementById('informePeriodo').value==='mensual'){
                    document.getElementById('informePeriodo').onchange();
                }
            };
            abrirModal('modalInforme');}
        function generarInforme(){const trim=parseInt(document.getElementById('informeTrim').value),a=alumnos[alumnoActual],st=calcStats(a);const conseguidos=[],proceso=[],noIniciados=[];if(a.programas){Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};(p.objetivos||[]).forEach((obj,oi)=>{(obj.indicadores||[]).forEach((ind,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+trim,e=a.evaluaciones?a.evaluaciones[k]:null,item={programa:info.nombre,objetivo:'O'+obj.numero,indicador:ind};if(e==='C')conseguidos.push(item);else if(e==='P')proceso.push(item);else noIniciados.push(item);});});});}informeData={alumno:a,trim:trim,conseguidos:conseguidos,proceso:proceso,noIniciados:noIniciados,ausencias:st.porTrim[trim]?st.porTrim[trim].aus:0};const total=conseguidos.length+proceso.length+noIniciados.length,porcC=total?Math.round(conseguidos.length/total*100):0;document.getElementById('informePreview').innerHTML='<h4>T'+trim+' - '+a.siglas+'</h4><p>âœ… '+conseguidos.length+' ('+porcC+'%) | ğŸ”„ '+proceso.length+' | â­• '+noIniciados.length+' | âŒ '+informeData.ausencias+' aus.</p>';document.getElementById('informePreview').style.display='block';document.getElementById('btnImprimirInforme').style.display='inline-flex';toast('Generado','success');}
        function abrirChatGPTInforme(tipo){
            const trim=parseInt(document.getElementById('informeTrim').value);
            const periodo=document.getElementById('informePeriodo').value;
            const a=alumnos[alumnoActual],st=calcStats(a);
            
            // Recopilar datos
            const conseguidos=[],proceso=[],noIniciados=[];
            if(a.programas){Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};(p.objetivos||[]).forEach((obj,oi)=>{(obj.indicadores||[]).forEach((ind,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+trim,e=a.evaluaciones?a.evaluaciones[k]:null,item=info.nombre+': '+ind;if(e==='C')conseguidos.push(item);else if(e==='P')proceso.push(item);else noIniciados.push(item);});});});}
            
            let prompt='';
            const periodoTexto=periodo==='mensual'?'MES: '+MESES[document.getElementById('informeMes').value].nombre:'TRIMESTRE: '+trim;
            const datosBase='ALUMNO: '+a.siglas+' ('+a.curso+')\n'+periodoTexto+'\n\nCONSEGUIDOS ('+conseguidos.length+'):\n'+(conseguidos.slice(0,10).join('\n')||'Ninguno')+'\n\nEN PROCESO ('+proceso.length+'):\n'+(proceso.slice(0,10).join('\n')||'Ninguno')+'\n\nAUSENCIAS: '+(st.porTrim[trim]?st.porTrim[trim].aus:0);
            
            if(tipo==='pt'){
                prompt='ValoraciÃ³n PT para informe.\n\n'+datosBase+'\n\nEscribe 2-3 pÃ¡rrafos profesionales para el informe de PT.';
            }else if(tipo==='familia'){
                prompt='Informe para FAMILIAS de alumno con necesidades educativas especiales.\n\n'+datosBase+'\n\nREQUISITOS:\n- Lenguaje cercano y positivo, evita tecnicismos\n- Destaca logros y avances del alumno\n- Incluye orientaciones prÃ¡cticas para trabajar en casa\n- Tono motivador y esperanzador\n- 3-4 pÃ¡rrafos\n\nEscribe el informe para entregar a la familia.';
            }else if(tipo==='tutor'){
                prompt='Informe para el TUTOR/A sobre alumno con necesidades educativas especiales.\n\n'+datosBase+'\n\nREQUISITOS:\n- Lenguaje tÃ©cnico-pedagÃ³gico\n- Resumen de objetivos trabajados y grado de consecuciÃ³n\n- Orientaciones para la coordinaciÃ³n en el aula ordinaria\n- Propuestas de adaptaciÃ³n metodolÃ³gica\n- Recomendaciones para reforzar en clase\n- 3-4 pÃ¡rrafos\n\nEscribe el informe de coordinaciÃ³n con el tutor/a.';
            }
            
            navigator.clipboard.writeText(prompt).then(()=>{toast('Copiado para ChatGPT','success');window.open('https://chat.openai.com/','_blank');});
        }
        function imprimirInforme(){if(!informeData)return;const a=informeData.alumno,win=window.open('','_blank');win.document.write('<!DOCTYPE html><html><head><title>Informe</title><style>body{font-family:Arial;padding:30px;max-width:800px;margin:0 auto}h1{color:#1a5f4a}h2{margin-top:20px}.indicador{margin:5px 0 5px 20px}</style></head><body><h1>INFORME T'+informeData.trim+' - '+a.siglas+'</h1><p>Curso: '+a.curso+' | Fecha: '+new Date().toLocaleDateString('es-ES')+'</p><h2>âœ… Conseguidos ('+informeData.conseguidos.length+')</h2>'+(informeData.conseguidos.map(x=>'<p class="indicador">â€¢ '+x.programa+': '+x.indicador+'</p>').join('')||'<p>Ninguno</p>')+'<h2>ğŸ”„ En Proceso ('+informeData.proceso.length+')</h2>'+(informeData.proceso.map(x=>'<p class="indicador">â€¢ '+x.programa+': '+x.indicador+'</p>').join('')||'<p>Ninguno</p>')+'<h2>â­• No Iniciados ('+informeData.noIniciados.length+')</h2>'+(informeData.noIniciados.map(x=>'<p class="indicador">â€¢ '+x.programa+': '+x.indicador+'</p>').join('')||'<p>Ninguno</p>')+'<p style="margin-top:40px">Fdo: _______________</p></body></html>');win.document.close();setTimeout(()=>{win.print();},300);}

        // IMPRESIÃ“N MASIVA
        function abrirModalImprimir(){if(!Object.keys(alumnos).length){toast('No hay alumnos','error');return;}abrirModal('modalImprimir');}
        
        // FunciÃ³n auxiliar para generar grÃ¡ficas de evaluaciÃ³n
        async function generarGraficasEvaluacion(alumnoId, trimestreSelec) {
            const a = alumnos[alumnoId];
            if (!a || !a.programas) return null;
            
            // Recopilar datos por trimestre
            const datosT1 = {C:0, P:0, N:0};
            const datosT2 = {C:0, P:0, N:0};
            const datosT3 = {C:0, P:0, N:0};
            
            Object.keys(a.programas).forEach(pId => {
                const p = a.programas[pId];
                (p.objetivos || []).forEach((obj, oi) => {
                    (obj.indicadores || []).forEach((ind, ii) => {
                        [1,2,3].forEach(trim => {
                            const k = pId+'_'+oi+'_'+ii+'_T'+trim;
                            const e = a.evaluaciones ? a.evaluaciones[k] : null;
                            const datos = trim===1 ? datosT1 : trim===2 ? datosT2 : datosT3;
                            if (e === 'C') datos.C++;
                            else if (e === 'P') datos.P++;
                            else if (e === 'N') datos.N++;
                        });
                    });
                });
            });
            
            let imgBarras = null;
            let imgCircular = null;
            
            // Si es "todos" los trimestres, generar grÃ¡fico de barras comparativo
            if (trimestreSelec === 'todos') {
                const canvas1 = document.createElement('canvas');
                canvas1.width = 800;
                canvas1.height = 400;
                const ctx1 = canvas1.getContext('2d');
                
                const chart1 = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: ['Trimestre 1', 'Trimestre 2', 'Trimestre 3'],
                        datasets: [
                            {
                                label: 'Conseguido',
                                data: [datosT1.C, datosT2.C, datosT3.C],
                                backgroundColor: '#22c55e'
                            },
                            {
                                label: 'En Proceso',
                                data: [datosT1.P, datosT2.P, datosT3.P],
                                backgroundColor: '#3b82f6'
                            },
                            {
                                label: 'No Iniciado',
                                data: [datosT1.N, datosT2.N, datosT3.N],
                                backgroundColor: '#999'
                            }
                        ]
                    },
                    options: {
                        responsive: false,
                        animation: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'EvoluciÃ³n por Trimestres - ' + a.siglas,
                                font: {size: 18, weight: 'bold'},
                                color: '#1a5f4a'
                            },
                            legend: {
                                position: 'bottom',
                                labels: {font: {size: 14}}
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {stepSize: 1, font: {size: 12}}
                            },
                            x: {
                                ticks: {font: {size: 12}}
                            }
                        }
                    }
                });
                
                await new Promise(resolve => setTimeout(resolve, 200));
                imgBarras = canvas1.toDataURL('image/png');
                chart1.destroy();
            }
            
            // Determinar quÃ© trimestre usar para el grÃ¡fico circular
            const trimActual = trimestreSelec === 'todos' ? (evalTrim || 1) : parseInt(trimestreSelec);
            const datosActual = trimActual===1 ? datosT1 : trimActual===2 ? datosT2 : datosT3;
            const total = datosActual.C + datosActual.P + datosActual.N;
            
            if (total > 0) {
                const canvas2 = document.createElement('canvas');
                canvas2.width = 800;
                canvas2.height = 400;
                const ctx2 = canvas2.getContext('2d');
                
                // Si es un trimestre especÃ­fico, mostrar grÃ¡fico de barras tambiÃ©n
                if (trimestreSelec !== 'todos') {
                    const chart1 = new Chart(ctx2, {
                        type: 'bar',
                        data: {
                            labels: ['Conseguido', 'En Proceso', 'No Iniciado'],
                            datasets: [{
                                label: 'Cantidad',
                                data: [datosActual.C, datosActual.P, datosActual.N],
                                backgroundColor: ['#22c55e', '#3b82f6', '#999']
                            }]
                        },
                        options: {
                            responsive: false,
                            animation: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Resultados Trimestre ' + trimActual + ' - ' + a.siglas,
                                    font: {size: 18, weight: 'bold'},
                                    color: '#1a5f4a'
                                },
                                legend: {display: false}
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {stepSize: 1, font: {size: 12}}
                                },
                                x: {
                                    ticks: {font: {size: 12}}
                                }
                            }
                        }
                    });
                    
                    await new Promise(resolve => setTimeout(resolve, 200));
                    imgBarras = canvas2.toDataURL('image/png');
                    chart1.destroy();
                    
                    // Crear nuevo canvas para el circular
                    const canvas3 = document.createElement('canvas');
                    canvas3.width = 800;
                    canvas3.height = 400;
                    const ctx3 = canvas3.getContext('2d');
                    
                    const chart2 = new Chart(ctx3, {
                        type: 'doughnut',
                        data: {
                            labels: ['Conseguido', 'En Proceso', 'No Iniciado'],
                            datasets: [{
                                data: [datosActual.C, datosActual.P, datosActual.N],
                                backgroundColor: ['#22c55e', '#3b82f6', '#999']
                            }]
                        },
                        options: {
                            responsive: false,
                            animation: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'DistribuciÃ³n Trimestre ' + trimActual + ' - ' + a.siglas,
                                    font: {size: 18, weight: 'bold'},
                                    color: '#1a5f4a'
                                },
                                legend: {
                                    position: 'bottom',
                                    labels: {font: {size: 14}}
                                }
                            }
                        }
                    });
                    
                    await new Promise(resolve => setTimeout(resolve, 200));
                    imgCircular = canvas3.toDataURL('image/png');
                    chart2.destroy();
                } else {
                    // Para "todos", mostrar solo el circular del trimestre actual
                    const chart2 = new Chart(ctx2, {
                        type: 'doughnut',
                        data: {
                            labels: ['Conseguido', 'En Proceso', 'No Iniciado'],
                            datasets: [{
                                data: [datosActual.C, datosActual.P, datosActual.N],
                                backgroundColor: ['#22c55e', '#3b82f6', '#999']
                            }]
                        },
                        options: {
                            responsive: false,
                            animation: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'DistribuciÃ³n Trimestre ' + trimActual + ' - ' + a.siglas,
                                    font: {size: 18, weight: 'bold'},
                                    color: '#1a5f4a'
                                },
                                legend: {
                                    position: 'bottom',
                                    labels: {font: {size: 14}}
                                }
                            }
                        }
                    });
                    
                    await new Promise(resolve => setTimeout(resolve, 200));
                    imgCircular = canvas2.toDataURL('image/png');
                    chart2.destroy();
                }
            }
            
            return {barras: imgBarras, circular: imgCircular, trimestre: trimActual};
        }
        
        // FunciÃ³n para imprimir informe de evaluaciÃ³n con grÃ¡ficas
        async function imprimirInformeEvaluacion() {
            const ids = Object.keys(alumnos);
            if(!ids.length){toast('No hay alumnos','error');return;}
            
            const trimestreSelec = document.getElementById('trimestreInforme').value;
            const tituloTrimestre = trimestreSelec === 'todos' ? 'Comparativa Anual' : 'Trimestre ' + trimestreSelec;
            
            toast('Generando informe con grÃ¡ficas...', 'success');
            
            // Generar grÃ¡ficas para todos los alumnos
            const graficas = {};
            for (const id of ids) {
                const graficasAlumno = await generarGraficasEvaluacion(id, trimestreSelec);
                graficas[id] = graficasAlumno;
            }
            
            const cursoEscolar = new Date().getMonth()>=8 ? new Date().getFullYear()+'/'+(new Date().getFullYear()+1) : (new Date().getFullYear()-1)+'/'+new Date().getFullYear();
            
            let html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Informe de EvaluaciÃ³n</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;font-size:10px;color:#333}

/* PORTADA */
.portada{
    height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
    background:linear-gradient(160deg,#f0faf6 0%,#e0f2ec 40%,#d0eae2 100%);
    position:relative;overflow:hidden;text-align:center;padding:40px;
}
.portada::before{
    content:'';position:absolute;top:-80px;right:-80px;width:300px;height:300px;
    border-radius:50%;background:rgba(26,95,74,0.07);
}
.portada::after{
    content:'';position:absolute;bottom:-60px;left:-60px;width:250px;height:250px;
    border-radius:50%;background:rgba(26,95,74,0.05);
}
.portada-linea-top{position:absolute;top:0;left:0;right:0;height:8px;background:linear-gradient(90deg,#1a5f4a,#2d8a6e,#22c55e)}
.portada-icono{font-size:60px;margin-bottom:20px;filter:drop-shadow(0 4px 8px rgba(26,95,74,0.2))}
.portada-titulo{font-size:28px;font-weight:800;color:#1a5f4a;letter-spacing:1px;margin-bottom:6px;line-height:1.3}
.portada-subtitulo{font-size:18px;font-weight:600;color:#2d8a6e;margin-bottom:30px}
.portada-periodo{font-size:22px;font-weight:700;color:#1a5f4a;background:white;padding:12px 40px;border-radius:12px;box-shadow:0 4px 16px rgba(26,95,74,0.15);margin-bottom:30px;border:2px solid rgba(26,95,74,0.1)}
.portada-centro{font-size:14px;color:#1a5f4a;font-weight:700;margin-bottom:4px}
.portada-curso{font-size:13px;color:#5a8a7a;margin-bottom:6px}
.portada-linea{width:60px;height:3px;background:#2d8a6e;border-radius:2px;margin:16px auto}
.portada-footer{position:absolute;bottom:30px;font-size:11px;color:#8aab9e}

/* CONTENIDO */
.contenido{padding:30px 25px}
.titulo{text-align:center;color:#1a5f4a;font-size:20px;font-weight:700;margin-bottom:10px}
.subtitulo{text-align:center;color:#888;font-size:13px;margin-bottom:20px}
.sep{border:none;border-bottom:2px solid #1a5f4a;margin-bottom:20px}

/* GRÃFICAS */
.bloque-alumno{page-break-inside:avoid;margin-bottom:30px}
.eval-sec{color:#1a5f4a;font-size:14px;font-weight:700;margin-bottom:12px;padding-bottom:6px;border-bottom:2px solid #e0e0e0}
.graficas-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.grafica-container{background:#fff;border-radius:8px;padding:10px;border:1px solid #e0e0e0}
.grafica-img{display:block;margin:0 auto;max-width:100%;height:auto}

/* TABLA DE RESUMEN */
.tabla-resumen{width:100%;border-collapse:collapse;margin-bottom:20px;font-size:11px}
.tabla-resumen th{background:#1a5f4a;color:#fff;padding:8px;text-align:center;border:1px solid #bbb}
.tabla-resumen td{border:1px solid #d0d0d0;padding:8px;text-align:center}
.tabla-resumen td:first-child{background:#e8f5f1;color:#1a5f4a;font-weight:700;text-align:left}

@media print{
    body{padding:0}
    .portada{height:100vh;page-break-after:always}
    @page{margin:1.8cm 1.5cm}
    @page:first{margin:0}
    .contenido{padding:0}
    .bloque-alumno{page-break-inside:avoid}
    .graficas-grid{grid-template-columns:1fr}
    .page-break{page-break-before:always}
}
</style></head><body>`;

            // === PORTADA ===
            html += '<div class="portada">';
            html += '<div class="portada-linea-top"></div>';
            html += '<div class="portada-icono">ğŸ“Š</div>';
            html += '<div class="portada-titulo">INFORME DE EVALUACIÃ“N</div>';
            html += '<div class="portada-subtitulo">Resultados AcadÃ©micos</div>';
            html += '<div class="portada-linea"></div>';
            html += '<div class="portada-periodo">'+tituloTrimestre+'</div>';
            html += '<div class="portada-centro">CEIP Capitulaciones de Santa Fe</div>';
            html += '<div class="portada-curso">Curso escolar '+cursoEscolar+'</div>';
            html += '<div class="portada-linea"></div>';
            html += '<div class="portada-footer">PedagogÃ­a TerapÃ©utica</div>';
            html += '</div>';

            // === GRÃFICAS DE RESULTADOS ===
            html += '<div class="contenido page-break">';
            html += '<div class="titulo">Resultados por Alumno</div>';
            html += '<div class="subtitulo">'+tituloTrimestre+'</div>';
            html += '<hr class="sep">';
            
            ids.forEach(id => {
                const a = alumnos[id];
                const g = graficas[id];
                
                html += '<div class="bloque-alumno">';
                html += '<div class="eval-sec">'+a.siglas+' - '+a.curso+'</div>';
                
                if(g && (g.barras || g.circular)){
                    html += '<div class="graficas-grid">';
                    if(g.barras){
                        html += '<div class="grafica-container">';
                        html += '<img src="'+g.barras+'" class="grafica-img" />';
                        html += '</div>';
                    }
                    if(g.circular){
                        html += '<div class="grafica-container">';
                        html += '<img src="'+g.circular+'" class="grafica-img" />';
                        html += '</div>';
                    }
                    html += '</div>';
                } else {
                    html += '<p style="color:#888;font-style:italic;padding:20px;text-align:center">No hay datos de evaluaciÃ³n registrados</p>';
                }
                html += '</div>';
            });
            
            html += '</div>';

            // === TABLA RESUMEN ===
            html += '<div class="contenido page-break">';
            html += '<div class="titulo">Resumen General</div>';
            html += '<div class="subtitulo">'+tituloTrimestre+'</div>';
            html += '<hr class="sep">';
            
            html += '<table class="tabla-resumen">';
            
            if (trimestreSelec === 'todos') {
                // Tabla con los 3 trimestres
                html += '<tr><th>Alumno</th><th>T1 Conseguido</th><th>T1 Proceso</th><th>T1 No Iniciado</th>';
                html += '<th>T2 Conseguido</th><th>T2 Proceso</th><th>T2 No Iniciado</th>';
                html += '<th>T3 Conseguido</th><th>T3 Proceso</th><th>T3 No Iniciado</th></tr>';
                
                ids.forEach(id => {
                    const a = alumnos[id];
                    const datosT1 = {C:0, P:0, N:0};
                    const datosT2 = {C:0, P:0, N:0};
                    const datosT3 = {C:0, P:0, N:0};
                    
                    if(a.programas){
                        Object.keys(a.programas).forEach(pId => {
                            const p = a.programas[pId];
                            (p.objetivos || []).forEach((obj, oi) => {
                                (obj.indicadores || []).forEach((ind, ii) => {
                                    [1,2,3].forEach(trim => {
                                        const k = pId+'_'+oi+'_'+ii+'_T'+trim;
                                        const e = a.evaluaciones ? a.evaluaciones[k] : null;
                                        const datos = trim===1 ? datosT1 : trim===2 ? datosT2 : datosT3;
                                        if (e === 'C') datos.C++;
                                        else if (e === 'P') datos.P++;
                                        else if (e === 'N') datos.N++;
                                    });
                                });
                            });
                        });
                    }
                    
                    html += '<tr>';
                    html += '<td>'+a.siglas+' - '+a.curso+'</td>';
                    html += '<td>'+datosT1.C+'</td><td>'+datosT1.P+'</td><td>'+datosT1.N+'</td>';
                    html += '<td>'+datosT2.C+'</td><td>'+datosT2.P+'</td><td>'+datosT2.N+'</td>';
                    html += '<td>'+datosT3.C+'</td><td>'+datosT3.P+'</td><td>'+datosT3.N+'</td>';
                    html += '</tr>';
                });
            } else {
                // Tabla de un solo trimestre
                const trimNum = parseInt(trimestreSelec);
                html += '<tr><th>Alumno</th><th>Conseguido</th><th>En Proceso</th><th>No Iniciado</th><th>Total</th><th>% Conseguido</th></tr>';
                
                ids.forEach(id => {
                    const a = alumnos[id];
                    const datos = {C:0, P:0, N:0};
                    
                    if(a.programas){
                        Object.keys(a.programas).forEach(pId => {
                            const p = a.programas[pId];
                            (p.objetivos || []).forEach((obj, oi) => {
                                (obj.indicadores || []).forEach((ind, ii) => {
                                    const k = pId+'_'+oi+'_'+ii+'_T'+trimNum;
                                    const e = a.evaluaciones ? a.evaluaciones[k] : null;
                                    if (e === 'C') datos.C++;
                                    else if (e === 'P') datos.P++;
                                    else if (e === 'N') datos.N++;
                                });
                            });
                        });
                    }
                    
                    const total = datos.C + datos.P + datos.N;
                    const porcentaje = total > 0 ? Math.round((datos.C / total) * 100) : 0;
                    
                    html += '<tr>';
                    html += '<td>'+a.siglas+' - '+a.curso+'</td>';
                    html += '<td>'+datos.C+'</td><td>'+datos.P+'</td><td>'+datos.N+'</td>';
                    html += '<td>'+total+'</td><td>'+porcentaje+'%</td>';
                    html += '</tr>';
                });
            }
            
            html += '</table>';
            html += '</div>';

            html += '</body></html>';
            
            const win = window.open('','_blank');
            win.document.write(html);
            win.document.close();
            setTimeout(() => {win.print();}, 500);
        }
        
        function imprimirTodos(){const mesSeleccionado=parseInt(document.getElementById('printMes').value);const ids=Object.keys(alumnos);let html='<!DOCTYPE html><html><head><title>Programaciones</title><style>body{font-family:Arial;padding:20px;font-size:11px}h1{color:#1a5f4a;font-size:16px}h2{font-size:14px;border-bottom:2px solid #1a5f4a}table{width:100%;border-collapse:collapse;margin-bottom:15px}th,td{border:1px solid #ccc;padding:6px}th{background:#1a5f4a;color:#fff}td:first-child{background:#2d8a6e;color:#fff;text-align:center;width:50px}.page-break{page-break-after:always}</style></head><body>';ids.forEach((id,idx)=>{const a=alumnos[id],dias=a.diasSesion||[1,3,4];html+='<div'+(idx<ids.length-1?' class="page-break"':'')+'><h1>'+a.siglas+' - '+a.curso+'</h1>';const mesesAImprimir=mesSeleccionado===-1?MESES.map((_,i)=>i):[mesSeleccionado];mesesAImprimir.forEach(mi=>{const mes=MESES[mi];html+='<h2>'+mes.nombre+' (T'+mes.trim+')</h2><table><tr><th>S</th>';dias.forEach(d=>{html+='<th>'+DIAS_C[d]+'</th>';});html+='</tr>';for(let s=1;s<=mes.semanas;s++){html+='<tr><td>'+s+'</td>';dias.forEach(d=>{const k=mi+'_'+s+'_'+d,c=a.programacion?a.programacion[k]:null;if(c&&a.programas&&a.programas[c.pId]){const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;if(obj){const ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';html+='<td><b>O'+obj.numero+'</b><br>'+ind.substring(0,20)+'</td>';}else{html+='<td>-</td>';}}else{html+='<td>-</td>';}});html+='</tr>';}html+='</table>';});html+='</div>';});html+='</body></html>';const win=window.open('','_blank');win.document.write(html);win.document.close();setTimeout(()=>{win.print();},500);cerrarModal('modalImprimir');}

        async function imprimirCompacto(){
            const mesSeleccionado=parseInt(document.getElementById('printMes').value);
            const ids=Object.keys(alumnos);
            if(!ids.length){toast('No hay alumnos','error');return;}

            let tituloMes='Todo el curso';
            let mesTexto='Curso completo';
            let trimTexto='';
            if(mesSeleccionado!==-1){
                tituloMes=MESES[mesSeleccionado].nombre+' (T'+MESES[mesSeleccionado].trim+')';
                mesTexto=MESES[mesSeleccionado].nombre;
                trimTexto='Trimestre '+MESES[mesSeleccionado].trim;
            }

            const cursoEscolar=new Date().getMonth()>=8?new Date().getFullYear()+'/'+(new Date().getFullYear()+1):(new Date().getFullYear()-1)+'/'+new Date().getFullYear();

            let html=`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Programaciones</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;font-size:10px;color:#333}

/* PORTADA */
.portada{
    height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
    background:linear-gradient(160deg,#f0faf6 0%,#e0f2ec 40%,#d0eae2 100%);
    position:relative;overflow:hidden;text-align:center;padding:40px;
}
.portada::before{
    content:'';position:absolute;top:-80px;right:-80px;width:300px;height:300px;
    border-radius:50%;background:rgba(26,95,74,0.07);
}
.portada::after{
    content:'';position:absolute;bottom:-60px;left:-60px;width:250px;height:250px;
    border-radius:50%;background:rgba(26,95,74,0.05);
}
.portada-linea-top{position:absolute;top:0;left:0;right:0;height:8px;background:linear-gradient(90deg,#1a5f4a,#2d8a6e,#22c55e)}
.portada-icono{font-size:60px;margin-bottom:20px;filter:drop-shadow(0 4px 8px rgba(26,95,74,0.2))}
.portada-titulo{font-size:28px;font-weight:800;color:#1a5f4a;letter-spacing:1px;margin-bottom:6px;line-height:1.3}
.portada-subtitulo{font-size:18px;font-weight:600;color:#2d8a6e;margin-bottom:30px}
.portada-mes{
    font-size:38px;font-weight:800;color:#1a5f4a;
    background:white;padding:16px 50px;border-radius:16px;
    box-shadow:0 6px 24px rgba(26,95,74,0.15);margin-bottom:12px;
    border:2px solid rgba(26,95,74,0.1);
}
.portada-trim{font-size:16px;color:#5a8a7a;font-weight:600;margin-bottom:40px}
.portada-centro{font-size:14px;color:#1a5f4a;font-weight:700;margin-bottom:4px}
.portada-curso{font-size:13px;color:#5a8a7a;margin-bottom:6px}
.portada-linea{width:60px;height:3px;background:#2d8a6e;border-radius:2px;margin:16px auto}
.portada-footer{position:absolute;bottom:30px;font-size:11px;color:#8aab9e}

/* CONTENIDO */
.contenido{padding:20px 25px}
.titulo{text-align:center;color:#1a5f4a;font-size:18px;font-weight:700;margin-bottom:2px}
.subtitulo{text-align:center;color:#888;font-size:12px;margin-bottom:8px}
.sep{border:none;border-bottom:2px solid #1a5f4a;margin-bottom:12px}
.sec{color:#1a5f4a;font-size:12px;font-weight:700;margin:10px 0 2px 0}
.sub{font-size:10px;color:#555;font-weight:700;margin-bottom:4px;padding-bottom:2px;border-bottom:1px solid #1a5f4a;display:inline-block}
table{width:100%;border-collapse:collapse;margin-bottom:10px}
th{background:#1a5f4a;color:#fff;padding:4px 6px;font-size:9px;text-align:center;border:1px solid #bbb}
td{border:1px solid #d0d0d0;padding:3px 6px;font-size:9px;vertical-align:middle}
td:first-child{background:#e8f5f1;color:#1a5f4a;text-align:center;font-weight:700;width:28px}
tr:nth-child(even) td:not(:first-child){background:#f8f9fa}
.ob{font-weight:700;color:#1a5f4a}
.bloque-alumno{page-break-inside:avoid;margin-bottom:10px}
.sub-inline{font-size:10px;color:#555;font-weight:600;margin-left:6px}
.page-break{page-break-before:always}
.eval-titulo{text-align:center;color:#1a5f4a;font-size:18px;font-weight:700;margin-bottom:2px}
.eval-sub{text-align:center;color:#888;font-size:12px;margin-bottom:8px}
.eval-sec{color:#1a5f4a;font-size:12px;font-weight:700;margin:10px 0 4px 0}
.eval-table th{font-size:9px;padding:4px 5px}
.eval-table td{font-size:9px;padding:4px 5px}
.eval-table td:first-child{width:35px}
.eval-table .col-c,.eval-table .col-ep,.eval-table .col-ni{width:30px;text-align:center}
.eval-table th.col-val{background:#1a5f4a;color:#fff;width:30px;text-align:center;font-size:8px}
.check{color:#22c55e;font-weight:700}
.check-ep{color:#3b82f6;font-weight:700}
.check-ni{color:#999;font-weight:700}
.rel-table th{font-size:9px;padding:4px 5px}
.rel-table td{font-size:9px;padding:4px 6px;vertical-align:top}
.rel-table td:first-child{width:35px}
.rel-table .rel-obj,.rel-table th:first-child{width:35px}
.rel-table .rel-area,.rel-table .rel-area-td{width:80px;font-size:8px;color:#1a5f4a}
.rel-table .rel-desc{width:120px}

/* ESTILOS PARA GRÃFICAS */
.grafica-container{margin:15px 0;page-break-inside:avoid}
.grafica-titulo{color:#1a5f4a;font-size:14px;font-weight:700;margin-bottom:8px;text-align:center}
.grafica-img{display:block;margin:0 auto;max-width:100%;border:1px solid #e0e0e0;border-radius:8px}
.graficas-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
@media print{.graficas-grid{grid-template-columns:1fr}}

@media print{
    body{padding:0}
    .portada{height:100vh;page-break-after:always}
    @page{margin:1.8cm 1.5cm}
    @page:first{margin:0}
    .contenido{padding:0}
    table{page-break-inside:avoid}
    .sec{page-break-inside:avoid}
    .eval-sec,.eval-sec+table{page-break-inside:avoid}
    .bloque-alumno{page-break-inside:avoid}
    .grafica-container{page-break-inside:avoid}
}
</style></head><body>`;

            // === PORTADA ===
            html+='<div class="portada">';
            html+='<div class="portada-linea-top"></div>';
            html+='<div class="portada-icono">ğŸ“‹</div>';
            html+='<div class="portada-titulo">PROGRAMACI\u00D3N MENSUAL</div>';
            html+='<div class="portada-subtitulo">Alumnado PT</div>';
            html+='<div class="portada-linea"></div>';
            html+='<div class="portada-mes">'+mesTexto+'</div>';
            if(trimTexto) html+='<div class="portada-trim">'+trimTexto+'</div>';
            else html+='<div class="portada-trim">&nbsp;</div>';
            html+='<div class="portada-linea"></div>';
            html+='<div class="portada-centro">CEIP Capitulaciones de Santa Fe</div>';
            html+='<div class="portada-curso">Curso escolar '+cursoEscolar+'</div>';
            html+='<div class="portada-footer">Pedagog\u00EDa Terap\u00E9utica</div>';
            html+='</div>';

            // === PARTE 1: PROGRAMACIONES ===
            html+='<div class="contenido page-break">';
            html+='<div class="titulo">Programaciones</div>';
            html+='<div class="subtitulo">'+tituloMes+'</div>';
            html+='<hr class="sep">';

            ids.forEach(id=>{
                const a=alumnos[id],dias=a.diasSesion||[1,3,4];
                const mesesAImprimir=mesSeleccionado===-1?MESES.map((_,i)=>i):[mesSeleccionado];
                mesesAImprimir.forEach(mi=>{
                    const mes=MESES[mi];
                    html+='<div class="bloque-alumno">';
                    html+='<div class="sec">'+a.siglas+' - '+a.curso;
                    if(mesSeleccionado===-1) html+=' <span class="sub-inline">'+mes.nombre+' (T'+mes.trim+')</span>';
                    html+='</div>';
                    html+='<table><tr><th>S</th>';
                    dias.forEach(d=>{html+='<th>'+DIAS_C[d]+'</th>';});
                    html+='</tr>';
                    for(let s=1;s<=mes.semanas;s++){
                        html+='<tr><td>'+s+'</td>';
                        dias.forEach(d=>{
                            const k=mi+'_'+s+'_'+d,c=a.programacion?a.programacion[k]:null;
                            if(c&&a.programas&&a.programas[c.pId]){
                                const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;
                                if(obj){
                                    const ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';
                                    html+='<td><span class="ob">O'+obj.numero+'</span> '+ind.substring(0,25)+'</td>';
                                }else html+='<td>-</td>';
                            }else html+='<td>-</td>';
                        });
                        html+='</tr>';
                    }
                    html+='</table></div>';
                });
            });
            html+='</div>';

            // === PARTE 2: VALORACIÃ“N DE INDICADORES ===
            html+='<div class="contenido page-break">';
            html+='<div class="eval-titulo">Valoraci\u00F3n de Indicadores</div>';
            html+='<div class="eval-sub">'+tituloMes+'</div>';
            html+='<hr class="sep">';

            ids.forEach(id=>{
                const a=alumnos[id],dias=a.diasSesion||[1,3,4];
                const mesesAImprimir=mesSeleccionado===-1?MESES.map((_,i)=>i):[mesSeleccionado];

                const indMap=new Map();
                mesesAImprimir.forEach(mi=>{
                    const mes=MESES[mi];
                    for(let s=1;s<=mes.semanas;s++){
                        dias.forEach(d=>{
                            const k=mi+'_'+s+'_'+d,c=a.programacion?a.programacion[k]:null;
                            if(c&&a.programas&&a.programas[c.pId]){
                                const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;
                                if(obj){
                                    const ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';
                                    const uKey=c.pId+'_'+c.oIdx+'_'+c.iIdx;
                                    if(!indMap.has(uKey)){
                                        const trim=MESES[mi].trim;
                                        const eKey=c.pId+'_'+c.oIdx+'_'+c.iIdx+'_T'+trim;
                                        const ev=a.evaluaciones?a.evaluaciones[eKey]:null;
                                        indMap.set(uKey,{objNum:obj.numero,indicador:ind,eval:ev});
                                    }
                                }
                            }
                        });
                    }
                });

                if(!indMap.size) return;

                html+='<div class="bloque-alumno">';
                html+='<div class="eval-sec">'+a.siglas+' - '+a.curso+'</div>';
                html+='<table class="eval-table"><tr><th>Obj</th><th>Indicador</th><th class="col-val">C</th><th class="col-val">EP</th><th class="col-val">NI</th></tr>';
                let ri=0;
                indMap.forEach(v=>{
                    const bg=ri%2===0?'':'style="background:#f8f9fa"';
                    const cMark=v.eval==='C'?'<span class="check">\u2713</span>':'';
                    const epMark=v.eval==='P'?'<span class="check-ep">\u2713</span>':'';
                    const niMark=v.eval==='N'?'<span class="check-ni">\u2713</span>':'';
                    html+='<tr '+bg+'><td><span class="ob">O'+v.objNum+'</span></td><td>'+v.indicador+'</td><td class="col-c">'+cMark+'</td><td class="col-ep">'+epMark+'</td><td class="col-ni">'+niMark+'</td></tr>';
                    ri++;
                });
                html+='</table></div>';
            });
            html+='</div>';

            // === PARTE 3: RELACIÃ“N OBJETIVOS-INDICADORES (solo meses sueltos) ===
            if(mesSeleccionado!==-1){
                html+='<div class="contenido page-break">';
                html+='<div class="titulo">Relaci\u00F3n Objetivos - Indicadores</div>';
                html+='<div class="subtitulo">'+tituloMes+'</div>';
                html+='<hr class="sep">';

                ids.forEach(id=>{
                    const a=alumnos[id],dias=a.diasSesion||[1,3,4];
                    const mi=mesSeleccionado,mes=MESES[mi];

                    // Agrupar indicadores por objetivo
                    const objMap=new Map(); // key=pId_oIdx => {objNum, desc, area, indicadores:[]}
                    for(let s=1;s<=mes.semanas;s++){
                        dias.forEach(d=>{
                            const k=mi+'_'+s+'_'+d,c=a.programacion?a.programacion[k]:null;
                            if(c&&a.programas&&a.programas[c.pId]){
                                const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;
                                if(obj){
                                    const oKey=c.pId+'_'+c.oIdx;
                                    const ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';
                                    const info=AREAS[p.tipo]||{nombre:p.tipo};
                                    if(!objMap.has(oKey)){
                                        objMap.set(oKey,{objNum:obj.numero,desc:obj.descripcion||'',area:info.nombre,indicadores:new Set()});
                                    }
                                    if(ind) objMap.get(oKey).indicadores.add(ind);
                                }
                            }
                        });
                    }

                    if(!objMap.size) return;

                    html+='<div class="bloque-alumno">';
                    html+='<div class="eval-sec">'+a.siglas+' - '+a.curso+'</div>';
                    html+='<table class="rel-table"><tr><th class="rel-obj">Obj</th><th class="rel-area">\u00C1rea</th><th class="rel-desc">Objetivo</th><th>Indicadores trabajados</th></tr>';
                    let ri=0;
                    objMap.forEach(v=>{
                        const bg=ri%2===0?'':'style="background:#f8f9fa"';
                        const inds=[...v.indicadores];
                        html+='<tr '+bg+'>';
                        html+='<td><span class="ob">O'+v.objNum+'</span></td>';
                        html+='<td class="rel-area-td">'+v.area+'</td>';
                        html+='<td>'+v.desc+'</td>';
                        html+='<td>'+inds.join(', ')+'</td>';
                        html+='</tr>';
                        ri++;
                    });
                    html+='</table></div>';
                });
                html+='</div>';
            }

            html+='</body></html>';
            const win=window.open('','_blank');
            win.document.write(html);
            win.document.close();
            setTimeout(()=>{win.print();},500);
            cerrarModal('modalImprimir');
        }

        // UTILIDADES
        function abrirModal(id){document.getElementById(id).classList.add('active');}
        function cerrarModal(id){document.getElementById(id).classList.remove('active');}
        function toast(msg,tipo){const t=document.getElementById('toast');t.textContent=msg;t.className='toast '+(tipo||'');setTimeout(()=>{t.classList.add('show');},10);setTimeout(()=>{t.classList.remove('show');},2500);}
    </script>
</body>
</html>