<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a5f4a">
    <title>Gestor PE v3</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='110' fill='%231a5f4a'/%3E%3Crect x='100' y='70' width='220' height='300' rx='20' fill='white'/%3E%3Ccircle cx='160' cy='140' r='16' fill='%2322c55e'/%3E%3Ccircle cx='370' cy='350' r='100' fill='%23f59e0b'/%3E%3Ccircle cx='370' cy='350' r='80' fill='white'/%3E%3Cpath d='M370 290v60h50' stroke='%231a5f4a' stroke-width='12' stroke-linecap='round' fill='none'/%3E%3C/svg%3E">
    <style>
        :root{--primary:#1a5f4a;--primary-light:#2d8a6e;--primary-dark:#134536;--bg:#f5f7f6;--bg-card:#fff;--text:#1a2a24;--text-light:#5a6b64;--border:#d4ddd9;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444;--proceso:#3b82f6;--shadow:0 4px 20px rgba(26,95,74,0.1);--radius:16px;--radius-sm:10px}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
        .header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:12px 16px;position:sticky;top:0;z-index:100}
        .header-content{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
        .header h1{font-size:1.1rem;cursor:pointer}
        .status{display:flex;align-items:center;gap:5px;font-size:.7rem;background:rgba(255,255,255,.2);padding:4px 10px;border-radius:20px}
        .status-dot{width:8px;height:8px;border-radius:50%;background:var(--warning)}
        .status-dot.ok{background:var(--success)}
        .container{max-width:1200px;margin:0 auto;padding:14px}
        .screen{display:none}.screen.active{display:block}
        .card{background:var(--bg-card);border-radius:var(--radius);padding:16px;margin-bottom:12px;box-shadow:var(--shadow)}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px}
        .card-title{font-size:1rem;font-weight:700;color:var(--primary)}
        .btn{padding:10px 14px;border:none;border-radius:var(--radius-sm);font-family:inherit;font-size:.85rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:4px}
        .btn-primary{background:var(--primary);color:#fff}
        .btn-secondary{background:var(--bg);color:var(--text);border:2px solid var(--border)}
        .btn-danger{background:var(--danger);color:#fff}
        .btn-warning{background:var(--warning);color:#fff}
        .btn-ai{background:#10a37f;color:#fff}
        .btn-sm{padding:7px 10px;font-size:.75rem}
        .btn-group{display:flex;gap:6px;flex-wrap:wrap}
        .nav-tabs{display:flex;gap:8px;margin-bottom:16px}
        .nav-tab{padding:12px 20px;border:none;background:var(--bg-card);color:var(--text-light);font-family:inherit;font-size:.9rem;font-weight:600;cursor:pointer;border-radius:var(--radius);box-shadow:var(--shadow)}
        .nav-tab.active{background:var(--primary);color:#fff}
        .alumnos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin-top:12px}
        .alumno-card{background:var(--bg-card);border-radius:var(--radius);padding:16px 10px;text-align:center;cursor:pointer;border:2px solid transparent;box-shadow:var(--shadow)}
        .alumno-card:hover{border-color:var(--primary-light)}
        .alumno-siglas{font-family:monospace;font-size:1.3rem;font-weight:700;color:var(--primary)}
        .alumno-curso{font-size:.75rem;color:var(--text-light)}
        .alumno-progs{font-size:.65rem;color:var(--primary);margin-top:4px}
        .alumno-card-add{background:transparent;border:2px dashed var(--primary-light);color:var(--primary);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:85px}
        .tabs{display:flex;gap:4px;background:var(--bg-card);padding:4px;border-radius:var(--radius);margin-bottom:14px;overflow-x:auto}
        .tab{flex:1;padding:9px 8px;border:none;background:transparent;color:var(--text-light);font-family:inherit;font-size:.75rem;font-weight:600;cursor:pointer;border-radius:var(--radius-sm);white-space:nowrap}
        .tab.active{background:var(--primary);color:#fff}
        .tab-content{display:none}.tab-content.active{display:block}
        .form-group{margin-bottom:12px}
        .form-label{display:block;font-weight:600;margin-bottom:4px;font-size:.8rem}
        .form-input,.form-select,.form-textarea{width:100%;padding:10px 12px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:inherit;font-size:16px}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--primary)}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000;padding:14px}
        .modal-overlay.active{display:flex}
        .modal{background:var(--bg-card);border-radius:var(--radius);width:100%;max-width:500px;max-height:85vh;overflow-y:auto}
        .modal-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-title{font-size:.95rem;font-weight:700}
        .modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-light)}
        .modal-body{padding:16px}
        .modal-footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:6px}
        .dias-btns{display:flex;gap:6px;margin-top:5px}
        .dia-btn{width:42px;height:42px;border:2px solid var(--border);border-radius:var(--radius-sm);background:#fff;font-weight:600;cursor:pointer}
        .dia-btn.active{border-color:var(--primary);background:rgba(26,95,74,.15);color:var(--primary)}
        .programa-card{background:var(--bg);border-radius:var(--radius-sm);padding:12px;margin-bottom:10px;border-left:4px solid var(--primary)}
        .programa-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .programa-titulo{font-weight:600;font-size:.9rem}
        .objetivo-card{background:#fff;border-radius:8px;padding:10px;margin-bottom:8px}
        .objetivo-header{display:flex;gap:5px;margin-bottom:5px;align-items:center}
        .objetivo-num{font-family:monospace;font-size:.7rem;font-weight:600;padding:2px 5px;border-radius:4px;background:rgba(26,95,74,.15);color:var(--primary)}
        .trimestre-badge{font-size:.65rem;padding:2px 5px;border-radius:4px;font-weight:600}
        .t1{background:#8b5cf620;color:#8b5cf6}.t2{background:#06b6d420;color:#06b6d4}.t3{background:#f59e0b20;color:#f59e0b}
        .objetivo-desc{font-size:.8rem}
        .indicadores-list{font-size:.75rem;margin-top:6px;padding-top:6px;border-top:1px solid var(--border);list-style:none}
        .indicadores-list li{padding:2px 0}
        .cuadrante-nav{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}
        .nav-btn{width:34px;height:34px;border:2px solid var(--border);background:#fff;border-radius:8px;cursor:pointer}
        .cuadrante-table{width:100%;border-collapse:collapse;font-size:.75rem}
        .cuadrante-table th,.cuadrante-table td{border:1px solid var(--border);padding:5px;text-align:left;vertical-align:top}
        .cuadrante-table th{background:var(--primary);color:#fff;text-align:center}
        .cuadrante-table td:first-child{background:var(--primary-light);color:#fff;text-align:center;width:40px}
        .celda{min-height:50px;cursor:pointer;position:relative}
        .celda:hover{background:var(--bg)}
        .celda-vacia{background:#f9fafb;color:var(--text-light)}
        .celda-obj{font-weight:600;color:var(--primary);font-size:.7rem}
        .celda-ind{font-size:.6rem;color:var(--text)}
        .celda-ausencia{background:#fee2e2!important}
        .celda-sincole{background:#e0e7ff!important}
        .celda-icon{position:absolute;top:2px;right:2px;font-size:.6rem}
        .upload-zone{border:2px dashed var(--border);border-radius:var(--radius-sm);padding:20px;text-align:center;cursor:pointer;background:var(--bg)}
        .upload-zone.has-file{border-color:var(--success);background:rgba(34,197,94,.1)}
        .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--text);color:#fff;padding:10px 18px;border-radius:var(--radius-sm);font-weight:500;opacity:0;transition:all .3s;z-index:2000}
        .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
        .toast.success{background:var(--success)}
        .toast.error{background:var(--danger)}
        .empty-state{text-align:center;padding:25px;color:var(--text-light)}
        .leyenda{display:flex;gap:12px;flex-wrap:wrap;font-size:.7rem;margin-top:8px}
        .leyenda-item{display:flex;align-items:center;gap:4px}
        .leyenda-color{width:12px;height:12px;border-radius:3px}
        .alumno-header{display:flex;align-items:center;gap:12px;margin-bottom:14px;flex-wrap:wrap}
        .alumno-header-siglas{font-family:monospace;font-size:1.5rem;font-weight:700;color:var(--primary);background:rgba(26,95,74,.1);padding:10px 16px;border-radius:var(--radius)}
        .stats-box{display:flex;gap:10px;flex-wrap:wrap;padding:10px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:12px}
        .stat-item{text-align:center;padding:8px 12px;background:#fff;border-radius:8px;min-width:70px;flex:1}
        .stat-num{font-size:1.3rem;font-weight:700}
        .stat-label{font-size:.65rem;color:var(--text-light)}
        .eval-item{display:flex;align-items:center;gap:6px;padding:8px;background:var(--bg);border-radius:6px;margin-bottom:5px;flex-wrap:wrap}
        .eval-text{flex:1;font-size:.8rem;min-width:140px}
        .eval-btn{width:32px;height:32px;border-radius:50%;border:2px solid var(--border);background:#fff;cursor:pointer;font-size:.85rem}
        .eval-btn.c{border-color:var(--success);color:var(--success)}
        .eval-btn.c.active{background:var(--success);color:#fff}
        .eval-btn.p{border-color:var(--proceso);color:var(--proceso)}
        .eval-btn.p.active{background:var(--proceso);color:#fff}
        .eval-btn.n{border-color:#888;color:#888}
        .eval-btn.n.active{background:#888;color:#fff}
        .asist-btns{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
        .asist-btn{flex:1;padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer;text-align:center;min-width:80px}
        .asist-btn.selected{border-width:3px}
        .asist-btn.asiste.selected{border-color:var(--success);background:rgba(34,197,94,.1)}
        .asist-btn.ausencia.selected{border-color:var(--danger);background:rgba(239,68,68,.1)}
        .asist-btn.sincole.selected{border-color:#6366f1;background:rgba(99,102,241,.1)}
        .resultado-btns{display:flex;gap:8px;margin-top:10px}
        .resultado-btn{flex:1;padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer;text-align:center;font-size:.8rem}
        .resultado-btn.selected{border-width:3px}
        .resultado-btn.conseguido.selected{border-color:var(--success);background:rgba(34,197,94,.1)}
        .resultado-btn.repetir.selected{border-color:var(--warning);background:rgba(245,158,11,.1)}
        .chart-container{background:#fff;border-radius:var(--radius-sm);padding:12px;margin-bottom:12px}
        .chart-container canvas{max-height:200px}
        .informe-preview{background:#fff;border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-top:12px;font-size:.85rem;max-height:400px;overflow-y:auto}
        .pasado-badge{font-size:.6rem;background:#fef3c7;color:#92400e;padding:1px 4px;border-radius:3px;margin-left:4px}
        .print-option{padding:12px;border:2px solid var(--border);border-radius:var(--radius-sm);margin-bottom:8px;cursor:pointer;transition:all .2s}
        .print-option:hover{border-color:var(--primary);background:rgba(26,95,74,.05)}
        .print-option h4{margin-bottom:4px;color:var(--primary)}
        .print-option p{font-size:.8rem;color:var(--text-light)}
        .filtros{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
        .filtros select{padding:8px 12px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.85rem}
        .plantilla-card{background:var(--bg-card);border-radius:var(--radius);padding:14px;margin-bottom:10px;box-shadow:var(--shadow);cursor:pointer;border:2px solid transparent;transition:all .2s}
        .plantilla-card:hover{border-color:var(--primary-light)}
        .plantilla-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
        .plantilla-titulo{font-weight:700;color:var(--primary);font-size:.95rem}
        .plantilla-meta{display:flex;gap:6px;flex-wrap:wrap}
        .plantilla-badge{font-size:.65rem;padding:3px 8px;border-radius:12px;font-weight:600}
        .badge-area{background:#dcfce7;color:#166534}
        .plantilla-stats{font-size:.75rem;color:var(--text-light)}
        .ciclo-infantil{background:#fce7f3;color:#be185d}
        .ciclo-ciclo1{background:#dbeafe;color:#1e40af}
        .ciclo-ciclo2{background:#d1fae5;color:#065f46}
        .ciclo-ciclo3{background:#fef3c7;color:#92400e}
        @media print{.no-print{display:none!important}body{background:#fff}.card{box-shadow:none;border:1px solid #ddd}}
        /* S√âNECA STYLES */
        .seneca-programa{background:var(--bg-card);border-radius:var(--radius);padding:16px;margin-bottom:16px;box-shadow:var(--shadow);border-left:5px solid var(--primary)}
        .seneca-programa-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid var(--primary)}
        .seneca-programa-titulo{font-size:1.1rem;font-weight:700;color:var(--primary)}
        .seneca-objetivo{background:var(--bg);border-radius:var(--radius-sm);padding:14px;margin-bottom:12px}
        .seneca-objetivo-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .seneca-objetivo-titulo{font-weight:600;color:var(--text)}
        .seneca-seccion{background:#fff;border-radius:8px;padding:12px;margin-bottom:8px;border:1px solid var(--border)}
        .seneca-seccion-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .seneca-seccion-titulo{font-weight:600;font-size:.85rem;color:var(--primary-dark)}
        .seneca-contenido{font-size:.8rem;color:var(--text);line-height:1.5;white-space:pre-wrap}
        .btn-copiar{padding:5px 10px;font-size:.7rem;background:var(--primary);color:#fff;border:none;border-radius:6px;cursor:pointer;display:inline-flex;align-items:center;gap:4px}
        .btn-copiar:hover{background:var(--primary-dark)}
        .btn-copiar.copiado{background:var(--success)}
        .btn-copiar-sm{padding:4px 8px;font-size:.65rem;min-width:32px}
        .seneca-indicadores-lista{display:flex;flex-direction:column;gap:6px}
        .seneca-indicador-item{display:flex;align-items:center;gap:8px;padding:8px 10px;background:#fff;border-radius:6px;border:1px solid var(--border)}
        .seneca-indicador-num{font-weight:700;color:var(--primary);min-width:20px;text-align:center;font-size:.8rem}
        .seneca-indicador-texto{flex:1;font-size:.8rem;color:var(--text)}
        .seneca-info{background:#e0f2fe;padding:12px;border-radius:8px;font-size:.8rem;color:#0369a1;margin-bottom:16px}
    </style>
</head>
<body>
    <header class="header no-print">
        <div class="header-content">
            <h1 onclick="volverInicio()">üìã Gestor PE v3</h1>
            <div class="status"><div class="status-dot" id="statusDot"></div><span id="statusText">Conectando...</span></div>
        </div>
    </header>

    <div id="screenInicio" class="screen active">
        <div class="container">
            <div class="nav-tabs no-print">
                <button class="nav-tab active" onclick="cambiarSeccion('alumnos',this)">üë• Alumnos</button>
                <button class="nav-tab" onclick="cambiarSeccion('biblioteca',this)">üìö Biblioteca</button>
            </div>
            <div id="seccionAlumnos">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üë• Mis Alumnos</h2>
                        <div class="btn-group">
                            <button class="btn btn-secondary btn-sm" onclick="abrirModalImprimir()">üñ®Ô∏è</button>
                            <button class="btn btn-primary btn-sm" onclick="abrirModalNuevo()">‚ûï Nuevo</button>
                        </div>
                    </div>
                    <div class="alumnos-grid" id="alumnosGrid"></div>
                </div>
            </div>
            <div id="seccionBiblioteca" style="display:none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìö Biblioteca de Plantillas</h2>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm" onclick="abrirModalNuevaPlantilla()">‚ûï Nueva</button>
                        </div>
                    </div>
                    <div class="filtros">
                        <select id="filtroCiclo" onchange="renderBiblioteca()">
                            <option value="">Todos los ciclos</option>
                            <option value="infantil">üíí Infantil</option>
                            <option value="ciclo1">üîµ 1¬∫ Ciclo</option>
                            <option value="ciclo2">üü¢ 2¬∫ Ciclo</option>
                            <option value="ciclo3">üü† 3¬∫ Ciclo</option>
                        </select>
                        <select id="filtroArea" onchange="renderBiblioteca()">
                            <option value="">Todas las √°reas</option>
                            <option value="psicomotor">Desarrollo Psicomotor</option>
                            <option value="motor">Desarrollo Motor</option>
                            <option value="comunicativo">Desarrollo Comunicativo</option>
                            <option value="cognitivo">Desarrollo Cognitivo</option>
                            <option value="social">Desarrollo Social-Emocional</option>
                            <option value="autonomia">Autonom√≠a Personal</option>
                        </select>
                    </div>
                    <div id="bibliotecaGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="screenAlumno" class="screen">
        <div class="container">
            <div class="alumno-header" id="alumnoHeader"></div>
            <div class="tabs no-print">
                <button class="tab active" onclick="cambiarTab('programas')">üìÑ Programas</button>
                <button class="tab" onclick="cambiarTab('programacion')">üìÖ Programaci√≥n</button>
                <button class="tab" onclick="cambiarTab('evaluacion')">üìä Evaluaci√≥n</button>
                <button class="tab" onclick="cambiarTab('asistencia')">üìà Resumen</button>
                <button class="tab" onclick="cambiarTab('seneca')">üèõÔ∏è S√©neca</button>
            </div>
            <div id="tabProgramas" class="tab-content active"></div>
            <div id="tabProgramacion" class="tab-content"></div>
            <div id="tabEvaluacion" class="tab-content"></div>
            <div id="tabAsistencia" class="tab-content"></div>
            <div id="tabSeneca" class="tab-content"></div>
        </div>
    </div>

    <!-- MODALES -->
    <div class="modal-overlay" id="modalNuevo">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">‚ûï Nuevo Alumno</h3><button class="modal-close" onclick="cerrarModal('modalNuevo')">√ó</button></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Siglas *</label><input type="text" class="form-input" id="nuevoSiglas" placeholder="M.G.L." maxlength="10"></div>
                    <div class="form-group"><label class="form-label">Curso *</label><select class="form-select" id="nuevoCurso"><option value="infantil">Infantil 3 a√±os</option><option value="infantil">Infantil 4 a√±os</option><option value="infantil" selected>Infantil 5 a√±os</option><option value="ciclo1">1¬∫ Primaria</option><option value="ciclo1">2¬∫ Primaria</option><option value="ciclo2">3¬∫ Primaria</option><option value="ciclo2">4¬∫ Primaria</option><option value="ciclo3">5¬∫ Primaria</option><option value="ciclo3">6¬∫ Primaria</option></select></div>
                </div>
                <div class="form-group"><label class="form-label">D√≠as de sesi√≥n</label><div class="dias-btns" id="diasBtns"><button type="button" class="dia-btn" data-dia="0" onclick="toggleDia(0)">L</button><button type="button" class="dia-btn active" data-dia="1" onclick="toggleDia(1)">M</button><button type="button" class="dia-btn" data-dia="2" onclick="toggleDia(2)">X</button><button type="button" class="dia-btn active" data-dia="3" onclick="toggleDia(3)">J</button><button type="button" class="dia-btn active" data-dia="4" onclick="toggleDia(4)">V</button></div></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalNuevo')">Cancelar</button><button class="btn btn-primary" onclick="crearAlumno()">‚úì Crear</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalAddProg">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">üìÑ A√±adir Programa</h3><button class="modal-close" onclick="cerrarModal('modalAddProg')">√ó</button></div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Seleccionar de biblioteca</label>
                    <select class="form-select" id="selPlantilla" onchange="previsualizarPlantilla()">
                        <option value="">-- Elegir plantilla --</option>
                    </select>
                </div>
                <div id="previewPlantilla" style="display:none;margin-top:12px;padding:12px;background:var(--bg);border-radius:8px;font-size:.8rem;max-height:200px;overflow-y:auto"></div>
                <hr style="margin:16px 0;border:none;border-top:1px solid var(--border)">
                <p style="font-size:.8rem;color:var(--text-light);margin-bottom:10px">O crear manualmente:</p>
                <div class="form-group"><label class="form-label">Tipo de programa</label><select class="form-select" id="addProgTipo" onchange="cambioTipoProg()"><option value="">Seleccionar...</option><option value="psicomotor">üèÉ Desarrollo Psicomotor</option><option value="motor">‚úã Desarrollo Motor</option><option value="comunicativo">üí¨ Desarrollo Comunicativo</option><option value="cognitivo">üß† Desarrollo Cognitivo</option><option value="social">‚ù§Ô∏è Desarrollo Social-Emocional</option><option value="autonomia">üéØ Autonom√≠a Personal</option><option value="lectoescritura">üìñ Lectoescritura (predefinido)</option></select></div>
                <div id="zonaDocx"><div class="form-group"><label class="form-label">Importar DOCX</label><div class="upload-zone" id="uploadZone" onclick="document.getElementById('inputFile').click()">üìÑ Toca para seleccionar</div><input type="file" id="inputFile" accept=".docx" style="display:none" onchange="cargarDocx(this)"></div><div class="form-group"><label class="form-label">O pegar texto</label><textarea class="form-input" id="addProgTexto" rows="3" placeholder="OBJETIVO 1: ..."></textarea></div><button class="btn btn-secondary btn-sm" onclick="analizarTexto()">üîç Analizar</button></div>
                <div id="zonaLecto" style="display:none"><div style="background:var(--bg);padding:12px;border-radius:8px"><strong>üìñ Programa predefinido</strong><p style="font-size:.8rem;color:var(--text-light)">Vocales y consonantes</p></div></div>
                <div id="previewProg" style="display:none;margin-top:12px;padding:10px;background:var(--bg);border-radius:8px;font-size:.8rem"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalAddProg')">Cancelar</button><button class="btn btn-primary" onclick="addPrograma()">üì• A√±adir</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalCelda">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title" id="celdaTitulo">Sesi√≥n</h3><button class="modal-close" onclick="cerrarModal('modalCelda')">√ó</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Estado</label><div class="asist-btns"><button type="button" class="asist-btn asiste" onclick="setEstado('asiste',this)">‚úÖ Asiste</button><button type="button" class="asist-btn ausencia" onclick="setEstado('ausencia',this)">‚ùå Ausencia</button><button type="button" class="asist-btn sincole" onclick="setEstado('sincole',this)">üè´ Sin cole</button></div></div>
                <div id="contenidoSesion">
                    <div class="form-group"><label class="form-label">Programa</label><select class="form-select" id="selPrograma" onchange="cargarObjetivos()"></select></div>
                    <div class="form-group"><label class="form-label">Objetivo</label><select class="form-select" id="selObjetivo" onchange="cargarIndicadores()"></select></div>
                    <div class="form-group"><label class="form-label">Indicador</label><select class="form-select" id="selIndicador"></select></div>
                    <div class="form-group"><label class="form-label">Resultado</label><div class="resultado-btns"><button type="button" class="resultado-btn conseguido" onclick="setResultado('conseguido',this)">‚úÖ Conseguido</button><button type="button" class="resultado-btn repetir" onclick="setResultado('repetir',this)">üîÑ Repetir</button></div></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-danger btn-sm" onclick="borrarCelda()">üóëÔ∏è</button><button class="btn btn-secondary" onclick="cerrarModal('modalCelda')">Cancelar</button><button class="btn btn-primary" onclick="guardarCelda()">üíæ Guardar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalInforme">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title">üìÑ Generar Informe</h3><button class="modal-close" onclick="cerrarModal('modalInforme')">√ó</button></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Trimestre</label><select class="form-select" id="informeTrim"><option value="1">1¬∫ Trimestre</option><option value="2">2¬∫ Trimestre</option><option value="3">3¬∫ Trimestre</option></select></div>
                    <div class="form-group"><label class="form-label">Per√≠odo</label><select class="form-select" id="informePeriodo"><option value="trimestral">Trimestral</option><option value="mensual">Mensual</option></select></div>
                </div>
                <div class="form-group" id="grupoMes" style="display:none"><label class="form-label">Mes</label><select class="form-select" id="informeMes"></select></div>
                <div class="btn-group" style="flex-direction:column;gap:8px">
                    <button class="btn btn-primary" onclick="generarInforme()">üìÑ Generar Informe PT</button>
                    <button class="btn btn-ai" onclick="abrirChatGPTInforme('pt')">ü§ñ ChatGPT - Valoraci√≥n PT</button>
                    <hr style="border:none;border-top:1px solid var(--border);margin:4px 0">
                    <button class="btn btn-ai" onclick="abrirChatGPTInforme('familia')" style="background:#8b5cf6">üë®‚Äçüë©‚Äçüëß ChatGPT - Informe Familias</button>
                    <button class="btn btn-ai" onclick="abrirChatGPTInforme('tutor')" style="background:#06b6d4">üë©‚Äçüè´ ChatGPT - Informe Tutor</button>
                </div>
                <div id="informePreview" class="informe-preview" style="display:none"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalInforme')">Cerrar</button><button class="btn btn-primary" id="btnImprimirInforme" onclick="imprimirInforme()" style="display:none">üñ®Ô∏è Imprimir</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalImportJSON">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title">üì• Importar JSON</h3><button class="modal-close" onclick="cerrarModal('modalImportJSON')">√ó</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Pega el JSON:</label><textarea class="form-textarea" id="jsonInput" rows="10"></textarea></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalImportJSON')">Cancelar</button><button class="btn btn-primary" onclick="importarJSON()">üì• Importar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalImprimir">
        <div class="modal" style="max-width:500px">
            <div class="modal-header"><h3 class="modal-title">üñ®Ô∏è Imprimir</h3><button class="modal-close" onclick="cerrarModal('modalImprimir')">√ó</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Mes</label><select class="form-select" id="printMes"><option value="-1">üìÖ Todo el curso</option><option value="0">Septiembre</option><option value="1">Octubre</option><option value="2">Noviembre</option><option value="3">Diciembre</option><option value="4">Enero</option><option value="5">Febrero</option><option value="6">Marzo</option><option value="7">Abril</option><option value="8">Mayo</option><option value="9">Junio</option></select></div>
                <div class="print-option" onclick="generarWord()"><h4>üì• Descargar Word</h4><p>Programaciones + hoja de valoraci√≥n de indicadores</p></div>
                <div class="print-option" onclick="imprimirTodos()"><h4>üñ®Ô∏è Imprimir separado</h4><p>Cada alumno en una p√°gina distinta (PDF)</p></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalImprimir')">Cerrar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalPlantilla">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title" id="modalPlantillaTitulo">üìö Plantilla</h3><button class="modal-close" onclick="cerrarModal('modalPlantilla')">√ó</button></div>
            <div class="modal-body" id="modalPlantillaBody"></div>
            <div class="modal-footer" id="modalPlantillaFooter"></div>
        </div>
    </div>

    <div class="modal-overlay" id="modalNuevaPlantilla">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h3 class="modal-title">‚ûï Nueva Plantilla</h3><button class="modal-close" onclick="cerrarModal('modalNuevaPlantilla')">√ó</button></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Nombre *</label><input type="text" class="form-input" id="plantillaNombre"></div>
                    <div class="form-group"><label class="form-label">Ciclo *</label><select class="form-select" id="plantillaCiclo"><option value="infantil">Infantil</option><option value="ciclo1">1¬∫ Ciclo</option><option value="ciclo2">2¬∫ Ciclo</option><option value="ciclo3">3¬∫ Ciclo</option></select></div>
                </div>
                <div class="form-group"><label class="form-label">√Årea *</label><select class="form-select" id="plantillaArea"><option value="psicomotor">Desarrollo Psicomotor</option><option value="motor">Desarrollo Motor</option><option value="comunicativo">Desarrollo Comunicativo</option><option value="cognitivo">Desarrollo Cognitivo</option><option value="social">Desarrollo Social-Emocional</option><option value="autonomia">Autonom√≠a Personal</option></select></div>
                <div class="form-group"><label class="form-label">Importar DOCX o pegar texto</label><div class="upload-zone" id="uploadZonePlantilla" onclick="document.getElementById('inputFilePlantilla').click()">üìÑ Toca para seleccionar</div><input type="file" id="inputFilePlantilla" accept=".docx" style="display:none" onchange="cargarDocxPlantilla(this)"></div>
                <div class="form-group"><textarea class="form-input" id="plantillaTexto" rows="5" placeholder="OBJETIVO 1: ..."></textarea></div>
                <button class="btn btn-secondary btn-sm" onclick="analizarTextoPlantilla()">üîç Analizar</button>
                <div id="previewPlantillaNueva" style="display:none;margin-top:12px;padding:10px;background:var(--bg);border-radius:8px;font-size:.8rem"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="cerrarModal('modalNuevaPlantilla')">Cancelar</button><button class="btn btn-primary" id="btnGuardarPlantilla" onclick="guardarNuevaPlantilla()" disabled>üíæ Guardar</button></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/docx@9.5.1/build/index.umd.js"></script>
    <script>
        firebase.initializeApp({databaseURL:"https://gestorpt-7946b-default-rtdb.europe-west1.firebasedatabase.app"});
        const db=firebase.database();
        let alumnos={},plantillas={},alumnoActual=null,mesActual=0,diasSel=[1,3,4],celdaEditando=null,docExtraido=null,docExtraidoPlantilla=null,estadoCelda='asiste',resultadoCelda=null,evalTrim=1,charts={},informeData=null;
        
        const CICLOS={infantil:{nombre:'Infantil',icon:'üíí'},ciclo1:{nombre:'1¬∫ Ciclo',icon:'üîµ'},ciclo2:{nombre:'2¬∫ Ciclo',icon:'üü¢'},ciclo3:{nombre:'3¬∫ Ciclo',icon:'üü†'}};
        const AREAS={psicomotor:{nombre:'Desarrollo Psicomotor',icon:'üèÉ',color:'#8b5cf6'},motor:{nombre:'Desarrollo Motor',icon:'‚úã',color:'#06b6d4'},comunicativo:{nombre:'Desarrollo Comunicativo',icon:'üí¨',color:'#10b981'},cognitivo:{nombre:'Desarrollo Cognitivo',icon:'üß†',color:'#3b82f6'},social:{nombre:'Desarrollo Social-Emocional',icon:'‚ù§Ô∏è',color:'#ec4899'},autonomia:{nombre:'Autonom√≠a Personal',icon:'üéØ',color:'#f59e0b'},lectoescritura:{nombre:'Lectoescritura',icon:'üìñ',color:'#6366f1'}};
        const MESES=[{nombre:'Septiembre',semanas:3,trim:1},{nombre:'Octubre',semanas:4,trim:1},{nombre:'Noviembre',semanas:4,trim:1},{nombre:'Diciembre',semanas:2,trim:1},{nombre:'Enero',semanas:3,trim:2},{nombre:'Febrero',semanas:4,trim:2},{nombre:'Marzo',semanas:3,trim:2},{nombre:'Abril',semanas:3,trim:3},{nombre:'Mayo',semanas:4,trim:3},{nombre:'Junio',semanas:3,trim:3}];
        const DIAS=['Lunes','Martes','Mi√©rcoles','Jueves','Viernes'],DIAS_C=['L','M','X','J','V'];
        const LECTO=['A','E','I','O','U','M','P','S','L','T','N','D','F','B','V','J','R','C','Q','G','H','CH','√ë','Y','LL','Z','X','K','W'].map((l,i)=>({numero:i+1,descripcion:'Letra '+l,trimestre:i<10?1:(i<20?2:3),indicadores:['Reconoce '+l,'Traza '+l,'Lee s√≠labas con '+l]}));
        
        // PLANTILLAS BASE - 12 plantillas completas
        const PLANTILLAS_BASE = [
            {nombre:'Desarrollo Cognitivo',ciclo:'infantil',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Mejorar atenci√≥n sostenida',trimestre:1,indicadores:['Mantiene atenci√≥n 3 min','Sigue con mirada objetos','Permanece sentado en actividad','Atiende a cuentos breves']},
                {numero:2,descripcion:'Desarrollar atenci√≥n selectiva',trimestre:1,indicadores:['Discrimina figura-fondo','Localiza objetos en im√°genes','Identifica sonidos del entorno','Selecciona objetos por color']},
                {numero:3,descripcion:'Mejorar memoria visual',trimestre:1,indicadores:['Recuerda 2-3 im√°genes','Encuentra objeto escondido','Empareja im√°genes iguales','Completa puzzles 4-6 piezas']},
                {numero:4,descripcion:'Desarrollar memoria auditiva',trimestre:1,indicadores:['Repite secuencia 2 sonidos','Sigue instrucciones 1 paso','Recuerda nombres compa√±eros','Reproduce ritmos sencillos']},
                {numero:5,descripcion:'Mejorar percepci√≥n visual',trimestre:1,indicadores:['Discrimina colores b√°sicos','Reconoce formas geom√©tricas','Identifica grande-peque√±o','Completa series 2 elementos']},
                {numero:6,descripcion:'Desarrollar razonamiento b√°sico',trimestre:2,indicadores:['Clasifica por un atributo','Agrupa objetos iguales','Identifica diferente en grupo','Ordena por tama√±o 3 objetos']},
                {numero:7,descripcion:'Mejorar orientaci√≥n espacial',trimestre:2,indicadores:['Identifica arriba-abajo','Reconoce dentro-fuera','Sit√∫a delante-detr√°s','Sigue caminos sencillos']},
                {numero:8,descripcion:'Desarrollar orientaci√≥n temporal',trimestre:2,indicadores:['Diferencia d√≠a-noche','Conoce rutinas diarias','Ordena secuencia 2 im√°genes','Identifica antes-despu√©s']},
                {numero:9,descripcion:'Ampliar atenci√≥n conjunta',trimestre:2,indicadores:['Se√±ala objeto de inter√©s','Comparte atenci√≥n con adulto','Mira donde se√±ala otro','Responde a su nombre']},
                {numero:10,descripcion:'Mejorar funciones ejecutivas',trimestre:2,indicadores:['Espera turno con apoyo','Inhibe respuesta ante STOP','Cambia actividad sin rabieta','Sigue rutina 2 pasos']},
                {numero:11,descripcion:'Desarrollar pensamiento simb√≥lico',trimestre:3,indicadores:['Juega a ser otro personaje','Usa objeto como si fuera otro','Imita acciones cotidianas','Representa con plastilina']},
                {numero:12,descripcion:'Mejorar resoluci√≥n problemas',trimestre:3,indicadores:['Busca objeto no visible','Usa herramienta para alcanzar','Pide ayuda cuando necesita','Intenta varias soluciones']},
                {numero:13,descripcion:'Ampliar conocimiento entorno',trimestre:3,indicadores:['Nombra animales comunes','Identifica alimentos b√°sicos','Reconoce transportes','Conoce partes del cuerpo']},
                {numero:14,descripcion:'Desarrollar creatividad',trimestre:3,indicadores:['Garabatea con intenci√≥n','Construye con bloques','Experimenta con materiales','Propone juegos nuevos']},
                {numero:15,descripcion:'Generalizar aprendizajes',trimestre:3,indicadores:['Aplica en otros contextos','Transfiere a casa','Recuerda tras vacaciones','Muestra progreso acumulado']}
            ]},
            {nombre:'Desarrollo Cognitivo',ciclo:'ciclo1',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Mejorar atenci√≥n sostenida',trimestre:1,indicadores:['Mantiene atenci√≥n 10 min','Finaliza tareas cortas','Trabaja sin distraerse','Sigue explicaciones grupales']},
                {numero:2,descripcion:'Desarrollar atenci√≥n selectiva',trimestre:1,indicadores:['Localiza diferencias','Busca elementos espec√≠ficos','Filtra informaci√≥n relevante','Sigue instrucciones con distractores']},
                {numero:3,descripcion:'Mejorar memoria de trabajo',trimestre:1,indicadores:['Retiene 3-4 instrucciones','Opera mentalmente con n√∫meros','Recuerda inicio de frase','Mantiene informaci√≥n trabajando']},
                {numero:4,descripcion:'Ampliar memoria largo plazo',trimestre:1,indicadores:['Recuerda contenidos anteriores','Evoca vocabulario aprendido','Relaciona con previos','Aplica procedimientos']},
                {numero:5,descripcion:'Mejorar percepci√≥n visual',trimestre:1,indicadores:['Discrimina letras similares','Reconoce palabras globalmente','Percibe detalles en im√°genes','Copia figuras con precisi√≥n']},
                {numero:6,descripcion:'Desarrollar razonamiento l√≥gico',trimestre:2,indicadores:['Clasifica por 2 atributos','Establece causa-efecto','Resuelve problemas sencillos','Completa series num√©ricas']},
                {numero:7,descripcion:'Mejorar organizaci√≥n espacial',trimestre:2,indicadores:['Sit√∫a izquierda-derecha','Interpreta planos sencillos','Reproduce en cuadr√≠cula','Describe posiciones objetos']},
                {numero:8,descripcion:'Desarrollar organizaci√≥n temporal',trimestre:2,indicadores:['Ordena secuencias 4 im√°genes','Conoce d√≠as semana','Sit√∫a ayer-hoy-ma√±ana','Estima duraciones cortas']},
                {numero:9,descripcion:'Mejorar planificaci√≥n',trimestre:2,indicadores:['Organiza material','Sigue pasos en orden','Anticipa lo que necesita','Divide tarea en partes']},
                {numero:10,descripcion:'Desarrollar flexibilidad cognitiva',trimestre:2,indicadores:['Acepta cambios de plan','Considera alternativas','Corrige errores sin frustrar','Adapta estrategia']},
                {numero:11,descripcion:'Mejorar comprensi√≥n verbal',trimestre:3,indicadores:['Entiende instrucciones complejas','Comprende textos cortos','Responde preguntas literales','Identifica idea principal']},
                {numero:12,descripcion:'Desarrollar expresi√≥n verbal',trimestre:3,indicadores:['Explica procedimientos','Narra ordenadamente','Usa vocabulario adecuado','Formula preguntas coherentes']},
                {numero:13,descripcion:'Ampliar razonamiento num√©rico',trimestre:3,indicadores:['Comprende valor posicional','Resuelve suma/resta','Estima cantidades','Usa estrategias c√°lculo']},
                {numero:14,descripcion:'Mejorar metacognici√≥n',trimestre:3,indicadores:['Identifica qu√© sabe/no sabe','Pide aclaraciones','Revisa su trabajo','Valora su esfuerzo']},
                {numero:15,descripcion:'Generalizar aprendizajes',trimestre:3,indicadores:['Aplica en otras √°reas','Transfiere a casa','Mantiene logros','Muestra autonom√≠a creciente']}
            ]},
            {nombre:'Desarrollo Social-Emocional',ciclo:'infantil',tipo:'social',objetivos:[
                {numero:1,descripcion:'Desarrollar conciencia emocional',trimestre:1,indicadores:['Identifica alegr√≠a','Reconoce tristeza','Expresa enfado b√°sico','Identifica miedo']},
                {numero:2,descripcion:'Reconocer emociones en otros',trimestre:1,indicadores:['Identifica caras alegres','Reconoce tristeza otros','Detecta enfado en otros','Responde a llanto']},
                {numero:3,descripcion:'Mejorar regulaci√≥n emocional',trimestre:1,indicadores:['Acepta consuelo adulto','Usa objeto de apego','Se calma con estrategias','Tolera peque√±as frustraciones']},
                {numero:4,descripcion:'Desarrollar v√≠nculo adultos',trimestre:1,indicadores:['Busca proximidad adulto','Acepta separaci√≥n','Muestra preferencia figuras','Comparte con adulto']},
                {numero:5,descripcion:'Iniciar relaci√≥n iguales',trimestre:1,indicadores:['Muestra inter√©s otros ni√±os','Juega al lado de otros','Observa juego compa√±eros','Acepta presencia otros']},
                {numero:6,descripcion:'Desarrollar juego social',trimestre:2,indicadores:['Participa juego paralelo','Comparte espacio juego','Imita compa√±eros','Inicia interacci√≥n simple']},
                {numero:7,descripcion:'Mejorar comunicaci√≥n social',trimestre:2,indicadores:['Saluda con apoyo','Se despide','Responde cuando llaman','Pide por favor']},
                {numero:8,descripcion:'Desarrollar conductas prosociales',trimestre:2,indicadores:['Ayuda a recoger','Ofrece objeto a otro','Muestra preocupaci√≥n','Consuela b√°sico']},
                {numero:9,descripcion:'Mejorar tolerancia frustraci√≥n',trimestre:2,indicadores:['Espera turno apoyo visual','Acepta no ser primero','Tolera perder','Acepta l√≠mites adulto']},
                {numero:10,descripcion:'Desarrollar autoconcepto',trimestre:2,indicadores:['Dice su nombre','Reconoce pertenencias','Muestra logros','Expresa preferencias']},
                {numero:11,descripcion:'Ampliar juego cooperativo',trimestre:3,indicadores:['Participa con otros','Acepta propuestas','Sigue reglas simples','Comparte materiales']},
                {numero:12,descripcion:'Mejorar resoluci√≥n conflictos',trimestre:3,indicadores:['Pide ayuda ante conflicto','Acepta mediaci√≥n','Usa palabras no pegar','Propone soluci√≥n']},
                {numero:13,descripcion:'Desarrollar empat√≠a b√°sica',trimestre:3,indicadores:['Preocupaci√≥n otro triste','Ofrece ayuda espont√°nea','Adapta conducta','Celebra logros otros']},
                {numero:14,descripcion:'Ampliar autonom√≠a emocional',trimestre:3,indicadores:['Expresa emociones verbal','Pide lo que necesita','Acepta ayuda','Orgullo por logros']},
                {numero:15,descripcion:'Generalizar habilidades',trimestre:3,indicadores:['Aplica en recreo','Conductas en casa','Interact√∫a adultos','Mantiene amistades']}
            ]},
            {nombre:'Desarrollo Social-Emocional',ciclo:'ciclo1',tipo:'social',objetivos:[
                {numero:1,descripcion:'Ampliar vocabulario emocional',trimestre:1,indicadores:['Nombra emociones b√°sicas','Describe situaciones','Usa palabras emocionales','Diferencia intensidad']},
                {numero:2,descripcion:'Mejorar conciencia emocional',trimestre:1,indicadores:['Identifica emociones propias','Reconoce cambios','Relaciona situaci√≥n-emoci√≥n','Expresa c√≥mo se siente']},
                {numero:3,descripcion:'Desarrollar regulaci√≥n emocional',trimestre:1,indicadores:['Usa relajaci√≥n simple','Aplica respiraci√≥n','Busca lugar tranquilo','Pide ayuda para regular']},
                {numero:4,descripcion:'Mejorar tolerancia frustraci√≥n',trimestre:1,indicadores:['Acepta errores sin rabieta','Sigue tras fracaso','Espera turno','Acepta no ganar']},
                {numero:5,descripcion:'Desarrollar autoestima',trimestre:1,indicadores:['Reconoce fortalezas','Acepta dificultades','Orgullo por logros','Habla positivamente']},
                {numero:6,descripcion:'Mejorar conversaci√≥n',trimestre:2,indicadores:['Inicia conversaci√≥n','Mantiene tema','Respeta turnos palabra','Hace preguntas']},
                {numero:7,descripcion:'Desarrollar asertividad',trimestre:2,indicadores:['Expresa opiniones','Defiende derechos','Dice no apropiadamente','Pide lo que necesita']},
                {numero:8,descripcion:'Mejorar cooperaci√≥n',trimestre:2,indicadores:['Trabaja en equipo','Aporta al grupo','Acepta ideas otros','Celebra logros grupales']},
                {numero:9,descripcion:'Desarrollar empat√≠a',trimestre:2,indicadores:['Reconoce emociones otros','Se pone en lugar','Ofrece consuelo','Adapta conducta']},
                {numero:10,descripcion:'Mejorar resoluci√≥n conflictos',trimestre:2,indicadores:['Identifica problema','Propone soluciones','Negocia','Acepta compromiso']},
                {numero:11,descripcion:'Desarrollar amistad',trimestre:3,indicadores:['Inicia amistades','Comparte con amigos','Ayuda a amigos','Resuelve conflictos amigos']},
                {numero:12,descripcion:'Mejorar conducta grupo',trimestre:3,indicadores:['Sigue normas grupales','Participa activamente','Respeta opiniones','Contribuye clima positivo']},
                {numero:13,descripcion:'Desarrollar responsabilidad',trimestre:3,indicadores:['Asume consecuencias','Cumple compromisos','Cuida materiales','Ayuda sin pedir']},
                {numero:14,descripcion:'Ampliar regulaci√≥n conductual',trimestre:3,indicadores:['Controla impulsos','Piensa antes actuar','Sigue normas solo','Se autorregula']},
                {numero:15,descripcion:'Generalizar competencias',trimestre:3,indicadores:['Aplica en contextos','Mejora en casa','Relaciones positivas','Gestiona emociones']}
            ]},
            {nombre:'Desarrollo Comunicativo',ciclo:'infantil',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Desarrollar intenci√≥n comunicativa',trimestre:1,indicadores:['Usa gestos comunicar','Se√±ala para pedir','Muestra objetos','Busca atenci√≥n adulto']},
                {numero:2,descripcion:'Ampliar comprensi√≥n verbal',trimestre:1,indicadores:['Comprende palabras familiares','Sigue √≥rdenes simples','Identifica objetos','Responde s√≠/no']},
                {numero:3,descripcion:'Mejorar expresi√≥n oral',trimestre:1,indicadores:['Emite vocalizaciones','Produce primeras palabras','Nombra objetos','Pide mediante palabra']},
                {numero:4,descripcion:'Desarrollar vocabulario',trimestre:1,indicadores:['Comprende 50+ palabras','Produce 10+ palabras','Aprende nuevas','Usa nombres cercanos']},
                {numero:5,descripcion:'Mejorar articulaci√≥n',trimestre:1,indicadores:['Produce vocales','Articula consonantes iniciales','Produce s√≠labas directas','Inteligible cercanos']},
                {numero:6,descripcion:'Ampliar estructura frases',trimestre:2,indicadores:['Combina dos palabras','Usa frase 3 elementos','Usa art√≠culos','Incorpora verbos']},
                {numero:7,descripcion:'Desarrollar comprensi√≥n oraciones',trimestre:2,indicadores:['Comprende √≥rdenes 2 pasos','Entiende qu√©/qui√©n','Sigue instrucciones','Comprende negaciones']},
                {numero:8,descripcion:'Mejorar pragm√°tica',trimestre:2,indicadores:['Saluda apropiadamente','Responde a saludos','Participa intercambios','Mantiene tema breve']},
                {numero:9,descripcion:'Desarrollar narraci√≥n',trimestre:2,indicadores:['Cuenta experiencias','Secuencia 2 eventos','Describe im√°genes','Responde sobre cuentos']},
                {numero:10,descripcion:'Ampliar comprensi√≥n cuentos',trimestre:2,indicadores:['Atiende cuentos cortos','Identifica personajes','Responde preguntas','Anticipa eventos']},
                {numero:11,descripcion:'Mejorar conciencia fonol√≥gica',trimestre:3,indicadores:['Identifica rimas','Reconoce sonido inicial','Segmenta s√≠labas','Discrimina sonidos']},
                {numero:12,descripcion:'Desarrollar lenguaje descriptivo',trimestre:3,indicadores:['Usa adjetivos b√°sicos','Describe objetos','Compara tama√±o/color','Describe acciones']},
                {numero:13,descripcion:'Ampliar uso preguntas',trimestre:3,indicadores:['Hace preguntas qu√©','Pregunta d√≥nde','Usa por qu√©','Responde abiertas']},
                {numero:14,descripcion:'Mejorar discurso',trimestre:3,indicadores:['Narra inicio-fin','Usa conectores b√°sicos','Mantiene coherencia','Adapta interlocutor']},
                {numero:15,descripcion:'Preparar lectoescritura',trimestre:3,indicadores:['Reconoce nombre escrito','Identifica letras','Garabatea intenci√≥n','Diferencia dibujo-escritura']}
            ]},
            {nombre:'Desarrollo Comunicativo',ciclo:'ciclo1',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Mejorar conciencia fonol√≥gica',trimestre:1,indicadores:['Segmenta en s√≠labas','Identifica s√≠laba inicial','Reconoce rimas','Manipula fonemas']},
                {numero:2,descripcion:'Desarrollar decodificaci√≥n',trimestre:1,indicadores:['Lee s√≠labas directas','Lee palabras 2 s√≠labas','Automatiza frecuentes','Lee menos silabeo']},
                {numero:3,descripcion:'Mejorar fluidez lectora',trimestre:1,indicadores:['Lee frases cortas','Respeta puntuaci√≥n','Aumenta velocidad','Lee sin regresiones']},
                {numero:4,descripcion:'Desarrollar comprensi√≥n lectora',trimestre:1,indicadores:['Comprende frases','Responde literales','Identifica personajes','Secuencia eventos']},
                {numero:5,descripcion:'Mejorar expresi√≥n escrita',trimestre:1,indicadores:['Copia correcci√≥n','Escribe dictado','Separa palabras','Usa may√∫scula inicial']},
                {numero:6,descripcion:'Ampliar vocabulario',trimestre:2,indicadores:['Vocabulario de √°rea','Define palabras','Usa sin√≥nimos','Comprende en contexto']},
                {numero:7,descripcion:'Mejorar expresi√≥n oral',trimestre:2,indicadores:['Narra con orden','Describe objetos','Explica procedimientos','Argumenta preferencias']},
                {numero:8,descripcion:'Desarrollar lectura comprensiva',trimestre:2,indicadores:['Comprende textos','Realiza inferencias','Identifica idea principal','Relaciona previo']},
                {numero:9,descripcion:'Mejorar escritura creativa',trimestre:2,indicadores:['Escribe frases propias','Completa textos','Redacta breves','Vocabulario variado']},
                {numero:10,descripcion:'Desarrollar ortograf√≠a',trimestre:2,indicadores:['Aplica reglas','Usa may√∫sculas','Escribe sin omisiones','Corrige errores']},
                {numero:11,descripcion:'Ampliar comprensi√≥n oral',trimestre:3,indicadores:['Comprende explicaciones','Sigue instrucciones complejas','Entiende textos orales','Capta impl√≠cita']},
                {numero:12,descripcion:'Mejorar habilidades discursivas',trimestre:3,indicadores:['Organiza discurso','Mantiene coherencia','Usa conectores','Adapta registro']},
                {numero:13,descripcion:'Desarrollar lectura expresiva',trimestre:3,indicadores:['Lee con entonaci√≥n','Respeta pausas','Lee expresivamente','Lee para otros']},
                {numero:14,descripcion:'Ampliar producci√≥n escrita',trimestre:3,indicadores:['Escribe 5+ oraciones','Planifica textos','Revisa escrito','Presenta legibles']},
                {numero:15,descripcion:'Consolidar comunicativa',trimestre:3,indicadores:['Comunica eficazmente','Lee comprensi√≥n funcional','Escribe para comunicar','Disfruta leer/escribir']}
            ]},
            {nombre:'Autonom√≠a Personal',ciclo:'infantil',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Desarrollar autonom√≠a alimentaci√≥n',trimestre:1,indicadores:['Come con cuchara','Bebe de vaso','Permanece sentado','Muestra preferencias']},
                {numero:2,descripcion:'Mejorar control esf√≠nteres',trimestre:1,indicadores:['Avisa necesidad','Usa WC con ayuda','Permanece seco','Colabora limpieza']},
                {numero:3,descripcion:'Desarrollar autonom√≠a vestido',trimestre:1,indicadores:['Colabora vestirse','Se quita prendas','Identifica partes ropa','Se√±ala su ropa']},
                {numero:4,descripcion:'Mejorar higiene personal',trimestre:1,indicadores:['Acepta lavado manos','Colabora lavado cara','Se limpia nariz','Acepta peinarse']},
                {numero:5,descripcion:'Desarrollar organizaci√≥n',trimestre:1,indicadores:['Guarda juguetes','Reconoce pertenencias','Sigue rutina','Acepta transiciones']},
                {numero:6,descripcion:'Ampliar autonom√≠a alimentaci√≥n',trimestre:2,indicadores:['Usa tenedor','Se sirve con ayuda','Limpia derramado','Come variedad']},
                {numero:7,descripcion:'Consolidar control esf√≠nteres',trimestre:2,indicadores:['Va WC solo','Se limpia supervisi√≥n','Permanece seco d√≠a','Avisa anticipaci√≥n']},
                {numero:8,descripcion:'Mejorar autonom√≠a vestido',trimestre:2,indicadores:['Se pone ropa sencilla','Se quita zapatos','Intenta abrochar','Elige entre opciones']},
                {numero:9,descripcion:'Ampliar higiene personal',trimestre:2,indicadores:['Se lava manos solo','Se lava cara','Cepilla dientes','Usa jab√≥n']},
                {numero:10,descripcion:'Desarrollar seguridad',trimestre:2,indicadores:['Conoce normas seguridad','Identifica peligros','Pide ayuda','Se orienta espacios']},
                {numero:11,descripcion:'Consolidar alimentaci√≥n',trimestre:3,indicadores:['Come aut√≥nomamente','Usa servilleta','Pone/quita mesa','Prueba nuevos']},
                {numero:12,descripcion:'Ampliar autonom√≠a vestido',trimestre:3,indicadores:['Se viste completamente','Abrocha velcro/botones','Calza zapatos','Cuelga abrigo']},
                {numero:13,descripcion:'Consolidar higiene',trimestre:3,indicadores:['Rutina aut√≥noma','Reconoce cu√°ndo lavarse','Tira cisterna','Usa WC p√∫blico']},
                {numero:14,descripcion:'Desarrollar autonom√≠a tareas',trimestre:3,indicadores:['Prepara material','Recoge tras actividad','Sigue rutina clase','Realiza encargos']},
                {numero:15,descripcion:'Generalizar autonom√≠a',trimestre:3,indicadores:['Aut√≥nomo rutinas','Transfiere a casa','Pide ayuda apropiada','Muestra iniciativa']}
            ]},
            {nombre:'Autonom√≠a Personal',ciclo:'ciclo1',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Consolidar h√°bitos higiene',trimestre:1,indicadores:['Aseo aut√≥nomo','Cuida aspecto','Usa WC correctamente','Lava manos solo']},
                {numero:2,descripcion:'Mejorar autonom√≠a alimentaci√≥n',trimestre:1,indicadores:['Come cualquier alimento','Usa cubiertos','Se sirve cantidad','Mastica correctamente']},
                {numero:3,descripcion:'Desarrollar autonom√≠a vestido',trimestre:1,indicadores:['Se viste solo','Ata cordones','Abrocha cierres','Elige ropa apropiada']},
                {numero:4,descripcion:'Mejorar organizaci√≥n materiales',trimestre:1,indicadores:['Prepara mochila','Cuida material','Organiza mesa','Encuentra lo necesario']},
                {numero:5,descripcion:'Desarrollar gesti√≥n tiempo',trimestre:1,indicadores:['Sigue horario','Distingue momentos d√≠a','Calcula tiempo','Llega puntual']},
                {numero:6,descripcion:'Ampliar responsabilidad',trimestre:2,indicadores:['Cuida pertenencias','Cumple encargos','Recuerda tareas','Asume consecuencias']},
                {numero:7,descripcion:'Mejorar autonom√≠a acad√©mica',trimestre:2,indicadores:['Inicia tareas solo','Busca informaci√≥n','Pide ayuda apropiada','Trabaja solo']},
                {numero:8,descripcion:'Desarrollar seguridad personal',trimestre:2,indicadores:['Conoce normas','Act√∫a con prudencia','Se orienta entorno','Identifica riesgos']},
                {numero:9,descripcion:'Mejorar autocuidado',trimestre:2,indicadores:['Reconoce malestar','Comunica necesidades','Cuida heridas','Conoce h√°bitos']},
                {numero:10,descripcion:'Desarrollar autonom√≠a hogar',trimestre:2,indicadores:['Colabora tareas','Recoge habitaci√≥n','Pone/quita mesa','Cuida espacios']},
                {numero:11,descripcion:'Ampliar desplazamientos',trimestre:3,indicadores:['Se desplaza colegio','Conoce espacios','Llega solo cercanos','Se orienta planos']},
                {numero:12,descripcion:'Mejorar gesti√≥n pertenencias',trimestre:3,indicadores:['Cuida cosas','Presta/pide prestado','Administra cantidades','Valora lo que tiene']},
                {numero:13,descripcion:'Desarrollar resoluci√≥n problemas',trimestre:3,indicadores:['Resuelve peque√±os solo','Busca alternativas','Toma decisiones','Pide ayuda necesaria']},
                {numero:14,descripcion:'Ampliar h√°bitos saludables',trimestre:3,indicadores:['Dieta equilibrada','Actividad f√≠sica','Duerme horas','Evita perjudiciales']},
                {numero:15,descripcion:'Generalizar autonom√≠a',trimestre:3,indicadores:['Aut√≥nomo rutinas','Act√∫a responsable','Muestra iniciativa','Generaliza habilidades']}
            ]},
            {nombre:'Desarrollo Motor',ciclo:'infantil',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Desarrollar prensi√≥n',trimestre:1,indicadores:['Agarra objetos gruesos','Usa pinza digital','Manipula plastilina','Ensarta cuentas grandes']},
                {numero:2,descripcion:'Mejorar coordinaci√≥n √≥culo-manual',trimestre:1,indicadores:['Apila 4-5 bloques','Encaja piezas','Abre/cierra tapones','Vierte con ayuda']},
                {numero:3,descripcion:'Desarrollar grafomotricidad',trimestre:1,indicadores:['Garabatea con agarre','Traza l√≠neas verticales','Imita trazos','Colorea sin l√≠mites']},
                {numero:4,descripcion:'Mejorar destreza manual',trimestre:1,indicadores:['Abre recipientes','Pasa p√°ginas','Usa pegamento','Rasga papel']},
                {numero:5,descripcion:'Desarrollar lateralidad',trimestre:1,indicadores:['Preferencia mano','Usa dominante','Cruza l√≠nea media','Identifica manos']},
                {numero:6,descripcion:'Ampliar precisi√≥n manual',trimestre:2,indicadores:['Recorta con tijeras','Pica con punz√≥n','Moldea formas','Dobla papel']},
                {numero:7,descripcion:'Mejorar grafomotricidad',trimestre:2,indicadores:['Traza horizontales','Dibuja c√≠rculos','Copia formas','Colorea contorno']},
                {numero:8,descripcion:'Desarrollar coordinaci√≥n bimanual',trimestre:2,indicadores:['Usa manos coordinadas','Enrosca/desenrosca','Abre cremalleras','Abotona grandes']},
                {numero:9,descripcion:'Mejorar manejo utensilios',trimestre:2,indicadores:['Usa tijeras bien','Maneja pincel','Agarre correcto l√°piz','Usa goma']},
                {numero:10,descripcion:'Ampliar destrezas finas',trimestre:2,indicadores:['Ensarta peque√±as','Construye piezas peque√±as','Manipula peque√±os','Pliega papel']},
                {numero:11,descripcion:'Consolidar grafomotricidad',trimestre:3,indicadores:['Dibuja figura humana','Copia letras','Escribe nombre','Controla presi√≥n']},
                {numero:12,descripcion:'Mejorar precisi√≥n',trimestre:3,indicadores:['Recorta l√≠neas','Pega precisi√≥n','Colorea sin salir','Dibuja detalles']},
                {numero:13,descripcion:'Desarrollar autonom√≠a manipulativa',trimestre:3,indicadores:['Manualidades guiadas','Completa tareas solo','Organiza materiales','Cuida herramientas']},
                {numero:14,descripcion:'Ampliar destreza juegos',trimestre:3,indicadores:['Construye bloques peque√±os','Puzzles 12+ piezas','Juegos construcciones','Manipula mesa']},
                {numero:15,descripcion:'Preparar para escritura',trimestre:3,indicadores:['Postura correcta','Agarre maduro','Traza con fluidez','Controla espacio']}
            ]},
            {nombre:'Desarrollo Motor',ciclo:'ciclo1',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Consolidar agarre l√°piz',trimestre:1,indicadores:['Agarre tr√≠pode correcto','Presi√≥n adecuada','Postura correcta','Fluidez en trazo']},
                {numero:2,descripcion:'Mejorar trazo grafomotor',trimestre:1,indicadores:['Escribe en rengl√≥n','Respeta m√°rgenes','Tama√±o uniforme','Direccionalidad correcta']},
                {numero:3,descripcion:'Desarrollar precisi√≥n recorte',trimestre:1,indicadores:['Recorta l√≠neas curvas','Recorta figuras','Recorta con precisi√≥n','Usa tijeras dominante']},
                {numero:4,descripcion:'Ampliar destrezas manipulativas',trimestre:1,indicadores:['Ensarta agujas','Hace nudos','Trenza','Usa herramientas finas']},
                {numero:5,descripcion:'Mejorar coordinaci√≥n bimanual',trimestre:1,indicadores:['Tareas ambas manos','Usa mano auxiliar','Coordina movimientos','Actividades bimanuales']},
                {numero:6,descripcion:'Desarrollar velocidad escritura',trimestre:2,indicadores:['Escribe m√°s r√°pido','Mantiene calidad','Copia con fluidez','Dictado a ritmo']},
                {numero:7,descripcion:'Mejorar organizaci√≥n espacial papel',trimestre:2,indicadores:['Distribuye espacio','Usa cuadr√≠cula','Respeta formatos','Presenta ordenado']},
                {numero:8,descripcion:'Ampliar manualidades',trimestre:2,indicadores:['Origami sencillo','Manualidades complejas','Usa materiales variados','Sigue instrucciones']},
                {numero:9,descripcion:'Desarrollar dibujo representativo',trimestre:2,indicadores:['Dibuja con detalle','Proporci√≥n figuras','Usa colores apropiados','Representa escenas']},
                {numero:10,descripcion:'Mejorar uso tecnolog√≠a',trimestre:2,indicadores:['Usa rat√≥n precisi√≥n','Teclea palabras','Usa tablet','Coordina ojo-mano pantalla']},
                {numero:11,descripcion:'Consolidar escritura',trimestre:3,indicadores:['Escribe legible','Velocidad adecuada','Automatiza letras','Cansancio m√≠nimo']},
                {numero:12,descripcion:'Ampliar expresi√≥n pl√°stica',trimestre:3,indicadores:['T√©cnicas variadas','Creatividad manual','Trabajos elaborados','Presenta con cuidado']},
                {numero:13,descripcion:'Desarrollar coordinaci√≥n fina deportes',trimestre:3,indicadores:['Lanza con punter√≠a','Bota con control','Maneja implementos','Coordinaci√≥n raqueta']},
                {numero:14,descripcion:'Mejorar autonom√≠a tareas manuales',trimestre:3,indicadores:['Prepara materiales','Ejecuta sin ayuda','Limpia y recoge','Cuida herramientas']},
                {numero:15,descripcion:'Generalizar destrezas',trimestre:3,indicadores:['Aplica en contextos','Transfiere habilidades','Muestra destreza','Autonom√≠a motora']}
            ]},
            {nombre:'Desarrollo Psicomotor',ciclo:'infantil',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Desarrollar control postural',trimestre:1,indicadores:['Equilibrio de pie','Se sienta correcto','Cambia posici√≥n','Mantiene postura']},
                {numero:2,descripcion:'Mejorar desplazamientos',trimestre:1,indicadores:['Camina seguro','Corre sin caer','Sube escaleras','Baja con apoyo']},
                {numero:3,descripcion:'Desarrollar coordinaci√≥n global',trimestre:1,indicadores:['Salta dos pies','Lanza pelota','Atrapa grande','Patea bal√≥n']},
                {numero:4,descripcion:'Mejorar esquema corporal',trimestre:1,indicadores:['Se√±ala partes cuerpo','Nombra principales','Dibuja figura b√°sica','Imita posiciones']},
                {numero:5,descripcion:'Desarrollar equilibrio est√°tico',trimestre:1,indicadores:['Pata coja','De puntillas','Posturas estatua','Equilibrio un pie']},
                {numero:6,descripcion:'Ampliar desplazamientos',trimestre:2,indicadores:['Salta obst√°culos','Corre cambiando','Galopa','Desplaza atr√°s']},
                {numero:7,descripcion:'Mejorar coordinaci√≥n din√°mica',trimestre:2,indicadores:['Intenta saltar cuerda','Bota pelota','Camina l√≠nea','Sigue circuitos']},
                {numero:8,descripcion:'Desarrollar lateralidad corporal',trimestre:2,indicadores:['Diferencia derecha-izquierda','Usa lado dominante','Cruza l√≠nea media','Movimientos bilaterales']},
                {numero:9,descripcion:'Mejorar ritmo movimiento',trimestre:2,indicadores:['Sigue ritmos cuerpo','Baila con m√∫sica','Reproduce secuencias','Coordina con sonido']},
                {numero:10,descripcion:'Desarrollar conciencia espacial',trimestre:2,indicadores:['Arriba/abajo/dentro','Sigue direcciones','Calcula distancias','Se orienta']},
                {numero:11,descripcion:'Consolidar equilibrio din√°mico',trimestre:3,indicadores:['Camina barra baja','Salta alternando','Equilibrio movimiento','Supera circuitos']},
                {numero:12,descripcion:'Ampliar habilidades motrices',trimestre:3,indicadores:['Trepa','Se cuelga','Voltereta con ayuda','Usa aparatos parque']},
                {numero:13,descripcion:'Mejorar coordinaci√≥n objetos',trimestre:3,indicadores:['Bota y camina','Lanza con direcci√≥n','Atrapa peque√±as','Maneja implementos']},
                {numero:14,descripcion:'Desarrollar expresi√≥n corporal',trimestre:3,indicadores:['Representa cuerpo','Imita animales','Expresa emociones','Participa dramatizaciones']},
                {numero:15,descripcion:'Preparar deportes',trimestre:3,indicadores:['Juegos grupales motrices','Sigue reglas','Deportividad b√°sica','Disfruta actividad']}
            ]},
            // COGNITIVO 2¬∫ CICLO - Con matem√°ticas nivel 2¬∫ Primaria
            {nombre:'Desarrollo Cognitivo',ciclo:'ciclo2',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Mejorar atenci√≥n sostenida y concentraci√≥n',trimestre:1,indicadores:['Mantiene atenci√≥n 15-20 min','Finaliza tareas sin supervisi√≥n continua','Ignora distractores ambientales','Retoma tarea tras interrupci√≥n']},
                {numero:2,descripcion:'Desarrollar memoria de trabajo',trimestre:1,indicadores:['Retiene 4-5 instrucciones seguidas','Opera con n√∫meros mentalmente','Recuerda informaci√≥n mientras resuelve','Mantiene el hilo en tareas largas']},
                {numero:3,descripcion:'Consolidar numeraci√≥n hasta 999',trimestre:1,indicadores:['Lee y escribe n√∫meros hasta 999','Identifica valor posicional (C-D-U)','Ordena n√∫meros de mayor a menor','Compara usando > < =']},
                {numero:4,descripcion:'Dominar suma con llevadas',trimestre:1,indicadores:['Realiza sumas de 2 cifras con llevada','Coloca correctamente en vertical','Resuelve sumas de 3 sumandos','Automatiza combinaciones b√°sicas']},
                {numero:5,descripcion:'Dominar resta con llevadas',trimestre:1,indicadores:['Realiza restas de 2 cifras con llevada','Comprende el concepto de "prestar"','Verifica resultado con suma','Resuelve restas en horizontal y vertical']},
                {numero:6,descripcion:'Iniciar multiplicaci√≥n',trimestre:2,indicadores:['Comprende multiplicar como suma repetida','Memoriza tablas del 2, 5 y 10','Resuelve multiplicaciones de 1 cifra','Aplica propiedad conmutativa']},
                {numero:7,descripcion:'Resolver problemas de una operaci√≥n',trimestre:2,indicadores:['Identifica datos del problema','Elige operaci√≥n correcta (+ o -)','Escribe la operaci√≥n y resuelve','Comprueba si el resultado tiene sentido']},
                {numero:8,descripcion:'Manejar monedas y billetes',trimestre:2,indicadores:['Reconoce monedas de 1, 2, 5, 10, 20, 50 cts y 1, 2‚Ç¨','Cuenta cantidades con monedas','Calcula vueltas sencillas','Forma cantidades de diferentes modos']},
                {numero:9,descripcion:'Comprender medidas de longitud',trimestre:2,indicadores:['Usa regla para medir en cm','Estima longitudes cotidianas','Conoce metro y cent√≠metro','Resuelve problemas sencillos de medida']},
                {numero:10,descripcion:'Desarrollar razonamiento l√≥gico',trimestre:2,indicadores:['Completa series num√©ricas','Identifica patrones','Clasifica por varios criterios','Resuelve acertijos sencillos']},
                {numero:11,descripcion:'Ampliar tablas de multiplicar',trimestre:3,indicadores:['Memoriza tablas del 3 y 4','Aplica tablas en problemas','Relaciona multiplicaci√≥n con repartos','Calcula dobles y triples']},
                {numero:12,descripcion:'Comprender fracciones b√°sicas',trimestre:3,indicadores:['Identifica mitad y cuarto','Parte figuras en partes iguales','Asocia fracci√≥n con representaci√≥n','Resuelve problemas de mitades']},
                {numero:13,descripcion:'Interpretar datos sencillos',trimestre:3,indicadores:['Lee pictogramas','Interpreta gr√°ficos de barras','Recoge datos en tabla','Responde preguntas sobre gr√°ficos']},
                {numero:14,descripcion:'Reconocer formas geom√©tricas',trimestre:3,indicadores:['Identifica tri√°ngulo, cuadrado, rect√°ngulo, c√≠rculo','Reconoce formas en el entorno','Dibuja formas con regla','Conoce lados y v√©rtices']},
                {numero:15,descripcion:'Generalizar aprendizajes matem√°ticos',trimestre:3,indicadores:['Aplica c√°lculo en situaciones reales','Usa matem√°ticas en otras √°reas','Resuelve problemas cotidianos','Muestra confianza con n√∫meros']}
            ]},
            // COGNITIVO 3¬∫ CICLO - Con matem√°ticas nivel 3¬∫-4¬∫ Primaria
            {nombre:'Desarrollo Cognitivo',ciclo:'ciclo3',tipo:'cognitivo',objetivos:[
                {numero:1,descripcion:'Consolidar atenci√≥n ejecutiva',trimestre:1,indicadores:['Mantiene atenci√≥n 25-30 min','Alterna entre tareas eficientemente','Filtra informaci√≥n relevante','Planifica antes de actuar']},
                {numero:2,descripcion:'Desarrollar metacognici√≥n',trimestre:1,indicadores:['Identifica qu√© sabe y qu√© no','Elige estrategias de estudio','Eval√∫a su propio trabajo','Pide ayuda espec√≠fica cuando necesita']},
                {numero:3,descripcion:'Dominar numeraci√≥n hasta 99.999',trimestre:1,indicadores:['Lee y escribe n√∫meros hasta 99.999','Descompone en U, D, C, UM, DM','Redondea a decenas y centenas','Ordena series num√©ricas']},
                {numero:4,descripcion:'Consolidar multiplicaci√≥n',trimestre:1,indicadores:['Domina todas las tablas','Multiplica por 2 cifras','Resuelve con ceros intermedios','Aplica propiedades de multiplicaci√≥n']},
                {numero:5,descripcion:'Dominar divisi√≥n',trimestre:1,indicadores:['Divide entre 1 cifra','Comprende resto y cociente','Verifica con multiplicaci√≥n','Resuelve divisiones exactas e inexactas']},
                {numero:6,descripcion:'Resolver problemas de dos operaciones',trimestre:2,indicadores:['Identifica pasos del problema','Elige operaciones necesarias','Organiza datos correctamente','Verifica la soluci√≥n']},
                {numero:7,descripcion:'Operar con fracciones sencillas',trimestre:2,indicadores:['Lee y escribe fracciones','Representa fracciones gr√°ficamente','Compara fracciones mismo denominador','Calcula fracci√≥n de un n√∫mero']},
                {numero:8,descripcion:'Manejar unidades de medida',trimestre:2,indicadores:['Conoce km, m, cm, mm','Conoce kg, g y litro, ml','Realiza conversiones sencillas','Resuelve problemas de medida']},
                {numero:9,descripcion:'Comprender el tiempo',trimestre:2,indicadores:['Lee reloj anal√≥gico y digital','Calcula duraciones','Conoce equivalencias h-min-seg','Interpreta calendarios']},
                {numero:10,descripcion:'Desarrollar c√°lculo mental',trimestre:2,indicadores:['Suma y resta decenas mentalmente','Multiplica por 10, 100','Estima resultados','Usa estrategias de c√°lculo']},
                {numero:11,descripcion:'Calcular per√≠metro y √°rea',trimestre:3,indicadores:['Mide per√≠metro de figuras','Calcula √°rea de rect√°ngulo','Diferencia per√≠metro de √°rea','Resuelve problemas geom√©tricos']},
                {numero:12,descripcion:'Interpretar y crear gr√°ficos',trimestre:3,indicadores:['Lee gr√°ficos de barras y l√≠neas','Recoge datos y organiza en tabla','Construye gr√°ficos sencillos','Analiza informaci√≥n estad√≠stica']},
                {numero:13,descripcion:'Desarrollar razonamiento abstracto',trimestre:3,indicadores:['Resuelve problemas de l√≥gica','Completa series complejas','Encuentra reglas y patrones','Aplica razonamiento deductivo']},
                {numero:14,descripcion:'Preparar transici√≥n a ESO',trimestre:3,indicadores:['Organiza trabajo aut√≥nomamente','Usa agenda y planificaci√≥n','Gestiona materiales de varias √°reas','Trabaja con autonom√≠a creciente']},
                {numero:15,descripcion:'Generalizar competencia matem√°tica',trimestre:3,indicadores:['Aplica matem√°ticas a vida real','Resuelve problemas contextualizados','Muestra actitud positiva','Transfiere a otras √°reas']}
            ]},
            // SOCIAL-EMOCIONAL 2¬∫ CICLO
            {nombre:'Desarrollo Social y Emocional',ciclo:'ciclo2',tipo:'social',objetivos:[
                {numero:1,descripcion:'Ampliar vocabulario emocional',trimestre:1,indicadores:['Nombra emociones complejas (verg√ºenza, orgullo, celos)','Describe matices emocionales','Diferencia emociones similares','Expresa emociones verbalmente']},
                {numero:2,descripcion:'Desarrollar autoconciencia emocional',trimestre:1,indicadores:['Identifica desencadenantes emocionales','Reconoce se√±ales corporales','Anticipa reacciones propias','Reflexiona sobre su conducta']},
                {numero:3,descripcion:'Mejorar autorregulaci√≥n',trimestre:1,indicadores:['Aplica t√©cnicas de relajaci√≥n','Usa tiempo fuera voluntariamente','Controla impulsos en situaciones dif√≠ciles','Gestiona frustraci√≥n sin explosiones']},
                {numero:4,descripcion:'Desarrollar tolerancia a la frustraci√≥n',trimestre:1,indicadores:['Acepta errores como aprendizaje','Persiste ante dificultades','Maneja el fracaso constructivamente','Pide ayuda sin abandonar']},
                {numero:5,descripcion:'Fortalecer autoestima',trimestre:1,indicadores:['Reconoce fortalezas y debilidades','Acepta cr√≠ticas constructivas','Valora sus logros sin compararse','Habla de s√≠ mismo con respeto']},
                {numero:6,descripcion:'Mejorar habilidades conversacionales',trimestre:2,indicadores:['Inicia y mantiene conversaciones','Muestra inter√©s por el otro','Respeta turnos de palabra','Adapta lenguaje al contexto']},
                {numero:7,descripcion:'Desarrollar asertividad',trimestre:2,indicadores:['Expresa opiniones con respeto','Defiende derechos sin agredir','Dice no de forma adecuada','Pide lo que necesita claramente']},
                {numero:8,descripcion:'Mejorar trabajo en equipo',trimestre:2,indicadores:['Colabora activamente en grupo','Acepta diferentes roles','Aporta ideas y escucha otras','Resuelve desacuerdos dialogando']},
                {numero:9,descripcion:'Profundizar en empat√≠a',trimestre:2,indicadores:['Toma perspectiva del otro','Comprende emociones ajenas','Adapta conducta al estado del otro','Muestra compasi√≥n genuina']},
                {numero:10,descripcion:'Mejorar resoluci√≥n de conflictos',trimestre:2,indicadores:['Identifica el problema objetivamente','Genera m√∫ltiples soluciones','Negocia y busca compromiso','Acepta mediaci√≥n cuando necesita']},
                {numero:11,descripcion:'Desarrollar habilidades de amistad',trimestre:3,indicadores:['Mantiene amistades estables','Supera conflictos con amigos','Muestra lealtad apropiada','Diferencia amigos de conocidos']},
                {numero:12,descripcion:'Manejar presi√≥n de grupo',trimestre:3,indicadores:['Reconoce presi√≥n de iguales','Mantiene criterio propio','Rechaza propuestas inadecuadas','Busca grupos positivos']},
                {numero:13,descripcion:'Desarrollar responsabilidad social',trimestre:3,indicadores:['Cumple compromisos grupales','Asume consecuencias de actos','Contribuye al bien com√∫n','Respeta normas sociales']},
                {numero:14,descripcion:'Gestionar situaciones sociales complejas',trimestre:3,indicadores:['Maneja situaciones nuevas','Se adapta a diferentes grupos','Act√∫a apropiadamente en p√∫blico','Pide ayuda en situaciones dif√≠ciles']},
                {numero:15,descripcion:'Generalizar competencias socioemocionales',trimestre:3,indicadores:['Aplica habilidades en todos los contextos','Mantiene relaciones positivas','Gestiona emociones aut√≥nomamente','Muestra madurez emocional']}
            ]},
            // SOCIAL-EMOCIONAL 3¬∫ CICLO
            {nombre:'Desarrollo Social y Emocional',ciclo:'ciclo3',tipo:'social',objetivos:[
                {numero:1,descripcion:'Desarrollar inteligencia emocional',trimestre:1,indicadores:['Analiza emociones propias en profundidad','Comprende causas y efectos emocionales','Anticipa estados emocionales','Reflexiona sobre patrones emocionales']},
                {numero:2,descripcion:'Consolidar autorregulaci√≥n emocional',trimestre:1,indicadores:['Usa m√∫ltiples estrategias de regulaci√≥n','Adapta estrategia a la situaci√≥n','Mantiene calma en situaciones estresantes','Se recupera de emociones intensas']},
                {numero:3,descripcion:'Fortalecer identidad personal',trimestre:1,indicadores:['Conoce sus valores personales','Acepta sus caracter√≠sticas','Muestra coherencia yo real-ideal','Construye autoconcepto positivo']},
                {numero:4,descripcion:'Desarrollar pensamiento cr√≠tico social',trimestre:1,indicadores:['Cuestiona estereotipos','Analiza mensajes de medios','Forma opiniones fundamentadas','Respeta diversidad de opiniones']},
                {numero:5,descripcion:'Manejar ansiedad y estr√©s',trimestre:1,indicadores:['Identifica fuentes de estr√©s','Aplica t√©cnicas de relajaci√≥n avanzadas','Organiza tiempo para reducir agobio','Pide apoyo cuando lo necesita']},
                {numero:6,descripcion:'Desarrollar comunicaci√≥n asertiva avanzada',trimestre:2,indicadores:['Comunica necesidades claramente','Expresa desacuerdo con respeto','Negocia soluciones win-win','Maneja cr√≠ticas constructivamente']},
                {numero:7,descripcion:'Profundizar habilidades de equipo',trimestre:2,indicadores:['Asume liderazgo cuando corresponde','Delega y coordina tareas','Motiva a compa√±eros','Eval√∫a trabajo grupal objetivamente']},
                {numero:8,descripcion:'Desarrollar empat√≠a cognitiva y afectiva',trimestre:2,indicadores:['Comprende perspectivas diferentes','Responde emocionalmente apropiado','Ayuda de forma efectiva','Muestra sensibilidad social']},
                {numero:9,descripcion:'Gestionar conflictos complejos',trimestre:2,indicadores:['Analiza conflictos desde m√∫ltiples perspectivas','Media en conflictos de otros','Propone soluciones creativas','Mantiene relaci√≥n tras el conflicto']},
                {numero:10,descripcion:'Resistir presi√≥n social',trimestre:2,indicadores:['Mantiene valores bajo presi√≥n','Rechaza conductas de riesgo','Busca apoyo en adultos','Elige amistades positivas']},
                {numero:11,descripcion:'Preparar cambios de la adolescencia',trimestre:3,indicadores:['Comprende cambios f√≠sicos y emocionales','Acepta transformaciones corporales','Gestiona nuevas emociones','Mantiene comunicaci√≥n con adultos']},
                {numero:12,descripcion:'Desarrollar toma de decisiones',trimestre:3,indicadores:['Eval√∫a opciones y consecuencias','Considera valores en decisiones','Asume responsabilidad de elecciones','Aprende de decisiones err√≥neas']},
                {numero:13,descripcion:'Construir proyecto personal',trimestre:3,indicadores:['Identifica intereses y metas','Planifica pasos hacia objetivos','Muestra motivaci√≥n intr√≠nseca','Visualiza futuro positivamente']},
                {numero:14,descripcion:'Preparar transici√≥n a ESO',trimestre:3,indicadores:['Maneja incertidumbre del cambio','Desarrolla autonom√≠a emocional','Construye red de apoyo','Muestra resiliencia ante retos']},
                {numero:15,descripcion:'Consolidar madurez socioemocional',trimestre:3,indicadores:['Integra habilidades aprendidas','Act√∫a con responsabilidad social','Mantiene bienestar emocional','Muestra competencia social']}
            ]},
            // COMUNICATIVO 2¬∫ CICLO
            {nombre:'Desarrollo Comunicativo',ciclo:'ciclo2',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Consolidar fluidez lectora',trimestre:1,indicadores:['Lee con velocidad adecuada (80-100 ppm)','Respeta signos de puntuaci√≥n','Lee con entonaci√≥n expresiva','Evita silabeo y regresiones']},
                {numero:2,descripcion:'Desarrollar comprensi√≥n lectora literal',trimestre:1,indicadores:['Identifica informaci√≥n expl√≠cita','Localiza datos concretos','Reconoce personajes y hechos','Secuencia eventos del texto']},
                {numero:3,descripcion:'Mejorar comprensi√≥n inferencial',trimestre:1,indicadores:['Deduce informaci√≥n impl√≠cita','Interpreta expresiones figuradas','Predice acontecimientos','Relaciona causa-efecto']},
                {numero:4,descripcion:'Ampliar vocabulario',trimestre:1,indicadores:['Incorpora vocabulario de √°reas','Deduce significado por contexto','Usa sin√≥nimos y ant√≥nimos','Consulta diccionario aut√≥nomamente']},
                {numero:5,descripcion:'Mejorar expresi√≥n escrita',trimestre:1,indicadores:['Escribe textos de 5-8 oraciones','Usa conectores b√°sicos (y, pero, porque)','Respeta estructura inicio-desarrollo-fin','Revisa y corrige textos propios']},
                {numero:6,descripcion:'Consolidar ortograf√≠a',trimestre:2,indicadores:['Aplica reglas de b/v, g/j, h','Usa may√∫sculas correctamente','Escribe sin omisiones ni sustituciones','Acent√∫a palabras frecuentes']},
                {numero:7,descripcion:'Desarrollar expresi√≥n oral estructurada',trimestre:2,indicadores:['Expone temas con orden','Usa apoyo visual en exposiciones','Responde preguntas sobre lo expuesto','Adapta registro al contexto']},
                {numero:8,descripcion:'Mejorar comprensi√≥n oral',trimestre:2,indicadores:['Comprende explicaciones extensas','Sigue instrucciones de 4-5 pasos','Extrae ideas principales de audio','Toma notas sencillas']},
                {numero:9,descripcion:'Producir textos narrativos',trimestre:2,indicadores:['Escribe relatos con estructura','Describe personajes y escenarios','Incluye di√°logos','Crea finales coherentes']},
                {numero:10,descripcion:'Producir textos descriptivos',trimestre:2,indicadores:['Describe personas ordenadamente','Describe lugares con detalle','Usa adjetivos variados','Organiza descripci√≥n l√≥gicamente']},
                {numero:11,descripcion:'Desarrollar lectura comprensiva de problemas',trimestre:3,indicadores:['Identifica datos en enunciados','Comprende qu√© se pregunta','Subraya informaci√≥n relevante','Relee para verificar comprensi√≥n']},
                {numero:12,descripcion:'Mejorar producci√≥n de textos funcionales',trimestre:3,indicadores:['Escribe cartas y emails','Redacta instrucciones claras','Completa formularios','Toma notas organizadas']},
                {numero:13,descripcion:'Desarrollar habilidades argumentativas b√°sicas',trimestre:3,indicadores:['Expresa opini√≥n con razones','Defiende punto de vista','Escucha argumentos contrarios','Distingue hecho de opini√≥n']},
                {numero:14,descripcion:'Fomentar gusto por la lectura',trimestre:3,indicadores:['Lee por placer regularmente','Elige libros seg√∫n intereses','Comenta lecturas realizadas','Recomienda libros a otros']},
                {numero:15,descripcion:'Generalizar competencia comunicativa',trimestre:3,indicadores:['Comunica eficazmente oral y escrito','Lee con comprensi√≥n funcional','Adapta comunicaci√≥n al contexto','Disfruta expres√°ndose']}
            ]},
            // COMUNICATIVO 3¬∫ CICLO
            {nombre:'Desarrollo Comunicativo',ciclo:'ciclo3',tipo:'comunicativo',objetivos:[
                {numero:1,descripcion:'Consolidar fluidez y expresividad lectora',trimestre:1,indicadores:['Lee con velocidad adecuada (100-120 ppm)','Modula voz seg√∫n contenido','Lee en voz alta para otros','Transmite emociones del texto']},
                {numero:2,descripcion:'Profundizar comprensi√≥n lectora',trimestre:1,indicadores:['Identifica ideas principales y secundarias','Realiza inferencias complejas','Interpreta intenciones del autor','Relaciona con conocimientos previos']},
                {numero:3,descripcion:'Desarrollar lectura cr√≠tica',trimestre:1,indicadores:['Distingue hechos de opiniones','Eval√∫a fiabilidad de fuentes','Detecta intenciones persuasivas','Compara diferentes textos']},
                {numero:4,descripcion:'Ampliar competencia l√©xica',trimestre:1,indicadores:['Usa vocabulario t√©cnico de √°reas','Comprende palabras polis√©micas','Emplea lenguaje figurado','Incorpora vocabulario nuevo activamente']},
                {numero:5,descripcion:'Mejorar expresi√≥n escrita compleja',trimestre:1,indicadores:['Escribe textos de 10-15 oraciones','Usa conectores variados','Estructura p√°rrafos coherentes','Revisa contenido y forma']},
                {numero:6,descripcion:'Dominar ortograf√≠a',trimestre:2,indicadores:['Aplica reglas de acentuaci√≥n','Escribe sin errores frecuentes','Usa puntuaci√≥n correctamente','Autocorrige errores ortogr√°ficos']},
                {numero:7,descripcion:'Desarrollar expresi√≥n oral formal',trimestre:2,indicadores:['Realiza exposiciones estructuradas','Usa recursos expresivos','Gestiona tiempo de intervenci√≥n','Responde preguntas con soltura']},
                {numero:8,descripcion:'Mejorar comprensi√≥n oral compleja',trimestre:2,indicadores:['Comprende textos orales extensos','Identifica estructura del discurso','Toma apuntes organizados','Distingue informaci√≥n relevante']},
                {numero:9,descripcion:'Producir textos argumentativos',trimestre:2,indicadores:['Estructura opini√≥n con argumentos','Anticipa contraargumentos','Usa ejemplos y datos','Concluye coherentemente']},
                {numero:10,descripcion:'Producir textos expositivos',trimestre:2,indicadores:['Organiza informaci√≥n l√≥gicamente','Usa t√≠tulos y subt√≠tulos','Incluye ejemplos y definiciones','Cita fuentes sencillas']},
                {numero:11,descripcion:'Desarrollar t√©cnicas de estudio',trimestre:3,indicadores:['Subraya ideas principales','Hace esquemas y res√∫menes','Usa mapas conceptuales','Estudia de forma aut√≥noma']},
                {numero:12,descripcion:'Mejorar comprensi√≥n de textos de estudio',trimestre:3,indicadores:['Comprende libros de texto','Extrae informaci√≥n de esquemas','Interpreta gr√°ficos y tablas','Relaciona informaci√≥n de fuentes']},
                {numero:13,descripcion:'Desarrollar comunicaci√≥n digital',trimestre:3,indicadores:['Busca informaci√≥n en internet','Eval√∫a p√°ginas web','Produce textos digitales','Comunica respetando netiqueta']},
                {numero:14,descripcion:'Preparar exigencias comunicativas de ESO',trimestre:3,indicadores:['Lee textos m√°s extensos','Toma apuntes de explicaciones','Expresa ideas con precisi√≥n','Trabaja con m√∫ltiples fuentes']},
                {numero:15,descripcion:'Consolidar competencia comunicativa',trimestre:3,indicadores:['Comunica con eficacia en cualquier contexto','Lee comprensivamente todo tipo de textos','Escribe con correcci√≥n y coherencia','Muestra gusto por la comunicaci√≥n']}
            ]},
            // MOTOR 3¬∫ CICLO
            {nombre:'Desarrollo Motor',ciclo:'ciclo3',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Consolidar escritura automatizada y eficiente',trimestre:1,indicadores:['Escribe con velocidad adecuada al nivel','Mantiene legibilidad en textos extensos','Toma apuntes sin perder informaci√≥n','Adapta letra seg√∫n contexto']},
                {numero:2,descripcion:'Desarrollar precisi√≥n en trabajos manuales',trimestre:1,indicadores:['Realiza trabajos con alta precisi√≥n','Maneja herramientas especializadas','Ejecuta tareas de detalle','Presenta trabajos de calidad']},
                {numero:3,descripcion:'Mejorar coordinaci√≥n fina en tecnolog√≠a',trimestre:1,indicadores:['Teclea con velocidad y precisi√≥n','Usa dispositivos t√°ctiles con destreza','Maneja programas de dise√±o b√°sico','Coordina acciones en pantalla']},
                {numero:4,descripcion:'Ampliar t√©cnicas art√≠sticas avanzadas',trimestre:1,indicadores:['Domina t√©cnicas pl√°sticas variadas','Combina materiales creativamente','Ejecuta proyectos art√≠sticos complejos','Muestra estilo personal']},
                {numero:5,descripcion:'Desarrollar destrezas para la vida diaria',trimestre:1,indicadores:['Realiza tareas dom√©sticas manuales','Manipula herramientas del hogar','Ejecuta peque√±as reparaciones','Muestra autonom√≠a pr√°ctica']},
                {numero:6,descripcion:'Consolidar habilidades instrumentales',trimestre:2,indicadores:['Usa instrumentos de medici√≥n','Maneja comp√°s y reglas','Ejecuta dibujo t√©cnico b√°sico','Trabaja con precisi√≥n matem√°tica']},
                {numero:7,descripcion:'Mejorar coordinaci√≥n en deportes',trimestre:2,indicadores:['Muestra destreza en deportes de raqueta','Coordina en deportes de equipo','Maneja implementos deportivos','Ejecuta t√©cnicas espec√≠ficas']},
                {numero:8,descripcion:'Desarrollar expresi√≥n pl√°stica elaborada',trimestre:2,indicadores:['Crea obras con intenci√≥n art√≠stica','Planifica proyectos visuales','Combina t√©cnicas de forma innovadora','Expresa ideas complejas visualmente']},
                {numero:9,descripcion:'Ampliar uso de tecnolog√≠a creativa',trimestre:2,indicadores:['Crea contenido digital b√°sico','Edita im√°genes y v√≠deo','Usa herramientas de dise√±o','Presenta trabajos multimedia']},
                {numero:10,descripcion:'Mejorar autonom√≠a en proyectos manuales',trimestre:2,indicadores:['Planifica proyectos completos','Ejecuta sin supervisi√≥n continua','Resuelve problemas t√©cnicos','Eval√∫a resultados cr√≠ticamente']},
                {numero:11,descripcion:'Preparar habilidades para ESO',trimestre:3,indicadores:['Toma apuntes eficientemente','Organiza informaci√≥n visual','Presenta trabajos con rigor','Gestiona materiales m√∫ltiples']},
                {numero:12,descripcion:'Consolidar destrezas deportivas',trimestre:3,indicadores:['Muestra competencia en varios deportes','Ejecuta t√©cnicas con correcci√≥n','Mejora rendimiento personal','Disfruta de la pr√°ctica deportiva']},
                {numero:13,descripcion:'Desarrollar proyectos tecnol√≥gicos',trimestre:3,indicadores:['Participa en proyectos STEM','Construye prototipos b√°sicos','Resuelve retos t√©cnicos','Muestra pensamiento maker']},
                {numero:14,descripcion:'Ampliar autonom√≠a creativa',trimestre:3,indicadores:['Desarrolla proyectos propios','Muestra iniciativa art√≠stica','Explora nuevas t√©cnicas','Comparte creaciones']},
                {numero:15,descripcion:'Generalizar competencia motora fina',trimestre:3,indicadores:['Muestra destreza manual completa','Aplica habilidades en contextos variados','Transfiere a situaciones nuevas','Autonom√≠a motora funcional']}
            ]},
            // PSICOMOTOR 3¬∫ CICLO
            {nombre:'Desarrollo Psicomotor',ciclo:'ciclo3',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Consolidar habilidades motrices b√°sicas',trimestre:1,indicadores:['Ejecuta carrera con t√©cnica eficiente','Salta con coordinaci√≥n y potencia','Lanza con precisi√≥n y fuerza','Recepciona en situaciones variadas']},
                {numero:2,descripcion:'Desarrollar condici√≥n f√≠sica',trimestre:1,indicadores:['Mejora resistencia cardiovascular','Desarrolla fuerza muscular adecuada','Mantiene flexibilidad','Aumenta velocidad de reacci√≥n']},
                {numero:3,descripcion:'Mejorar habilidades gimn√°sticas avanzadas',trimestre:1,indicadores:['Ejecuta secuencias gimn√°sticas','Realiza equilibrios complejos','Combina elementos con fluidez','Muestra control corporal']},
                {numero:4,descripcion:'Ampliar deportes individuales',trimestre:1,indicadores:['Practica atletismo b√°sico','Desarrolla nataci√≥n','Participa en deportes de raqueta','Mejora marcas personales']},
                {numero:5,descripcion:'Desarrollar deportes colectivos',trimestre:1,indicadores:['Domina t√©cnicas de f√∫tbol/baloncesto','Participa en juegos de equipo','Asume diferentes posiciones','Colabora t√°cticamente']},
                {numero:6,descripcion:'Mejorar expresi√≥n corporal elaborada',trimestre:2,indicadores:['Crea coreograf√≠as grupales','Expresa emociones complejas','Improvisa con creatividad','Comunica a trav√©s del cuerpo']},
                {numero:7,descripcion:'Consolidar orientaci√≥n espacial y temporal',trimestre:2,indicadores:['Se orienta en espacios amplios','Anticipa movimientos de otros','Coordina acciones con el tiempo','Ocupa espacios t√°cticamente']},
                {numero:8,descripcion:'Desarrollar trabajo en equipo motor',trimestre:2,indicadores:['Lidera actividades grupales','Coordina acciones con compa√±eros','Comunica durante el juego','Acepta roles diversos']},
                {numero:9,descripcion:'Ampliar conocimiento corporal',trimestre:2,indicadores:['Conoce capacidades y l√≠mites','Adapta esfuerzo a la tarea','Reconoce efectos del ejercicio','Cuida su cuerpo']},
                {numero:10,descripcion:'Mejorar fair play y deportividad',trimestre:2,indicadores:['Respeta normas y √°rbitros','Acepta victoria y derrota','Ayuda a compa√±eros','Rechaza conductas antideportivas']},
                {numero:11,descripcion:'Preparar actividad f√≠sica aut√≥noma',trimestre:3,indicadores:['Calienta correctamente','Dosifica el esfuerzo','Recupera adecuadamente','Practica con regularidad']},
                {numero:12,descripcion:'Consolidar h√°bitos saludables',trimestre:3,indicadores:['Mantiene vida activa','Equilibra ejercicio y descanso','Conoce beneficios del deporte','Rechaza sedentarismo']},
                {numero:13,descripcion:'Desarrollar competencias para ESO',trimestre:3,indicadores:['Prepara para educaci√≥n f√≠sica de ESO','Conoce deportes del curriculum','Muestra autonom√≠a en actividades','Transfiere aprendizajes']},
                {numero:14,descripcion:'Ampliar pr√°ctica deportiva extraescolar',trimestre:3,indicadores:['Participa en actividades fuera del cole','Muestra inter√©s por deporte','Busca pr√°ctica regular','Disfruta de la actividad f√≠sica']},
                {numero:15,descripcion:'Generalizar competencia motriz',trimestre:3,indicadores:['Muestra competencia motriz global','Adapta motricidad a cualquier contexto','Mantiene estilo de vida activo','Autonom√≠a motora completa']}
            ]},
            // AUTONOM√çA 3¬∫ CICLO
            {nombre:'Autonom√≠a Personal',ciclo:'ciclo3',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Consolidar autonom√≠a en rutinas diarias',trimestre:1,indicadores:['Gestiona rutinas sin supervisi√≥n','Organiza su tiempo de forma aut√≥noma','Cumple responsabilidades regularmente','Muestra iniciativa personal']},
                {numero:2,descripcion:'Desarrollar h√°bitos de estudio avanzados',trimestre:1,indicadores:['Planifica estudio semanalmente','Usa t√©cnicas de estudio eficaces','Organiza material de varias asignaturas','Prepara ex√°menes aut√≥nomamente']},
                {numero:3,descripcion:'Mejorar gesti√≥n del tiempo',trimestre:1,indicadores:['Usa agenda o planificador','Prioriza tareas','Cumple plazos establecidos','Equilibra obligaciones y ocio']},
                {numero:4,descripcion:'Ampliar responsabilidad personal',trimestre:1,indicadores:['Asume consecuencias de sus actos','Cumple compromisos adquiridos','Muestra responsabilidad con otros','Act√∫a con integridad']},
                {numero:5,descripcion:'Desarrollar autonom√≠a en desplazamientos',trimestre:1,indicadores:['Se desplaza solo por el barrio','Usa transporte p√∫blico b√°sico','Conoce normas de circulaci√≥n','Se orienta en entornos conocidos']},
                {numero:6,descripcion:'Consolidar autocuidado y salud',trimestre:2,indicadores:['Mantiene h√°bitos saludables','Reconoce se√±ales de su cuerpo','Act√∫a ante malestar b√°sico','Conoce primeros auxilios b√°sicos']},
                {numero:7,descripcion:'Mejorar gesti√≥n econ√≥mica b√°sica',trimestre:2,indicadores:['Administra paga o asignaci√≥n','Ahorra para objetivos','Distingue necesidades de deseos','Valora el dinero']},
                {numero:8,descripcion:'Desarrollar colaboraci√≥n en el hogar',trimestre:2,indicadores:['Realiza tareas dom√©sticas regulares','Colabora en organizaci√≥n familiar','Cuida espacios comunes','Ayuda sin que le pidan']},
                {numero:9,descripcion:'Ampliar seguridad personal',trimestre:2,indicadores:['Identifica situaciones de riesgo','Act√∫a con prudencia','Conoce recursos de ayuda','Protege datos personales']},
                {numero:10,descripcion:'Mejorar toma de decisiones',trimestre:2,indicadores:['Eval√∫a opciones antes de decidir','Considera consecuencias','Asume decisiones tomadas','Aprende de errores']},
                {numero:11,descripcion:'Preparar transici√≥n a ESO',trimestre:3,indicadores:['Conoce funcionamiento de ESO','Prepara cambio de centro','Gestiona incertidumbre','Muestra madurez ante cambios']},
                {numero:12,descripcion:'Consolidar uso responsable de tecnolog√≠a',trimestre:3,indicadores:['Usa internet con criterio','Gestiona tiempo de pantallas','Protege privacidad online','Identifica contenidos inadecuados']},
                {numero:13,descripcion:'Desarrollar proyecto personal',trimestre:3,indicadores:['Identifica intereses y metas','Planifica pasos hacia objetivos','Muestra motivaci√≥n','Persevera ante dificultades']},
                {numero:14,descripcion:'Ampliar competencia social aut√≥noma',trimestre:3,indicadores:['Interact√∫a apropiadamente en contextos nuevos','Pide ayuda cuando la necesita','Se relaciona con adultos correctamente','Muestra habilidades sociales maduras']},
                {numero:15,descripcion:'Generalizar autonom√≠a personal',trimestre:3,indicadores:['Act√∫a con autonom√≠a en todos los √°mbitos','Toma decisiones responsables','Muestra madurez personal','Preparado para nueva etapa']}
            ]},
            // MOTOR 2¬∫ CICLO
            {nombre:'Desarrollo Motor',ciclo:'ciclo2',tipo:'motor',objetivos:[
                {numero:1,descripcion:'Consolidar grafomotricidad funcional',trimestre:1,indicadores:['Escribe con letra legible y uniforme','Mantiene velocidad sin perder calidad','Respeta m√°rgenes y renglones','Presenta trabajos limpios y ordenados']},
                {numero:2,descripcion:'Mejorar precisi√≥n en recorte',trimestre:1,indicadores:['Recorta figuras complejas con precisi√≥n','Recorta materiales de diferentes grosores','Sigue l√≠neas curvas y √°ngulos','Usa tijeras con destreza']},
                {numero:3,descripcion:'Desarrollar destrezas manipulativas finas',trimestre:1,indicadores:['Realiza manualidades con peque√±os objetos','Ensarta cuentas peque√±as','Hace nudos y lazadas','Manipula herramientas de precisi√≥n']},
                {numero:4,descripcion:'Ampliar coordinaci√≥n bimanual',trimestre:1,indicadores:['Coordina ambas manos en tareas complejas','Usa mano auxiliar eficientemente','Realiza tareas que requieren ambas manos','Mantiene estabilidad mientras manipula']},
                {numero:5,descripcion:'Mejorar control del trazo',trimestre:1,indicadores:['Controla presi√≥n del l√°piz','Traza l√≠neas fluidas','Dibuja con detalle y proporci√≥n','Colorea respetando contornos']},
                {numero:6,descripcion:'Desarrollar velocidad de escritura',trimestre:2,indicadores:['Aumenta velocidad manteniendo legibilidad','Copia textos a ritmo adecuado','Toma dictados sin quedarse atr√°s','Escribe al ritmo de su pensamiento']},
                {numero:7,descripcion:'Mejorar organizaci√≥n espacial en papel',trimestre:2,indicadores:['Distribuye espacio en la hoja','Usa correctamente la cuadr√≠cula','Respeta formatos establecidos','Organiza informaci√≥n visualmente']},
                {numero:8,descripcion:'Ampliar t√©cnicas pl√°sticas',trimestre:2,indicadores:['Domina diferentes t√©cnicas art√≠sticas','Usa materiales variados con destreza','Combina t√©cnicas creativamente','Presenta trabajos cuidados']},
                {numero:9,descripcion:'Desarrollar dibujo representativo detallado',trimestre:2,indicadores:['Dibuja figuras con proporci√≥n','Incluye detalles en sus dibujos','Representa escenas complejas','Usa perspectiva b√°sica']},
                {numero:10,descripcion:'Mejorar uso de tecnolog√≠a',trimestre:2,indicadores:['Usa rat√≥n con precisi√≥n','Teclea con agilidad','Maneja tablet y stylus','Realiza tareas digitales con destreza']},
                {numero:11,descripcion:'Consolidar escritura automatizada',trimestre:3,indicadores:['Escribe sin pensar en el trazo','Mantiene calidad en textos largos','Muestra m√≠nimo cansancio','Escribe con fluidez']},
                {numero:12,descripcion:'Ampliar expresi√≥n pl√°stica creativa',trimestre:3,indicadores:['Crea trabajos originales','Combina t√©cnicas con creatividad','Expresa ideas a trav√©s del arte','Muestra estilo personal']},
                {numero:13,descripcion:'Desarrollar habilidades para deportes',trimestre:3,indicadores:['Maneja implementos deportivos','Coordina ojo-mano en juegos','Lanza y recepciona con precisi√≥n','Participa en actividades deportivas']},
                {numero:14,descripcion:'Mejorar autonom√≠a en tareas manuales',trimestre:3,indicadores:['Prepara materiales sin ayuda','Ejecuta proyectos completos','Limpia y organiza su espacio','Cuida herramientas y materiales']},
                {numero:15,descripcion:'Generalizar destrezas motoras finas',trimestre:3,indicadores:['Aplica habilidades en diferentes contextos','Transfiere destrezas a nuevas tareas','Muestra confianza manipulativa','Autonom√≠a motora fina completa']}
            ]},
            // PSICOMOTOR 2¬∫ CICLO
            {nombre:'Desarrollo Psicomotor',ciclo:'ciclo2',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Consolidar habilidades locomotrices',trimestre:1,indicadores:['Corre con t√©cnica eficiente','Salta con coordinaci√≥n','Realiza desplazamientos variados','Combina movimientos con fluidez']},
                {numero:2,descripcion:'Mejorar equilibrio din√°mico',trimestre:1,indicadores:['Mantiene equilibrio en movimiento','Camina sobre superficies estrechas','Realiza giros sin perder estabilidad','Equilibrio en situaciones cambiantes']},
                {numero:3,descripcion:'Desarrollar coordinaci√≥n √≥culo-manual',trimestre:1,indicadores:['Lanza con precisi√≥n a diana','Atrapa objetos en movimiento','Golpea objetos con implementos','Coordina vista y manos eficientemente']},
                {numero:4,descripcion:'Ampliar coordinaci√≥n √≥culo-p√©dica',trimestre:1,indicadores:['Conduce bal√≥n con control','Golpea bal√≥n con precisi√≥n','Combina carrera y golpeo','Coordina vista y pies']},
                {numero:5,descripcion:'Mejorar control corporal',trimestre:1,indicadores:['Controla movimientos globales','Ajusta fuerza seg√∫n tarea','Frena y arranca con control','Adapta movimiento al espacio']},
                {numero:6,descripcion:'Desarrollar habilidades gimn√°sticas',trimestre:2,indicadores:['Realiza volteretas con t√©cnica','Ejecuta equilibrios invertidos','Combina elementos gimn√°sticos','Muestra control en aparatos']},
                {numero:7,descripcion:'Mejorar expresi√≥n corporal',trimestre:2,indicadores:['Expresa emociones con el cuerpo','Crea secuencias de movimiento','Sigue ritmos con coordinaci√≥n','Improvisa movimientos creativos']},
                {numero:8,descripcion:'Ampliar juegos predeportivos',trimestre:2,indicadores:['Participa en juegos de equipo','Aplica reglas deportivas','Colabora con compa√±eros','Acepta victoria y derrota']},
                {numero:9,descripcion:'Desarrollar orientaci√≥n espacial din√°mica',trimestre:2,indicadores:['Se orienta en espacios amplios','Calcula trayectorias de objetos','Anticipa movimientos de otros','Ocupa espacios estrat√©gicamente']},
                {numero:10,descripcion:'Mejorar condici√≥n f√≠sica b√°sica',trimestre:2,indicadores:['Muestra resistencia en actividades','Desarrolla fuerza apropiada','Mantiene flexibilidad','Mejora velocidad de reacci√≥n']},
                {numero:11,descripcion:'Consolidar deportes colectivos',trimestre:3,indicadores:['Practica deportes de equipo','Conoce y aplica reglas','Asume diferentes roles','Muestra deportividad']},
                {numero:12,descripcion:'Ampliar deportes individuales',trimestre:3,indicadores:['Practica deportes individuales','Mejora marcas personales','Muestra constancia en pr√°ctica','Disfruta de la actividad']},
                {numero:13,descripcion:'Desarrollar autonom√≠a en actividad f√≠sica',trimestre:3,indicadores:['Calienta antes de actividad','Estira despu√©s del ejercicio','Cuida su higiene deportiva','Practica actividad regularmente']},
                {numero:14,descripcion:'Mejorar trabajo en equipo motor',trimestre:3,indicadores:['Colabora en actividades grupales','Comunica durante el juego','Ayuda a compa√±eros','Acepta diferentes niveles']},
                {numero:15,descripcion:'Generalizar competencia motriz',trimestre:3,indicadores:['Muestra competencia motriz global','Disfruta del movimiento','Mantiene h√°bitos activos','Transfiere a vida cotidiana']}
            ]},
            // AUTONOM√çA 2¬∫ CICLO
            {nombre:'Autonom√≠a Personal',ciclo:'ciclo2',tipo:'autonomia',objetivos:[
                {numero:1,descripcion:'Consolidar higiene personal',trimestre:1,indicadores:['Realiza aseo diario aut√≥nomo','Cuida su imagen personal','Mantiene higiene dental correcta','Reconoce necesidades de higiene']},
                {numero:2,descripcion:'Mejorar organizaci√≥n de materiales',trimestre:1,indicadores:['Prepara mochila correctamente','Organiza su espacio de trabajo','Cuida y mantiene materiales','Encuentra lo que necesita']},
                {numero:3,descripcion:'Desarrollar gesti√≥n del tiempo',trimestre:1,indicadores:['Sigue horarios establecidos','Calcula tiempo para tareas','Llega puntual','Aprovecha el tiempo']},
                {numero:4,descripcion:'Ampliar responsabilidad personal',trimestre:1,indicadores:['Cumple con sus obligaciones','Asume consecuencias de actos','Recuerda tareas sin ayuda','Muestra iniciativa']},
                {numero:5,descripcion:'Mejorar autonom√≠a en tareas escolares',trimestre:1,indicadores:['Inicia tareas sin que le digan','Trabaja de forma independiente','Busca informaci√≥n necesaria','Pide ayuda apropiadamente']},
                {numero:6,descripcion:'Desarrollar h√°bitos de estudio',trimestre:2,indicadores:['Tiene lugar fijo de estudio','Organiza tiempo de deberes','Prepara material antes','Mantiene concentraci√≥n']},
                {numero:7,descripcion:'Mejorar autocuidado',trimestre:2,indicadores:['Reconoce s√≠ntomas de malestar','Comunica necesidades de salud','Conoce h√°bitos saludables','Se protege del sol y fr√≠o']},
                {numero:8,descripcion:'Ampliar colaboraci√≥n en hogar',trimestre:2,indicadores:['Realiza tareas dom√©sticas','Colabora sin que le pidan','Cuida espacios comunes','Ayuda a la familia']},
                {numero:9,descripcion:'Desarrollar seguridad personal',trimestre:2,indicadores:['Conoce normas de seguridad','Act√∫a con prudencia','Identifica situaciones de riesgo','Sabe pedir ayuda']},
                {numero:10,descripcion:'Mejorar desplazamientos aut√≥nomos',trimestre:2,indicadores:['Se desplaza por el centro solo','Conoce el camino a lugares','Sigue normas de circulaci√≥n','Se orienta en entorno conocido']},
                {numero:11,descripcion:'Consolidar alimentaci√≥n saludable',trimestre:3,indicadores:['Elige alimentos saludables','Come de forma equilibrada','Conoce grupos de alimentos','Evita excesos de dulces']},
                {numero:12,descripcion:'Ampliar gesti√≥n del ocio',trimestre:3,indicadores:['Organiza su tiempo libre','Elige actividades variadas','Equilibra pantallas y otras actividades','Propone planes']},
                {numero:13,descripcion:'Desarrollar resoluci√≥n de problemas cotidianos',trimestre:3,indicadores:['Resuelve peque√±os problemas solo','Busca alternativas','Toma decisiones adecuadas','Pide ayuda cuando la necesita']},
                {numero:14,descripcion:'Mejorar gesti√≥n de pertenencias',trimestre:3,indicadores:['Cuida sus cosas','Ahorra y administra dinero','Valora lo que tiene','Comparte apropiadamente']},
                {numero:15,descripcion:'Generalizar autonom√≠a personal',trimestre:3,indicadores:['Muestra autonom√≠a en rutinas','Act√∫a con responsabilidad','Toma iniciativas apropiadas','Transfiere habilidades a nuevos contextos']}
            ]},
            {nombre:'Desarrollo Psicomotor',ciclo:'ciclo1',tipo:'psicomotor',objetivos:[
                {numero:1,descripcion:'Consolidar carrera',trimestre:1,indicadores:['Corre con t√©cnica','Cambia direcci√≥n','Acelera/frena','Carrera continuada']},
                {numero:2,descripcion:'Mejorar salto',trimestre:1,indicadores:['Salta longitud','Salta altura','Salto alternando','Triple salto b√°sico']},
                {numero:3,descripcion:'Desarrollar lanzamiento',trimestre:1,indicadores:['Lanza con fuerza','Lanza con precisi√≥n','Lanza diferentes objetos','T√©cnica lanzamiento']},
                {numero:4,descripcion:'Ampliar recepci√≥n',trimestre:1,indicadores:['Atrapa con manos','Recepciona movimiento','Atrapa diferentes tama√±os','Anticipa trayectoria']},
                {numero:5,descripcion:'Mejorar equilibrio',trimestre:1,indicadores:['Equilibrio din√°mico','Equilibrio est√°tico prolongado','Equilibrio con ojos cerrados','Equilibrio inestable']},
                {numero:6,descripcion:'Desarrollar coordinaci√≥n general',trimestre:2,indicadores:['Circuitos complejos','Combina habilidades','Movimientos fluidos','Adapta a situaciones']},
                {numero:7,descripcion:'Ampliar habilidades gimn√°sticas',trimestre:2,indicadores:['Voltereta adelante','Voltereta atr√°s','Rueda lateral','Equilibrios invertidos']},
                {numero:8,descripcion:'Mejorar coordinaci√≥n con implementos',trimestre:2,indicadores:['Maneja raqueta','Usa bate','Conduce bal√≥n pie','Maneja stick']},
                {numero:9,descripcion:'Desarrollar expresi√≥n corporal',trimestre:2,indicadores:['Coreograf√≠as sencillas','Expresa con cuerpo','Sigue m√∫sica','Improvisa movimiento']},
                {numero:10,descripcion:'Ampliar juegos predeportivos',trimestre:2,indicadores:['Participa juegos equipo','Entiende reglas','Colabora con compa√±eros','Acepta resultados']},
                {numero:11,descripcion:'Consolidar habilidades',trimestre:3,indicadores:['Ejecuta con eficacia','Automatiza movimientos','Transfiere a deporte','Muestra competencia']},
                {numero:12,descripcion:'Desarrollar condici√≥n f√≠sica',trimestre:3,indicadores:['Resistencia b√°sica','Fuerza apropiada','Flexibilidad','Velocidad reacci√≥n']},
                {numero:13,descripcion:'Ampliar deportes',trimestre:3,indicadores:['Practica varios deportes','Conoce reglas b√°sicas','Participa competiciones','Deportividad']},
                {numero:14,descripcion:'Mejorar orientaci√≥n espacial',trimestre:3,indicadores:['Se orienta espacio','Calcula trayectorias','Anticipa compa√±eros','Ocupa espacios']},
                {numero:15,descripcion:'Generalizar competencia motriz',trimestre:3,indicadores:['Competencia motriz general','Disfruta movimiento','H√°bitos actividad','Autonom√≠a motora']}
            ]}
        ];
        
        // Cargar plantillas base inmediatamente (sin esperar Firebase)
        PLANTILLAS_BASE.forEach((p,i)=>{
            const id='base_'+p.ciclo+'_'+p.tipo;
            plantillas[id]={...p,esBase:true};
        });
        
        // Firebase listeners
        db.ref('gestorpe/alumnos').on('value',snap=>{alumnos=snap.val()||{};renderInicio();if(alumnoActual&&alumnos[alumnoActual]){renderProgs();renderProg();renderEval();renderAsis();}document.getElementById('statusDot').classList.add('ok');document.getElementById('statusText').textContent='Conectado';});
        db.ref('gestorpe/plantillas').on('value',snap=>{
            const customPlantillas=snap.val()||{};
            // A√±adir plantillas personalizadas de Firebase
            Object.keys(customPlantillas).forEach(id=>{
                plantillas[id]=customPlantillas[id];
            });
            renderBiblioteca();
        });
        
        // Renderizar biblioteca aunque Firebase no conecte
        renderBiblioteca();

        function cambiarSeccion(s,btn){document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');document.getElementById('seccionAlumnos').style.display=s==='alumnos'?'block':'none';document.getElementById('seccionBiblioteca').style.display=s==='biblioteca'?'block':'none';}
        function renderInicio(){const g=document.getElementById('alumnosGrid'),ids=Object.keys(alumnos);if(!ids.length){g.innerHTML='<div class="alumno-card alumno-card-add" onclick="abrirModalNuevo()"><span style="font-size:1.3rem">‚ûï</span><span style="font-size:.8rem">A√±adir</span></div>';return;}let h=ids.map(id=>{const a=alumnos[id],n=a.programas?Object.keys(a.programas).length:0;return'<div class="alumno-card" onclick="abrirAlumno(\''+id+'\')"><div class="alumno-siglas">'+a.siglas+'</div><div class="alumno-curso">'+a.curso+'</div><div class="alumno-progs">'+n+' prog.</div></div>';}).join('');h+='<div class="alumno-card alumno-card-add" onclick="abrirModalNuevo()"><span style="font-size:1.3rem">‚ûï</span></div>';g.innerHTML=h;}
        
        // BIBLIOTECA
        function renderBiblioteca(){const c=document.getElementById('bibliotecaGrid');const cicloF=document.getElementById('filtroCiclo').value;const areaF=document.getElementById('filtroArea').value;const lista=Object.keys(plantillas).map(id=>({id,...plantillas[id]}));const filtrada=lista.filter(p=>{if(cicloF&&p.ciclo!==cicloF)return false;if(areaF&&p.tipo!==areaF)return false;return true;});if(!filtrada.length){c.innerHTML='<div class="empty-state"><p>No hay plantillas con estos filtros</p></div>';return;}c.innerHTML=filtrada.map(p=>{const ciclo=CICLOS[p.ciclo]||{nombre:p.ciclo};const area=AREAS[p.tipo]||{nombre:p.tipo,icon:'üìÑ'};const nObj=p.objetivos?p.objetivos.length:0;const nInd=p.objetivos?p.objetivos.reduce((s,o)=>s+(o.indicadores?o.indicadores.length:0),0):0;const baseBadge=p.esBase?'<span style="font-size:.6rem;background:#e0e7ff;color:#4338ca;padding:2px 6px;border-radius:8px;margin-left:4px">BASE</span>':'';return'<div class="plantilla-card" onclick="verPlantilla(\''+p.id+'\')"><div class="plantilla-header"><span class="plantilla-titulo">'+area.icon+' '+p.nombre+baseBadge+'</span></div><div class="plantilla-meta"><span class="plantilla-badge ciclo-'+p.ciclo+'">'+ciclo.nombre+'</span><span class="plantilla-badge badge-area">'+area.nombre+'</span></div><div class="plantilla-stats">'+nObj+' objetivos ¬∑ '+nInd+' indicadores</div></div>';}).join('');}
        
        function verPlantilla(id){const p=plantillas[id];if(!p)return;const area=AREAS[p.tipo]||{nombre:p.tipo,icon:'üìÑ'};const ciclo=CICLOS[p.ciclo]||{nombre:p.ciclo};document.getElementById('modalPlantillaTitulo').textContent=area.icon+' '+p.nombre;let h='<div class="plantilla-meta" style="margin-bottom:12px"><span class="plantilla-badge ciclo-'+p.ciclo+'">'+ciclo.nombre+'</span><span class="plantilla-badge badge-area">'+area.nombre+'</span>'+(p.esBase?'<span style="font-size:.7rem;background:#e0e7ff;color:#4338ca;padding:3px 8px;border-radius:8px">Plantilla base</span>':'')+'</div>';(p.objetivos||[]).forEach(o=>{h+='<div class="objetivo-card"><div class="objetivo-header"><span class="objetivo-num">O'+o.numero+'</span><span class="trimestre-badge t'+o.trimestre+'">T'+o.trimestre+'</span></div><div class="objetivo-desc">'+o.descripcion+'</div>';if(o.indicadores&&o.indicadores.length){h+='<ul class="indicadores-list">'+o.indicadores.map(x=>'<li>‚Ä¢ '+x+'</li>').join('')+'</ul>';}h+='</div>';});document.getElementById('modalPlantillaBody').innerHTML=h;const deleteBtn=p.esBase?'':'<button class="btn btn-danger btn-sm" onclick="eliminarPlantilla(\''+id+'\')">üóëÔ∏è</button>';document.getElementById('modalPlantillaFooter').innerHTML=deleteBtn+'<button class="btn btn-secondary" onclick="cerrarModal(\'modalPlantilla\')">Cerrar</button><button class="btn btn-primary" onclick="usarPlantilla(\''+id+'\')">üì• Usar</button>';abrirModal('modalPlantilla');}
        
        function usarPlantilla(id){cerrarModal('modalPlantilla');if(!alumnoActual){const ids=Object.keys(alumnos);if(!ids.length){toast('Crea un alumno primero','error');return;}let h='<div class="form-group"><label class="form-label">Selecciona alumno:</label><select class="form-select" id="selAlumnoPlantilla">';ids.forEach(aid=>{h+='<option value="'+aid+'">'+alumnos[aid].siglas+' - '+alumnos[aid].curso+'</option>';});h+='</select></div>';document.getElementById('modalPlantillaBody').innerHTML=h;document.getElementById('modalPlantillaTitulo').textContent='Seleccionar alumno';document.getElementById('modalPlantillaFooter').innerHTML='<button class="btn btn-secondary" onclick="cerrarModal(\'modalPlantilla\')">Cancelar</button><button class="btn btn-primary" onclick="asignarPlantillaAlumno(\''+id+'\')">Asignar</button>';abrirModal('modalPlantilla');}else{asignarPlantilla(id,alumnoActual);}}
        
        function asignarPlantillaAlumno(pid){const aid=document.getElementById('selAlumnoPlantilla').value;cerrarModal('modalPlantilla');asignarPlantilla(pid,aid);}
        
        function asignarPlantilla(pid,aid){const p=plantillas[pid],a=alumnos[aid];if(!p||!a)return;const newPid='p_'+Date.now();const programa={tipo:p.tipo,objetivos:JSON.parse(JSON.stringify(p.objetivos))};db.ref('gestorpe/alumnos/'+aid+'/programas/'+newPid).set(programa).then(()=>{a.programas=a.programas||{};a.programas[newPid]=programa;const nueva=generarProgramacion(a);return db.ref('gestorpe/alumnos/'+aid+'/programacion').set(nueva);}).then(()=>{toast('Plantilla asignada a '+a.siglas,'success');if(alumnoActual===aid){renderProgs();renderProg();}});}
        
        function eliminarPlantilla(id){if(plantillas[id]&&plantillas[id].esBase){toast('No se pueden eliminar plantillas base','error');return;}if(!confirm('¬øEliminar plantilla?'))return;db.ref('gestorpe/plantillas/'+id).remove().then(()=>{cerrarModal('modalPlantilla');toast('Eliminada','success');});}
        
        function abrirModalNuevaPlantilla(){document.getElementById('plantillaNombre').value='';document.getElementById('plantillaTexto').value='';document.getElementById('uploadZonePlantilla').innerHTML='üìÑ Toca para seleccionar';document.getElementById('uploadZonePlantilla').classList.remove('has-file');document.getElementById('previewPlantillaNueva').style.display='none';document.getElementById('btnGuardarPlantilla').disabled=true;docExtraidoPlantilla=null;abrirModal('modalNuevaPlantilla');}
        async function cargarDocxPlantilla(inp){const f=inp.files[0];if(!f)return;document.getElementById('uploadZonePlantilla').innerHTML='üìÑ '+f.name;document.getElementById('uploadZonePlantilla').classList.add('has-file');try{const r=await mammoth.extractRawText({arrayBuffer:await f.arrayBuffer()});document.getElementById('plantillaTexto').value=r.value;}catch(e){toast('Error','error');}}
        function analizarTextoPlantilla(){const t=document.getElementById('plantillaTexto').value;if(t.length<20){toast('Pega m√°s contenido','error');return;}const objs=extraerObjetivos(t);if(!objs.length){toast('No se encontraron objetivos','error');return;}docExtraidoPlantilla=objs;document.getElementById('previewPlantillaNueva').innerHTML='‚úì '+objs.length+' objetivos';document.getElementById('previewPlantillaNueva').style.display='block';document.getElementById('btnGuardarPlantilla').disabled=false;}
        function guardarNuevaPlantilla(){const nombre=document.getElementById('plantillaNombre').value.trim();if(!nombre){toast('Introduce nombre','error');return;}if(!docExtraidoPlantilla||!docExtraidoPlantilla.length){toast('Analiza texto','error');return;}const id='pl_'+Date.now();db.ref('gestorpe/plantillas/'+id).set({nombre:nombre,ciclo:document.getElementById('plantillaCiclo').value,tipo:document.getElementById('plantillaArea').value,objetivos:docExtraidoPlantilla}).then(()=>{cerrarModal('modalNuevaPlantilla');toast('Guardada','success');});}

        // ALUMNOS
        function abrirModalNuevo(){document.getElementById('nuevoSiglas').value='';diasSel=[1,3,4];actualizarDiasBtns();abrirModal('modalNuevo');}
        function toggleDia(d){const idx=diasSel.indexOf(d);if(idx>-1){if(diasSel.length>1)diasSel.splice(idx,1);}else{diasSel.push(d);diasSel.sort((a,b)=>a-b);}actualizarDiasBtns();}
        function actualizarDiasBtns(){document.querySelectorAll('#diasBtns .dia-btn').forEach(btn=>{btn.classList.toggle('active',diasSel.includes(parseInt(btn.dataset.dia)));});}
        function crearAlumno(){const siglas=document.getElementById('nuevoSiglas').value.trim().toUpperCase();if(!siglas){toast('Introduce siglas','error');return;}const cursoSel=document.getElementById('nuevoCurso'),cursoTexto=cursoSel.options[cursoSel.selectedIndex].text,ciclo=cursoSel.value;db.ref('gestorpe/alumnos').push().set({siglas:siglas,curso:cursoTexto,ciclo:ciclo,diasSesion:diasSel.slice(),programas:{},programacion:{},evaluaciones:{},ausencias:{},sincole:{},resultados:{},pasados:{}}).then(()=>{cerrarModal('modalNuevo');toast(siglas+' creado ‚úì','success');});}
        function abrirAlumno(id){alumnoActual=id;mesActual=0;evalTrim=1;document.getElementById('screenInicio').classList.remove('active');document.getElementById('screenAlumno').classList.add('active');const a=alumnos[id],diasStr=(a.diasSesion||[0,2,4]).map(d=>DIAS_C[d]).join('-');document.getElementById('alumnoHeader').innerHTML='<div class="alumno-header-siglas">'+a.siglas+'</div><div><h2 style="font-size:.95rem">'+a.curso+'</h2><p style="color:var(--text-light);font-size:.75rem">'+diasStr+'</p></div><div style="margin-left:auto" class="btn-group no-print"><button class="btn btn-secondary btn-sm" onclick="volverInicio()">‚Üê Volver</button><button class="btn btn-secondary btn-sm" onclick="window.print()">üñ®Ô∏è</button><button class="btn btn-danger btn-sm" onclick="eliminarAlumno(\''+id+'\')">üóëÔ∏è</button></div>';document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',i===0));document.querySelectorAll('.tab-content').forEach((c,i)=>c.classList.toggle('active',i===0));renderProgs();renderProg();renderEval();renderAsis();}
        function volverInicio(){alumnoActual=null;document.getElementById('screenAlumno').classList.remove('active');document.getElementById('screenInicio').classList.add('active');}
        function cambiarTab(t){document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1)).classList.add('active');if(t==='asistencia')setTimeout(renderAsisCharts,100);if(t==='evaluacion')setTimeout(renderEvalCharts,100);if(t==='seneca')renderSeneca();}
        function eliminarAlumno(id){if(confirm('¬øEliminar alumno?')){db.ref('gestorpe/alumnos/'+id).remove();volverInicio();toast('Eliminado','success');}}

        // PROGRAMAS
        function renderProgs(){const a=alumnos[alumnoActual];let h='<div class="card"><div class="card-header"><h3 class="card-title">üìÑ Programas</h3><button class="btn btn-primary btn-sm no-print" onclick="abrirModalAddProg()">‚ûï</button></div>';if(!a.programas||!Object.keys(a.programas).length){h+='<div class="empty-state">Sin programas</div>';}else{Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{icon:'üìÑ',nombre:p.tipo,color:'#666'};h+='<div class="programa-card" style="border-left-color:'+info.color+'"><div class="programa-header"><span class="programa-titulo">'+info.icon+' '+info.nombre+'</span><button class="btn btn-danger btn-sm no-print" onclick="elimProg(\''+pId+'\')">üóëÔ∏è</button></div>';(p.objetivos||[]).forEach(obj=>{h+='<div class="objetivo-card"><div class="objetivo-header"><span class="objetivo-num">O'+obj.numero+'</span><span class="trimestre-badge t'+obj.trimestre+'">T'+obj.trimestre+'</span></div><div class="objetivo-desc">'+obj.descripcion+'</div>';if(obj.indicadores&&obj.indicadores.length){h+='<ul class="indicadores-list">'+obj.indicadores.map(x=>'<li>‚Ä¢ '+x+'</li>').join('')+'</ul>';}h+='</div>';});h+='</div>';});}h+='<div class="btn-group no-print" style="margin-top:12px"><button class="btn btn-secondary btn-sm" onclick="regenerarProg()">üîÑ Regenerar</button><button class="btn btn-ai btn-sm" onclick="generarPromptIA()">ü§ñ IA</button><button class="btn btn-warning btn-sm" onclick="abrirModal(\'modalImportJSON\')">üì• JSON</button></div></div>';document.getElementById('tabProgramas').innerHTML=h;}
        function abrirModalAddProg(){const a=alumnos[alumnoActual];const cicloAlumno=a.ciclo||'ciclo1';const sel=document.getElementById('selPlantilla');sel.innerHTML='<option value="">-- Elegir plantilla --</option>';Object.keys(plantillas).forEach(id=>{const p=plantillas[id];if(p.ciclo===cicloAlumno){const area=AREAS[p.tipo]||{icon:'üìÑ'};sel.innerHTML+='<option value="'+id+'">'+area.icon+' '+p.nombre+'</option>';}});document.getElementById('previewPlantilla').style.display='none';document.getElementById('addProgTipo').value='';document.getElementById('addProgTexto').value='';document.getElementById('uploadZone').innerHTML='üìÑ Toca para seleccionar';document.getElementById('uploadZone').classList.remove('has-file');document.getElementById('previewProg').style.display='none';document.getElementById('zonaDocx').style.display='block';document.getElementById('zonaLecto').style.display='none';docExtraido=null;abrirModal('modalAddProg');}
        function previsualizarPlantilla(){const id=document.getElementById('selPlantilla').value;if(!id){document.getElementById('previewPlantilla').style.display='none';return;}const p=plantillas[id];if(!p)return;const nObj=p.objetivos?p.objetivos.length:0;const nInd=p.objetivos?p.objetivos.reduce((s,o)=>s+(o.indicadores?o.indicadores.length:0),0):0;document.getElementById('previewPlantilla').innerHTML='<strong>'+p.nombre+'</strong><br>'+nObj+' objetivos ¬∑ '+nInd+' indicadores';document.getElementById('previewPlantilla').style.display='block';}
        function cambioTipoProg(){const t=document.getElementById('addProgTipo').value;document.getElementById('zonaDocx').style.display=t==='lectoescritura'?'none':'block';document.getElementById('zonaLecto').style.display=t==='lectoescritura'?'block':'none';}
        async function cargarDocx(inp){const f=inp.files[0];if(!f)return;document.getElementById('uploadZone').innerHTML='üìÑ '+f.name;document.getElementById('uploadZone').classList.add('has-file');try{const r=await mammoth.extractRawText({arrayBuffer:await f.arrayBuffer()});procesarTexto(r.value);}catch(e){toast('Error','error');}}
        function analizarTexto(){const t=document.getElementById('addProgTexto').value;if(t.length<20){toast('Pega m√°s contenido','error');return;}procesarTexto(t);}
        function procesarTexto(txt){const objs=extraerObjetivos(txt);if(!objs.length){toast('No se encontraron objetivos','error');return;}docExtraido=objs;document.getElementById('previewProg').innerHTML='‚úì '+objs.length+' objetivos';document.getElementById('previewProg').style.display='block';}
        function extraerObjetivos(txt){const objs=[],lineas=txt.split('\n');let actual=null,seccion=null;for(let i=0;i<lineas.length;i++){const lt=lineas[i].trim();if(!lt)continue;const m=lt.match(/^OBJETIVO\s*(\d+)[.:]\s*(.+)?/i)||lt.match(/^(\d+)[.\-)\s]+(.{15,})/);if(m){if(actual)objs.push(actual);actual={numero:parseInt(m[1]),descripcion:(m[2]||'').trim(),indicadores:[],trimestre:1};seccion=null;continue;}if(lt.toUpperCase().indexOf('INDICADOR')>-1){seccion='indicadores';continue;}if(actual&&seccion==='indicadores'&&lt.length>5){const ind=lt.replace(/^[-‚Ä¢¬∑‚ñ™‚ñ∫‚óè‚óã‚ó¶‚Ä£‚ÅÉ*]\s*/,'').trim();if(ind.length>5)actual.indicadores.push(ind);}}if(actual)objs.push(actual);const n=objs.length,p=Math.ceil(n/3);objs.forEach((o,i)=>{o.trimestre=i<p?1:(i<p*2?2:3);if(!o.indicadores.length)o.indicadores=['Indicador de '+o.descripcion.substring(0,20)];});return objs;}
        function addPrograma(){const plantillaId=document.getElementById('selPlantilla').value;if(plantillaId){asignarPlantilla(plantillaId,alumnoActual);cerrarModal('modalAddProg');return;}const tipo=document.getElementById('addProgTipo').value;if(!tipo){toast('Selecciona tipo o plantilla','error');return;}const objetivos=tipo==='lectoescritura'?LECTO:docExtraido;if(!objetivos||!objetivos.length){toast('Sin objetivos','error');return;}const a=alumnos[alumnoActual],pId='p_'+Date.now();db.ref('gestorpe/alumnos/'+alumnoActual+'/programas/'+pId).set({tipo:tipo,objetivos:objetivos}).then(()=>{a.programas=a.programas||{};a.programas[pId]={tipo:tipo,objetivos:objetivos};const nueva=generarProgramacion(a);return db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(nueva);}).then(()=>{cerrarModal('modalAddProg');renderProgs();renderProg();toast('A√±adido ‚úì','success');});}
        function elimProg(pId){if(!confirm('¬øEliminar?'))return;db.ref('gestorpe/alumnos/'+alumnoActual+'/programas/'+pId).remove().then(()=>{delete alumnos[alumnoActual].programas[pId];return db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(generarProgramacion(alumnos[alumnoActual]));}).then(()=>{renderProgs();renderProg();toast('Eliminado','success');});}

        // PROGRAMACI√ìN
        function getIndicadoresPasados(a,trim){const pasados=a.pasados||{},result=[];Object.keys(pasados).forEach(k=>{if(pasados[k]===trim){const parts=k.split('_');result.push({pId:parts[0],oIdx:parseInt(parts[1]),iIdx:parseInt(parts[2]),key:k});}});return result;}
        function getTodasLasSesiones(a){const dias=a.diasSesion||[1,3,4],keys=[];for(let mi=0;mi<MESES.length;mi++){const m=MESES[mi];for(let s=1;s<=m.semanas;s++){for(let di=0;di<dias.length;di++){keys.push(mi+'_'+s+'_'+dias[di]);}}}return keys;}
        function generarProgramacion(a){const prog={};if(!a.programas)return prog;const pIds=Object.keys(a.programas);if(!pIds.length)return prog;const todasSesiones=getTodasLasSesiones(a);const sesionesPorTrim={1:0,2:0,3:0};todasSesiones.forEach(k=>{const mi=parseInt(k.split('_')[0]);sesionesPorTrim[MESES[mi].trim]++;});const poolT={1:[],2:[],3:[]};pIds.forEach(pId=>{const p=a.programas[pId];(p.objetivos||[]).forEach((o,oi)=>{const trim=o.trimestre||1;(o.indicadores||['Indicador']).forEach((_,ii)=>{poolT[trim].push({pId:pId,oIdx:oi,iIdx:ii});});});});[2,3].forEach(t=>{getIndicadoresPasados(a,t).forEach(p=>poolT[t].push({pId:p.pId,oIdx:p.oIdx,iIdx:p.iIdx}));});[1,2,3].forEach(t=>{if(poolT[t].length<2)return;const porProg={};poolT[t].forEach(item=>{if(!porProg[item.pId])porProg[item.pId]=[];porProg[item.pId].push(item);});const pIdsEnPool=Object.keys(porProg);if(pIdsEnPool.length<2)return;const nuevo=[];let maxLen=Math.max(...pIdsEnPool.map(id=>porProg[id].length));for(let i=0;i<maxLen;i++){pIdsEnPool.forEach(id=>{if(porProg[id][i])nuevo.push(porProg[id][i]);});}poolT[t]=nuevo;});[1,2,3].forEach(t=>{if(!poolT[t].length)return;const sesiones=sesionesPorTrim[t];while(poolT[t].length<sesiones){const original=[...poolT[t]];for(let i=0;i<original.length&&poolT[t].length<sesiones;i++){poolT[t].push({...original[i]});}}});let idxT={1:0,2:0,3:0};todasSesiones.forEach(k=>{const mi=parseInt(k.split('_')[0]);const trim=MESES[mi].trim;const pool=poolT[trim];if(!pool.length)return;prog[k]=pool[idxT[trim]%pool.length];idxT[trim]++;});return prog;}
        function regenerarProg(){const a=alumnos[alumnoActual];if(!a.programas||!Object.keys(a.programas).length){toast('A√±ade programa','error');return;}const nueva=generarProgramacion(a);db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(nueva).then(()=>{a.programacion=nueva;renderProg();toast('Regenerado ‚úì','success');});}
        function reajustarDesde(a,desdeClave){const todasSesiones=getTodasLasSesiones(a);const idx=todasSesiones.indexOf(desdeClave);if(idx<0)return a.programacion;const nueva={...a.programacion};for(let i=todasSesiones.length-1;i>idx;i--){const keyActual=todasSesiones[i];const keyAnterior=todasSesiones[i-1];if(nueva[keyAnterior]){nueva[keyActual]=nueva[keyAnterior];}}delete nueva[desdeClave];return nueva;}
        function insertarRepeticion(a,clave,contenido){const todasSesiones=getTodasLasSesiones(a);const idx=todasSesiones.indexOf(clave);if(idx<0)return a.programacion;const dias=a.diasSesion||[1,3,4];let idxRepetir=idx+dias.length;if(idxRepetir>=todasSesiones.length)idxRepetir=todasSesiones.length-1;const claveRepetir=todasSesiones[idxRepetir];const nueva={...a.programacion};for(let i=todasSesiones.length-1;i>idxRepetir;i--){const keyActual=todasSesiones[i];const keyAnterior=todasSesiones[i-1];if(nueva[keyAnterior]){nueva[keyActual]=nueva[keyAnterior];}}nueva[claveRepetir]=contenido;return nueva;}
        function generarPromptIA(){const a=alumnos[alumnoActual];if(!a.programas||!Object.keys(a.programas).length){toast('A√±ade programas','error');return;}const dias=a.diasSesion||[1,3,4];const todasSesiones=getTodasLasSesiones(a);let prompt='Genera programaci√≥n COMPLETA curso 2025/2026.\n\nüë§ '+a.siglas+' ('+a.curso+')\nüìÜ '+dias.map(d=>DIAS_C[d]).join(', ')+'\nüìä '+todasSesiones.length+' sesiones\n\nüìö PROGRAMAS:\n';Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};prompt+='\nüî∑ '+info.nombre+' (ID: "'+pId+'")\n';(p.objetivos||[]).forEach((obj,oi)=>{prompt+='  O'+obj.numero+' (oIdx:'+oi+', T'+obj.trimestre+'): '+obj.descripcion+'\n';(obj.indicadores||[]).forEach((ind,ii)=>{prompt+='    - iIdx:'+ii+': '+ind+'\n';});});});prompt+='\nüì§ RESPONDE SOLO JSON:\n{"mes_semana_dia": {"pId": "...", "oIdx": N, "iIdx": N}, ...}\n\n‚ö†Ô∏è '+todasSesiones.length+' entradas. Alterna 50-50. Respeta trimestres.';navigator.clipboard.writeText(prompt).then(()=>{toast('Copiado','success');window.open('https://chat.openai.com/','_blank');});}
        function importarJSON(){const txt=document.getElementById('jsonInput').value.trim();if(!txt){toast('Pega JSON','error');return;}try{let cleanJSON=txt.replace(/```json?\n?/g,'').replace(/```/g,'').trim();const prog=JSON.parse(cleanJSON);db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(prog).then(()=>{alumnos[alumnoActual].programacion=prog;cerrarModal('modalImportJSON');document.getElementById('jsonInput').value='';renderProg();toast('Importado ‚úì','success');});}catch(e){toast('Error JSON','error');}}
        function renderProg(){const a=alumnos[alumnoActual],dias=a.diasSesion||[1,3,4],noms=dias.map(d=>DIAS_C[d]),mes=MESES[mesActual],st=calcStats(a);let h='<div class="card"><div class="stats-box no-print"><div class="stat-item"><div class="stat-num" style="color:var(--danger)">'+(st.porMes[mesActual]?st.porMes[mesActual].aus:0)+'</div><div class="stat-label">Ausencias</div></div></div><div class="cuadrante-nav no-print"><button class="nav-btn" onclick="cambiarMes(-1)">‚óÄ</button><select class="form-select" style="width:auto" onchange="mesActual=parseInt(this.value);renderProg()">';for(let i=0;i<MESES.length;i++){h+='<option value="'+i+'"'+(i===mesActual?' selected':'')+'>'+MESES[i].nombre+'</option>';}h+='</select><button class="nav-btn" onclick="cambiarMes(1)">‚ñ∂</button><span class="trimestre-badge t'+mes.trim+'">T'+mes.trim+'</span></div><div class="leyenda no-print"><div class="leyenda-item"><div class="leyenda-color" style="background:#fee2e2"></div>Ausencia</div><div class="leyenda-item"><div class="leyenda-color" style="background:#e0e7ff"></div>Sin cole</div></div><div style="overflow-x:auto;margin-top:8px"><table class="cuadrante-table"><thead><tr><th>S</th>';for(let i=0;i<noms.length;i++){h+='<th>'+noms[i]+'</th>';}h+='</tr></thead><tbody>';for(let si=0;si<mes.semanas;si++){const sem=si+1;h+='<tr><td>'+sem+'</td>';for(let di=0;di<dias.length;di++){h+=renderCelda(a,mesActual+'_'+sem+'_'+dias[di],dias[di]);}h+='</tr>';}h+='</tbody></table></div></div>';document.getElementById('tabProgramacion').innerHTML=h;}
        function renderCelda(a,k,d){const c=a.programacion?a.programacion[k]:null,aus=a.ausencias?a.ausencias[k]:false,sc=a.sincole?a.sincole[k]:false,res=a.resultados?a.resultados[k]:null;let cls='celda',icon='';if(sc){cls+=' celda-sincole';icon='üè´';}else if(aus){cls+=' celda-ausencia';icon='‚ùå';}else if(res==='conseguido'){icon='‚úÖ';}else if(res==='repetir'){icon='üîÑ';}if(!c||!a.programas||!a.programas[c.pId]){return'<td class="'+cls+' celda-vacia" onclick="editarCelda(\''+k+'\','+d+')">'+(icon?'<span class="celda-icon">'+icon+'</span>':'')+'+</td>';}const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;if(!obj)return'<td class="'+cls+'">?</td>';const info=AREAS[p.tipo]||{color:'#666'},ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';return'<td class="'+cls+'" onclick="editarCelda(\''+k+'\','+d+')">'+(icon?'<span class="celda-icon">'+icon+'</span>':'')+'<div class="celda-obj" style="color:'+info.color+'">O'+obj.numero+'</div><div class="celda-ind">'+ind.substring(0,25)+(ind.length>25?'...':'')+'</div></td>';}
        function cambiarMes(dir){mesActual=Math.max(0,Math.min(9,mesActual+dir));renderProg();}
        function editarCelda(k,d){celdaEditando=k;estadoCelda='asiste';resultadoCelda=null;const a=alumnos[alumnoActual],c=a.programacion?a.programacion[k]:{};document.getElementById('celdaTitulo').textContent=DIAS[d];document.querySelectorAll('.asist-btn').forEach(b=>b.classList.remove('selected'));document.querySelectorAll('.resultado-btn').forEach(b=>b.classList.remove('selected'));if(a.sincole&&a.sincole[k]){estadoCelda='sincole';document.querySelector('.asist-btn.sincole').classList.add('selected');document.getElementById('contenidoSesion').style.display='none';}else if(a.ausencias&&a.ausencias[k]){estadoCelda='ausencia';document.querySelector('.asist-btn.ausencia').classList.add('selected');document.getElementById('contenidoSesion').style.display='none';}else{document.querySelector('.asist-btn.asiste').classList.add('selected');document.getElementById('contenidoSesion').style.display='block';}resultadoCelda=(a.resultados&&a.resultados[k])?a.resultados[k]:null;if(resultadoCelda){const btn=document.querySelector('.resultado-btn.'+resultadoCelda);if(btn)btn.classList.add('selected');}const sel=document.getElementById('selPrograma');sel.innerHTML='<option value="">-</option>';if(a.programas){Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{icon:'üìÑ'};sel.innerHTML+='<option value="'+pId+'"'+(c.pId===pId?' selected':'')+'>'+info.icon+' '+(info.nombre||p.tipo)+'</option>';});}if(c.pId){cargarObjetivos();setTimeout(()=>{document.getElementById('selObjetivo').value=c.oIdx!==undefined?c.oIdx:'';cargarIndicadores();setTimeout(()=>{document.getElementById('selIndicador').value=c.iIdx!==undefined?c.iIdx:'';},30);},30);}else{document.getElementById('selObjetivo').innerHTML='<option value="">-</option>';document.getElementById('selIndicador').innerHTML='<option value="">-</option>';}abrirModal('modalCelda');}
        function setEstado(e,btn){estadoCelda=e;document.querySelectorAll('.asist-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');document.getElementById('contenidoSesion').style.display=e==='asiste'?'block':'none';}
        function setResultado(r,btn){if(resultadoCelda===r){resultadoCelda=null;btn.classList.remove('selected');}else{resultadoCelda=r;document.querySelectorAll('.resultado-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');}}
        function cargarObjetivos(){const a=alumnos[alumnoActual],pId=document.getElementById('selPrograma').value,sel=document.getElementById('selObjetivo');sel.innerHTML='<option value="">-</option>';document.getElementById('selIndicador').innerHTML='<option value="">-</option>';if(!pId||!a.programas||!a.programas[pId])return;a.programas[pId].objetivos.forEach((o,i)=>{sel.innerHTML+='<option value="'+i+'">O'+o.numero+': '+o.descripcion.substring(0,20)+'...</option>';});}
        function cargarIndicadores(){const a=alumnos[alumnoActual],pId=document.getElementById('selPrograma').value,oIdx=document.getElementById('selObjetivo').value,sel=document.getElementById('selIndicador');sel.innerHTML='<option value="">-</option>';if(!pId||oIdx==='')return;const inds=a.programas[pId].objetivos[parseInt(oIdx)].indicadores||[];inds.forEach((x,i)=>{sel.innerHTML+='<option value="'+i+'">'+x.substring(0,30)+'...</option>';});}
        function guardarCelda(){const a=alumnos[alumnoActual];const updates={};const contenidoActual=a.programacion?a.programacion[celdaEditando]:null;updates['gestorpe/alumnos/'+alumnoActual+'/ausencias/'+celdaEditando]=null;updates['gestorpe/alumnos/'+alumnoActual+'/sincole/'+celdaEditando]=null;updates['gestorpe/alumnos/'+alumnoActual+'/resultados/'+celdaEditando]=null;if(estadoCelda==='ausencia'||estadoCelda==='sincole'){const tipo=estadoCelda==='ausencia'?'ausencias':'sincole';updates['gestorpe/alumnos/'+alumnoActual+'/'+tipo+'/'+celdaEditando]=true;if(contenidoActual){const nuevaProg=reajustarDesde(a,celdaEditando);updates['gestorpe/alumnos/'+alumnoActual+'/programacion']=nuevaProg;}}else{const pId=document.getElementById('selPrograma').value;const oIdx=document.getElementById('selObjetivo').value;const iIdx=document.getElementById('selIndicador').value;if(pId&&oIdx!==''){const nuevoContenido={pId:pId,oIdx:parseInt(oIdx),iIdx:iIdx!==''?parseInt(iIdx):0};if(resultadoCelda==='repetir'){// Primero actualizar la celda actual en el objeto local
                    a.programacion=a.programacion||{};a.programacion[celdaEditando]=nuevoContenido;
                    // Luego insertar repetici√≥n (que desplaza todo)
                    const nuevaProg=insertarRepeticion(a,celdaEditando,nuevoContenido);
                    updates['gestorpe/alumnos/'+alumnoActual+'/programacion']=nuevaProg;}else{updates['gestorpe/alumnos/'+alumnoActual+'/programacion/'+celdaEditando]=nuevoContenido;}}if(resultadoCelda){updates['gestorpe/alumnos/'+alumnoActual+'/resultados/'+celdaEditando]=resultadoCelda;}}db.ref().update(updates).then(()=>{cerrarModal('modalCelda');toast(resultadoCelda==='repetir'?'Repetici√≥n insertada ‚úì':'Guardado ‚úì','success');});}
        function borrarCelda(){const updates={};['programacion','ausencias','sincole','resultados'].forEach(t=>{updates['gestorpe/alumnos/'+alumnoActual+'/'+t+'/'+celdaEditando]=null;});db.ref().update(updates).then(()=>{cerrarModal('modalCelda');toast('Eliminado','success');});}
        function calcStats(a){const aus=a.ausencias||{},res=a.resultados||{};let ausencias=0,conseguidos=0,repetir=0;const dias=a.diasSesion||[1,3,4],porMes={},porTrim={1:{aus:0},2:{aus:0},3:{aus:0}};for(let mi=0;mi<MESES.length;mi++){const m=MESES[mi];porMes[mi]={aus:0};for(let s=1;s<=m.semanas;s++){for(let di=0;di<dias.length;di++){const k=mi+'_'+s+'_'+dias[di];if(aus[k]){ausencias++;porMes[mi].aus++;porTrim[m.trim].aus++;}if(res[k]==='conseguido')conseguidos++;if(res[k]==='repetir')repetir++;}}}return{ausencias:ausencias,conseguidos:conseguidos,repetir:repetir,porMes:porMes,porTrim:porTrim};}

        // EVALUACI√ìN
        function renderEval(){const a=alumnos[alumnoActual];let h='<div class="card"><div class="card-header"><h3 class="card-title">üìä Evaluaci√≥n</h3></div><div class="btn-group no-print" style="margin-bottom:12px"><button class="btn '+(evalTrim===1?'btn-primary':'btn-secondary')+' btn-sm" onclick="setTrim(1)">T1</button><button class="btn '+(evalTrim===2?'btn-primary':'btn-secondary')+' btn-sm" onclick="setTrim(2)">T2</button><button class="btn '+(evalTrim===3?'btn-primary':'btn-secondary')+' btn-sm" onclick="setTrim(3)">T3</button><button class="btn btn-warning btn-sm" onclick="abrirModalInforme()">üìÑ Informe</button>';if(evalTrim<3){h+='<button class="btn btn-ai btn-sm" onclick="pasarNoConseguidos()">üì§ P/N‚ÜíT'+(evalTrim+1)+'</button>';}h+='</div><div class="chart-container no-print"><canvas id="chartProgreso"></canvas></div><div id="evalList"></div></div>';document.getElementById('tabEvaluacion').innerHTML=h;renderEvalList();setTimeout(renderEvalCharts,100);}
        function setTrim(t){evalTrim=t;renderEval();}
        function renderEvalCharts(){const a=alumnos[alumnoActual];if(!a.programas)return;const ctx=document.getElementById('chartProgreso');if(!ctx)return;if(charts.progreso)charts.progreso.destroy();const labels=[],conseguidos=[],proceso=[],noIniciados=[];Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};labels.push(info.nombre.substring(0,12));let c=0,pr=0,n=0;(p.objetivos||[]).forEach((obj,oi)=>{(obj.indicadores||[]).forEach((_,ii)=>{let found=false;for(let t=1;t<=3;t++){const k=pId+'_'+oi+'_'+ii+'_T'+t,e=a.evaluaciones?a.evaluaciones[k]:null;if(e==='C'){c++;found=true;break;}else if(e==='P'){pr++;found=true;break;}else if(e==='N'){n++;found=true;break;}}if(!found)n++;});});conseguidos.push(c);proceso.push(pr);noIniciados.push(n);});charts.progreso=new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'Conseguido',data:conseguidos,backgroundColor:'#22c55e'},{label:'En proceso',data:proceso,backgroundColor:'#3b82f6'},{label:'No iniciado',data:noIniciados,backgroundColor:'#d1d5db'}]},options:{responsive:true,plugins:{legend:{position:'bottom'}},scales:{x:{stacked:true},y:{stacked:true}}}});}
        function renderEvalList(){const a=alumnos[alumnoActual],c=document.getElementById('evalList');let h='',hay=false;if(!a.programas){c.innerHTML='<p style="text-align:center;color:var(--text-light)">Sin programas</p>';return;}const pasadosAqui=getIndicadoresPasados(a,evalTrim);Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{icon:'üìÑ',nombre:p.tipo,color:'#666'};const objsT=(p.objetivos||[]).filter(o=>o.trimestre===evalTrim);const pasadosProg=pasadosAqui.filter(x=>x.pId===pId);if(!objsT.length&&!pasadosProg.length)return;hay=true;h+='<div class="programa-card" style="border-left-color:'+info.color+'"><div class="programa-titulo" style="margin-bottom:8px">'+info.icon+' '+info.nombre+'</div>';objsT.forEach(obj=>{const oi=p.objetivos.indexOf(obj);h+='<div style="margin-bottom:8px"><div style="font-weight:600;font-size:.8rem;margin-bottom:4px">O'+obj.numero+': '+obj.descripcion.substring(0,30)+'...</div>';(obj.indicadores||[]).forEach((ind,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';h+='<div class="eval-item"><span class="eval-text">'+ind+'</span><button class="eval-btn c '+(e==='C'?'active':'')+'" onclick="setEval(\''+pId+'\','+oi+','+ii+',\'C\')">‚úì</button><button class="eval-btn p '+(e==='P'?'active':'')+'" onclick="setEval(\''+pId+'\','+oi+','+ii+',\'P\')">‚óê</button><button class="eval-btn n '+(e==='N'?'active':'')+'" onclick="setEval(\''+pId+'\','+oi+','+ii+',\'N\')">‚óã</button></div>';});h+='</div>';});if(pasadosProg.length){h+='<div style="margin-top:8px;padding-top:8px;border-top:1px dashed var(--border)"><div style="font-size:.75rem;color:var(--warning);margin-bottom:6px">üì§ Pasados:</div>';pasadosProg.forEach(item=>{const obj=p.objetivos[item.oIdx];if(!obj)return;const ind=obj.indicadores?obj.indicadores[item.iIdx]:'';const k=pId+'_'+item.oIdx+'_'+item.iIdx+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';h+='<div class="eval-item"><span class="eval-text">O'+obj.numero+': '+ind+'<span class="pasado-badge">T'+(evalTrim-1)+'</span></span><button class="eval-btn c '+(e==='C'?'active':'')+'" onclick="setEval(\''+pId+'\','+item.oIdx+','+item.iIdx+',\'C\')">‚úì</button><button class="eval-btn p '+(e==='P'?'active':'')+'" onclick="setEval(\''+pId+'\','+item.oIdx+','+item.iIdx+',\'P\')">‚óê</button><button class="eval-btn n '+(e==='N'?'active':'')+'" onclick="setEval(\''+pId+'\','+item.oIdx+','+item.iIdx+',\'N\')">‚óã</button></div>';});h+='</div>';}h+='</div>';});c.innerHTML=hay?h:'<p style="text-align:center;color:var(--text-light)">Sin indicadores en T'+evalTrim+'</p>';}
        function setEval(pId,oi,ii,e){const a=alumnos[alumnoActual],k=pId+'_'+oi+'_'+ii+'_T'+evalTrim;a.evaluaciones=a.evaluaciones||{};if(a.evaluaciones[k]===e){db.ref('gestorpe/alumnos/'+alumnoActual+'/evaluaciones/'+k).remove();delete a.evaluaciones[k];}else{db.ref('gestorpe/alumnos/'+alumnoActual+'/evaluaciones/'+k).set(e);a.evaluaciones[k]=e;}renderEvalList();setTimeout(renderEvalCharts,100);}
        function pasarNoConseguidos(){if(evalTrim>=3)return;const a=alumnos[alumnoActual];if(!a.programas)return;const siguienteTrim=evalTrim+1,updates={};let count=0;Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId];(p.objetivos||[]).forEach((obj,oi)=>{if(obj.trimestre!==evalTrim)return;(obj.indicadores||[]).forEach((_,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';if(e!=='C'){const pasadoKey=pId+'_'+oi+'_'+ii;updates['gestorpe/alumnos/'+alumnoActual+'/pasados/'+pasadoKey]=siguienteTrim;count++;}});});});const pasadosActuales=getIndicadoresPasados(a,evalTrim);pasadosActuales.forEach(item=>{const k=item.pId+'_'+item.oIdx+'_'+item.iIdx+'_T'+evalTrim,e=a.evaluaciones?a.evaluaciones[k]:'';if(e!=='C'){updates['gestorpe/alumnos/'+alumnoActual+'/pasados/'+item.key]=siguienteTrim;count++;}});if(count===0){toast('¬°Todo conseguido!','success');return;}db.ref().update(updates).then(()=>{const nueva=generarProgramacion(alumnos[alumnoActual]);return db.ref('gestorpe/alumnos/'+alumnoActual+'/programacion').set(nueva);}).then(()=>{toast(count+' ‚Üí T'+siguienteTrim,'success');evalTrim=siguienteTrim;renderEval();renderProg();});}

        // RESUMEN
        function renderAsis(){const a=alumnos[alumnoActual],st=calcStats(a);let totalC=0,totalP=0,totalN=0;if(a.evaluaciones){Object.keys(a.evaluaciones).forEach(k=>{const e=a.evaluaciones[k];if(e==='C')totalC++;else if(e==='P')totalP++;else if(e==='N')totalN++;});}document.getElementById('tabAsistencia').innerHTML='<div class="card"><div class="card-header"><h3 class="card-title">üìà Resumen</h3></div><div class="stats-box"><div class="stat-item"><div class="stat-num" style="color:var(--danger)">'+st.ausencias+'</div><div class="stat-label">Ausencias</div></div><div class="stat-item"><div class="stat-num" style="color:var(--success)">'+st.conseguidos+'</div><div class="stat-label">Sesiones OK</div></div><div class="stat-item"><div class="stat-num" style="color:var(--warning)">'+st.repetir+'</div><div class="stat-label">Repetir</div></div></div><div class="stats-box"><div class="stat-item"><div class="stat-num" style="color:var(--success)">'+totalC+'</div><div class="stat-label">Conseguidos</div></div><div class="stat-item"><div class="stat-num" style="color:var(--proceso)">'+totalP+'</div><div class="stat-label">En proceso</div></div><div class="stat-item"><div class="stat-num" style="color:gray">'+totalN+'</div><div class="stat-label">No iniciados</div></div></div><div class="chart-container"><canvas id="chartAusTrim"></canvas></div></div>';setTimeout(renderAsisCharts,100);}
        function renderAsisCharts(){const a=alumnos[alumnoActual],st=calcStats(a);const ctx1=document.getElementById('chartAusTrim');if(ctx1){if(charts.ausTrim)charts.ausTrim.destroy();charts.ausTrim=new Chart(ctx1,{type:'bar',data:{labels:['T1','T2','T3'],datasets:[{label:'Ausencias',data:[st.porTrim[1].aus,st.porTrim[2].aus,st.porTrim[3].aus],backgroundColor:'#ef4444'}]},options:{responsive:true,plugins:{legend:{display:false},title:{display:true,text:'Ausencias por trimestre'}}}});}}

        // S√âNECA
        function renderSeneca(){
            const a=alumnos[alumnoActual];
            let h='<div class="card"><div class="card-header"><h3 class="card-title">üèõÔ∏è Exportar a S√©neca</h3></div>';
            h+='<div class="seneca-info">‚ÑπÔ∏è Esta secci√≥n organiza los datos del programa espec√≠fico para copiarlos f√°cilmente a S√©neca. Usa los botones de copiar para trasladar cada parte.</div>';
            
            if(!a.programas||!Object.keys(a.programas).length){
                h+='<div class="empty-state">Sin programas creados</div></div>';
                document.getElementById('tabSeneca').innerHTML=h;
                return;
            }
            
            let progNum=1;
            Object.keys(a.programas).forEach(pId=>{
                const p=a.programas[pId];
                const info=AREAS[p.tipo]||{icon:'üìÑ',nombre:p.tipo};
                const nombrePrograma='PROGRAMA ESPEC√çFICO PARA EL DESARROLLO '+info.nombre.toUpperCase();
                
                h+='<div class="seneca-programa">';
                h+='<div class="seneca-programa-header">';
                h+='<span class="seneca-programa-titulo">'+info.icon+' Programa '+progNum+': '+info.nombre+'</span>';
                h+='</div>';
                
                // Nombre del programa
                h+='<div class="seneca-seccion">';
                h+='<div class="seneca-seccion-header">';
                h+='<span class="seneca-seccion-titulo">üìã Nombre del Programa</span>';
                h+='<button class="btn-copiar" onclick="copiarSeneca(this,\''+nombrePrograma+'\')">üìã Copiar</button>';
                h+='</div>';
                h+='<div class="seneca-contenido">'+nombrePrograma+'</div>';
                h+='</div>';
                
                // Agrupar objetivos similares
                const objetivosAgrupados=agruparObjetivos(p.objetivos||[]);
                
                objetivosAgrupados.forEach((objAgrupado,idx)=>{
                    h+='<div class="seneca-objetivo">';
                    h+='<div class="seneca-objetivo-header">';
                    h+='<span class="seneca-objetivo-titulo">üéØ Objetivo '+(idx+1)+'</span>';
                    h+='</div>';
                    
                    // Definici√≥n del objetivo
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">Definici√≥n del objetivo</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(objAgrupado.descripcion)+'`)">üìã Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+objAgrupado.descripcion+'</div>';
                    h+='</div>';
                    
                    // Indicadores - cada uno con su bot√≥n de copiar
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">üìä Indicadores</span>';
                    h+='</div>';
                    h+='<div class="seneca-indicadores-lista">';
                    objAgrupado.indicadores.forEach((ind,i)=>{
                        h+='<div class="seneca-indicador-item">';
                        h+='<span class="seneca-indicador-num">'+(i+1)+'</span>';
                        h+='<span class="seneca-indicador-texto">'+ind+'</span>';
                        h+='<button class="btn-copiar btn-copiar-sm" onclick="copiarSeneca(this,\''+escaparTexto(ind)+'\')">üìã</button>';
                        h+='</div>';
                    });
                    h+='</div>';
                    h+='</div>';
                    
                    // Contenidos
                    const contenidos=generarContenidos(objAgrupado,p.tipo);
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">üìö Contenidos</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(contenidos)+'`)">üìã Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+contenidos+'</div>';
                    h+='</div>';
                    
                    // Actividades
                    const actividades=generarActividades(objAgrupado,p.tipo);
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">üéÆ Actividades</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(actividades)+'`)">üìã Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+actividades+'</div>';
                    h+='</div>';
                    
                    // Competencias
                    const competencias=generarCompetencias(p.tipo);
                    h+='<div class="seneca-seccion">';
                    h+='<div class="seneca-seccion-header">';
                    h+='<span class="seneca-seccion-titulo">üèÜ Competencias</span>';
                    h+='<button class="btn-copiar" onclick="copiarSeneca(this,`'+escaparTexto(competencias)+'`)">üìã Copiar</button>';
                    h+='</div>';
                    h+='<div class="seneca-contenido">'+competencias+'</div>';
                    h+='</div>';
                    
                    h+='</div>'; // cierre seneca-objetivo
                });
                
                h+='</div>'; // cierre seneca-programa
                progNum++;
            });
            
            h+='</div>'; // cierre card
            document.getElementById('tabSeneca').innerHTML=h;
        }
        
        function agruparObjetivos(objetivos){
            if(!objetivos.length)return[];
            
            // M√≠nimo 3 objetivos, m√°ximo 6
            const MIN_OBJETIVOS=3;
            const MAX_OBJETIVOS=6;
            
            // Si hay 3 o menos objetivos, no agrupar
            if(objetivos.length<=MIN_OBJETIVOS){
                return objetivos.map(obj=>({
                    descripcion:obj.descripcion,
                    indicadores:[...(obj.indicadores||[])],
                    trimestres:[obj.trimestre]
                }));
            }
            
            // Agrupar por trimestre primero
            const porTrimestre={1:[],2:[],3:[]};
            objetivos.forEach(obj=>{
                const t=obj.trimestre||1;
                porTrimestre[t].push(obj);
            });
            
            const grupos=[];
            
            // Para cada trimestre, crear 1-2 objetivos agrupados
            [1,2,3].forEach(trim=>{
                const objsTrim=porTrimestre[trim];
                if(!objsTrim.length)return;
                
                if(objsTrim.length<=2){
                    // Pocos objetivos en este trimestre, crear uno por cada uno
                    objsTrim.forEach(obj=>{
                        grupos.push({
                            descripcion:obj.descripcion,
                            indicadores:[...(obj.indicadores||[])],
                            trimestres:[trim]
                        });
                    });
                }else if(objsTrim.length<=4){
                    // 3-4 objetivos: crear 2 grupos
                    const mitad=Math.ceil(objsTrim.length/2);
                    const grupo1=objsTrim.slice(0,mitad);
                    const grupo2=objsTrim.slice(mitad);
                    
                    grupos.push(crearGrupoObjetivos(grupo1,trim));
                    grupos.push(crearGrupoObjetivos(grupo2,trim));
                }else{
                    // 5+ objetivos: crear 2 grupos
                    const tercio=Math.ceil(objsTrim.length/2);
                    const grupo1=objsTrim.slice(0,tercio);
                    const grupo2=objsTrim.slice(tercio);
                    
                    grupos.push(crearGrupoObjetivos(grupo1,trim));
                    grupos.push(crearGrupoObjetivos(grupo2,trim));
                }
            });
            
            // Asegurar m√≠nimo 3 objetivos
            if(grupos.length<MIN_OBJETIVOS){
                // Si hay menos de 3, desagrupar hasta tener 3
                const resultado=[];
                for(let i=0;i<grupos.length&&resultado.length<MIN_OBJETIVOS;i++){
                    resultado.push(grupos[i]);
                }
                // A√±adir objetivos individuales si a√∫n faltan
                let idx=0;
                while(resultado.length<MIN_OBJETIVOS&&idx<objetivos.length){
                    const obj=objetivos[idx];
                    const yaIncluido=resultado.some(g=>g.descripcion.includes(obj.descripcion.split(' ')[0]));
                    if(!yaIncluido){
                        resultado.push({
                            descripcion:obj.descripcion,
                            indicadores:[...(obj.indicadores||[])],
                            trimestres:[obj.trimestre]
                        });
                    }
                    idx++;
                }
                return resultado;
            }
            
            // Asegurar m√°ximo 6 objetivos
            if(grupos.length>MAX_OBJETIVOS){
                return grupos.slice(0,MAX_OBJETIVOS);
            }
            
            return grupos;
        }
        
        function crearGrupoObjetivos(objs,trimestre){
            if(objs.length===1){
                return{
                    descripcion:objs[0].descripcion,
                    indicadores:[...(objs[0].indicadores||[])],
                    trimestres:[trimestre]
                };
            }
            
            // Combinar descripciones de forma inteligente
            const verbos=[];
            const temas=[];
            objs.forEach(obj=>{
                const palabras=obj.descripcion.split(' ');
                const verbo=palabras[0];
                const tema=palabras.slice(1).join(' ');
                if(!verbos.includes(verbo))verbos.push(verbo);
                temas.push(tema);
            });
            
            // Crear descripci√≥n combinada
            let descripcion='';
            if(verbos.length===1){
                descripcion=verbos[0]+' '+temas.join(', ');
            }else{
                descripcion=objs.map(o=>o.descripcion).join('; ');
            }
            
            // Combinar todos los indicadores (sin duplicados)
            const todosIndicadores=objs.flatMap(o=>o.indicadores||[]);
            const indicadoresUnicos=[...new Set(todosIndicadores)];
            
            return{
                descripcion:descripcion,
                indicadores:indicadoresUnicos,
                trimestres:[trimestre]
            };
        }
        
        function generarContenidos(objAgrupado,tipo){
            const contenidosBase={
                'comunicativo':['Vocabulario funcional y expresivo','Estructuras gramaticales b√°sicas','Habilidades pragm√°ticas del lenguaje','Comprensi√≥n y expresi√≥n oral','Conciencia fonol√≥gica'],
                'cognitivo':['Atenci√≥n y concentraci√≥n','Memoria de trabajo','Razonamiento l√≥gico-matem√°tico','Resoluci√≥n de problemas','Funciones ejecutivas'],
                'psicomotor':['Esquema corporal','Coordinaci√≥n din√°mica general','Equilibrio y control postural','Orientaci√≥n espacial y temporal','Lateralidad'],
                'motor':['Motricidad fina','Coordinaci√≥n √≥culo-manual','Grafomotricidad','Manipulaci√≥n de objetos','Precisi√≥n y destreza manual'],
                'social':['Habilidades sociales b√°sicas','Regulaci√≥n emocional','Interacci√≥n con iguales','Normas de convivencia','Empat√≠a y asertividad'],
                'autonomia':['H√°bitos de autonom√≠a personal','Autocuidado e higiene','Organizaci√≥n y planificaci√≥n','Responsabilidad en tareas','Independencia funcional']
            };
            
            const base=contenidosBase[tipo]||['Contenidos espec√≠ficos del √°rea','Habilidades funcionales','Generalizaci√≥n de aprendizajes'];
            
            // Personalizar seg√∫n indicadores
            const palabrasClave=objAgrupado.indicadores.join(' ').toLowerCase();
            let contenidos=[...base];
            
            if(palabrasClave.includes('vocabulario')||palabrasClave.includes('palabra'))contenidos.push('Ampliaci√≥n del l√©xico');
            if(palabrasClave.includes('comprens'))contenidos.push('Comprensi√≥n de instrucciones');
            if(palabrasClave.includes('escrib')||palabrasClave.includes('lectura'))contenidos.push('Iniciaci√≥n a la lectoescritura');
            if(palabrasClave.includes('n√∫mero')||palabrasClave.includes('contar'))contenidos.push('Conceptos num√©ricos b√°sicos');
            if(palabrasClave.includes('atenci√≥n'))contenidos.push('Estrategias atencionales');
            
            return contenidos.slice(0,5).map((c,i)=>(i+1)+'. '+c).join('\n');
        }
        
        function generarActividades(objAgrupado,tipo){
            const actividadesBase={
                'comunicativo':['Juegos de denominaci√≥n y descripci√≥n de im√°genes','Actividades de comprensi√≥n de √≥rdenes y narraciones','Ejercicios de conciencia fonol√≥gica (rimas, segmentaci√≥n)','Di√°logos guiados y role-playing comunicativo'],
                'cognitivo':['Actividades de atenci√≥n visual y auditiva','Juegos de memoria y secuenciaci√≥n','Resoluci√≥n de problemas manipulativos','Tareas de clasificaci√≥n y seriaci√≥n'],
                'psicomotor':['Circuitos motrices y juegos de movimiento','Actividades de equilibrio y coordinaci√≥n','Ejercicios de esquema corporal','Juegos de orientaci√≥n espacial'],
                'motor':['Actividades de recorte, picado y pegado','Ejercicios de grafomotricidad','Manipulaci√≥n de plastilina y materiales','Juegos de ensartado y encaje'],
                'social':['Role-playing de situaciones sociales','Juegos cooperativos en peque√±o grupo','Actividades de identificaci√≥n emocional','Din√°micas de turnos y normas'],
                'autonomia':['Rutinas de autocuidado guiadas','Tareas de organizaci√≥n del material','Actividades de responsabilidad','Secuencias de autonom√≠a personal']
            };
            
            return(actividadesBase[tipo]||['Actividades manipulativas','Juegos estructurados','Tareas funcionales','Generalizaci√≥n en contextos naturales']).slice(0,4).map((a,i)=>(i+1)+'. '+a).join('\n');
        }
        
        function generarCompetencias(tipo){
            const competenciasMap={
                'comunicativo':'CCL (Competencia en Comunicaci√≥n Ling√º√≠stica)',
                'cognitivo':'STEM (Competencia Matem√°tica y en Ciencia, Tecnolog√≠a e Ingenier√≠a)',
                'psicomotor':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)',
                'motor':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)',
                'social':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)\nCC (Competencia Ciudadana)',
                'autonomia':'CPSAA (Competencia Personal, Social y de Aprender a Aprender)'
            };
            return competenciasMap[tipo]||'CPSAA (Competencia Personal, Social y de Aprender a Aprender)';
        }
        
        function escaparTexto(texto){
            return texto.replace(/`/g,"'").replace(/\\/g,'\\\\').replace(/\n/g,'\\n');
        }
        
        function copiarSeneca(btn,texto){
            const textoReal=texto.replace(/\\n/g,'\n');
            navigator.clipboard.writeText(textoReal).then(()=>{
                const textoOriginal=btn.innerHTML;
                btn.innerHTML='‚úì Copiado';
                btn.classList.add('copiado');
                setTimeout(()=>{
                    btn.innerHTML=textoOriginal;
                    btn.classList.remove('copiado');
                },1500);
            }).catch(()=>{
                toast('Error al copiar','error');
            });
        }

        // INFORMES
        function abrirModalInforme(){document.getElementById('informeTrim').value=evalTrim;document.getElementById('informePeriodo').value='trimestral';document.getElementById('grupoMes').style.display='none';document.getElementById('informePreview').style.display='none';document.getElementById('btnImprimirInforme').style.display='none';informeData=null;
            // Configurar selector de periodo
            document.getElementById('informePeriodo').onchange=function(){
                const esMensual=this.value==='mensual';
                document.getElementById('grupoMes').style.display=esMensual?'block':'none';
                if(esMensual){
                    const trim=parseInt(document.getElementById('informeTrim').value);
                    const mesesTrim=MESES.map((m,i)=>({idx:i,...m})).filter(m=>m.trim===trim);
                    const sel=document.getElementById('informeMes');
                    sel.innerHTML=mesesTrim.map(m=>'<option value="'+m.idx+'">'+m.nombre+'</option>').join('');
                }
            };
            document.getElementById('informeTrim').onchange=function(){
                if(document.getElementById('informePeriodo').value==='mensual'){
                    document.getElementById('informePeriodo').onchange();
                }
            };
            abrirModal('modalInforme');}
        function generarInforme(){const trim=parseInt(document.getElementById('informeTrim').value),a=alumnos[alumnoActual],st=calcStats(a);const conseguidos=[],proceso=[],noIniciados=[];if(a.programas){Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};(p.objetivos||[]).forEach((obj,oi)=>{(obj.indicadores||[]).forEach((ind,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+trim,e=a.evaluaciones?a.evaluaciones[k]:null,item={programa:info.nombre,objetivo:'O'+obj.numero,indicador:ind};if(e==='C')conseguidos.push(item);else if(e==='P')proceso.push(item);else noIniciados.push(item);});});});}informeData={alumno:a,trim:trim,conseguidos:conseguidos,proceso:proceso,noIniciados:noIniciados,ausencias:st.porTrim[trim]?st.porTrim[trim].aus:0};const total=conseguidos.length+proceso.length+noIniciados.length,porcC=total?Math.round(conseguidos.length/total*100):0;document.getElementById('informePreview').innerHTML='<h4>T'+trim+' - '+a.siglas+'</h4><p>‚úÖ '+conseguidos.length+' ('+porcC+'%) | üîÑ '+proceso.length+' | ‚≠ï '+noIniciados.length+' | ‚ùå '+informeData.ausencias+' aus.</p>';document.getElementById('informePreview').style.display='block';document.getElementById('btnImprimirInforme').style.display='inline-flex';toast('Generado','success');}
        function abrirChatGPTInforme(tipo){
            const trim=parseInt(document.getElementById('informeTrim').value);
            const periodo=document.getElementById('informePeriodo').value;
            const a=alumnos[alumnoActual],st=calcStats(a);
            
            // Recopilar datos
            const conseguidos=[],proceso=[],noIniciados=[];
            if(a.programas){Object.keys(a.programas).forEach(pId=>{const p=a.programas[pId],info=AREAS[p.tipo]||{nombre:p.tipo};(p.objetivos||[]).forEach((obj,oi)=>{(obj.indicadores||[]).forEach((ind,ii)=>{const k=pId+'_'+oi+'_'+ii+'_T'+trim,e=a.evaluaciones?a.evaluaciones[k]:null,item=info.nombre+': '+ind;if(e==='C')conseguidos.push(item);else if(e==='P')proceso.push(item);else noIniciados.push(item);});});});}
            
            let prompt='';
            const periodoTexto=periodo==='mensual'?'MES: '+MESES[document.getElementById('informeMes').value].nombre:'TRIMESTRE: '+trim;
            const datosBase='ALUMNO: '+a.siglas+' ('+a.curso+')\n'+periodoTexto+'\n\nCONSEGUIDOS ('+conseguidos.length+'):\n'+(conseguidos.slice(0,10).join('\n')||'Ninguno')+'\n\nEN PROCESO ('+proceso.length+'):\n'+(proceso.slice(0,10).join('\n')||'Ninguno')+'\n\nAUSENCIAS: '+(st.porTrim[trim]?st.porTrim[trim].aus:0);
            
            if(tipo==='pt'){
                prompt='Valoraci√≥n PT para informe.\n\n'+datosBase+'\n\nEscribe 2-3 p√°rrafos profesionales para el informe de PT.';
            }else if(tipo==='familia'){
                prompt='Informe para FAMILIAS de alumno con necesidades educativas especiales.\n\n'+datosBase+'\n\nREQUISITOS:\n- Lenguaje cercano y positivo, evita tecnicismos\n- Destaca logros y avances del alumno\n- Incluye orientaciones pr√°cticas para trabajar en casa\n- Tono motivador y esperanzador\n- 3-4 p√°rrafos\n\nEscribe el informe para entregar a la familia.';
            }else if(tipo==='tutor'){
                prompt='Informe para el TUTOR/A sobre alumno con necesidades educativas especiales.\n\n'+datosBase+'\n\nREQUISITOS:\n- Lenguaje t√©cnico-pedag√≥gico\n- Resumen de objetivos trabajados y grado de consecuci√≥n\n- Orientaciones para la coordinaci√≥n en el aula ordinaria\n- Propuestas de adaptaci√≥n metodol√≥gica\n- Recomendaciones para reforzar en clase\n- 3-4 p√°rrafos\n\nEscribe el informe de coordinaci√≥n con el tutor/a.';
            }
            
            navigator.clipboard.writeText(prompt).then(()=>{toast('Copiado para ChatGPT','success');window.open('https://chat.openai.com/','_blank');});
        }
        function imprimirInforme(){if(!informeData)return;const a=informeData.alumno,win=window.open('','_blank');win.document.write('<!DOCTYPE html><html><head><title>Informe</title><style>body{font-family:Arial;padding:30px;max-width:800px;margin:0 auto}h1{color:#1a5f4a}h2{margin-top:20px}.indicador{margin:5px 0 5px 20px}</style></head><body><h1>INFORME T'+informeData.trim+' - '+a.siglas+'</h1><p>Curso: '+a.curso+' | Fecha: '+new Date().toLocaleDateString('es-ES')+'</p><h2>‚úÖ Conseguidos ('+informeData.conseguidos.length+')</h2>'+(informeData.conseguidos.map(x=>'<p class="indicador">‚Ä¢ '+x.programa+': '+x.indicador+'</p>').join('')||'<p>Ninguno</p>')+'<h2>üîÑ En Proceso ('+informeData.proceso.length+')</h2>'+(informeData.proceso.map(x=>'<p class="indicador">‚Ä¢ '+x.programa+': '+x.indicador+'</p>').join('')||'<p>Ninguno</p>')+'<h2>‚≠ï No Iniciados ('+informeData.noIniciados.length+')</h2>'+(informeData.noIniciados.map(x=>'<p class="indicador">‚Ä¢ '+x.programa+': '+x.indicador+'</p>').join('')||'<p>Ninguno</p>')+'<p style="margin-top:40px">Fdo: _______________</p></body></html>');win.document.close();setTimeout(()=>{win.print();},300);}

        // IMPRESI√ìN MASIVA
        function abrirModalImprimir(){if(!Object.keys(alumnos).length){toast('No hay alumnos','error');return;}abrirModal('modalImprimir');}
        function imprimirTodos(){const mesSeleccionado=parseInt(document.getElementById('printMes').value);const ids=Object.keys(alumnos);let html='<!DOCTYPE html><html><head><title>Programaciones</title><style>body{font-family:Arial;padding:20px;font-size:11px}h1{color:#1a5f4a;font-size:16px}h2{font-size:14px;border-bottom:2px solid #1a5f4a}table{width:100%;border-collapse:collapse;margin-bottom:15px}th,td{border:1px solid #ccc;padding:6px}th{background:#1a5f4a;color:#fff}td:first-child{background:#2d8a6e;color:#fff;text-align:center;width:50px}.page-break{page-break-after:always}</style></head><body>';ids.forEach((id,idx)=>{const a=alumnos[id],dias=a.diasSesion||[1,3,4];html+='<div'+(idx<ids.length-1?' class="page-break"':'')+'><h1>'+a.siglas+' - '+a.curso+'</h1>';const mesesAImprimir=mesSeleccionado===-1?MESES.map((_,i)=>i):[mesSeleccionado];mesesAImprimir.forEach(mi=>{const mes=MESES[mi];html+='<h2>'+mes.nombre+' (T'+mes.trim+')</h2><table><tr><th>S</th>';dias.forEach(d=>{html+='<th>'+DIAS_C[d]+'</th>';});html+='</tr>';for(let s=1;s<=mes.semanas;s++){html+='<tr><td>'+s+'</td>';dias.forEach(d=>{const k=mi+'_'+s+'_'+d,c=a.programacion?a.programacion[k]:null;if(c&&a.programas&&a.programas[c.pId]){const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;if(obj){const ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';html+='<td><b>O'+obj.numero+'</b><br>'+ind.substring(0,20)+'</td>';}else{html+='<td>-</td>';}}else{html+='<td>-</td>';}});html+='</tr>';}html+='</table>';});html+='</div>';});html+='</body></html>';const win=window.open('','_blank');win.document.write(html);win.document.close();setTimeout(()=>{win.print();},500);cerrarModal('modalImprimir');}

        function generarWord(){
            const mesSeleccionado=parseInt(document.getElementById('printMes').value);
            const ids=Object.keys(alumnos);
            if(!ids.length){toast('No hay alumnos','error');return;}

            const {Document,Packer,Paragraph,TextRun,Table,TableRow,TableCell,
                   Header,Footer,AlignmentType,BorderStyle,WidthType,
                   ShadingType,VerticalAlign,PageNumber,PageBreak}=docx;

            const ACCENT='1a5f4a', LIGHT_ACCENT='e8f5f1', LIGHT_GRAY='f8f9fa', WHITE='ffffff';
            const PAGE_W=11906,ML=1134,MR=1134,CW=PAGE_W-ML-MR;
            const brd={style:BorderStyle.SINGLE,size:1,color:'d0d0d0'};
            const brds={top:brd,bottom:brd,left:brd,right:brd};

            function hCell(t,w){return new TableCell({width:{size:w,type:WidthType.DXA},borders:brds,shading:{fill:ACCENT,type:ShadingType.CLEAR},verticalAlign:VerticalAlign.CENTER,margins:{top:50,bottom:50,left:80,right:80},children:[new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:0},children:[new TextRun({text:t,bold:true,color:WHITE,font:'Arial',size:18})]})]})}
            function dCell(t,w,alt){return new TableCell({width:{size:w,type:WidthType.DXA},borders:brds,shading:alt?{fill:LIGHT_GRAY,type:ShadingType.CLEAR}:undefined,verticalAlign:VerticalAlign.CENTER,margins:{top:40,bottom:40,left:80,right:80},children:[new Paragraph({spacing:{before:0,after:0},children:[new TextRun({text:t,font:'Arial',size:17})]})]})}
            function nCell(n,w,alt){return new TableCell({width:{size:w,type:WidthType.DXA},borders:brds,shading:alt?{fill:LIGHT_GRAY,type:ShadingType.CLEAR}:{fill:LIGHT_ACCENT,type:ShadingType.CLEAR},verticalAlign:VerticalAlign.CENTER,margins:{top:40,bottom:40,left:80,right:80},children:[new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:0},children:[new TextRun({text:String(n),bold:true,color:ACCENT,font:'Arial',size:17})]})]})}
            function secTitle(t){return new Paragraph({spacing:{before:240,after:30},children:[new TextRun({text:t,bold:true,font:'Arial',size:22,color:ACCENT})]})}
            function secSub(t){return new Paragraph({spacing:{before:20,after:60},border:{bottom:{style:BorderStyle.SINGLE,size:1,color:ACCENT}},children:[new TextRun({text:t,bold:true,font:'Arial',size:18,color:'555555'})]})}

            // --- SECTION 1: PROGRAMACIONES ---
            const children=[];
            let tituloMes='Todo el curso';
            if(mesSeleccionado!==-1) tituloMes=MESES[mesSeleccionado].nombre+' (T'+MESES[mesSeleccionado].trim+')';

            children.push(new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:40},children:[new TextRun({text:'Programaciones',bold:true,font:'Arial',size:32,color:ACCENT})]}));
            children.push(new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:140},children:[new TextRun({text:tituloMes,font:'Arial',size:22,color:'888888'})]}));
            children.push(new Paragraph({spacing:{before:0,after:140},border:{bottom:{style:BorderStyle.SINGLE,size:2,color:ACCENT}},children:[]}));

            ids.forEach(id=>{
                const a=alumnos[id],dias=a.diasSesion||[1,3,4];
                const mesesAImprimir=mesSeleccionado===-1?MESES.map((_,i)=>i):[mesSeleccionado];

                children.push(secTitle(a.siglas+' - '+a.curso));

                mesesAImprimir.forEach(mi=>{
                    const mes=MESES[mi];
                    if(mesSeleccionado===-1) children.push(secSub(mes.nombre+' (T'+mes.trim+')'));

                    const sW=700;const colW=Math.floor((CW-sW)/dias.length);
                    const lastW=CW-sW-colW*(dias.length-1);
                    const colWidths=[sW,...dias.map((_,i)=>i<dias.length-1?colW:lastW)];

                    const headerRow=new TableRow({children:[hCell('S',sW),...dias.map((d,i)=>hCell(DIAS_C[d],colWidths[i+1]))]});
                    const dataRows=[];
                    for(let s=1;s<=mes.semanas;s++){
                        const alt=s%2===0;
                        const cells=[nCell(s,sW,alt)];
                        dias.forEach((d,i)=>{
                            const k=mi+'_'+s+'_'+d,c=a.programacion?a.programacion[k]:null;
                            let txt='-';
                            if(c&&a.programas&&a.programas[c.pId]){
                                const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;
                                if(obj){const ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';txt='O'+obj.numero+' '+ind.substring(0,22);}
                            }
                            cells.push(dCell(txt,colWidths[i+1],alt));
                        });
                        dataRows.push(new TableRow({children:cells}));
                    }
                    children.push(new Table({width:{size:CW,type:WidthType.DXA},columnWidths:colWidths,rows:[headerRow,...dataRows]}));
                });
            });

            // --- SECTION 2: INDICADORES PARA VALORAR ---
            children.push(new Paragraph({pageBreakBefore:true,alignment:AlignmentType.CENTER,spacing:{before:0,after:40},children:[new TextRun({text:'Valoraci\u00F3n de Indicadores',bold:true,font:'Arial',size:32,color:ACCENT})]}));
            children.push(new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:140},children:[new TextRun({text:tituloMes,font:'Arial',size:22,color:'888888'})]}));
            children.push(new Paragraph({spacing:{before:0,after:100},border:{bottom:{style:BorderStyle.SINGLE,size:2,color:ACCENT}},children:[]}));

            ids.forEach(id=>{
                const a=alumnos[id],dias=a.diasSesion||[1,3,4];
                const mesesAImprimir=mesSeleccionado===-1?MESES.map((_,i)=>i):[mesSeleccionado];

                // Collect unique indicators used in the selected month(s)
                const indicadoresUsados=new Map(); // key => {obj, ind, pId, oIdx, iIdx, area}
                mesesAImprimir.forEach(mi=>{
                    const mes=MESES[mi];
                    for(let s=1;s<=mes.semanas;s++){
                        dias.forEach(d=>{
                            const k=mi+'_'+s+'_'+d,c=a.programacion?a.programacion[k]:null;
                            if(c&&a.programas&&a.programas[c.pId]){
                                const p=a.programas[c.pId],obj=p.objetivos?p.objetivos[c.oIdx]:null;
                                if(obj){
                                    const ind=obj.indicadores?(obj.indicadores[c.iIdx]||''):'';
                                    const uKey=c.pId+'_'+c.oIdx+'_'+c.iIdx;
                                    if(!indicadoresUsados.has(uKey)){
                                        const info=AREAS[p.tipo]||{nombre:p.tipo};
                                        // Check current eval for the trimestre of this month
                                        const trim=MESES[mi].trim;
                                        const eKey=c.pId+'_'+c.oIdx+'_'+c.iIdx+'_T'+trim;
                                        const ev=a.evaluaciones?a.evaluaciones[eKey]:null;
                                        indicadoresUsados.set(uKey,{objNum:obj.numero,indicador:ind,area:info.nombre,eval:ev});
                                    }
                                }
                            }
                        });
                    }
                });

                if(!indicadoresUsados.size) return;

                children.push(secTitle(a.siglas+' - '+a.curso));

                // Table: Obj | Indicador | C | EP | NI
                const wObj=700,wC=600,wEP=600,wNI=600;
                const wInd=CW-wObj-wC-wEP-wNI;
                const evalColWidths=[wObj,wInd,wC,wEP,wNI];

                const evalHeader=new TableRow({children:[
                    hCell('Obj',wObj),hCell('Indicador',wInd),
                    hCell('C',wC),hCell('EP',wEP),hCell('NI',wNI)
                ]});

                const evalRows=[];let ri=0;
                indicadoresUsados.forEach((v)=>{
                    const alt=ri%2===1;
                    // Mark with symbol if already evaluated
                    const cMark=v.eval==='C'?'\u2713':'';
                    const epMark=v.eval==='P'?'\u2713':'';
                    const niMark=v.eval==='N'?'\u2713':'';
                    evalRows.push(new TableRow({children:[
                        nCell('O'+v.objNum,wObj,alt),
                        dCell(v.indicador,wInd,alt),
                        new TableCell({width:{size:wC,type:WidthType.DXA},borders:brds,shading:alt?{fill:LIGHT_GRAY,type:ShadingType.CLEAR}:undefined,verticalAlign:VerticalAlign.CENTER,margins:{top:40,bottom:40,left:40,right:40},children:[new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:0},children:[new TextRun({text:cMark,font:'Arial',size:17,color:'22c55e'})]})]}),
                        new TableCell({width:{size:wEP,type:WidthType.DXA},borders:brds,shading:alt?{fill:LIGHT_GRAY,type:ShadingType.CLEAR}:undefined,verticalAlign:VerticalAlign.CENTER,margins:{top:40,bottom:40,left:40,right:40},children:[new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:0},children:[new TextRun({text:epMark,font:'Arial',size:17,color:'3b82f6'})]})]}),
                        new TableCell({width:{size:wNI,type:WidthType.DXA},borders:brds,shading:alt?{fill:LIGHT_GRAY,type:ShadingType.CLEAR}:undefined,verticalAlign:VerticalAlign.CENTER,margins:{top:40,bottom:40,left:40,right:40},children:[new Paragraph({alignment:AlignmentType.CENTER,spacing:{before:0,after:0},children:[new TextRun({text:niMark,font:'Arial',size:17,color:'888888'})]})]})
                    ]}));
                    ri++;
                });

                children.push(new Table({width:{size:CW,type:WidthType.DXA},columnWidths:evalColWidths,rows:[evalHeader,...evalRows]}));
            });

            // Build document
            const doc=new Document({
                styles:{default:{document:{run:{font:'Arial',size:18}}}},
                sections:[{
                    properties:{page:{size:{width:11906,height:16838},margin:{top:1134,right:1134,bottom:1134,left:1134}}},
                    headers:{default:new Header({children:[new Paragraph({alignment:AlignmentType.RIGHT,children:[new TextRun({text:'Programaciones - '+tituloMes,font:'Arial',size:14,color:'999999',italics:true})]})]})},
                    footers:{default:new Footer({children:[new Paragraph({alignment:AlignmentType.CENTER,children:[new TextRun({text:'P\u00E1gina ',font:'Arial',size:14,color:'999999'}),new TextRun({children:[PageNumber.CURRENT],font:'Arial',size:14,color:'999999'})]})]})},
                    children:children
                }]
            });

            Packer.toBlob(doc).then(blob=>{
                const url=URL.createObjectURL(blob);
                const a2=document.createElement('a');
                a2.href=url;
                a2.download='Programaciones_'+(mesSeleccionado===-1?'Curso':MESES[mesSeleccionado].nombre)+'.docx';
                a2.click();
                URL.revokeObjectURL(url);
                toast('Word descargado \u2713','success');
            }).catch(e=>{console.error(e);toast('Error al generar Word','error');});
            cerrarModal('modalImprimir');
        }

        // UTILIDADES
        function abrirModal(id){document.getElementById(id).classList.add('active');}
        function cerrarModal(id){document.getElementById(id).classList.remove('active');}
        function toast(msg,tipo){const t=document.getElementById('toast');t.textContent=msg;t.className='toast '+(tipo||'');setTimeout(()=>{t.classList.add('show');},10);setTimeout(()=>{t.classList.remove('show');},2500);}
    </script>
</body>
</html>